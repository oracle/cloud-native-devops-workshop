/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
/*! jQuery v1.9.1 | (c) 2005, 2012 jQuery Foundation, Inc. | jquery.org/license
*/(function(e,t){var n,r,i=typeof t,o=e.document,a=e.location,s=e.jQuery,u=e.$,l={},c=[],p="1.9.1",f=c.concat,d=c.push,h=c.slice,g=c.indexOf,m=l.toString,y=l.hasOwnProperty,v=p.trim,b=function(e,t){return new b.fn.init(e,t,r)},x=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,w=/\S+/g,T=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,k=/^[\],:{}\s]*$/,E=/(?:^|:|,)(?:\s*\[)+/g,S=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,j=/^-ms-/,D=/-([\da-z])/gi,L=function(e,t){return t.toUpperCase()},H=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(q(),b.ready())},q=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",H,!1),e.removeEventListener("load",H,!1)):(o.detachEvent("onreadystatechange",H),e.detachEvent("onload",H))};b.fn=b.prototype={jquery:p,constructor:b,init:function(e,n,r){var i,a;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),C.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(a=o.getElementById(i[2]),a&&a.parentNode){if(a.id!==i[2])return r.find(e);this.length=1,this[0]=a}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return h.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(h.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||b.isFunction(s)||(s={}),l===u&&(s=this,--u);l>u;u++)if(null!=(o=arguments[u]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,a=e&&b.isArray(e)?e:[]):a=e&&b.isPlainObject(e)?e:{},s[i]=b.extend(c,a,r)):r!==t&&(s[i]=r));return s},b.extend({noConflict:function(t){return e.$===b&&(e.$=u),t&&e.jQuery===b&&(e.jQuery=s),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!o.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(o,[b]),b.fn.trigger&&b(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||y.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=C.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&k.test(n.replace(S,"@").replace(A,"]").replace(E,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(j,"ms-").replace(D,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:v&&!v.call("\ufeff\u00a0")?function(e){return null==e?"":v.call(e)}:function(e){return null==e?"":(e+"").replace(T,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?b.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(g)return g.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else while(n[o]!==t)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return f.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),b.isFunction(e)?(r=h.call(arguments,2),i=function(){return e.apply(n||this,r.concat(h.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,o,a,s){var u=0,l=e.length,c=null==r;if("object"===b.type(r)){o=!0;for(u in r)b.access(e,n,u,r[u],!0,a,s)}else if(i!==t&&(o=!0,b.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(b(e),n)})),n))for(;l>u;u++)n(e[u],r,s?i:i.call(e[u],u,n(e[u],r)));return o?e:c?n.call(e):l?n(e[0],r):a},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===o.readyState)setTimeout(b.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",H,!1),e.addEventListener("load",H,!1);else{o.attachEvent("onreadystatechange",H),e.attachEvent("onload",H);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function a(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(a,50)}q(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=b(o);var _={};function F(e){var t=_[e]={};return b.each(e.match(w)||[],function(e,n){t[n]=!0}),t}b.Callbacks=function(e){e="string"==typeof e?_[e]||F(e):b.extend({},e);var n,r,i,o,a,s,u=[],l=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=u.length,n=!0;u&&o>a;a++)if(u[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,u&&(l?l.length&&c(l.shift()):r?u=[]:p.disable())},p={add:function(){if(u){var t=u.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&p.has(n)||u.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=u.length:r&&(s=t,c(r))}return this},remove:function(){return u&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,u,r))>-1)u.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?b.inArray(e,u)>-1:!(!u||!u.length)},empty:function(){return u=[],this},disable:function(){return u=l=r=t,this},disabled:function(){return!u},lock:function(){return l=t,r||p.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!u||i&&!l||(n?l.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,o){var a=o[0],s=b.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=h.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,o=1===i?e:b.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?h.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,u,l;if(r>1)for(s=Array(r),u=Array(r),l=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(a(t,l,n)).fail(o.reject).progress(a(t,u,s)):--i;return i||o.resolveWith(l,n),o.promise()}}),b.support=function(){var t,n,r,a,s,u,l,c,p,f,d=o.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0],!n||!r||!n.length)return{};s=o.createElement("select"),l=s.appendChild(o.createElement("option")),a=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==d.className,leadingWhitespace:3===d.firstChild.nodeType,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!a.value,optSelected:l.selected,enctype:!!o.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===o.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!l.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}a=o.createElement("input"),a.setAttribute("value",""),t.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","t"),a.setAttribute("name","t"),u=o.createDocumentFragment(),u.appendChild(a),t.appendChecked=a.checked,t.checkClone=u.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;return d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip,b(function(){var n,r,a,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",u=o.getElementsByTagName("body")[0];u&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",u.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",a=d.getElementsByTagName("td"),a[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===a[0].offsetHeight,a[0].style.display="",a[1].style.display="none",t.reliableHiddenOffsets=p&&0===a[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===d.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==u.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(o.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(u.style.zoom=1)),u.removeChild(n),n=d=a=r=null)}),n=s=u=l=r=a=null,t}();var O=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,B=/([A-Z])/g;function P(e,n,r,i){if(b.acceptData(e)){var o,a,s=b.expando,u="string"==typeof n,l=e.nodeType,p=l?b.cache:e,f=l?e[s]:e[s]&&s;if(f&&p[f]&&(i||p[f].data)||!u||r!==t)return f||(l?e[s]=f=c.pop()||b.guid++:f=s),p[f]||(p[f]={},l||(p[f].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?p[f]=b.extend(p[f],n):p[f].data=b.extend(p[f].data,n)),o=p[f],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[b.camelCase(n)]=r),u?(a=o[n],null==a&&(a=o[b.camelCase(n)])):a=o,a}}function R(e,t,n){if(b.acceptData(e)){var r,i,o,a=e.nodeType,s=a?b.cache:e,u=a?e[b.expando]:b.expando;if(s[u]){if(t&&(o=n?s[u]:s[u].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in o?t=[t]:(t=b.camelCase(t),t=t in o?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete o[t[r]];if(!(n?$:b.isEmptyObject)(o))return}(n||(delete s[u].data,$(s[u])))&&(a?b.cleanData([e],!0):b.support.deleteExpando||s!=s.window?delete s[u]:s[u]=null)}}}b.extend({cache:{},expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!$(e)},data:function(e,t,n){return P(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return P(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,o=this[0],a=0,s=null;if(e===t){if(this.length&&(s=b.data(o),1===o.nodeType&&!b._data(o,"parsedAttrs"))){for(r=o.attributes;r.length>a;a++)i=r[a].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),W(o,i,s[i]));b._data(o,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?o?W(o,e,b.data(o,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});function W(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(B,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:O.test(r)?b.parseJSON(r):r}catch(o){}b.data(e,n,r)}else r=t}return r}function $(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),o=b._queueHooks(e,t),a=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=b.Deferred(),a=this,s=this.length,u=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--)r=b._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var I,z,X=/[\t\r\n]/g,U=/\r/g,V=/^(?:input|select|textarea|button|object)$/i,Y=/^(?:a|area)$/i,J=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,G=/^(?:checked|selected)$/i,Q=b.support.getSetAttribute,K=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,u="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(w)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var o,a=0,s=b(this),u=t,l=e.match(w)||[];while(o=l[a++])u=r?u:!s.hasClass(o),s[u?"addClass":"removeClass"](o)}else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=b.isFunction(e),this.each(function(n){var o,a=b(this);1===this.nodeType&&(o=i?e.call(this,n,a.val()):e,null==o?o="":"number"==typeof o?o+="":b.isArray(o)&&(o=b.map(o,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))});if(o)return r=b.valHooks[o.type]||b.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(U,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,u=0>i?s:o?i:0;for(;s>u;u++)if(n=r[u],!(!n.selected&&u!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var o,a,s,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return typeof e.getAttribute===i?b.prop(e,n,r):(a=1!==u||!b.isXMLDoc(e),a&&(n=n.toLowerCase(),o=b.attrHooks[n]||(J.test(n)?z:I)),r===t?o&&a&&"get"in o&&null!==(s=o.get(e,n))?s:(typeof e.getAttribute!==i&&(s=e.getAttribute(n)),null==s?t:s):null!==r?o&&a&&"set"in o&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(w);if(o&&1===e.nodeType)while(n=o[i++])r=b.propFix[n]||n,J.test(n)?!Q&&G.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!b.isXMLDoc(e),a&&(n=b.propFix[n]||n,o=b.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):V.test(e.nodeName)||Y.test(e.nodeName)&&e.href?0:t}}}}),z={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),o="boolean"==typeof r?K&&Q?null!=i:G.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return o&&o.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},K&&Q||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):I&&I.set(e,n,r)}}),Q||(I=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:I.get,set:function(e,t,n){I.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return!0}function ot(){return!1}b.event={global:{},add:function(e,n,r,o,a){var s,u,l,c,p,f,d,h,g,m,y,v=b._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=b.guid++),(u=v.events)||(u=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(w)||[""],l=n.length;while(l--)s=rt.exec(n[l])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),p=b.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=b.event.special[g]||{},d=b.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&b.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=u[g])||(h=u[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),b.event.global[g]=!0;e=null}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,p,f,d,h,g,m=b.hasData(e)&&b._data(e);if(m&&(c=m.events)){t=(t||"").match(w)||[""],l=t.length;while(l--)if(s=rt.exec(t[l])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=b.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=f.length;while(o--)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));u&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||b.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)b.event.remove(e,d+t[l],n,r,!0);b.isEmptyObject(c)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,a){var s,u,l,c,p,f,d,h=[i||o],g=y.call(n,"type")?n.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(l=f=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+b.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),u=0>g.indexOf(":")&&"on"+g,n=n[b.expando]?n:new b.Event(g,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),p=b.event.special[g]||{},a||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!a&&!p.noBubble&&!b.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(l=l.parentNode);l;l=l.parentNode)h.push(l),f=l;f===(i.ownerDocument||o)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((l=h[d++])&&!n.isPropagationStopped())n.type=d>1?c:p.bindType||g,s=(b._data(l,"events")||{})[n.type]&&b._data(l,"handle"),s&&s.apply(l,r),s=u&&l[u],s&&b.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault();if(n.type=g,!(a||n.isDefaultPrevented()||p._default&&p._default.apply(i.ownerDocument,r)!==!1||"click"===g&&b.nodeName(i,"a")||!b.acceptData(i)||!u||!i[g]||b.isWindow(i))){f=i[u],f&&(i[u]=null),b.event.triggered=g;try{i[g]()}catch(v){}b.event.triggered=t,f&&(i[u]=f)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,o,a,s=[],u=h.call(arguments),l=(b._data(this,"events")||{})[e.type]||[],c=b.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=b.event.handlers.call(this,e,l),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],a=0;u>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?b(r,this).index(l)>=0:b.find(r,this,null,[l]).length),o[r]&&o.push(i);o.length&&s.push({elem:l,handlers:o})}return n.length>u&&s.push({elem:this,handlers:n.slice(u)}),s},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new b.Event(a),t=r.length;while(t--)n=r[t],e[n]=a[n];return e.target||(e.target=a.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,u=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,a=i.documentElement,r=i.body,e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==o.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===o.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;
return(!i||i!==r&&!b.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return b().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){var n,r,i,o,a,s,u,l,c,p,f,d,h,g,m,y,v,x="sizzle"+-new Date,w=e.document,T={},N=0,C=0,k=it(),E=it(),S=it(),A=typeof t,j=1<<31,D=[],L=D.pop,H=D.push,q=D.slice,M=D.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},_="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=F.replace("w","w#"),B="([*^$|!~]?=)",P="\\["+_+"*("+F+")"+_+"*(?:"+B+_+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+_+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+P.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+_+"+|((?:^|[^\\\\])(?:\\\\.)*)"+_+"+$","g"),$=RegExp("^"+_+"*,"+_+"*"),I=RegExp("^"+_+"*([\\x20\\t\\r\\n\\f>+~])"+_+"*"),z=RegExp(R),X=RegExp("^"+O+"$"),U={ID:RegExp("^#("+F+")"),CLASS:RegExp("^\\.("+F+")"),NAME:RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:RegExp("^("+F.replace("w","w*")+")"),ATTR:RegExp("^"+P),PSEUDO:RegExp("^"+R),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+_+"*(even|odd|(([+-]|)(\\d*)n|)"+_+"*(?:([+-]|)"+_+"*(\\d+)|))"+_+"*\\)|)","i"),needsContext:RegExp("^"+_+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+_+"*((?:-\\d)?\\d*)"+_+"*\\)|)(?=[^-]|$)","i")},V=/[\x20\t\r\n\f]*[+~]/,Y=/^[^{]+\{\s*\[native code/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,G=/^(?:input|select|textarea|button)$/i,Q=/^h\d$/i,K=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{q.call(w.documentElement.childNodes,0)[0].nodeType}catch(nt){q=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}function rt(e){return Y.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[x]=!0,e}function at(e){var t=p.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function st(e,t,n,r){var i,o,a,s,u,l,f,g,m,v;if((t?t.ownerDocument||t:w)!==p&&c(t),t=t||p,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(!d&&!r){if(i=J.exec(e))if(a=i[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return n;if(o.id===a)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&y(t,o)&&o.id===a)return n.push(o),n}else{if(i[2])return H.apply(n,q.call(t.getElementsByTagName(e),0)),n;if((a=i[3])&&T.getByClassName&&t.getElementsByClassName)return H.apply(n,q.call(t.getElementsByClassName(a),0)),n}if(T.qsa&&!h.test(e)){if(f=!0,g=x,m=t,v=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){l=ft(e),(f=t.getAttribute("id"))?g=f.replace(K,"\\$&"):t.setAttribute("id",g),g="[id='"+g+"'] ",u=l.length;while(u--)l[u]=g+dt(l[u]);m=V.test(e)&&t.parentNode||t,v=l.join(",")}if(v)try{return H.apply(n,q.call(m.querySelectorAll(v),0)),n}catch(b){}finally{f||t.removeAttribute("id")}}}return wt(e.replace(W,"$1"),t,n,r)}a=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},c=st.setDocument=function(e){var n=e?e.ownerDocument||e:w;return n!==p&&9===n.nodeType&&n.documentElement?(p=n,f=n.documentElement,d=a(n),T.tagNameNoComments=at(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),T.attributes=at(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),T.getByClassName=at(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),T.getByName=at(function(e){e.id=x+0,e.innerHTML="<a name='"+x+"'></a><div name='"+x+"'></div>",f.insertBefore(e,f.firstChild);var t=n.getElementsByName&&n.getElementsByName(x).length===2+n.getElementsByName(x+0).length;return T.getIdNotName=!n.getElementById(x),f.removeChild(e),t}),i.attrHandle=at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==A&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},T.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==A&&!d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==A&&!d){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==A&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=T.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},i.find.NAME=T.getByName&&function(e,n){return typeof n.getElementsByName!==A?n.getElementsByName(name):t},i.find.CLASS=T.getByClassName&&function(e,n){return typeof n.getElementsByClassName===A||d?t:n.getElementsByClassName(e)},g=[],h=[":focus"],(T.qsa=rt(n.querySelectorAll))&&(at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||h.push("\\["+_+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||h.push(":checked")}),at(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&h.push("[*^$]="+_+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||h.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),h.push(",.*:")})),(T.matchesSelector=rt(m=f.matchesSelector||f.mozMatchesSelector||f.webkitMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&at(function(e){T.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),g.push("!=",R)}),h=RegExp(h.join("|")),g=RegExp(g.join("|")),y=rt(f.contains)||f.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},v=f.compareDocumentPosition?function(e,t){var r;return e===t?(u=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||y(w,e)?-1:t===n||y(w,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return u=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:0;if(o===a)return ut(e,t);r=e;while(r=r.parentNode)s.unshift(r);r=t;while(r=r.parentNode)l.unshift(r);while(s[i]===l[i])i++;return i?ut(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},u=!1,[0,0].sort(v),T.detectDuplicates=u,p):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&c(e),t=t.replace(Z,"='$1']"),!(!T.matchesSelector||d||g&&g.test(t)||h.test(t)))try{var n=m.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&c(e),y(e,t)},st.attr=function(e,t){var n;return(e.ownerDocument||e)!==p&&c(e),d||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):d||T.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},st.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],r=1,i=0;if(u=!T.detectDuplicates,e.sort(v),u){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e};function ut(e,t){var n=t&&e,r=n&&(~t.sourceIndex||j)-(~e.sourceIndex||j);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ot(function(t){return t=+t,ot(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},i=st.selectors={cacheLength:50,createPseudo:ot,match:U,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return U.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&z.test(n)&&(t=ft(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[e+" "];return t||(t=RegExp("(^|"+_+")"+e+"("+_+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!u&&!s;if(m){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[x]||(m[x]={}),l=c[e]||[],d=l[0]===N&&l[1],f=l[0]===N&&l[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[N,d,f];break}}else if(v&&(l=(t[x]||(t[x]={}))[e])&&l[0]===N)f=l[1];else while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[x]||(p[x]={}))[e]=[N,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[x]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){var i,o=r(e,t),a=o.length;while(a--)i=M.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=s(e.replace(W,"$1"));return r[x]?ot(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:ot(function(e){return function(t){return st(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ot(function(e){return X.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=d?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Q.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=lt(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=ct(n);function ft(e,t){var n,r,o,a,s,u,l,c=E[e+" "];if(c)return t?0:c.slice(0);s=e,u=[],l=i.preFilter;while(s){(!n||(r=$.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),u.push(o=[])),n=!1,(r=I.exec(s))&&(n=r.shift(),o.push({value:n,type:r[0].replace(W," ")}),s=s.slice(n.length));for(a in i.filter)!(r=U[a].exec(s))||l[a]&&!(r=l[a](r))||(n=r.shift(),o.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?st.error(e):E(e,u).slice(0)}function dt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function ht(e,t,n){var i=t.dir,o=n&&"parentNode"===i,a=C++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var u,l,c,p=N+" "+a;if(s){while(t=t[i])if((1===t.nodeType||o)&&e(t,n,s))return!0}else while(t=t[i])if(1===t.nodeType||o)if(c=t[x]||(t[x]={}),(l=c[i])&&l[0]===p){if((u=l[1])===!0||u===r)return u===!0}else if(l=c[i]=[p],l[1]=e(t,n,s)||r,l[1]===!0)return!0}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var o,a=[],s=0,u=e.length,l=null!=t;for(;u>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),l&&t.push(s));return a}function yt(e,t,n,r,i,o){return r&&!r[x]&&(r=yt(r)),i&&!i[x]&&(i=yt(i,o)),ot(function(o,a,s,u){var l,c,p,f=[],d=[],h=a.length,g=o||xt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:mt(g,f,e,s,u),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,u),r){l=mt(y,d),r(l,[],s,u),c=l.length;while(c--)(p=l[c])&&(y[d[c]]=!(m[d[c]]=p))}if(o){if(i||e){if(i){l=[],c=y.length;while(c--)(p=y[c])&&l.push(m[c]=p);i(null,y=[],l,u)}c=y.length;while(c--)(p=y[c])&&(l=i?M.call(o,p):f[c])>-1&&(o[l]=!(a[l]=p))}}else y=mt(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function vt(e){var t,n,r,o=e.length,a=i.relative[e[0].type],s=a||i.relative[" "],u=a?1:0,c=ht(function(e){return e===t},s,!0),p=ht(function(e){return M.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;o>u;u++)if(n=i.relative[e[u].type])f=[ht(gt(f),n)];else{if(n=i.filter[e[u].type].apply(null,e[u].matches),n[x]){for(r=++u;o>r;r++)if(i.relative[e[r].type])break;return yt(u>1&&gt(f),u>1&&dt(e.slice(0,u-1)).replace(W,"$1"),n,r>u&&vt(e.slice(u,r)),o>r&&vt(e=e.slice(r)),o>r&&dt(e))}f.push(n)}return gt(f)}function bt(e,t){var n=0,o=t.length>0,a=e.length>0,s=function(s,u,c,f,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,T=l,C=s||a&&i.find.TAG("*",d&&u.parentNode||u),k=N+=null==T?1:Math.random()||.1;for(w&&(l=u!==p&&u,r=n);null!=(h=C[b]);b++){if(a&&h){g=0;while(m=e[g++])if(m(h,u,c)){f.push(h);break}w&&(N=k,r=++n)}o&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,o&&b!==v){g=0;while(m=t[g++])m(x,y,u,c);if(s){if(v>0)while(b--)x[b]||y[b]||(y[b]=L.call(f));y=mt(y)}H.apply(f,y),w&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(f)}return w&&(N=k,l=T),x};return o?ot(s):s}s=st.compile=function(e,t){var n,r=[],i=[],o=S[e+" "];if(!o){t||(t=ft(e)),n=t.length;while(n--)o=vt(t[n]),o[x]?r.push(o):i.push(o);o=S(e,bt(i,r))}return o};function xt(e,t,n){var r=0,i=t.length;for(;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r){var o,a,u,l,c,p=ft(e);if(!r&&1===p.length){if(a=p[0]=p[0].slice(0),a.length>2&&"ID"===(u=a[0]).type&&9===t.nodeType&&!d&&i.relative[a[1].type]){if(t=i.find.ID(u.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(a.shift().value.length)}o=U.needsContext.test(e)?0:a.length;while(o--){if(u=a[o],i.relative[l=u.type])break;if((c=i.find[l])&&(r=c(u.matches[0].replace(et,tt),V.test(a[0].type)&&t.parentNode||t))){if(a.splice(o,1),e=r.length&&dt(a),!e)return H.apply(n,q.call(r,0)),n;break}}}return s(e,p)(r,t,d,n,V.test(e)),n}i.pseudos.nth=i.pseudos.eq;function Tt(){}i.filters=Tt.prototype=i.pseudos,i.setFilters=new Tt,c(),st.attr=b.attr,b.find=st,b.expr=st.selectors,b.expr[":"]=b.expr.pseudos,b.unique=st.uniqueSort,b.text=st.getText,b.isXMLDoc=st.isXML,b.contains=st.contains}(e);var at=/Until$/,st=/^(?:parents|prev(?:Until|All))/,ut=/^.[^:#\[\.,]*$/,lt=b.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1))},filter:function(e){return this.pushStack(ft(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?lt.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,o=[],a=lt.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(a?a.index(n)>-1:b.find.matchesSelector(n,e)){o.push(n);break}n=n.parentNode}}return this.pushStack(o.length>1?b.unique(o):o)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack;function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return at.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!ct[e]?b.unique(i):i,this.length>1&&st.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!b(o).is(r)))1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ft(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(ut.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Nt=/^(?:checkbox|radio)$/i,Ct=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(o),Dt=jt.appendChild(o.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(Ot(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Mt(Ot(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(Ot(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(Ot(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=f.apply([],e);var i,o,a,s,u,l,c=0,p=this.length,d=this,h=p-1,g=e[0],m=b.isFunction(g);if(m||!(1>=p||"string"!=typeof g||b.support.checkClone)&&Ct.test(g))return this.each(function(i){var o=d.eq(i);m&&(e[0]=g.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(p&&(l=b.buildFragment(e,this[0].ownerDocument,!1,this),i=l.firstChild,1===l.childNodes.length&&(l=i),i)){for(n=n&&b.nodeName(i,"tr"),s=b.map(Ot(l,"script"),Ht),a=s.length;p>c;c++)o=l,c!==h&&(o=b.clone(o,!0,!0),a&&b.merge(s,Ot(o,"script"))),r.call(n&&b.nodeName(this[c],"table")?Lt(this[c],"tbody"):this[c],o,c);if(a)for(u=s[s.length-1].ownerDocument,b.map(s,qt),c=0;a>c;c++)o=s[c],kt.test(o.type||"")&&!b._data(o,"globalEval")&&b.contains(u,o)&&(o.src?b.ajax({url:o.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((o.text||o.textContent||o.innerHTML||"").replace(St,"")));l=i=null}return this}});function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function Ht(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Mt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function _t(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,o=b._data(e),a=b._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)b.event.add(t,n,s[n][r])}a.data&&(a.data=b.extend({},a.data))}}function Ft(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Nt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],o=b(e),a=o.length-1;for(;a>=r;r++)n=r===a?this:this.clone(!0),b(o[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}});function Ot(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||b.nodeName(o,n)?s.push(o):b.merge(s,Ot(o,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],s):s}function Bt(e){Nt.test(e.type)&&(e.defaultChecked=e.checked)}b.extend({clone:function(e,t,n){var r,i,o,a,s,u=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=Ot(o),s=Ot(e),a=0;null!=(i=s[a]);++a)r[a]&&Ft(i,r[a]);if(t)if(n)for(s=s||Ot(e),r=r||Ot(o),a=0;null!=(i=s[a]);a++)_t(i,r[a]);else _t(e,o);return r=Ot(o,"script"),r.length>0&&Mt(r,!u&&Ot(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,u,l,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++)if(o=e[h],o||0===o)if("object"===b.type(o))b.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),u=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[u]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--)s=s.lastChild;if(!b.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!b.support.tbody){o="table"!==u||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--)b.nodeName(l=o.childNodes[i],"tbody")&&!l.childNodes.length&&o.removeChild(l)
}b.merge(d,s.childNodes),s.textContent="";while(s.firstChild)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));s&&f.removeChild(s),b.support.appendChecked||b.grep(Ot(d,"input"),Bt),h=0;while(o=d[h++])if((!r||-1===b.inArray(o,r))&&(a=b.contains(o.ownerDocument,o),s=Ot(f.appendChild(o),"script"),a&&Mt(s),n)){i=0;while(o=s[i++])kt.test(o.type||"")&&n.push(o)}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,u=b.expando,l=b.cache,p=b.support.deleteExpando,f=b.event.special;for(;null!=(n=e[s]);s++)if((t||b.acceptData(n))&&(o=n[u],a=o&&l[o])){if(a.events)for(r in a.events)f[r]?b.event.remove(n,r):b.removeEvent(n,r,a.handle);l[o]&&(delete l[o],p?delete n[u]:typeof n.removeAttribute!==i?n.removeAttribute(u):n[u]=null,c.push(o))}}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+x+")(.*)$","i"),Yt=RegExp("^("+x+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+x+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++)r=e[a],r.style&&(o[a]=b._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=b._data(r,"olddisplay",un(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,o,a={},s=0;if(b.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=b.css(e,n[s],!1,o);return a}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,u=b.camelCase(n),l=e.style;if(n=b.cssProps[u]||(b.cssProps[u]=tn(l,u)),s=b.cssHooks[n]||b.cssHooks[u],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:l[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(b.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||b.cssNumber[u]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{l[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,u=b.camelCase(n);return n=b.cssProps[u]||(b.cssProps[u]=tn(e.style,u)),s=b.cssHooks[n]||b.cssHooks[u],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||b.isNumeric(o)?o||0:a):a},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||b.contains(e.ownerDocument,e)||(u=b.style(e,n)),Yt.test(u)&&Ut.test(n)&&(i=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=i,l.minWidth=o,l.maxWidth=a)),u}):o.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),u=s?s[n]:t,l=e.style;return null==u&&l&&l[n]&&(u=l[n]),Yt.test(u)&&!zt.test(n)&&(i=l.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),l.left="fontSize"===n?"1em":u,u=l.pixelLeft+"px",l.left=i,a&&(o.left=a)),""===u?"auto":u});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2)"margin"===n&&(a+=b.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=b.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=b.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=b.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=b.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function un(e){var t=o,n=Gt[e];return n||(n=ln(e,t),"none"!==n&&n||(Pt=(Pt||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=ln(e,t),Pt.detach()),Gt[e]=n),n}function ln(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(b.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Nt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],o=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,yn,vn=b.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Nn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Cn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=b.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=a.href}catch(Ln){yn=o.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(w)||[];if(b.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){var o={},a=e===jn;function s(u){var l;return o[u]=!0,b.each(e[u]||[],function(e,u){var c=u(n,r,i);return"string"!=typeof c||a||o[c]?a?!(l=c):t:(n.dataTypes.unshift(c),s(c),!1)}),l}return s(n.dataTypes[0])||!o["*"]&&s("*")}function Mn(e,n){var r,i,o=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}b.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u,e.length),e=e.slice(0,u)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&b.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,o){return b.isFunction(r)&&(o=o||i,i=r,r=t),b.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Nn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Mn(Mn(e,b.ajaxSettings),t):Mn(b.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,u,l,c,p=b.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?b(f):b.event,h=b.Deferred(),g=b.Callbacks("once memory"),m=p.statusCode||{},y={},v={},x=0,T="canceled",N={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!c){c={};while(t=Tn.exec(a))c[t[1].toLowerCase()]=t[2]}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)m[t]=[m[t],e[t]];else N.always(e[N.status]);return this},abort:function(e){var t=e||T;return l&&l.abort(t),k(0,t),this}};if(h.promise(N).complete=g.add,N.success=N.done,N.error=N.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=b.trim(p.dataType||"*").toLowerCase().match(w)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=b.param(p.data,p.traditional)),qn(An,p,n,N),2===x)return N;u=p.global,u&&0===b.active++&&b.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Cn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(b.lastModified[o]&&N.setRequestHeader("If-Modified-Since",b.lastModified[o]),b.etag[o]&&N.setRequestHeader("If-None-Match",b.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&N.setRequestHeader("Content-Type",p.contentType),N.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)N.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,N,p)===!1||2===x))return N.abort();T="abort";for(i in{success:1,error:1,complete:1})N[i](p[i]);if(l=qn(jn,p,n,N)){N.readyState=1,u&&d.trigger("ajaxSend",[N,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){N.abort("timeout")},p.timeout));try{x=1,l.send(y,k)}catch(C){if(!(2>x))throw C;k(-1,C)}}else k(-1,"No Transport");function k(e,n,r,i){var c,y,v,w,T,C=n;2!==x&&(x=2,s&&clearTimeout(s),l=t,a=i||"",N.readyState=e>0?4:0,r&&(w=_n(p,N,r)),e>=200&&300>e||304===e?(p.ifModified&&(T=N.getResponseHeader("Last-Modified"),T&&(b.lastModified[o]=T),T=N.getResponseHeader("etag"),T&&(b.etag[o]=T)),204===e?(c=!0,C="nocontent"):304===e?(c=!0,C="notmodified"):(c=Fn(p,w),C=c.state,y=c.data,v=c.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),N.status=e,N.statusText=(n||C)+"",c?h.resolveWith(f,[y,C,N]):h.rejectWith(f,[N,C,v]),N.statusCode(m),m=t,u&&d.trigger(c?"ajaxSuccess":"ajaxError",[N,p,c?y:v]),g.fireWith(f,[N,C]),u&&(d.trigger("ajaxComplete",[N,p]),--b.active||b.event.trigger("ajaxStop")))}return N},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}});function _n(e,n,r){var i,o,a,s,u=e.contents,l=e.dataTypes,c=e.responseFields;for(s in c)s in r&&(n[c[s]]=r[s]);while("*"===l[0])l.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in u)if(u[s]&&u[s].test(o)){l.unshift(s);break}if(l[0]in r)a=l[0];else{for(s in r){if(!l[0]||e.converters[s+" "+l[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==l[0]&&l.unshift(a),r[a]):t}function Fn(e,t){var n,r,i,o,a={},s=0,u=e.dataTypes.slice(),l=u[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u[1])for(i in e.converters)a[i.toLowerCase()]=e.converters[i];for(;r=u[++s];)if("*"!==r){if("*"!==l&&l!==r){if(i=a[l+" "+r]||a["* "+r],!i)for(n in a)if(o=n.split(" "),o[1]===r&&(i=a[l+" "+o[0]]||a["* "+o[0]])){i===!0?i=a[n]:a[n]!==!0&&(r=o[0],u.splice(s--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+l+" to "+r}}}l=r}return{state:"success",data:t}}b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||b("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var On=[],Bn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=On.pop()||b.expando+"_"+vn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,u=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||b.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,On.push(o)),s&&b.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=b.ajaxSettings.xhr(),b.support.cors=!!Rn&&"withCredentials"in Rn,Rn=b.support.ajax=!!Rn,Rn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,o){var a,s,u=n.xhr();if(n.username?u.open(n.type,n.url,n.async,n.username,n.password):u.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)u[s]=n.xhrFields[s];n.mimeType&&u.overrideMimeType&&u.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)u.setRequestHeader(s,i[s])}catch(l){}u.send(n.hasContent&&n.data||null),r=function(e,i){var s,l,c,p;try{if(r&&(i||4===u.readyState))if(r=t,a&&(u.onreadystatechange=b.noop,$n&&delete Pn[a]),i)4!==u.readyState&&u.abort();else{p={},s=u.status,l=u.getAllResponseHeaders(),"string"==typeof u.responseText&&(p.text=u.responseText);try{c=u.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,l)},n.async?4===u.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},b(e).unload($n)),Pn[a]=r),u.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+x+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=Yn.exec(t),a=i.cur(),s=+a||0,u=1,l=20;if(o){if(n=+o[2],r=o[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&s){s=b.css(i.elem,e,!0)||n||1;do u=u||".5",s/=u,b.style(i.elem,e,s+r);while(u!==(u=i.cur()/a)&&1!==u&&--l)}i.unit=r,i.start=s,i.end=o[1]?s+(o[1]+1)*n:n}return i}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Qn[t]||[]).concat(Qn["*"]),i=0,o=r.length;for(;o>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,o=0,a=Gn.length,s=b.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;var t=Xn||Kn(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,a=0,u=l.tweens.length;for(;u>a;a++)l.tweens[a].run(o);return s.notifyWith(e,[l,o,n]),1>o&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(tr(c,l.opts.specialEasing);a>o;o++)if(r=Gn[o].call(l,e,c,l.opts))return r;return Zn(l,c),b.isFunction(l.opts.start)&&l.opts.start.call(e,l),b.fx.timer(b.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function tr(e,t){var n,r,i,o,a;for(i in e)if(r=b.camelCase(i),o=t[r],n=e[i],b.isArray(n)&&(o=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),a=b.cssHooks[r],a&&"expand"in a){n=a.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=o)}else t[r]=o}b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,u,l,c,p,f=this,d=e.style,h={},g=[],m=e.nodeType&&nn(e);n.queue||(c=b._queueHooks(e,"fx"),null==c.unqueued&&(c.unqueued=0,p=c.empty.fire,c.empty.fire=function(){c.unqueued||p()}),c.unqueued++,f.always(function(){f.always(function(){c.unqueued--,b.queue(e,"fx").length||c.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==un(e.nodeName)?d.zoom=1:d.display="inline-block")),n.overflow&&(d.overflow="hidden",b.support.shrinkWrapBlocks||f.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(i in t)if(a=t[i],Vn.exec(a)){if(delete t[i],u=u||"toggle"===a,a===(m?"hide":"show"))continue;g.push(i)}if(o=g.length){s=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in s&&(m=s.hidden),u&&(s.hidden=!m),m?b(e).show():f.done(function(){b(e).hide()}),f.done(function(){var t;b._removeData(e,"fxshow");for(t in h)b.style(e,t,h[t])});for(i=0;o>i;i++)r=g[i],l=f.createTween(r,m?s[r]:0),h[r]=s[r]||b.style(e,r),r in s||(s[r]=l.start,m&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),o=b.speed(t,n,r),a=function(){var t=er(this,b.extend({},e),o);a.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=b.timers,a=b._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=b.timers,a=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Un||(Un=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Un),Un=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s)return n=s.documentElement,b.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),o=i.offset(),a=b.css(e,"top"),s=b.css(e,"left"),u=("absolute"===r||"fixed"===r)&&b.inArray("auto",[a,s])>-1,l={},c={},p,f;u?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),b.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(l.top=t.top-o.top+p),null!=t.left&&(l.left=t.left-o.left+f),"using"in t?t.using.call(e,l):i.css(l)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||o.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position"))e=e.offsetParent;return e||o.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?b(a).scrollLeft():o,r?o:b(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return b.access(this,function(n,r,i){var o;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?b.css(n,r,s):b.style(n,r,i,s)},n,a?i:t,a,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window);/*! Copyright (c) 2013 Brandon Aaron (http://brandon.aaron.sh)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version: 3.1.12
 *
 * Requires: jQuery 1.2.2+
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});(function(k){function n(c,a){k.ajax({url:c,async:!1,cache:a.cache,contentType:"text/plain;charset="+a.encoding,dataType:"text",success:function(b){r(b,a.mode)}})}function r(c,a){for(var b="",e=c.split(/\n/),d=/(\{\d+\})/g,q=/\{(\d+)\}/g,m=/(\\u.{4})/ig,f=0;f<e.length;f++)if(e[f]=e[f].replace(/^\s\s*/,"").replace(/\s\s*$/,""),e[f].length>0&&e[f].match("^#")!="#"){var g=e[f].split("=");if(g.length>0){for(var o=unescape(g[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),h=g.length==1?"":g[1];h.match(/\\$/)==
"\\";)h=h.substring(0,h.length-1),h+=e[++f].replace(/\s\s*$/,"");for(var l=2;l<g.length;l++)h+="="+g[l];h=h.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(a=="map"||a=="both"){if(g=h.match(m))for(l=0;l<g.length;l++)h=h.replace(g[l],s(g[l]));k.i18n.map[o]=h}if(a=="vars"||a=="both")if(h=h.replace(/"/g,'\\"'),t(o),d.test(h)){for(var g=h.split(d),l=!0,j="",n=[],p=0;p<g.length;p++)if(d.test(g[p])&&(n.length==0||n.indexOf(g[p])==-1))l||(j+=","),j+=g[p].replace(q,"v$1"),n.push(g[p]),l=!1;b+=o+"=function("+
j+"){";o='"'+h.replace(q,'"+v$1+"')+'"';b+="return "+o+";};"}else b+=o+'="'+h+'";'}}eval(b)}function t(c){if(/\./.test(c))for(var a="",c=c.split(/\./),b=0;b<c.length;b++)b>0&&(a+="."),a+=c[b],eval("typeof "+a+' == "undefined"')&&eval(a+"={};")}function s(c){var a=[],c=parseInt(c.substr(2),16);c>=0&&c<Math.pow(2,16)&&a.push(c);for(var c="",b=0;b<a.length;++b)c+=String.fromCharCode(a[b]);return c}k.i18n={};k.i18n.map={};k.i18n.properties=function(c){c=k.extend({name:"Messages",language:"",path:"",mode:"vars",
cache:!1,encoding:"UTF-8",callback:null},c);if(c.language===null||c.language=="")c.language=k.i18n.browserLang();if(c.language===null)c.language="";var a=c.name&&c.name.constructor==Array?c.name:[c.name];for(i=0;i<a.length;i++)n(c.path+a[i]+".properties",c),c.language.length>=2&&n(c.path+a[i]+"_"+c.language.substring(0,2)+".properties",c),c.language.length>=5&&n(c.path+a[i]+"_"+c.language.substring(0,5)+".properties",c);c.callback&&c.callback()};k.i18n.prop=function(c){var a=k.i18n.map[c];if(a==null)return"["+
c+"]";var b;if(typeof a=="string"){for(b=0;(b=a.indexOf("\\",b))!=-1;)a=a[b+1]=="t"?a.substring(0,b)+"\t"+a.substring(b++ +2):a[b+1]=="r"?a.substring(0,b)+"\r"+a.substring(b++ +2):a[b+1]=="n"?a.substring(0,b)+"\n"+a.substring(b++ +2):a[b+1]=="f"?a.substring(0,b)+"\u000c"+a.substring(b++ +2):a[b+1]=="\\"?a.substring(0,b)+"\\"+a.substring(b++ +2):a.substring(0,b)+a.substring(b+1);var e=[],d,j;for(b=0;b<a.length;)if(a[b]=="'")if(b==a.length-1)a=a.substring(0,b);else if(a[b+1]=="'")a=a.substring(0,b)+
a.substring(++b);else{for(d=b+2;(d=a.indexOf("'",d))!=-1;)if(d==a.length-1||a[d+1]!="'"){a=a.substring(0,b)+a.substring(b+1,d)+a.substring(d+1);b=d-1;break}else a=a.substring(0,d)+a.substring(++d);d==-1&&(a=a.substring(0,b)+a.substring(b+1))}else if(a[b]=="{")if(d=a.indexOf("}",b+1),d==-1)b++;else if(j=parseInt(a.substring(b+1,d)),!isNaN(j)&&j>=0){var m=a.substring(0,b);m!=""&&e.push(m);e.push(j);b=0;a=a.substring(d+1)}else b=d+1;else b++;a!=""&&e.push(a);a=e;k.i18n.map[c]=e}if(a.length==0)return"";
if(a.lengh==1&&typeof a[0]=="string")return a[0];m="";for(b=0;b<a.length;b++)m+=typeof a[b]=="string"?a[b]:a[b]+1<arguments.length?arguments[a[b]+1]:"{"+a[b]+"}";return m};k.i18n.browserLang=function(){var c=navigator.language||navigator.userLanguage,c=c.toLowerCase();c.length>3&&(c=c.substring(0,3)+c.substring(3).toUpperCase());return c};var j;if(!j)j=function(c,a,b){if(Object.prototype.toString.call(a)!=="[object RegExp]")return typeof j._nativeSplit=="undefined"?c.split(a,b):j._nativeSplit.call(c,
a,b);var e=[],d=0,k=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.sticky?"y":""),a=RegExp(a.source,k+"g"),m,f,g;c+="";j._compliantExecNpcg||(m=RegExp("^"+a.source+"$(?!\\s)",k));if(b===void 0||+b<0)b=Infinity;else if(b=Math.floor(+b),!b)return[];for(;f=a.exec(c);){k=f.index+f[0].length;if(k>d&&(e.push(c.slice(d,f.index)),!j._compliantExecNpcg&&f.length>1&&f[0].replace(m,function(){for(var a=1;a<arguments.length-2;a++)arguments[a]===void 0&&(f[a]=void 0)}),f.length>1&&f.index<c.length&&Array.prototype.push.apply(e,
f.slice(1)),g=f[0].length,d=k,e.length>=b))break;a.lastIndex===f.index&&a.lastIndex++}d===c.length?(g||!a.test(""))&&e.push(""):e.push(c.slice(d));return e.length>b?e.slice(0,b):e},j._compliantExecNpcg=/()??/.exec("")[1]===void 0,j._nativeSplit=String.prototype.split;String.prototype.split=function(c,a){return j(this,c,a)}})(jQuery);/*! jQuery plugin for Hammer.JS - v1.1.2 - 2014-04-25
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */

!function(a,b){"use strict";function c(){e.READY||(t.determineEventTypes(),s.each(e.gestures,function(a){v.register(a)}),t.onTouch(e.DOCUMENT,o,v.detect),t.onTouch(e.DOCUMENT,p,v.detect),e.READY=!0)}function d(a,c){Date.now||(Date.now=function(){return(new Date).getTime()}),a.utils.each(["on","off"],function(d){a.utils[d]=function(a,e,f){c(a)[d](e,function(a){var d=c.extend({},a.originalEvent,a);d.button===b&&(d.button=a.which-1),f.call(this,d)})}}),a.Instance.prototype.trigger=function(a,b){var d=c(this.element);return d.has(b.target).length&&(d=c(b.target)),d.trigger({type:a,gesture:b})},c.fn.hammer=function(b){return this.each(function(){var d=c(this),e=d.data("hammer");e?e&&b&&a.utils.extend(e.options,b):d.data("hammer",new a(this,b||{}))})}}var e=function w(a,b){return new w.Instance(a,b||{})};e.VERSION="1.1.2",e.defaults={behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},e.DOCUMENT=document,e.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,e.HAS_TOUCHEVENTS="ontouchstart"in a,e.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),e.NO_MOUSEEVENTS=e.HAS_TOUCHEVENTS&&e.IS_MOBILE||e.HAS_POINTEREVENTS,e.CALCULATE_INTERVAL=25;var f={},g=e.DIRECTION_DOWN="down",h=e.DIRECTION_LEFT="left",i=e.DIRECTION_UP="up",j=e.DIRECTION_RIGHT="right",k=e.POINTER_MOUSE="mouse",l=e.POINTER_TOUCH="touch",m=e.POINTER_PEN="pen",n=e.EVENT_START="start",o=e.EVENT_MOVE="move",p=e.EVENT_END="end",q=e.EVENT_RELEASE="release",r=e.EVENT_TOUCH="touch";e.READY=!1,e.plugins=e.plugins||{},e.gestures=e.gestures||{};var s=e.utils={extend:function(a,c,d){for(var e in c)!c.hasOwnProperty(e)||a[e]!==b&&d||(a[e]=c[e]);return a},on:function(a,b,c){a.addEventListener(b,c,!1)},off:function(a,b,c){a.removeEventListener(b,c,!1)},each:function(a,c,d){var e,f;if("forEach"in a)a.forEach(c,d);else if(a.length!==b){for(e=0,f=a.length;f>e;e++)if(c.call(d,a[e],e,a)===!1)return}else for(e in a)if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1)return},inStr:function(a,b){return a.indexOf(b)>-1},inArray:function(a,b){if(a.indexOf){var c=a.indexOf(b);return-1===c?!1:c}for(var d=0,e=a.length;e>d;d++)if(a[d]===b)return d;return!1},toArray:function(a){return Array.prototype.slice.call(a,0)},hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){var b=[],c=[],d=[],e=[],f=Math.min,g=Math.max;return 1===a.length?{pageX:a[0].pageX,pageY:a[0].pageY,clientX:a[0].clientX,clientY:a[0].clientY}:(s.each(a,function(a){b.push(a.pageX),c.push(a.pageY),d.push(a.clientX),e.push(a.clientY)}),{pageX:(f.apply(Math,b)+g.apply(Math,b))/2,pageY:(f.apply(Math,c)+g.apply(Math,c))/2,clientX:(f.apply(Math,d)+g.apply(Math,d))/2,clientY:(f.apply(Math,e)+g.apply(Math,e))/2})},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.clientX-a.clientX,d=b.clientY-a.clientY;return 180*Math.atan2(d,c)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.clientX-b.clientX),d=Math.abs(a.clientY-b.clientY);return c>=d?a.clientX-b.clientX>0?h:j:a.clientY-b.clientY>0?i:g},getDistance:function(a,b){var c=b.clientX-a.clientX,d=b.clientY-a.clientY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==i||a==g},setPrefixedCss:function(a,b,c,d){var e=["","Webkit","Moz","O","ms"];b=s.toCamelCase(b);for(var f=0;f<e.length;f++){var g=b;if(e[f]&&(g=e[f]+g.slice(0,1).toUpperCase()+g.slice(1)),g in a.style){a.style[g]=(null==d||d)&&c||"";break}}},toggleBehavior:function(a,b,c){if(b&&a&&a.style){s.each(b,function(b,d){s.setPrefixedCss(a,d,b,c)});var d=c&&function(){return!1};"none"==b.userSelect&&(a.onselectstart=d),"none"==b.userDrag&&(a.ondragstart=d)}},toCamelCase:function(a){return a.replace(/[_-]([a-z])/g,function(a){return a[1].toUpperCase()})}};e.Instance=function(a,b){var d=this;c(),this.element=a,this.enabled=!0,s.each(b,function(a,c){delete b[c],b[s.toCamelCase(c)]=a}),this.options=s.extend(s.extend({},e.defaults),b||{}),this.options.behavior&&s.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=t.onTouch(a,n,function(a){d.enabled&&a.eventType==n?v.startDetect(d,a):a.eventType==r&&v.detect(a)}),this.eventHandlers=[]},e.Instance.prototype={on:function(a,b){var c=this;return t.on(c.element,a,b,function(a){c.eventHandlers.push({gesture:a,handler:b})}),c},off:function(a,b){var c=this;return t.off(c.element,a,b,function(a){var d=s.inArray({gesture:a,handler:b});d!==!1&&c.eventHandlers.splice(d,1)}),c},trigger:function(a,b){b||(b={});var c=e.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var d=this.element;return s.hasParent(b.target,d)&&(d=b.target),d.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this},dispose:function(){var a,b;for(s.toggleBehavior(this.element,this.options.behavior,!1),a=-1;b=this.eventHandlers[++a];)s.off(this.element,b.gesture,b.handler);return this.eventHandlers=[],t.off(this.element,f[n],this.eventStartHandler),null}};var t=e.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(a,b,c,d){var e=b.split(" ");s.each(e,function(b){s.on(a,b,c),d&&d(b)})},off:function(a,b,c,d){var e=b.split(" ");s.each(e,function(b){s.off(a,b,c),d&&d(b)})},onTouch:function(a,b,c){var d=this,e=function(e){var f,g=e.type.toLowerCase(),h=s.inStr(g,"pointer"),i=s.inStr(g,"mouse");i&&d.preventMouseEvents||(i&&b==n&&0===e.button?(d.preventMouseEvents=!1,d.shouldDetect=!0):h&&b==n?d.shouldDetect=1===e.buttons:i||b!=n||(d.preventMouseEvents=!0,d.shouldDetect=!0),h&&b!=p&&u.updatePointer(b,e),d.shouldDetect&&(f=d.doDetect.call(d,e,b,a,c)),f==p&&(d.preventMouseEvents=!1,d.shouldDetect=!1,u.reset()),h&&b==p&&u.updatePointer(b,e))};return this.on(a,f[b],e),e},doDetect:function(a,b,c,d){var e=this.getTouchList(a,b),f=e.length,g=b,h=e.trigger,i=f;b==n?h=r:b==p&&(h=q,i=e.length-(a.changedTouches?a.changedTouches.length:1)),i>0&&this.started&&(g=o),this.started=!0;var j=this.collectEventData(c,g,e,a);return b!=p&&d.call(v,j),h&&(j.changedLength=i,j.eventType=h,d.call(v,j),j.eventType=g,delete j.changedLength),g==p&&(d.call(v,j),this.started=!1),g},determineEventTypes:function(){var b;return b=e.HAS_POINTEREVENTS?a.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:e.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],f[n]=b[0],f[o]=b[1],f[p]=b[2],f},getTouchList:function(a,b){if(e.HAS_POINTEREVENTS)return u.getTouchList();if(a.touches){if(b==o)return a.touches;var c=[],d=[].concat(s.toArray(a.touches),s.toArray(a.changedTouches)),f=[];return s.each(d,function(a){s.inArray(c,a.identifier)===!1&&f.push(a),c.push(a.identifier)}),f}return a.identifier=1,[a]},collectEventData:function(a,b,c,d){var e=l;return s.inStr(d.type,"mouse")||u.matchType(k,d)?e=k:u.matchType(m,d)&&(e=m),{center:s.getCenter(c),timeStamp:Date.now(),target:d.target,touches:c,eventType:b,pointerType:e,srcEvent:d,preventDefault:function(){var a=this.srcEvent;a.preventManipulation&&a.preventManipulation(),a.preventDefault&&a.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return v.stopDetect()}}}},u=e.PointerEvent={pointers:{},getTouchList:function(){var a=[];return s.each(this.pointers,function(b){a.push(b)}),a},updatePointer:function(a,b){a==p||a!=p&&1!==b.buttons?delete this.pointers[b.pointerId]:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b)},matchType:function(a,b){if(!b.pointerType)return!1;var c=b.pointerType,d={};return d[k]=c===(b.MSPOINTER_TYPE_MOUSE||k),d[l]=c===(b.MSPOINTER_TYPE_TOUCH||l),d[m]=c===(b.MSPOINTER_TYPE_PEN||m),d[a]},reset:function(){this.pointers={}}},v=e.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:s.extend({},b),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);var b=this.current.inst,c=b.options;return s.each(this.gestures,function(d){return!this.stopped&&b.enabled&&c[d.name]&&d.handler.call(d,a,b)===!1?(this.stopDetect(),!1):void 0},this),this.current&&(this.current.lastEvent=a),a.eventType==p&&this.stopDetect(),a}},stopDetect:function(){this.previous=s.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(a,b,c,d,f){var g=this.current,h=!1,i=g.lastCalcEvent,j=g.lastCalcData;i&&a.timeStamp-i.timeStamp>e.CALCULATE_INTERVAL&&(b=i.center,c=a.timeStamp-i.timeStamp,d=a.center.clientX-i.center.clientX,f=a.center.clientY-i.center.clientY,h=!0),(a.eventType==r||a.eventType==q)&&(g.futureCalcEvent=a),(!g.lastCalcEvent||h)&&(j.velocity=s.getVelocity(c,d,f),j.angle=s.getAngle(b,a.center),j.direction=s.getDirection(b,a.center),g.lastCalcEvent=g.futureCalcEvent||a,g.futureCalcEvent=a),a.velocityX=j.velocity.x,a.velocityY=j.velocity.y,a.interimAngle=j.angle,a.interimDirection=j.direction},extendEventData:function(a){var b=this.current,c=b.startEvent,d=b.lastEvent||c;(a.eventType==r||a.eventType==q)&&(c.touches=[],s.each(a.touches,function(a){c.touches.push({clientX:a.clientX,clientY:a.clientY})}));var e=a.timeStamp-c.timeStamp,f=a.center.clientX-c.center.clientX,g=a.center.clientY-c.center.clientY;return this.getCalculatedData(a,d.center,e,f,g),s.extend(a,{startEvent:c,deltaTime:e,deltaX:f,deltaY:g,distance:s.getDistance(c.center,a.center),angle:s.getAngle(c.center,a.center),direction:s.getDirection(c.center,a.center),scale:s.getScale(c.touches,a.touches),rotation:s.getRotation(c.touches,a.touches)}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),s.extend(e.defaults,c,!0),a.index=a.index||1e3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}};!function(a){function b(b,d){var e=v.current;if(!(d.options.dragMaxTouches>0&&b.touches.length>d.options.dragMaxTouches))switch(b.eventType){case n:c=!1;break;case o:if(b.distance<d.options.dragMinDistance&&e.name!=a)return;var f=e.startEvent.center;if(e.name!=a&&(e.name=a,d.options.dragDistanceCorrection&&b.distance>0)){var k=Math.abs(d.options.dragMinDistance/b.distance);f.pageX+=b.deltaX*k,f.pageY+=b.deltaY*k,f.clientX+=b.deltaX*k,f.clientY+=b.deltaY*k,b=v.extendEventData(b)}(e.lastEvent.dragLockToAxis||d.options.dragLockToAxis&&d.options.dragLockMinDistance<=b.distance)&&(b.dragLockToAxis=!0);var l=e.lastEvent.direction;b.dragLockToAxis&&l!==b.direction&&(b.direction=s.isVertical(l)?b.deltaY<0?i:g:b.deltaX<0?h:j),c||(d.trigger(a+"start",b),c=!0),d.trigger(a,b),d.trigger(a+b.direction,b);var m=s.isVertical(b.direction);(d.options.dragBlockVertical&&m||d.options.dragBlockHorizontal&&!m)&&b.preventDefault();break;case q:c&&b.changedLength<=d.options.dragMaxTouches&&(d.trigger(a+"end",b),c=!1);break;case p:c=!1}}var c=!1;e.gestures.Drag={name:a,index:50,handler:b,defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),e.gestures.Gesture={name:"gesture",index:1337,handler:function(a,b){b.trigger(this.name,a)}},function(a){function b(b,d){var e=d.options,f=v.current;switch(b.eventType){case n:clearTimeout(c),f.name=a,c=setTimeout(function(){f&&f.name==a&&d.trigger(a,b)},e.holdTimeout);break;case o:b.distance>e.holdThreshold&&clearTimeout(c);break;case q:clearTimeout(c)}}var c;e.gestures.Hold={name:a,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:b}}("hold"),e.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==q&&b.trigger(this.name,a)}},e.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(a,b){if(a.eventType==q){var c=a.touches.length,d=b.options;if(c<d.swipeMinTouches||c>d.swipeMaxTouches)return;(a.velocityX>d.swipeVelocityX||a.velocityY>d.swipeVelocityY)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},function(a){function b(b,d){var e,f,g=d.options,h=v.current,i=v.previous;switch(b.eventType){case n:c=!1;break;case o:c=c||b.distance>g.tapMaxDistance;break;case p:"touchcancel"!=b.srcEvent.type&&b.deltaTime<g.tapMaxTime&&!c&&(e=i&&i.lastEvent&&b.timeStamp-i.lastEvent.timeStamp,f=!1,i&&i.name==a&&e&&e<g.doubleTapInterval&&b.distance<g.doubleTapDistance&&(d.trigger("doubletap",b),f=!0),(!f||g.tapAlways)&&(h.name=a,d.trigger(h.name,b)))}}var c=!1;e.gestures.Tap={name:a,index:100,handler:b,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),e.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(a,b){return b.options.preventMouse&&a.pointerType==k?void a.stopDetect():(b.options.preventDefault&&a.preventDefault(),void(a.eventType==r&&b.trigger("touch",a)))}},function(a){function b(b,d){switch(b.eventType){case n:c=!1;break;case o:if(b.touches.length<2)return;var e=Math.abs(1-b.scale),f=Math.abs(b.rotation);if(e<d.options.transformMinScale&&f<d.options.transformMinRotation)return;v.current.name=a,c||(d.trigger(a+"start",b),c=!0),d.trigger(a,b),f>d.options.transformMinRotation&&d.trigger("rotate",b),e>d.options.transformMinScale&&(d.trigger("pinch",b),d.trigger("pinch"+(b.scale<1?"in":"out"),b));break;case q:c&&b.changedLength<2&&(d.trigger(a+"end",b),c=!1)}}var c=!1;e.gestures.Transform={name:a,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:b}}("transform"),a.Hammer=e,"undefined"!=typeof module&&module.exports&&(module.exports=e),"function"==typeof define&&define.amd?define(["jquery"],function(b){return d(a.Hammer,b)}):d(a.Hammer,a.jQuery||a.Zepto)}(window);
//
/****************************************************************************** 
	rtree.js -Non-Recursive Javascript R-Tree Library
	Version 1.0.0, March 15th 2013

	https://github.com/leaflet-extras/RTree.
******************************************************************************/

var RTree=function(a){var c=3;var b=6;if(!isNaN(a)){c=Math.floor(a/2);b=a}var f={x:0,y:0,w:0,h:0,id:"root",nodes:[]};var j=function(q){return Object.prototype.toString.call(q)==="[object Array]"};var i=(function(){var q={};return function(s){var r=0;if(s in q){r=q[s]++}else{q[s]=0}return s+"_"+r}})();RTree.Rectangle.squarified_ratio=function(r,q,v){var u=(r+q)/2;var t=r*q;var s=t/(u*u);return(t*v/s)};var e=function(w,s,x){var y=[];var u=[];var z=[];var A=1;var C,r,v;if(!w||!RTree.Rectangle.overlap_rectangle(w,x)){return z}var q={x:w.x,y:w.y,w:w.w,h:w.h,target:s};u.push(x.nodes.length);y.push(x);do{C=y.pop();r=u.pop()-1;if("target" in q){while(r>=0){v=C.nodes[r];if(RTree.Rectangle.overlap_rectangle(q,v)){if((q.target&&"leaf" in v&&v.leaf===q.target)||(!q.target&&("leaf" in v||RTree.Rectangle.contains_rectangle(v,q)))){if("nodes" in v){z=m(v,true,[],v);C.nodes.splice(r,1)}else{z=C.nodes.splice(r,1)}RTree.Rectangle.make_MBR(C.nodes,C);delete q.target;if(C.nodes.length<c){q.nodes=m(C,true,[],C)}break}else{if("nodes" in v){A+=1;u.push(r);y.push(C);C=v;r=v.nodes.length}}}r-=1}}else{if("nodes" in q){C.nodes.splice(r+1,1);if(C.nodes.length>0){RTree.Rectangle.make_MBR(C.nodes,C)}for(var B=0;B<q.nodes.length;B++){h(q.nodes[B],C)}q.nodes.length=0;if(y.length==0&&C.nodes.length<=1){q.nodes=m(C,true,q.nodes,C);C.nodes.length=0;y.push(C);u.push(1)}else{if(y.length>0&&C.nodes.length<c){q.nodes=m(C,true,q.nodes,C);C.nodes.length=0}else{delete q.nodes}}}else{RTree.Rectangle.make_MBR(C.nodes,C)}}A-=1}while(y.length>0);return(z)};var l=function(y,z){var u=-1;var x=[];var B;var C=function(E,D){return(function(F){E._attach_data(D,F)})};x.push(z);var q=z.nodes;do{if(u!=-1){x.push(q[u]);q=q[u].nodes;u=-1}for(var s=q.length-1;s>=0;s--){var w=q[s];if("leaf" in w){u=-1;break}var v=RTree.Rectangle.squarified_ratio(w.w,w.h,w.nodes.length+1);var t=Math.max(w.x+w.w,y.x+y.w)-Math.min(w.x,y.x);var r=Math.max(w.y+w.h,y.y+y.h)-Math.min(w.y,y.y);var A=RTree.Rectangle.squarified_ratio(t,r,w.nodes.length+2);if(u<0||Math.abs(A-v)<B){B=Math.abs(A-v);u=s}}}while(u!=-1);return(x)};var d=function(q){var r=k(q);while(q.length>0){g(q,r[0],r[1])}return(r)};var g=function(q,D,C){var u=RTree.Rectangle.squarified_ratio(D.w,D.h,D.nodes.length+1);var t=RTree.Rectangle.squarified_ratio(C.w,C.h,C.nodes.length+1);var s;var z;var E;for(var x=q.length-1;x>=0;x--){var r=q[x];var y={};y.x=Math.min(D.x,r.x);y.y=Math.min(D.y,r.y);y.w=Math.max(D.x+D.w,r.x+r.w)-y.x;y.h=Math.max(D.y+D.h,r.y+r.h)-y.y;var B=Math.abs(RTree.Rectangle.squarified_ratio(y.w,y.h,D.nodes.length+2)-u);var w={};w.x=Math.min(C.x,r.x);w.y=Math.min(C.y,r.y);w.w=Math.max(C.x+C.w,r.x+r.w)-w.x;w.h=Math.max(C.y+C.h,r.y+r.h)-w.y;var A=Math.abs(RTree.Rectangle.squarified_ratio(w.w,w.h,C.nodes.length+2)-t);if(!z||!s||Math.abs(A-B)<s){z=x;s=Math.abs(A-B);E=A<B?C:D}}var v=q.splice(z,1)[0];if(D.nodes.length+q.length+1<=c){D.nodes.push(v);RTree.Rectangle.expand_rectangle(D,v)}else{if(C.nodes.length+q.length+1<=c){C.nodes.push(v);RTree.Rectangle.expand_rectangle(C,v)}else{E.nodes.push(v);RTree.Rectangle.expand_rectangle(E,v)}}};var k=function(q){var s=q.length-1;var A=0;var r=q.length-1;var y=0;var w,v;for(var u=q.length-2;u>=0;u--){var t=q[u];if(t.x>q[A].x){A=u}else{if(t.x+t.w<q[s].x+q[s].w){s=u}}if(t.y>q[y].y){y=u}else{if(t.y+t.h<q[r].y+q[r].h){r=u}}}var z=Math.abs((q[s].x+q[s].w)-q[A].x);var x=Math.abs((q[r].y+q[r].h)-q[y].y);if(z>x){if(s>A){w=q.splice(s,1)[0];v=q.splice(A,1)[0]}else{v=q.splice(A,1)[0];w=q.splice(s,1)[0]}}else{if(r>y){w=q.splice(r,1)[0];v=q.splice(y,1)[0]}else{v=q.splice(y,1)[0];w=q.splice(r,1)[0]}}return([{x:w.x,y:w.y,w:w.w,h:w.h,nodes:[w]},{x:v.x,y:v.y,w:v.w,h:v.h,nodes:[v]}])};var p=function(r,q){r.nodes=q.nodes;r.x=q.x;r.y=q.y;r.w=q.w;r.h=q.h;return(r)};var m=function(v,s,u,w){var x=[];if(!RTree.Rectangle.overlap_rectangle(v,w)){return(u)}var y=function(A,z){return(function(B){A._attach_data(z,B)})};x.push(w.nodes);do{var q=x.pop();for(var r=q.length-1;r>=0;r--){var t=q[r];if(RTree.Rectangle.overlap_rectangle(v,t)){if("nodes" in t){x.push(t.nodes)}else{if("leaf" in t){if(!s){u.push(t.leaf)}else{u.push(t)}}}}}}while(x.length>0);return(u)};var h=function(q,w){var u;if(w.nodes.length===0){w.x=q.x;w.y=q.y;w.w=q.w;w.h=q.h;w.nodes.push(q);return}var s=l(q,w);var r=q;do{if(u&&"nodes" in u&&u.nodes.length===0){var z=u;u=s.pop();for(var y=0;y<u.nodes.length;y++){if(u.nodes[y]===z||u.nodes[y].nodes.length===0){u.nodes.splice(y,1);break}}}else{u=s.pop()}if("leaf" in r||"nodes" in r||j(r)){if(j(r)){for(var v=0;v<r.length;v++){RTree.Rectangle.expand_rectangle(u,r[v])}u.nodes=u.nodes.concat(r)}else{RTree.Rectangle.expand_rectangle(u,r);u.nodes.push(r)}if(u.nodes.length<=b){r={x:u.x,y:u.y,w:u.w,h:u.h}}else{var x=d(u.nodes);r=x;if(s.length<1){u.nodes.push(x[0]);s.push(u);r=x[1]}}}else{RTree.Rectangle.expand_rectangle(u,r);r={x:u.x,y:u.y,w:u.w,h:u.h}}}while(s.length>0)};this.get_tree=function(){return f};this.set_tree=function(r,q){if(!q){q=f}return(p(q,r))};this.search=function(w,q,v,x){if(arguments.length<1){throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle."}var t,y,u,r;switch(arguments.length){case 1:return m.apply(this,[w,false,[],f]);case 2:if(typeof q==="function"){t=[w,false,[],f];y=q;break}else{return m.apply(this,[w,q,[],f])}case 3:if(typeof v==="function"){t=[w,q,[],f];y=v;break}else{return m.apply(this,[w,q,v,f])}case 4:t=[w,q,v,f];y=x;break}if(y){try{u=m.apply(this,t)}catch(s){r=s}finally{y(r,u)}}};this.toJSON=function(z,E){var B=[];var w=[];var A={};var s=3;var C=1;var r="";if(z&&!RTree.Rectangle.overlap_rectangle(z,f)){return""}if(!E){w.push(f.nodes.length);B.push(f.nodes);r+="var main_tree = {x:"+f.x.toFixed()+",y:"+f.y.toFixed()+",w:"+f.w.toFixed()+",h:"+f.h.toFixed()+",nodes:["}else{s+=4;w.push(E.nodes.length);B.push(E.nodes);r+="var main_tree = {x:"+E.x.toFixed()+",y:"+E.y.toFixed()+",w:"+E.w.toFixed()+",h:"+E.h.toFixed()+",nodes:["}do{var q=B.pop();var v=w.pop()-1;if(v>=0&&v<q.length-1){r+=","}while(v>=0){var y=q[v];if(!z||RTree.Rectangle.overlap_rectangle(z,y)){if(y.nodes){if(C>=s){var x=A.length;var u=i("saved_subtree");r+="{x:"+y.x.toFixed()+",y:"+y.y.toFixed()+",w:"+y.w.toFixed()+",h:"+y.h.toFixed()+",load:'"+u+".js'}";A[u]=this.toJSON(z,y);if(v>0){r+=","}}else{r+="{x:"+y.x.toFixed()+",y:"+y.y.toFixed()+",w:"+y.w.toFixed()+",h:"+y.h.toFixed()+",nodes:[";C+=1;w.push(v);B.push(q);q=y.nodes;v=y.nodes.length}}else{if(y.leaf){var t=y.leaf.toJSON?y.leaf.toJSON():JSON.stringify(y.leaf);r+="{x:"+y.x.toFixed()+",y:"+y.y.toFixed()+",w:"+y.w.toFixed()+",h:"+y.h.toFixed()+",leaf:"+t+"}";if(v>0){r+=","}}else{if(y.load){r+="{x:"+y.x.toFixed()+",y:"+y.y.toFixed()+",w:"+y.w.toFixed()+",h:"+y.h.toFixed()+",load:'"+y.load+"'}";if(v>0){r+=","}}}}}v-=1}if(v<0){r+="]}";C-=1}}while(B.length>0);r+=";";for(var D in A){r+="\nvar "+D+" = function(){"+A[D]+" return(main_tree);};"}return(r)};this.remove=function(t,v,w){var q,s,r,u;if(arguments.length<1){throw"Wrong number of arguments. RT.remove requires at least a bounding rectangle."}switch(arguments.length){case 1:s=[t,false,f];break;case 2:if(typeof arguments[1]==="function"){q=v;v=false}s=[t,v,f];break;case 3:if(typeof w==="function"){q=w}s=[t,v,f];break}if(s[1]===false){r=0;u=[];do{r=u.length;u=u.concat(e.apply(this,s))}while(r!=u.length);if(!q){return u}else{q(null,u)}}else{if(!q){return(e.apply(this,s))}else{q(null,e.apply(this,s))}}};this.insert=function(r,u,v){var q,s;if(arguments.length<2){throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle and an object."}if(!v){return(h({x:r.x,y:r.y,w:r.w,h:r.h,leaf:u},f)||true)}else{try{q=(h({x:r.x,y:r.y,w:r.w,h:r.h,leaf:u},f))}catch(t){s=t}finally{v(s,q)}}};var n=function(t,w){if(w&&w.bbox){return{leaf:w,x:w.bbox[0],y:w.bbox[1],w:w.bbox[2]-w.bbox[0],h:w.bbox[3]-w.bbox[1]}}var r=t.length;var v=0;var s=new Array(r);while(v<r){s[v]=[t[v][0],t[v][1]];v++}var x=s[0];r=s.length;v=1;var q={min:[].concat(x),max:[].concat(x)};while(v<r){if(s[v][0]<q.min[0]){q.min[0]=s[v][0]}else{if(s[v][0]>q.max[0]){q.max[0]=s[v][0]}}if(s[v][1]<q.min[1]){q.min[1]=s[v][1]}else{if(s[v][1]>q.max[1]){q.max[1]=s[v][1]}}v++}var u={x:q.min[0],y:q.min[1],w:(q.max[0]-q.min[0]),h:(q.max[1]-q.min[1])};if(w){u.leaf=w}return u};var o={};o.point=function(q){return(h({x:q.geometry.coordinates[0],y:q.geometry.coordinates[1],w:0,h:0,leaf:q},f))};o.multiPointLineString=function(q){return(h(n(q.geometry.coordinates,q),f))};o.multiLineStringPolygon=function(q){return(h(n(Array.prototype.concat.apply([],q.geometry.coordinates),q),f))};o.multiPolygon=function(q){return(h(n(Array.prototype.concat.apply([],Array.prototype.concat.apply([],q.geometry.coordinates)),q),f))};o.makeRec=function(q){return new RTree.Rectangle(q.x,q.y,q.w,q.h)};o.geometryCollection=function(u){if(u.bbox){return(h({leaf:u,x:u.bbox[0],y:u.bbox[1],w:u.bbox[2]-u.bbox[0],h:u.bbox[3]-u.bbox[1]},f))}var w=u.geometry.geometries;var s=0;var r=w.length;var q=[];var t;while(s<r){t=w[s];switch(t.type){case"Point":q.push(o.makeRec({x:t.coordinates[0],y:t.coordinates[1],w:0,h:0}));break;case"MultiPoint":q.push(o.makeRec(n(t.coordinates)));break;case"LineString":q.push(o.makeRec(n(t.coordinates)));break;case"MultiLineString":q.push(o.makeRec(n(Array.prototype.concat.apply([],t.coordinates))));break;case"Polygon":q.push(o.makeRec(n(Array.prototype.concat.apply([],t.coordinates))));break;case"MultiPolygon":q.push(o.makeRec(n(Array.prototype.concat.apply([],Array.prototype.concat.apply([],t.coordinates)))));break;case"GeometryCollection":w=w.concat(t.geometries);r=w.length;break}s++}var v=q[0];s=1;r=q.length;while(s<r){v.expand(q[s]);s++}return h({leaf:u,x:v.x(),y:v.y(),h:v.h(),w:v.w()},f)};this.geoJSON=function(u,v){v=v||function(){return true};var t,s;if(j(u)){t=u.slice()}else{if(u.features&&j(u.features)){t=u.features.slice()}else{throw ("this isn't what we're looking for")}}var q=t.length;var r=0;while(r<q){s=t[r];if(s.type==="Feature"){switch(s.geometry.type){case"Point":o.point(s);break;case"MultiPoint":o.multiPointLineString(s);break;case"LineString":o.multiPointLineString(s);break;case"MultiLineString":o.multiLineStringPolygon(s);break;case"Polygon":o.multiLineStringPolygon(s);break;case"MultiPolygon":o.multiPolygon(s);break;case"GeometryCollection":o.geometryCollection(s);break}}r++}return v(null,true)};this.bbox=function(){var s,u,r,t,w,q,v;switch(arguments.length){case 0:throw ("not enough arguments");case 1:s=arguments[0][0][0];u=arguments[0][0][1];r=arguments[0][1][0];t=arguments[0][1][1];break;case 2:if(typeof arguments[1]==="function"){s=arguments[0][0][0];u=arguments[0][0][1];r=arguments[0][1][0];t=arguments[0][1][1];w=arguments[1];break}else{s=arguments[0][0];u=arguments[0][1];r=arguments[1][0];t=arguments[1][1];break}case 3:s=arguments[0][0];u=arguments[0][1];r=arguments[1][0];t=arguments[1][1];w=arguments[2];break;case 4:s=arguments[0];u=arguments[1];r=arguments[2];t=arguments[3];break;case 5:s=arguments[0];u=arguments[1];r=arguments[2];t=arguments[3];w=arguments[4];break}if(!w){return this.search({x:s,y:u,w:r-s,h:t-u})}else{this.search({x:s,y:u,w:r-s,h:t-u},w)}}};var rTree=function(b,f){var a,c;if(typeof b==="function"){f=b;b=undefined}if(!f){return new RTree(b)}else{try{a=new RTree(b)}catch(d){c=d}finally{f(c,a)}}};RTree.Rectangle=function(c,b,d,k){var i,a,f,g,j,e;if(c.x){i=c.x;f=c.y;if(c.w!==0&&!c.w&&c.x2){j=c.x2-c.x;e=c.y2-c.y}else{j=c.w;e=c.h}a=i+j;g=f+e}else{i=c;f=b;j=d;e=k;a=i+j;g=f+e}this.x1=this.x=function(){return i};this.y1=this.y=function(){return f};this.x2=function(){return a};this.y2=function(){return g};this.w=function(){return j};this.h=function(){return e};this.toJSON=function(){return('{"x":'+i.toString()+', "y":'+f.toString()+', "w":'+j.toString()+', "h":'+e.toString()+"}")};this.overlap=function(h){return(this.x()<h.x2()&&this.x2()>h.x()&&this.y()<h.y2()&&this.y2()>h.y())};this.expand=function(l){var h=Math.min(this.x(),l.x());var m=Math.min(this.y(),l.y());j=Math.max(this.x2(),l.x2())-h;e=Math.max(this.y2(),l.y2())-m;i=h;f=m;return(this)};this.setRect=function(n,m,o,u){var s,l,q,r,t,p;if(n.x){s=n.x;q=n.y;if(n.w!==0&&!n.w&&n.x2){t=n.x2-n.x;p=n.y2-n.y}else{t=n.w;p=n.h}l=s+t;r=q+p}else{s=n;q=m;t=o;p=u;l=s+t;r=q+p}}};RTree.Rectangle.overlap_rectangle=function(d,c){if((d.h===0&&d.w===0)||(c.h===0&&c.w===0)){return(d.x<=(c.x+c.w)&&(d.x+d.w)>=c.x&&d.y<=(c.y+c.h)&&(d.y+d.h)>=c.y)}else{return(d.x<(c.x+c.w)&&(d.x+d.w)>c.x&&d.y<(c.y+c.h)&&(d.y+d.h)>c.y)}};RTree.Rectangle.contains_rectangle=function(d,c){return((d.x+d.w)<=(c.x+c.w)&&d.x>=c.x&&(d.y+d.h)<=(c.y+c.h)&&d.y>=c.y)};RTree.Rectangle.expand_rectangle=function(e,d){var c=Math.min(e.x,d.x);var f=Math.min(e.y,d.y);e.w=Math.max(e.x+e.w,d.x+d.w)-c;e.h=Math.max(e.y+e.h,d.y+d.h)-f;e.x=c;e.y=f;return(e)};RTree.Rectangle.make_MBR=function(a,c){if(a.length<1){return({x:0,y:0,w:0,h:0})}if(!c){c={x:a[0].x,y:a[0].y,w:a[0].w,h:a[0].h}}else{c.x=a[0].x}c.y=a[0].y;c.w=a[0].w;c.h=a[0].h;for(var b=a.length-1;b>0;b--){RTree.Rectangle.expand_rectangle(c,a[b])}return(c)};if(typeof module!=="undefined"&&module.exports){module.exports=rTree};
var ouilib;(function(){function a(b,d){if(!b){b={}}var b=b||{};b.config=b.config||{defaultViewportWidth:undefined,defaultViewportHeight:undefined,defaultLayoutDir:undefined,defaultLogLevel:"FINEST",defaultLogHandler:undefined,embeddedResourcesMap:undefined,preventTimerStart:false,frameRate:undefined,environment:undefined,base:".",catchAllEventListener:undefined,altText:"",hiDPI:true,silverlight:undefined};b.setUp=function(e){var f=b.config;if(b.equalIgnoreCase(b.RTL,f.defaultLayoutDir)){b.layoutDir=b.RTL;b.filters._onLayoutDir(b.layoutDir)}else{b.layoutDir=b.LTR}if(b.equalIgnoreCase(b.EnvironmentEnum.MOBILE,f.environment)){b.environment=b.EnvironmentEnum.MOBILE}else{b.environment=b.EnvironmentEnum.DESKTOP}b.deviceOrientation=b.DeviceOrientationEnum.LANDSCAPE;b.viewportWidth=0;if(b.isPositiveNumber(f.defaultViewportWidth)){b.viewportWidth=f.defaultViewportWidth}b.viewportHeight=0;if(b.isPositiveNumber(f.defaultViewportHeight)){b.viewportHeight=f.defaultViewportHeight}b.viewportBounds={x:0,y:0,width:b.viewportWidth,height:b.viewportHeight};b.tree=new b.scene.Tree();b.timer=new b.timing.Timer(f.frameRate);b.tree._setContainerImpl(e);b.rootNode=b.tree.userLayer;b.focusManager=new b.focus.FocusManager(b.rootNode);b.tooltipManager=new b.tooltip.TooltipManager();b.resourcesManager=new b.utils.ResourcesManager();b.rootNode.addEventListener(b.ViewEvents.USER_EVENTS_SUPPORTED,b.events.setUserEventsSupported);b.rootNode.addEventListener(b.ViewEvents.ABOUT_INFO_REQUEST,function(g){g.returnValue=b.aboutInfo});if(f.preventTimerStart!==true){b.timer.start()}};(function(){b.NO_OP=function(){};b.BASE_VALUE="base";b.FillEnum={REMOVE:"REMOVE",FREEZE:"FREEZE",_LEGACY:"_LEGACY"};b.DEFAULT_TAG="defaultTag";b.TAGS={LAYOUT_DIR:"layoutDir",PAINT:"paint",GEOM:"geom",TRANSFO_SET:"transfoSet",TRANSFO:"transfo",SENSITIVITY:"sensitivity",VISIBILITY:"visibility",DISPLAY:"display",OPACITY:"opacity",NAME:"name",CLIP:"clip",CURSOR:"cursor",FOCUSABLE:"focusable",DESC:"desc",FILTER:"filter",LAYOUT:"layout",PREF_SIZE:"prefSize",SRC:"src",MARKER_START:"markerStart",MARKER_START_DATA:"markerStartData",MARKER_START_PAINT:"markerStartPaint",MARKER_END:"markerEnd",MARKER_END_DATA:"markerEndData",MARKER_END_PAINT:"markerEndPaint"};b.EnvironmentEnum={DESKTOP:"DESKTOP",MOBILE:"MOBILE"};b.DeviceOrientationEnum={LANDSCAPE:"LANDSCAPE",PORTRAIT:"PORTRAIT"};b.CursorType={AUTO:"auto",DEFAULT:"default",MOVE:"move",POINTER:"pointer",TEXT:"text",WAIT:"wait",NONE:"none",HELP:"help",CROSSHAIR:"crosshair"};b.TextAlignEnum={LINE_BEGIN:"LINE_BEGIN",CENTER:"CENTER",LINE_END:"LINE_END",JUSTIFY:"JUSTIFY"};b.LineCap={BUTT:"butt",ROUND:"round",SQUARE:"square"};b.DirectionEnum={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT",TO_LINE_BEGIN:"TO_LINE_BEGIN",TO_LINE_END:"TO_LINE_END"};b.OrientationEnum={VERTICAL:"VERTICAL",HORIZONTAL:"HORIZONTAL"};b.LineJoin={MITER:"miter",ROUND:"round",BEVEL:"bevel"};b.FontWeightEnum={NORMAL:"NORMAL",BOLD:"BOLD"};b.FontStyleEnum={NORMAL:"NORMAL",ITALIC:"ITALIC"};b.LayoutDirEnum={LTR:"LTR",RTL:"RTL"};b.LTR="LTR";b.RTL="RTL";b.NodeAlign={TOP:0,CENTER:0.5,BOTTOM:1,LINE_BEGIN:0,LINE_END:1};b._BoundsType={DEFAULT:0,LAYOUT:1,RENDER:2};b.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,MULTIPLY:106,PLUS:107,MINUS:109,DIVIDE:111,DASH:189,FORWARD_SLASH:191,BACK_SLASH:220};b.PreserveAspectRatioEnum={NONE:"NONE",MIN:"MIN",MAX:"MAX"};b.WindingRuleEnum={EVEN_ODD:"EVEN_ODD",NON_ZERO:"NON_ZERO"};b.AUTO="AUTO";b.QuoteStyleEnum={ENT_COMPAT:"ENT_COMPAT",ENT_QUOTES:"ENT_QUOTES",ENT_NOQUOTES:"ENT_NOQUOTES"};b.GENERIC_FONTS={SERIF:"serif",SANS_SERIF:"sans-serif",CURSIVE:"cursive",MONOSPACE:"monospace"}}());b.LogLevel={OFF:"OFF",ERROR:"ERROR",SEVERE:"SEVERE",WARNING:"WARNING",INFO:"INFO",FINEST:"FINEST",ALL:"ALL",LOG:"LOG"};var c;b.log=c=(function(){var o=b.LogLevel,f={OFF:0,SEVERE:1,WARNING:2,INFO:3,FINEST:4,ALL:5},n=[],j=0,i=[],p,l,h,e,k;p=function(){k.release()};function m(w,u){var r=n,t,s,v=r.length;for(s=0;s<v;s++){t=r[s];if(typeof t==="function"){t.call(null,w,u)}else{t.log(w,u)}}}function q(s,r){if(i.length===j){i.shift()}i.push({level:s,message:r})}function g(s){var r=o.INFO;if(typeof s==="string"){s=s.toUpperCase()}if(o.hasOwnProperty(s)){r=o[s]}return r}k=function(r,u,s){var t,v;if(u){r=g(r);if(u instanceof Error){u=u.toString()}if(e){u=e(u,s)}if(r===o.ERROR){throw new Error(u)}else{t=f[h];v=f[r];if(v<=t){if(j>0){q(r,u)}else{m(r,u)}}}}};k.setLevel=function(r){h=g(r)};k.setFormatter=function(r){if(typeof r==="function"){e=r}};k.error=function(s,r){k(o.ERROR,s,r)};k.severe=function(s,r){k(o.SEVERE,s,r)};k.warn=k.warning=function(s,r){k(o.WARNING,s,r)};k.info=function(s,r){k(o.INFO,s,r)};k.finest=function(s,r){k(o.FINEST,s,r)};k.addLogHandler=function(r){if(typeof r==="function"||(r&&typeof r.log==="function")){n.push(r)}};k.delay=function(r,s){if(l){clearTimeout(l)}k.hold(s);l=setTimeout(p,r)};k.hold=function(r){j=r>0?r:500};k.release=function(){var r,s=i.length;if(s>0){m(o.LOG,">>>> releasing "+s+" logs.");while(s--){r=i.shift();m(r.level,r.message)}m(o.LOG,">>>> end logs release")}j=0};k.setLevel(b.config.defaultLogLevel||b.LogLevel.FINEST);k.addLogHandler(b.config.defaultLogHandler);k.setFormatter(function(s,r){if(r!==undefined){if(r.constructor===Array){s+="::"+r.join(",")}else{s+="::"+r}}return s});return k}());b.ns=function(j){var g,f,k,e,h,m,l;if(typeof j==="string"){for(h=0,m=j.length;h<m;h++){l=j.charAt(h);if((l===".")||((l>="a")&&(l<="z"))||((l>="A")&&(l<="Z"))||((l>="0")&&(l<="9"))){continue}else{c.error("ERR__NAMESPACE__ILLEGAL_CHAR",j)}}k=j.split(".");f=undefined;if(k[0]==="oui"){f=b}if(f===undefined||f.length===0){c.error("ERR__NS__ROOT_FAIL",k[0])}for(h=1,m=k.length;h<m;h++){e=k[h];f[e]=f[e]||{};f=f[e]}g=f}else{c.error("ERR__NS__INV_STR",[j,typeof j])}return g};(function(){b.ns("oui.lang");b.lang.AspectSupport={addAspect:function(g,f,j,i){var h=this[g],e;if(b.isA(h,Function)&&b.isA(f,Function)){if(j===true){e=function(){e.aspect.apply(this,arguments);return e.nextMethod.apply(this,arguments)}}else{e=function(){var k=h.apply(this,arguments);e.aspect.apply(this,arguments);return k}}e.nextMethod=h;e.aspect=f;e.aspectName=i;this[g]=e}},removeAspect:function(f,e){var h=this[f],g;while(h){if(h.aspect===e){if(g){g.nextMethod=h.nextMethod}else{this[f]=h.nextMethod}break}else{g=h;h=h.nextMethod}}}}}());(function(){b.ns("oui.lang");var f,e={superClass:false,__configs:false,events:true};b.lang.Class=f={mixin:function(i,h,g){if(!i){c.error("ERR__MIX__INV_TARGET")}else{if(!h||!f._isStrictObject(h)){c.error("ERR__MIX__INV_SRC")}else{if(g===undefined){g=true}if(f._isClass(i)){f.merge(i.prototype,h,g,e)}else{if(f._isStrictObject(i)){f.merge(i,h,g,e)}else{c.error("ERR__MIX__INV_TARGET")}}f._copyConfigs(i,h)}}},_copyConfigs:function(l,j){var n,m,i,g,h,k;if(j.__configs){if(!l.__configs){l.__configs={}}for(n in j.__configs){if(!l.__configs[n]){b.lang.PropertiesUtil.addConfig(l,{},n)}m=j.__configs[n].definitionClass.prototype;i=j.__configs[n].configClass.prototype;g=l.__configs[n].definitionClass.prototype;h=l.__configs[n].configClass.prototype;for(k in m){if(!i[k]){c.error("ERR__CONFIG__NO_DEFAULT",k)}if(!g[k]&&!h[k]){g[k]=m[k];h[k]=i[k]}else{c.error("ERR__CONFIG__DUP_PROP",k)}}}}},merge:function(k,h,g,j){var i;j=j||{};for(i in h){if(!j.hasOwnProperty(i)&&(g||!k.hasOwnProperty(i))){k[i]=h[i]}else{if(j[i]===true){if(!k[i]){k[i]={}}this.merge(k[i],h[i],g,j)}}}if(h.hasOwnProperty("toString")&&g){k.toString=h.toString}},extend:function(i,g){var h;if(!i||!f._isClass(i)){c.error("ERR__EXT__INV_CHILD")}else{if(!g||!f._isClass(g)){c.error("ERR__EXT__INV_PARENT")}else{if(i.superClass!==undefined){c.error("ERR__EXT__MULT_INHERIT")}h=function(){};h.prototype=g.prototype;i.prototype=new h();i.prototype.constructor=i;i.superClass=g}}},isA:function(i,h){var g=false;if(typeof i==="boolean"){g=(h===Boolean)}else{if(typeof i==="number"){g=(h===Number)}else{if(typeof i==="string"){g=(h===String)}else{if(h===Function){g=(typeof i==="function"||i===Date)}else{if(h&&i){if(i.constructor===h){g=true}else{if(f._isClass(h)&&i instanceof h){g=true}else{if(i.constructor!==undefined){g=f._inheritsFrom(i.constructor,h)}}}}}}}}return g},isAny:function(h){var k=arguments.length,g=false,j;for(j=1;j<k;j++){if(b.isA(h,arguments[j])){g=true;break}}return g},_isStrictObject:function(g){return g.constructor===Object},_isClass:function(g){return(g.constructor===Function||(b.as3Class!==undefined&&g.constructor===b.as3Class))},_inheritsFrom:function(j,i){var g=false,h=j.superClass;if(j===i){g=true}else{if(h!==undefined){g=f._inheritsFrom(h,i)}}return g},declare:function(l){var m,h,o,j,k,p,g;if(!b.isA(l,Object)){c.error("ERR__DECL__INV_CLASS_DEF")}m=l.name;if(!b.isA(m,String)||m.indexOf(".")<0){c.error("ERR__DECL__INV_CLASS_NAME")}j=m.lastIndexOf(".");h=b.ns(m.substr(0,j));m=m.substr(j+1);if(l.isAbstract===true){o=function(){c.error("ERR__ABSTR_CLASS",l.name)}}else{o=function(){this.init.apply(this,arguments)}}if(h[m]!==undefined){c.error("ERR__DECL__DUP_CLASS",l.name)}h[m]=o;if(b.isA(l.extend,Function)){b.extend(o,l.extend)}if(b.isA(l.mixins,Array)){for(k=0,p=l.mixins.length;k<p;k++){b.mixin(o,l.mixins[k])}}g=[{name:"styleDef",call:b.addStyleSupport},{name:"modelDef",call:b.addModelSupport},{name:"propertiesDef",call:b.addPropertiesSupport},{name:"resourcesDef",call:b.addI18nSupport},{name:"jsonDef",call:b.addJSONLoaderSupport},{name:"eventsDef",call:b.addEventsSupport}];for(k=0,p=g.length;k<p;k++){if(b.isA(l[g[k].name],Object)){g[k].call(o,l[g[k].name])}}if(b.isA(l.membersDef,Object)){b.mixin(o,l.membersDef)}return o}};b.merge=f.merge;b.extend=f.extend;b.mixin=f.mixin;b.isA=f.isA;b.isAny=f.isAny;b.declare=f.declare}());(function(){b.ns("oui.lang");b.mixin(b,{isChar:function(e){return typeof e==="string"&&e.length===1},isStringNotEmpty:function(e){return typeof e==="string"&&e.length>0},isValueInEnum:function(f,e){return typeof f==="string"&&e!==undefined&&e.hasOwnProperty(f)},isPositiveNumber:function(f,e){return typeof f==="number"&&(e===true?f>0:f>=0)},isFiniteNumber:function(e){return typeof e==="number"&&isFinite(e)},isFinitePositiveNumber:function(f,e){return typeof f==="number"&&isFinite(f)&&(e===true?f>0:f>=0)},isNumberInRange:function(g,e,h){var f;if(h===true){f=b.isArrayOfType(e,{type:Number})&&e.length===2&&!isNaN(e[0])&&!isNaN(e[1])}else{f=true}return f&&typeof g==="number"&&!isNaN(g)&&g>=e[0]&&g<=e[1]},isFunctionWithArgCount:function(e,f){return typeof e==="function"&&e.length===f},isArrayOfType:function(f,g,l,m,k){var e=true,j,h;if(g===undefined||g===null||g.type===undefined){e=false}else{if(f&&f.constructor===Array){j=f.length;if(l!==undefined){if(k===true&&typeof l!=="number"){e=false}if(j<l){e=false}}if(m!==undefined){if(k===true&&typeof m!=="number"){e=false}if(j>m){e=false}}for(h=0;h<j&&e===true;h++){e=b.isValueValid(f[h],g)}}else{e=false}}return e},isArrayOfProperties:function(l,e,f,m,k){var n=true,h=null,j,g;if(e===undefined||e===null){n=false}else{if(l&&l.constructor===Array){j=l.length;if(f!==undefined){if(k===true&&typeof f!=="number"){n=false}if(j<f){n=false}}if(m!==undefined){if(k===true&&typeof m!=="number"){n=false}if(j>m){n=false}}for(g=0;g<j&&n===true;g++){h=l[g];n=h!==undefined&&h!==null&&h.constructor===Object&&b.isObjectValid(h,e,true)}}else{n=false}}return n},isMapOfType:function(h,f){var e=true,g;if(f===undefined||f===null||f.type===undefined){e=false}else{if(typeof h==="object"){for(g in h){if(h.hasOwnProperty(g)){e=b.isValueValid(h[g],f)}}}else{e=false}}return e},isMapOfProperties:function(k,g,h,f,i){var e=false,j;if(g&&k&&k.constructor===Object){if(typeof h!=="boolean"){h=true}e=true;for(j in k){if(k.hasOwnProperty(j)){e=b.isObjectValid(k[j],g,h,f);if(e===false&&i===true){e=b.isMapOfProperties(k[j],g,h,f,i)}if(e===false){break}}}}return e},isObjectValid:function(l,k,h,i){var n=false,f=false,m=false,e,j,g;if(k!==undefined&&l!==undefined&&k!==null&&l!==null){for(e in k){if(k[e]!==undefined){j=l[e];g=k[e];if(j!==undefined){f=b.isValueValid(j,g,h);n=f}else{m=m||!l.hasOwnProperty(e);n=!h}if(n!==true){break}}}if(n===true&&h===false&&i===true&&m){if(f===true){for(e in k){if(l.hasOwnProperty(e)===false){g=k[e];l[e]=g.defaultValue}}}else{n=false}}}return n},inheritsFrom:function(h,i,f){var e=false,g=true;if(f!==false){g=b.isA(i,Function)}if(g&&b.isA(h,Function)){e=b.lang.Class._inheritsFrom(h,i)}return e}})}());(function(){b.ns("oui.lang");var e=b.QuoteStyleEnum,f="(&amp;|&lt;|&gt;|&quot;|&#039;|&#8230;)",g=new RegExp(f,"gi"),h=new RegExp("^"+f+"$","i");b.mixin(b,{currentTimeMillis:function(){return new Date().getTime()},equalIgnoreCase:function(k,j){var i=false;if(typeof k==="string"&&typeof j==="string"){i=(k.toLowerCase()===j.toLowerCase())}return i},trim:function(i){return i.replace(/^\s+|\s+$/g,"")},arrayRemove:function(o,l,k){var j,m=o.length;for(j=m-1;j>=0;j--){if(o[j]===l){o.splice(j,1);if(k===false){break}}}return o},hasOwnValue:function(l,n,k){var m,j=false,i;if(l!==undefined){if(typeof n==="string"&&k===true){i=n.toLowerCase();for(m in l){if(l.hasOwnProperty(m)&&l[m].toLowerCase()===i){j=true;break}}}else{for(m in l){if(l.hasOwnProperty(m)&&l[m]===n){j=true;break}}}}return j},supportsEvents:function(i){return i!==null&&i!==undefined&&b.isA(i.addEventListener,Function)},getValidIndex:function(j,l){var m,k;if(j<0){k=j%l;m=(k===0)?0:l+(j%l)}else{if(j>0){m=(j<l)?j:j%l}else{m=0}}return m},isValueOfType:function(n,m,o){var i=false,l,k;if(m===Object){i=true}else{if(n!==undefined&&n!==null&&m!==undefined&&m!==null){if(m===String||m===Number||m===Boolean||m===Array||m===Date||m===Function){i=(n.constructor===m)}else{if(m.constructor===Object&&n.constructor===Object){i=(b.isObjectValid(n,m,o)===true)}else{if(m.constructor===Function){i=b.isA(n,m)}else{if(m.constructor===Array){k=m.length;for(l=0;l<k;l++){if(n===m[l]){i=true;break}}}}}}}}return i},isValueInConstraint:function(m,o,k){var l=null,j=null,i=true;if(o){i=false;if(o.constructor===Function){l=o;j=[m]}else{if(o.constructor===Array&&o.length>0&&o[0]!==undefined&&o[0]!==null&&o[0].constructor===Function){l=o[0];j=o.concat();j[0]=m}}}if(k===undefined){k=null}if(l!==null){try{i=l.apply(k,j)}catch(n){c.info("INFO__CONSTRAINT_FAIL",[n.message,m,o,k])}}return i},isValueValid:function(k,j,l){var i=false;if(j.type!==undefined){i=b.isValueOfType(k,j.type,l)}else{i=b.isValueOfType(k,j,l)}if(i===true&&j.constraint!==undefined){i=b.isValueInConstraint(k,j.constraint)}return i},buildDefaults:function(j,m){var i=m,k,l;if(typeof i!=="object"||i===null){i={}}for(l in j){k=j[l];if(k!==null&&k!==undefined&&k.constructor===Object){if(k.defaultValue!==undefined){i[l]=k.defaultValue}else{if(k.type!==undefined&&k.type.constructor===Object){k=k.type}i[l]=b.buildDefaults(k)}}}return i},applyProperties:function(l,m,k,i){var j={};if(l&&k){b._applyPropertiesImpl(l,m,k,i,j)}return j},_applyPropertiesImpl:function(i,q,l,t,v){var j,s,m,n,k,r,u,o=b._applyPropertiesImpl;for(j in i){m=l[j];s=i[j];n=q[j];if(m!==undefined&&s!==n){if(m.type===undefined){if(m.constructor===Object){o(s,n,m,t,v)}}else{if(m.type.constructor===Object){o(s,n,m.type,t,v)}else{k=false;r=undefined;k=(s===null&&m.allowsNull)||(s===undefined&&m.allowsUndef)||b.isValueOfType(s,m.type,false);if(k===true){r=s}else{if(m.convertor){u={value:undefined,validValue:false};m.convertor(s,u);k=(u.validValue===true);r=u.value}}if(k===true&&m.comparator){k=!m.comparator(n,s)}if(k===true&&m.constraint){k=b.isValueInConstraint(r,m.constraint,t);if(!k&&m.itemsConvertor){u={value:undefined,validValue:false};m.itemsConvertor(r,u);k=(u.validValue===true);r=u.value}}if(k===true){q[j]=r;if(m.tag){v[m.tag]=true}else{v[b.DEFAULT_TAG]=true}}}}}}},xmlSpecialChars:function(p,j,k){var o,m,l,q;if(!b.hasOwnValue(e,j)){j=e.ENT_COMPAT}if(k===false){o=p.split(g);for(l=0,q=o.length;l<q;l++){m=o[l];if(m.match(h)===null){o[l]=m.replace(/&/g,"&amp;")}}p=o.join("")}else{p=p.replace(/&/g,"&amp;")}p=p.replace(/</g,"&lt;");p=p.replace(/>/g,"&gt;");if(j===e.ENT_COMPAT){p=p.replace(/"/g,"&quot;")}else{if(j===e.ENT_QUOTES){p=p.replace(/"/g,"&quot;");p=p.replace(/'/g,"&#039;")}}p=p.replace(/\u2026/g,"&#8230;");return p}})}());(function(){b.ns("oui.defs");function l(w,u,v,A,y,o,t,x,s){var q,p,z,r=(v===null&&x)||(v===undefined&&s)||b.isValueOfType(v,u,false);if(!r||!b.isValueInConstraint(v,o)){if(t===undefined){t=["def=",v];if(b.isA(o,Array)){t.push(" with constraints: ");for(q=1,p=o.length;q<p;q++){t.push(o[q],", ")}}}c.error("ERR__DEFS__INV",[t,"oui.defs."+w])}else{if(A!==undefined&&!b.isA(A,String)){c.error("ERR__DEFS__INV",["tag","oui.defs."+w])}else{z={type:u,constraint:o,defaultValue:v,convertor:y,tag:A}}}return z}function f(q,p,o,r){var n=false;if(q===null){n=o}else{if(q===undefined){n=r}else{n=b.isValueOfType(q,p,true)}}return n}function i(p,r,o,q){var n=false;if(p===null){n=o}else{if(p===undefined){n=q}else{n=b.isValueInConstraint(p,r)}}return n}function k(o,n){if(o===1||o==="1"||o==="true"||o==="TRUE"){n.validValue=true;n.value=true}else{if(o===0||o==="0"||o==="false"||o==="FALSE"){n.validValue=true;n.value=false}}}function m(o,n){if(o!==undefined&&o!==null){n.validValue=true;n.value=o.toString()}}function e(o,n){if(b.isA(o,String)){var p=parseFloat(o);if(!isNaN(p)){n.valueValid=true;n.value=p}}}function g(p,o){if(b.isA(p,String)){var n=Date.parse(p);if(!isNaN(n)){o.validValue=true;o.value=new Date(n)}}}function j(p){var s,r=p.convertor,q,u,t,o;if(r!==undefined){s=function(v,n){u=[].concat(v);t=u.length;for(q=0;q<t;q++){o=b.isValueOfType(u[q],p.type,false);if(o===false){n.validValue=false;r(u[q],n,q,t);if(n.validValue===true){o=n.validValue;u[q]=n.value}}if(o===false){break}}if(q===t){n.validValue=true;n.value=u}else{n.validValue=false}}}return s}function h(o,r,q){var p,n=false;if(o!==null&&o!==undefined&&r!==null&&r!==undefined&&o.constructor===Array&&r.constructor===Array&&o.length===r.length){n=true;p=o.length;if(q===true){while(n&&p--){if(o[p].constructor===Array){n=h(o[p],r[p],q)}}}else{while(n&&p--){n=(o[p]===r[p])}}}return n}b.mixin(b.defs,{_createDef:l,Boolean:function(o,n){return l("Boolean",Boolean,o,n,k)},String:function(o,n){return l("String",String,o,n,m)},Char:function(o,n){return l("Char",String,o,n,m,b.isChar)},Number:function(o,n){return l("Number",Number,o,n,e)},FiniteNumber:function(o,n){return l("FiniteNumber",Number,o,n,e,b.isFiniteNumber)},FinitePositiveNumber:function(o,n){return l("FinitePositiveNumber",Number,o,n,e,b.isFinitePositiveNumber)},PositiveNumber:function(o,n){return l("PositiveNumber",Number,o,n,e,b.isPositiveNumber)},StrictlyPositiveNumber:function(o,n){return l("StrictlyPositiveNumber",Number,o,n,e,[b.isPositiveNumber,true])},NumberInRange:function(o,q,n){var r=[b.isNumberInRange,o,true],p=l("NumberInRange",Number,q,n,e,r);r[2]=false;return p},Enum:function(q,o,n){var s=[],r;for(r in q){if(q.hasOwnProperty(r)){s.push(q[r])}}return l("Enum",s,o,n)},Date:function(o,n){return l("Date",Date,o,n,g)},MapOfProperties:function(r,s,p,o,q,n){return l("MapOfProperties",Object,s,n,undefined,[b.isMapOfProperties,r,p,o,q])},MapOfType:function(o,p,n){return l("MapOfType",Object,p,n,undefined,[b.isMapOfType,o])},ArrayOfProperties:function(o,s,t,q,n){var r=[b.isArrayOfProperties,o,s,t,true],p=l("ArrayOfProperties",Array,q,n,undefined,r);r[4]=false;return p},ArrayOfType:function(u,n,t,p,x,v,s){var o=[b.isArrayOfType,u,n,t,true],q,w={},r;if(s){r=j(u);r(p,w);if(w.validValue){p=w.value}}q=l("ArrayOfType",Array,p,x,null,o);if(s){q.itemsConvertor=r}if(v){q.comparator=h}o[4]=false;return q},ObjectOfType:function(p,r,o,q,n){return l("ObjectOfType",Object,r,n,undefined,[f,p,o,q])},ObjectOfConstraint:function(p,r,o,q,n){return l("ObjectOfConstraint",Object,r,n,undefined,[i,p,o,q])},Function:function(p,o,n){return l("Function",Function,o,n,undefined,[b.isFunctionWithArgCount,p])},Class:function(r,p,n){var q=[b.inheritsFrom,r],o=l("Class",Function,p,n,undefined,q);q[2]=false;return o}})}());(function(){b.ns("oui.lang");b.lang.PropertiesSupport={_initProperties:function(e){this._properties=new this.Properties();this.setProperties(e)},setProperties:function(f){var e=this._properties.updateObject(f),g;for(g in e){if(e[g]===true){this.onPropChanged(g)}}},applyProperties:function(e){this.setProperties(e)},onPropChanged:function(){}}}());(function(){b.ns("oui.lang");var e=/\^\.([a-zA-Z0-9\-_]*)\[([a-zA-Z0-9\-]*)\]/;b.lang.BindingSupport={applyBinding:function(i,g,h,k,j,f){var l=this[j];if(b.isA(l,Function)){this._applyBinding(i,g,h,k,l,f)}},_applyBinding:function(o,g,k,f,p,t){var r=this[k],l,s,h,q,m,j;if(t===true&&r!==undefined){l=this._computeBinding(o,r,g,this);p.call(this,l)}s=this[f];if(s===undefined||g===s){q=this.firstChild;while(q){q._applyBinding(o,g,k,f,p,true);q=q.nextSibling}}else{h=this.getOutOfBindingScopeChildren(k);for(m=0,j=h.length;m<j;m++){h[m]._applyBinding(o,g,k,f,p,true)}}},getOutOfBindingScopeChildren:function(f){return[]},_computeBinding:function(i,j,g,h){var f;if(j.constructor===String){f=this._computeStringBinding(i,j,g,h)}else{if(j.constructor===Object){f=this._computeObjectBinding(i,j,g,h)}else{if(j.constructor===Function){f=j.call(g,i,h)}}}return f},_computeStringBinding:function(k,n,f,g){var q,p,o=0,m=n.charAt(0),j,h,l;if(m==="@"){p=n.slice(1).split(".");o=p.length;if(o>0){q=k;for(j=0;j<o;j++){q=q[p[j]]}}}else{if(m==="$"){h=f[n.slice(1)];if(h!==undefined&&h.constructor===Function){q=h.call(f,k,g)}}else{if(m==="^"){l=e.exec(n);if(l[1]&&l[2]){q=b.tree.getCSSValue(l[1],l[2])}}}}return q},_computeObjectBinding:function(j,g,h,i){var f={},k;for(k in g){if(g.hasOwnProperty(k)){f[k]=this._computeBinding(j,g[k],h,i)}}return f}}}());(function(){b.ns("oui.lang");b.lang.LinkedListSupport={addLinkedList:function(C,u,n,B,g,h,A,l,x,y,s,r,v,m,w,o,i,z,k,q){var t=C.prototype,j,p,e,f;if(!b.isA(i,String)){i="_numChildren"}t[n]=null;t[B]=null;t[g]=null;t[h]=null;t[A]=null;t[i]=0;if(b.isA(m,String)&&b.isA(t[m],Function)){j=function(D){return this[m](D)}}if(!j){j=function(D){return b.isA(D,u)}}if(b.isA(w,String)){p=t[w]}if(!p){p=function(D){}}if(b.isA(o,String)){e=t[o]}if(!e){e=function(D){}}f="_safe"+x.charAt(0).toUpperCase()+x.slice(1);t[l]=function(D){return this[s](D)};t[s]=function(F,I){var D,E,G,H;if(j.call(this,F)===true){E=true;G=this;while(G&&G!==F){G=G[g]}if(G!==null){E=false;c.warn("WARN__HRCHY_REQ__INSERT_ANCEST")}}else{E=false;c.warn("WARN__HRCHY_REQ__INV_TYPE")}if(E){H=F[g];if(H!==null){H[f](F,(H===this))}if(!I){if(this[A]!==null){F[B]=this[A];this[A][n]=F}else{F[B]=null;this[h]=F}F[n]=null;this[A]=F;D=F}else{if(I===this[h]){this[h]=F;F[n]=I;F[B]=null;I[B]=F;D=F}else{if(I[g]===this){I[B][n]=F;F[B]=I[B];I[B]=F;F[n]=I;D=F}else{c.warn("WARN__NOTFOUND__INSERT")}}}if(D){F[g]=this;p.call(this,F,I,(H===this));this[i]++}}return D};t[f]=function(E,D){if(this[h]===E){this[h]=E[n];if(this[A]===E){this[A]=null}}else{if(this[A]===E){this[A]=E[B]}}if(E[B]!==null){E[B][n]=E[n]}if(E[n]!==null){E[n][B]=E[B]}E[B]=null;E[n]=null;E[g]=null;if(D!==true){e.call(this,E,false,true)}this[i]--};t[x]=function(E){var D;if(E&&E[g]===this){this[f](E,false);D=E}else{c.warn("WARN__NOTFOUND__REMOVE")}return D};t[y]=function(){var D=this[h],E;if(D!==null){while(D){E=D[n];D[g]=null;D[B]=null;D[n]=null;e.call(this,D,true,(E===null));D=E}this[h]=null;this[A]=null;this[i]=0}};t[r]=function(G,E){var D,F;if(b.isA(E,u)&&E[g]===this){F=E.nextSibling;this[x](E);this[s](G,F);D=E}return D};t[v]=function(){return(this[h]!==null)};if(b.isA(z,String)){t[z]=function(D){var F=null,E=this[i];if(D>=0&&D<E){F=this[h];E=0;while(E<D){F=F[n];E++}}return F}}if(b.isA(k,String)){t[k]=function(E){var D=0,F=this[h];while(F&&F!==E){F=F[n];D++}return(F===E)?D:-1}}if(b.isA(q,String)){t[q]=function(E,D){var F=this[z](D);this[s](E,F)}}}}}());(function(){b.ns("oui.lang");function f(m,l){return function(){return this[m][l]}}function k(n,m){var l=m.concat();return function(){var p=this[n],o,q=l.length;for(o=0;o<q;o++){p=p[l[o]]}return p}}function i(l){return function(n){var m;if(n.length===1){m=f(l,n[0])}else{m=k(l,n)}return m}}function h(l,m){return function(n){var o={};o[m]=n;this[l](o)}}function e(l,n){var m=n.concat();return function(r){var s={},p=s,o,q=m.length;for(o=0;o<q-1;o++){p[m[o]]={};p=p[m[o]]}p[m[q-1]]=r;this[l](s)}}function j(l){return function(n){var m;if(n.length===1){m=h(l,n[0])}else{m=e(l,n)}return m}}b.lang.PropertiesUtil={addConfig:function(w,l,t,u,o){var n=t+"Definition",p=function(){},r=this._getSuperConfig(w,t),v,m,q,s,x;if(r!==undefined){v=r.__configs[t].definitionClass;m=r.__configs[t].configClass;b.extend(p,v)}b.mixin(p,l);s=(function(y){return function(A){var C,B,z;if(A!==undefined){C=function(){};if(y!==undefined){b.extend(C,y)}for(B in A){C.prototype[B]=A[B]}this.definition=new C();b.buildDefaults(this.definition,this)}else{z=this.compounds;for(B in z){if(z.hasOwnProperty(B)){this[B]=new z[B]()}}}}}(v));q={updateObject:function(z,y){return b.applyProperties(z,this,this.definition,y)},definition:new p(),compounds:{}};this._getDefaultsAndCompounds(q.definition,q,q.compounds);if(m!==undefined){b.extend(s,m)}b.mixin(s,q);x=w;if(b.isA(w,Function)){x=w.prototype}if(u){this._addAccessors(l,"get",[],i("_"+t.toLowerCase()),x,true)}if(o){this._addAccessors(l,"set",[],j("apply"+t),x,false)}if(w.constructor===Function){w.prototype[n]=p;w.prototype[t]=s;w[n]=l}if(!w.__configs){w.__configs={}}w.__configs[t]={definitionClass:p,configClass:s}},_addAccessors:function(q,v,y,u,t,x){var l,m,s,r,o,w;if(q!==undefined){if(!this._isCompound(q)){m="";r=y.length;for(s=0;s<r;s++){o=y[s];if(o.length>0){m+=o.charAt(0).toUpperCase()+o.slice(1)}}l=u(y);if(x){t[m.charAt(0).toLowerCase()+m.slice(1)]=l}t[v+m]=l}else{w=q;if(q.type!==undefined){w=q.type}for(o in w){if(w.hasOwnProperty(o)===true){y.push(o);this._addAccessors(w[o],v,y,u,t,x);y.pop()}}}}},_getSuperConfig:function(l,n){var m=l.superClass;if(m){if(!m.__configs||!m.__configs[n]){m=this._getSuperConfig(m,n)}}return m},_isCompound:function(l){return(l.type===undefined&&l.constructor===Object)||(l.type!==undefined&&l.type.constructor===Object)},_compoundedDefaultsFactory:function(m){var l={},n={},o;this._getDefaultsAndCompounds(m,n,l);o=function(){var q;for(q in l){if(l.hasOwnProperty(q)===true){this[q]=new l[q]()}}};o.prototype=n;return o},_getDefaultsAndCompounds:function(m,o,l){var q,n;for(n in m){if((q=m[n])!==null&&q!==undefined&&q.constructor===Object){if(this._isCompound(q)){l[n]=this._compoundedDefaultsFactory(q)}else{o[n]=q.defaultValue}}}}};var g=b.lang.PropertiesUtil;b.addStyleSupport=function(l,m){g.addConfig(l,m,"Style",true,true)};b.addModelSupport=function(l,m){g.addConfig(l,m,"Model",false,false)};b.addPropertiesSupport=function(l,m){g.addConfig(l,m,"Properties",true,true)}}());(function(){b.declare({name:"oui.geom.Matrix",membersDef:{init:function(l,j,n,m,k,i){if(arguments.length>=1&&b.isA(l,Number)&&b.isA(j,Number)&&b.isA(n,Number)&&b.isA(m,Number)&&b.isA(k,Number)&&b.isA(i,Number)){this.a=l;this.b=j;this.c=n;this.d=m;this.tx=k;this.ty=i}else{this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0}},_safeTranslate:function(i,j){this.tx+=this.a*i+this.c*j;this.ty+=this.b*i+this.d*j;return this},_safeRotate:function(p,j,r){var l=(j!==0||r!==0),i,q,k=Math.cos(p),o=Math.sin(p);if(l){this._safeTranslate(j,r)}i=this.a;q=this.c;this.a=i*k+q*o;this.c=i*-o+q*k;i=this.b;q=this.d;this.b=i*k+q*o;this.d=i*-o+q*k;if(l){this._safeTranslate(-j,-r)}return this},_safeScale:function(i,j){this.a*=i;this.c*=j;this.b*=i;this.d*=j;return this},set:function(i){if(b.isA(i,b.geom.Matrix)){this.a=i.a;this.b=i.b;this.c=i.c;this.d=i.d;this.tx=i.tx;this.ty=i.ty}return this},isIdentity:function(){return this.tx===0&&this.ty===0&&this.a===1&&this.b===0&&this.c===0&&this.d===1},concat:function(i){if(b.isA(i,b.geom.Matrix)){this._concat(i)}return this},_concat:function(o){var n,m,l;n=this.a;m=this.c;l=this.tx;this.a=n*o.a+m*o.b;this.c=n*o.c+m*o.d;this.tx=n*o.tx+m*o.ty+l;n=this.b;m=this.d;l=this.ty;this.b=n*o.a+m*o.b;this.d=n*o.c+m*o.d;this.ty=n*o.tx+m*o.ty+l},transformAll:function(q,t){var l=q.length||0,s,o,r,p,n,m,k,j;t=t||q;l+=l%2;r=this.a;p=this.b;n=this.c;m=this.d;k=this.tx;j=this.ty;while(l--){s=q[--l];o=q[l+1];t[l]=r*s+n*o+k;t[l+1]=p*s+m*o+j}return t},transform:function(i,j){return{x:this.a*i+this.c*j+this.tx,y:this.b*i+this.d*j+this.ty}},det:function(){return(this.a*this.d)-(this.b*this.c)},inv:function(){var i,j=this.det();if(j!==0){i=new b.geom.Matrix();i.a=this.d/j;i.b=-this.b/j;i.c=-this.c/j;i.d=this.a/j;i.tx=(this.c*this.ty-this.tx*this.d)/j;i.ty=(this.tx*this.b-this.a*this.ty)/j}else{c.error("ERR__MTX__INV")}return i},clone:function(){var i=new b.geom.Matrix();i.a=this.a;i.b=this.b;i.c=this.c;i.d=this.d;i.tx=this.tx;i.ty=this.ty;return i},equals:function(k,i){var j=false;if(b.isA(k,b.geom.Matrix)){if(!i){j=k.a===this.a&&k.c===this.c&&k.tx===this.tx&&k.b===this.b&&k.d===this.d&&k.ty===this.ty}else{j=Math.abs(k.a-this.a)<i&&Math.abs(k.c-this.c)<i&&Math.abs(k.tx-this.tx)<i&&Math.abs(k.b-this.b)<i&&Math.abs(k.d-this.d)<i&&Math.abs(k.ty-this.ty)<i}}return j}}});b.geom.Matrix.IDENTITY=new b.geom.Matrix();function h(j){var i=j.length;return function(){var l=arguments,k=[];k.push.apply(k,l);if(k.length>0&&typeof k[0]==="number"){if(i===3&&l[1]===undefined){k[1]=0;k[2]=0}else{if(l[i-1]===undefined){k[i-1]=k[i-2]}}j.apply(this,k)}return this}}var g=b.geom.Matrix.prototype,e={},f;for(f in g){if(f.indexOf("_safe")===0){e[f.charAt(5).toLowerCase()+f.substr(6)]=h(g[f])}}b.mixin(b.geom.Matrix,e)}());(function(){var j="([+-]?\\d+(\\.\\d+)?)",h="translate\\(\\s*"+j+"\\s*,\\s*"+j+"\\s*\\)",g="matrix\\(\\s*"+j+"\\s*,\\s*"+j+"\\s*,\\s*"+j+"\\s*,\\s*"+j+"\\s*,\\s*"+j+"\\s*,\\s*"+j+"\\s*\\)",e=new RegExp(h,"g"),f=new RegExp(g,"g");function i(m,k){var l,n=null;f.lastIndex=0;e.lastIndex=0;if(b.isA(m,Array)&&m.length===6){n=new b.geom.Matrix(m[0],m[1],m[2],m[3],m[4],m[5])}else{l=f.exec(m);if(l===null){l=e.exec(m);if(l!==null){n=new b.geom.Matrix(1,0,0,1,parseFloat(l[1]),parseFloat(l[3]))}}else{n=new b.geom.Matrix(parseFloat(l[1]),parseFloat(l[3]),parseFloat(l[5]),parseFloat(l[7]),parseFloat(l[9]),parseFloat(l[11]))}}if(n===null){k.validValue=false}else{k.validValue=true;k.value=n}}b.mixin(b.defs,{Matrix:function(l,k){return b.defs._createDef("Matrix",b.geom.Matrix,l,k,i)}})}());(function(){b.ns("oui.geom");function g(i,h,j){return i+(h-i)*j}function f(i,h){return(i+h)/2}var e=5;b.mixin(b.geom,{DEG_TO_RAD:Math.PI/180,computeBounds:function(m){var n=m.length||0,j,l,k,h,p,o;if(n%2===0&&n>1){k=m[0];p=m[0];h=m[1];o=m[1];for(l=2;l<n;l+=2){k=m[l]<k?m[l]:k;p=m[l]>p?m[l]:p;h=m[l+1]<h?m[l+1]:h;o=m[l+1]>o?m[l+1]:o}j={x:k,y:h,width:p-k,height:o-h}}return j},intersectLine:function(s,i,q,h,k,p,j,m){var t=b.geom.slope(s,i,q,h),r=b.geom.slope(k,p,j,m),o=i-(t*s),l=p-(r*k),n,u;if(t===r||Math.abs(t-r)<0.000001){u=[]}else{if(!isFinite(t)){u=[s,r*s+l]}else{if(!isFinite(r)){u=[k,t*k+o]}else{n=(o-l)/(r-t);u=[n,(t*n+o+r*n+l)/2]}}}return u},intersectRect:function(l,k,q){var s,m,j,i,r,h,p,o,n;if(l&&k){if(q!==true){if((m=l.x)<=(p=k.x+k.width)&&(h=k.x)<=(j=l.x+l.width)&&(i=l.y)<=(n=k.y+k.height)&&(o=k.y)<=(r=l.y+l.height)){s={x:m>h?m:h,y:i>o?i:o};s.width=(j>p?p:j)-s.x;s.height=(r>n?n:r)-s.y}}else{if((m=l.x)<(p=k.x+k.width)&&(h=k.x)<(j=l.x+l.width)&&(i=l.y)<(n=k.y+k.height)&&(o=k.y)<(r=l.y+l.height)){s={x:m>h?m:h,y:i>o?i:o};s.width=(j>p?p:j)-s.x;s.height=(r>n?n:r)-s.y}}}return s},unionRect:function(m,k){var i,j,n,o,h;if(m&&k){j=Math.min(m.x,k.x);n=Math.min(m.y,k.y);o=Math.max(m.x+m.width,k.x+k.width);h=Math.max(m.y+m.height,k.y+k.height);i={x:j,y:n,width:o-j,height:h-n}}else{i=m||k}return i},calculateAngle:function(h,l,j,i){var k=Math.atan2(i,j)-Math.atan2(l,h);if(k<0){k+=2*Math.PI}return k},slope:function(i,k,h,j){return(h-i===0)?Number.POSITIVE_INFINITY:((j-k)/(h-i))},distSq:function(i,k,h,j){return(i-h)*(i-h)+(k-j)*(k-j)},dist:function(i,k,h,j){return Math.sqrt(b.geom.distSq(i,k,h,j))},centroid:function(o,k,h){var m=0,l=0,p=o.length,j=p-1;while(j>=0){m+=o[j][k];l+=o[j][h];j--}return{x:(m/p),y:(l/p)}},dotprod:function(h,k,j,i){return(h*j)+(k*i)},ptSegDistSq:function(j,n,i,l,p,o){var m,h,k;i-=j;l-=n;p-=j;o-=n;m=p*i+o*l;if(m<=0){h=0}else{p=i-p;o=l-o;m=p*i+o*l;if(m<=0){h=0}else{h=m*m/(i*i+l*l)}}k=p*p+o*o-h;if(k<0){k=0}return k},isPointInEllipse:function(i,m,h,l,k,j){i=(i-h)/k;m=(m-l)/j;return(i*i+m*m)<=1},isPointInTriangle:function(s,q,t,r,H,G,n,l){var A=b.geom.dotprod,k=n-t,j=l-r,p=H-t,o=G-r,F=s-t,D=q-r,E=A(k,j,k,j),C=A(k,j,p,o),B=A(k,j,F,D),i=A(p,o,p,o),h=A(p,o,F,D),m=1/(E*i-C*C),z=(i*B-C*h)*m,w=(E*h-C*B)*m;return(z>=0)&&(w>=0)&&(z+w<=1)},isValidRect:function(h){return h!==undefined&&h!==null&&!isNaN(h.x)&&!isNaN(h.y)&&h.width>=0&&h.height>=0},getBoundedXY:function(m,A,o,v){var j=b.geom,n=null,l,k,q,p,u,t,i,h,s,r,z,w;if(!b.isFiniteNumber(o)){o=e}if(j.isValidRect(m)&&j.isValidRect(A)){l=m.x;k=m.y;q=m.width;p=m.height;u=A.x+o;t=A.y+o;i=A.width-2*o;h=A.height-2*o;if(v){s=v.x;r=v.y;z=2*s-(l+q);w=2*r-(k+p)}if(i>q){if(l<u){l=u}else{if(l+q>u+i){l=u+i-q;if(v&&s>l&&s<l+q&&r>k&&r<k+p&&z>=u&&z+q<=u+i){l=z}}}}else{if(i===q){l=u}}if(h>p){if(k<t){k=t}else{if(k+p>t+h){k=t+h-p;if(v&&s>l&&s<l+q&&r>k&&r<k+p&&w>=t&&w+p<=t+h){k=w}}}}else{if(h===p){k=t}}n={x:l,y:k}}return n},getBoxCtrlPts:function(i,l,k,h){var j=[];if(k>0&&h>0){j.push(i,l,i+k,l,i+k,l+h,i,l+h)}else{if(k>0){j.push(i,l,i+k,l)}else{if(h>0){j.push(i,l,i,l+h)}else{j.push(i,l)}}}return j},crossLine:function(k,m,j,l,i,n){var h;if((i<k&&i<j)||(i>k&&i>j)||(n>m&&n>l)||(k===j)){h=0}else{if(i===k){h=k<j?0:-1}else{if(i===j){h=k<j?1:0}else{if((n-m)-(l-m)*(i-k)/(j-k)<0){h=(k<j)?1:-1}else{h=0}}}}return h},crossQuad:function(j,n,i,m,h,k,o,l){var p;if((o<j&&o<i&&o<h)||(o>j&&o>i&&o>h)||(l>n&&l>m&&l>k)||(j===i&&i===h)){p=0}else{p=b.geom.crossLine(j,n,i,m,o,l)+b.geom.crossLine(i,m,h,k,o,l)}return p},crossCubic:function(j,p,i,n,h,l,r,k,o,m){var q;if((o<j&&o<i&&o<h&&o<r)||(o>j&&o>i&&o>h&&o>r)||(m>p&&m>n&&m>l&&m>k)||(j===i&&i===h&&h===r)){q=0}else{q=b.geom.crossLine(j,p,i,n,o,m)+b.geom.crossLine(i,n,h,l,o,m)+b.geom.crossLine(h,l,r,k,o,m)}return q},cubic2Quad:function(y,x,I,H,m,k,A,z){var u=f(y,I),t=f(x,H),o=f(I,m),n=f(H,k),l=f(m,A),j=f(k,z),C=f(u,o),B=f(t,n),K=f(o,l),J=f(n,j),r=g(y,u,3/4),p=g(x,t,3/4),E=g(C,K,1/8),D=g(B,J,1/8),M=g(K,C,1/8),L=g(J,B,1/8),s=g(A,l,3/4),q=g(z,j,3/4),w=f(r,E),v=f(p,D),G=f(C,K),F=f(B,J),i=f(M,s),h=f(L,q);return[r,p,w,v,E,D,G,F,M,L,i,h,s,q,A,z]},quad2Cubic:function(q,p,m,l,j,h){var k=q+(2/3)*(m-q),i=p+(2/3)*(l-p),o=k+(1/3)*(j-q),n=i+(1/3)*(h-p);return[k,i,o,n,j,h]},_isFlatQuad:function(j,q,m,k,h,p,l,i){var n,r,o=b.geom.dist;if(i===undefined||i<0){n=2/l;r=o(j,q,m,k)+o(m,k,h,p)-o(j,q,h,p)}else{n=i*i;r=b.geom.ptSegDistSq(j,q,h,p,m,k)}return r<n},_isFlatCubic:function(j,t,q,m,p,l,h,s,n,i){var o,u,r=b.geom.dist,k;if(i===undefined||i<0){o=2/n;u=r(j,t,q,m)+r(q,m,p,l)+r(p,l,h,s)-r(j,t,h,s)}else{k=b.geom.ptSegDistSq;o=i*i;u=Math.max(k(j,t,h,s,q,m),k(j,t,h,s,p,l))}return u<o},flattenQuad:function(k,s,p,n,h,r,q,o,j){var x=b.geom.flattenQuad,i=b.geom._isFlatQuad,w,v,m,l,u,t;if(o<=0||i(k,s,p,n,h,r,o,j)){q.push(h,r)}else{o--;w=(k+p)/2;v=(s+n)/2;m=(p+h)/2;l=(n+r)/2;u=(w+m)/2;t=(v+l)/2;x(k,s,w,v,u,t,q,o,j);x(u,t,m,l,h,r,q,o,j)}},flattenCubic:function(w,i,s,C,q,B,v,h,u,z,A){var t=b.geom.flattenCubic,D=b.geom._isFlatCubic,r,o,F,m,E,l,y,k,x,j,p,n;if(z<=0||D(w,i,s,C,q,B,v,h,z,A)){u.push(v,h)}else{z--;r=(s+q)/2;o=(C+B)/2;F=(w+s)/2;m=(i+C)/2;E=(F+r)/2;l=(m+o)/2;x=(q+v)/2;j=(B+h)/2;y=(r+x)/2;k=(o+j)/2;p=(E+y)/2;n=(l+k)/2;t(w,i,F,m,E,l,p,n,u,z,A);t(p,n,y,k,x,j,v,h,u,z,A)}}})}());(function(){function e(j,l,h,k,g,i){return(h-j)*(i-l)-(k-l)*(g-j)}function f(j,o,h,m,g,l){var p,n,k,q=(h-j),i=(m-o);p=((g-j)*q+(l-o)*i)/(q*q+i*i);n=j+p*q;k=o+p*i;return(n-g)*(n-g)+(k-l)*(k-l)}b.mixin(b.geom,{computeConvexHull:function(h){var g,i=h.length;if(i>2&&(i%2)===0){g=this._quickHull(h)}else{if(i===2){g=[h[0],h[1]]}else{g=[]}}return g},_quickHull:function(y){var t=[],p=y.length,h,q,s,v,u,g,o,m,k,j,w;for(s=h=q=0;s<p;s+=2){v=y[s];if(y[q]<v||(y[q]===v&&y[q+1]<y[s+1])){q=s}if(y[h]>v||(y[h]===v&&y[h+1]>y[s+1])){h=s}}if(q===h){t.push(y[q],y[q+1])}else{u=[];g=[];o=y[q];m=y[q+1];k=y[h];j=y[h+1];for(s=0;s<p;s+=2){if(s===q||s===h){continue}w=e(o,m,k,j,y[s],y[s+1]);if(w>0){u.push(y[s],y[s+1])}else{if(w<0){g.push(y[s],y[s+1])}}}t.push(k,j);b.geom._quickHullRecurse(k,j,o,m,u,t);t.push(o,m);b.geom._quickHullRecurse(o,m,k,j,g,t)}return t},_quickHullRecurse:function(j,s,h,r,v,m){var l,k=v.length,g,p,u,t,q,o;if(k>0){l=b.geom._farthestPointIndex(j,s,h,r,v);g=v[l];p=v[l+1];u=[];t=[];for(l=0;l<k;l+=2){q=v[l];o=v[l+1];if((q===j&&o===s)||(q===h&&o===r)){continue}else{if(e(g,p,j,s,q,o)>0){u.push(q,o)}else{if(e(h,r,g,p,q,o)>0){t.push(q,o)}}}}b.geom._quickHullRecurse(j,s,g,p,u,m);m.push(g,p);b.geom._quickHullRecurse(g,p,h,r,t,m)}},_farthestPointIndex:function(h,q,g,p,s){var k,j=s.length,t=-1,r=-1,o,m,l;for(k=0;k<j;k+=2){o=s[k];m=s[k+1];if((o===h&&m===q)||(o===g&&m===p)){continue}l=f(h,q,g,p,o,m);if(l>r){r=l;t=k}}return t}})}());(function(){b.UIEvents={ACTIVATE:"activate",FOCUS_IN:"focusIn",FOCUS_OUT:"focusOut"};b.MouseEvents={CLICK:"click",DBL_CLICK:"dblClick",MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",MOUSE_OVER:"mouseOver",MOUSE_OUT:"mouseOut",MOUSE_MOVE:"mouseMove",MOUSE_ENTER:"mouseEnter",MOUSE_LEAVE:"mouseLeave",MOUSE_WHEEL:"mouseWheel"};b.KeyEvents={KEY_DOWN:"keyDown",KEY_UP:"keyUp"};b.SyncEvents={BEGIN:"begin",END:"end",REPEAT:"repeat"};b.DragEvents={DRAG:"drag",DRAG_START:"dragStart",DRAG_END:"dragEnd"};b.TouchEvents={TOUCH_START:"touchStart",TOUCH_END:"touchEnd",TOUCH_MOVE:"touchMove",TOUCH_ENTER:"touchEnter",TOUCH_LEAVE:"touchLeave"};b.GenericGestureEvents={GESTURE_START:"gestureStart",GESTURE_CHANGE:"gestureChange",GESTURE_END:"gestureEnd"};b.GestureEvents={TAP:"tap",DBL_TAP:"dblTap",TOUCH_LONG_PRESS:"touchLongPress",PRESS_AND_TAP:"pressAndTap",SWIPE:"swipe",PINCH:"pinch"};b.GestureEventPhases={BEGIN:"Begin",CHANGE:"Change",CANCEL:"Cancel",END:"End"};b.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2};b.ViewEvents={LOAD:"load",VIEWPORT_RESIZE:"viewportResize",RELEASE_FOCUS:"releaseFocus",FOCUS_COMPONENT:"focusComponent",BLUR_COMPONENT:"blurComponent",USER_EVENTS_SUPPORTED:"userEventsSupported",ABOUT_INFO_REQUEST:"aboutInfoRequest",DEVICE_ORIENTATION:"deviceOrientation"}}());(function(){b.ns("oui.events");var i="CAPTURE",j="BUBBLE";function e(m,l){if(m){if(m.handleEvent){m.handleEvent(l)}else{m.call(null,l)}}}function k(l){return(typeof l==="function"||(l!==null&&l!==undefined&&typeof l.handleEvent==="function"))}function f(l){this.defaultPrevented=true;if(l!==true&&this.preventNativeDefault){this.preventNativeDefault()}}function g(l){this.stopped=true;if(l!==true&&this.stopNativePropagation){this.stopNativePropagation()}}function h(l){this.stoppedImmediate=true;this.stopPropagation(l)}b.events.EventSupport={_snapshotListeners:function(p){var o=[],n=[],r=[],m=[],l=[],q=this;p=p.toLowerCase();while(q){o.push(q);q._appendListeners(p,n,r,m,l);q=q.parentNode}return{nodes:o,bubbleListeners:n,captureListeners:r,bubbleIndices:m,captureIndices:l}},_appendListeners:function(o,q,m,l,n){var p=this.listeners;n.push(m.length);if(p&&p[o]){m.push.apply(m,p[o][i]);q.push.apply(q,p[o][j])}l.push(q.length-1)},_checkListeners:function(){if(this.listeners===undefined){this.listeners={}}},addEventListener:function(p,q,m){var r,l,o,n=false;if(typeof p==="string"&&k(q)){p=p.toLowerCase();this._checkListeners();if(this.listeners[p]===undefined){this.listeners[p]={};this.listeners[p][i]=[];this.listeners[p][j]=[]}r=m===true?i:j;l=this.listeners[p][r];o=l.length;while(o--&&!n){n=(q===l[o])}if(!n){l.push(q)}}},removeEventListener:function(n,o,m){var l,p;if(typeof n==="string"&&k(o)&&this.listeners){n=n.toLowerCase();l=this.listeners[n];if(l){p=m===true?i:j;b.arrayRemove(l[p],o,false)}}},dispatchEvent:function(l){var u,p,v,m,n,q,x,z,r,y,o,w,t,s;if(l&&typeof l.type==="string"){l.timeStamp=b.currentTimeMillis();u=(l.bubbles!==false);p=(l.cancelable===true);v=null;if(typeof l.defaultAction==="function"){v=l.defaultAction}l.CAPTURING_PHASE=1;l.AT_TARGET=2;l.BUBBLING_PHASE=3;l.preventDefault=f;l.stopPropagation=g;l.stopImmediatePropagation=h;m=this._snapshotListeners(l.type);n=m.nodes;q=m.captureListeners;x=m.bubbleListeners;z=m.captureIndices;r=m.bubbleIndices;l.eventPhase=l.CAPTURING_PHASE;l.target=this;l.stopped=false;l.stoppedImmediate=false;l.defaultPrevented=false;y=q.length-1;for(t=n.length-1;t>0&&l.stopped===false;t--){l.currentTarget=n[t];for(s=y;s>=z[t]&&l.stoppedImmediate===false;s--){e(q[y],l);y--}}l.eventPhase=l.AT_TARGET;l.currentTarget=this;o=0;if(l.stopped!==true){for(s=y;s>=0&&l.stoppedImmediate===false;s--){e(q[y],l);y--}for(s=0;s<=r[0]&&l.stoppedImmediate===false;s++){e(x[o],l);o++}}if(u){l.eventPhase=l.BUBBLING_PHASE;w=n.length;for(t=1;t<w&&l.stopped===false;t++){l.currentTarget=n[t];for(s=o;s<=r[t]&&l.stoppedImmediate===false;s++){e(x[o],l);o++}}}if(v!==null&&(p===false||l.defaultPrevented!==true)){v.call(null,l)}}},getDefaultActivateAction:function(){var l;if(this.activateAction){l=this.activateAction}else{if(b.isA(this.getActivateAction,Function)){l=this.getActivateAction()}}return l},handler:function(p,n,m,l,q){var o=null,r=null;if(p){if(typeof p==="string"){if(typeof this[p]==="function"){o=this;r=this[p]}}else{if(typeof p==="function"){r=p}else{if(typeof p.handleEvent==="function"){o=p;r=p.handleEvent}}}}if(!r){c.error("ERR__EVT__INV_HANDLER")}return function(s){if(b.isValueInConstraint(s,q)){if(l===true){s.stopPropagation()}if(m===true){s.preventDefault()}r.call(o,s,n)}}}}}());(function(){b.ns("oui.events");var l=b.events,i=b.defs,m={},o,s,n,r,p,f,k;function e(w,v){var t,u=Math.min(w.length,v.length);for(t=0;t<u;t++){if(w[t]!==v[t]){break}}return(t-1)}function g(){l._stopNextNativeMouseEvent(this.type,this.clientX,this.clientY)}r={mousedown:function(t,u){if(!o||u!==o.target||t.clientX!==o.clientX||t.clientY!==o.clientY){n=1}else{n++}if(t.hasOwnProperty("detail")===false){t.detail=n}o=t},mouseup:function(t,u){if(!o||u!==o.target||t.clientX!==o.clientX||t.clientY!==o.clientY){n=1}if(t.hasOwnProperty("detail")===false){t.detail=n}}};p={mouseover:function(t){l.handleEnter(t.target,t.relatedTarget,b.MouseEvents.MOUSE_ENTER,t)},mouseout:function(t){l.handleLeave(t.target,t.relatedTarget,b.MouseEvents.MOUSE_LEAVE,t)},mousedown:function(t){var u=t.target,v=u;if(b.focus.isFocusableTarget(u)!==true){v=b.focus.getFocusableAncestor(u)}if(v!==null){b.focusManager.requestFocus(v,t);v.dispatchEvent({type:b.UIEvents.ACTIVATE,defaultAction:v.getDefaultActivateAction()})}},mouseup:function(w){var v=b.MouseEvents.CLICK,u=b.MouseEvents.DBL_CLICK,t;if(o&&w.target===o.target&&w.clientX===o.clientX&&w.clientY===o.clientY){t={type:v,clientX:w.clientX,clientY:w.clientY,pageX:w.pageX,pageY:w.pageY,userX:w.userX,userY:w.userY,ctrlKey:w.ctrlKey,shiftKey:w.shiftKey,altKey:w.altKey,button:w.button,detail:w.detail,defaultAction:null,stopNativePropagation:g};w.target.dispatchEvent(t);if(s&&t.target===s.target&&t.userX===s.userX&&t.userY===s.userY&&t.button===s.button&&t.detail%2===0&&t.timeStamp-s.timeStamp<500){t.target.dispatchEvent({type:u,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,userX:t.userX,userY:t.userY,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,button:t.button,detail:t.detail,defaultAction:null,stopNativePropagation:g})}s=t}}};f={KEYS:"KEYS",MOUSE:"MOUSE",WHEEL:"WHEEL",TOUCHES:"TOUCHES",GESTURES:"GESTURES"};k=function(){this._initProperties()};b.mixin(k,b.lang.PropertiesSupport);b.mixin(k,{onPropChanged:function(u){var t=this._properties.fromPlatform;switch(u){case f.KEYS:l.toggleNativeKeys(t.keyEvents);break;case f.MOUSE:l.toggleNativeMouse(t.mouseEvents);break;case f.WHEEL:l.toggleNativeWheel(t.wheelEvents);break;case f.TOUCHES:l.toggleNativeTouches(t.touchEvents);break;case f.GESTURES:l.toggleNativeGestures(t.gestureEvents);break;default:}}});b.addPropertiesSupport(k,{fromPlatform:{keyEvents:i.Boolean(false,f.KEYS),mouseEvents:i.Boolean(false,f.MOUSE),wheelEvents:i.Boolean(false,f.WHEEL),touchEvents:i.Boolean(false,f.TOUCHES),gestureEvents:i.Boolean(false,f.GESTURES)},fromContainer:{keyEvents:i.Boolean(true),mouseEvents:i.Boolean(true),wheelEvents:i.Boolean(true),touchEvents:i.Boolean(true),gestureEvents:i.Boolean(true)}});b.mixin(b.events,{_userEventsSupport:new k(),setUserEventsSupported:function(t){l._userEventsSupport.applyProperties(t)},getUserEventsSupported:function(){var t=l._userEventsSupport;return{fromPlatform:{keyEvents:t.fromPlatformKeyEvents(),mouseEvents:t.fromPlatformMouseEvents(),wheelEvents:t.fromPlatformWheelEvents(),touchEvents:t.fromPlatformTouchEvents(),gestureEvents:t.fromPlatformGestureEvents()},fromContainer:{keyEvents:t.fromContainerKeyEvents(),mouseEvents:t.fromContainerMouseEvents(),wheelEvents:t.fromContainerWheelEvents(),touchEvents:t.fromContainerTouchEvents(),gestureEvents:t.fromContainerGestureEvents()}}},toggleNativeKeys:function(t){},toggleNativeMouse:function(t){},toggleNativeWheel:function(t){},toggleNativeTouches:function(t){},toggleNativeGestures:function(t){},dispatchExternalEvent:function(u){var t=null;if(typeof b.config.catchAllEventListener==="function"&&u){u.domId=b.config.domId;b.config.catchAllEventListener(u,u.domId);t=u.returnValue}return t},handleExternalEvent:function(A){var C=l._userEventsSupport,D,u,y,v,t=C.fromContainerKeyEvents(),x=C.fromContainerMouseEvents(),B=C.fromContainerWheelEvents(),w=C.fromContainerTouchEvents(),z=C.fromContainerGestureEvents();if(A===null){c.warn("WARN__EVT__NPE")}else{if(A){u={type:A.type};y=null;if(b.hasOwnValue(b.KeyEvents,u.type,true)){if(t){u.cancelable=true;y=b.focusManager.getFocusOwner();u.keyCode=A.keyCode;l._getModifiers(u,A)}}else{if(b.equalIgnoreCase(b.MouseEvents.MOUSE_WHEEL,u.type)){if(B){y=l._getNodeFromContainer(A);if(y){l._getCoordsFromContainer(u,A,y);l._getModifiers(u,A);if(typeof A.delta==="number"){u.delta=A.delta}else{u.delta=0}}}}else{if(b.hasOwnValue(b.MouseEvents,u.type,true)){if(x){y=l._getNodeFromContainer(A);if(y){l._getCoordsFromContainer(u,A,y);l._getModifiers(u,A);if(b.equalIgnoreCase(b.MouseEvents.MOUSE_OVER,u.type)||b.equalIgnoreCase(b.MouseEvents.MOUSE_OUT,u.type)){u.relatedTarget=null}if(typeof A.button==="number"){u.button=A.button}else{u.button=0}}}}else{if(b.hasOwnValue(b.TouchEvents,u.type,true)){if(w){y=l._getNodeFromContainer(A);if(y){l._getCoordsFromContainer(u,A,y);l._getModifiers(u,A)}}}else{if(b.hasOwnValue(b.GenericGestureEvents,u.type,true)){if(z){y=b.rootNode;u.rotation=A.rotation;u.scale=A.scale}}else{y=b.rootNode;for(v in A){if(v!=="type"){u[v]=A[v]}}}}}}}if(y!==null){l._dispatchTo(y,u)}D=u.returnValue}}return D},_dispatchKeyEvent:function(v){var t,u=b.focusManager.getFocusOwner();if(u!==null){t=l._createAPIEvent(v,true);l._getKeyArgs(t,v);l._dispatchTo(u,t)}},_dispatchMouseEvent:function(v){var t,u=l._getAPITarget(v);if(u!==null){t=l._createAPIEvent(v);l._getMouseArgs(t,v,u);l._dispatchTo(u,t)}},_dispatchTouchEvent:function(w){var v=l._createAPIEvent(w,true),C=w.changedTouches,E=C.length,F=[],u=w.targetTouches,I=u.length,D=[],G=w.touches,z=G.length,B=[],H,A,y,x;if(v.type===b.TouchEvents.TOUCH_START){for(H=0;H<E;H++){A=C[H];y=l._createAPITouch(A);if(y){x={touchValue:y,relatedTarget:null};m[A.identifier]=x;l._handleTouchEnterLeave(A,x);F.push(y)}}}else{for(H=0;H<E;H++){A=C[H];x=m[A.identifier];if(x){y=x.touchValue;l._updateAPITouch(A,y);l._handleTouchEnterLeave(A,x);F.push(y)}}}for(H=0;H<I;H++){A=u[H];x=m[A.identifier];if(x){D.push(x.touchValue)}}for(H=0;H<z;H++){A=G[H];x=m[A.identifier];if(x){B.push(x.touchValue)}}v.changedTouches=F;v.targetTouches=D;v.touches=B;l._getModifiers(v,w);l._getGestureArgs(v,w);if(F.length>0&&F[0].target){l._dispatchTo(F[0].target,v)}},_handleTouchEnterLeave:function(v,u){var w=l._getAPITarget(v),t;if(w!==null){t=u.relatedTarget;if(w!==t){if(t!==null){l.handleLeave(t,w,b.TouchEvents.TOUCH_LEAVE,u.touchValue)}l.handleEnter(w,t,b.TouchEvents.TOUCH_ENTER,u.touchValue)}u.relatedTarget=w}},handleEnter:function(z,t,w,y){var x=z.getAncestors(),u=-1,v;if(t!==null){u=e(x,t.getAncestors())}for(v=u+1;v<x.length;v++){x[v].dispatchEvent({type:w,clientX:y.clientX,clientY:y.clientY,userX:y.userX,userY:y.userY,ctrlKey:y.ctrlKey,shiftKey:y.shiftKey,altKey:y.altKey,relatedTarget:t,bubbles:false})}},handleLeave:function(z,t,w,y){var x=z.getAncestors(),u=-1,v;if(t!==null){u=e(x,t.getAncestors())}for(v=x.length-1;v>u;v--){x[v].dispatchEvent({type:w,clientX:y.clientX,clientY:y.clientY,userX:y.userX,userY:y.userY,ctrlKey:y.ctrlKey,shiftKey:y.shiftKey,altKey:y.altKey,relatedTarget:t,bubbles:false})}},_createAPITouch:function(){},_updateAPITouch:function(){return null},_dispatchGestureEvent:function(u){var t=l._createAPIEvent(u,true);l._getGestureArgs(t,u);l._dispatchTo(b.rootNode,t)},_createAPIEvent:function(t,u){return{type:l._getAPIType(t),cancelable:u,preventNativeDefault:l._preventNativeDefault(t),stopNativePropagation:l._stopNativePropagation(t)}},_dispatchTo:function(x,w){var t=w.type.toLowerCase(),v=r[t],u=p[t];if(v){v(w,x)}x.dispatchEvent(w);if(u){u(w)}b.tree.layout()},_getModifiers:function(u,t){u.ctrlKey=t.ctrlKey;u.shiftKey=t.shiftKey;u.altKey=t.altKey},_getNodeFromContainer:function(w){var v=null,u=w.clientX,t=w.clientY,x=w.delta;if(isFinite(u)&&isFinite(t)){v=b.tree.getNodeAt(u,t)}else{if(isFinite(x)){v=b.rootNode}}return v},_getCoordsFromContainer:function(t,x,w){var v=x.clientX,u=x.clientY,y=w.globalToLocal(v,u);t.clientX=v;t.clientY=u;t.pageX=x.pageX;t.pageY=x.pageY;t.userX=y.x;t.userY=y.y},_getAPIType:function(){return undefined},_preventNativeDefault:function(t){return function(){t.preventDefault()}},_stopNativePropagation:function(t){return function(){t.stopPropagation()}},_stopNextNativeMouseEvent:function(){},_getAPITarget:function(){return null},_getKeyArgs:function(){},_getMouseArgs:function(){},_getGestureArgs:function(){}});function h(t){return function(v,u){this.addEventListener(t,v,u)}}function j(t){return function(v,u){this.removeEventListener(t,v,u)}}function q(t){return function(w){var u="",v="";if(w===undefined){w=0}u+=t;v+=w;if(!this._eventDescCache){this._eventDescCache={}}if(!this._eventDescCache[u]){this._eventDescCache[u]={}}if(!this._eventDescCache[u][v]){this._eventDescCache[u][v]={source:this,type:t,offset:w}}return this._eventDescCache[u][v]}}b.addEventsSupport=function(B,v){var z=B.superClass,y=B.prototype,C={},A,t,x,w,u;if(b.isA(v,Array)){x={};for(w=0,u=v.length;w<u;w++){b.mixin(x,v[w])}v=x}if(z&&z.prototype.events){C.prototype=z.prototype.events}for(t in v){if(v.hasOwnProperty(t)){A=v[t];C[t]=A;x=A.charAt(0).toUpperCase()+A.substr(1);y["on"+x]=h(A);y["off"+x]=j(A);y["on"+x+"At"]=q(A)}}y.events=C}}());(function(){var n=b.events,r=null,w=b.MouseEvents,x=b.KeyEvents,y=b.TouchEvents,q=b.GenericGestureEvents,t=b.CursorType.AUTO,v={},o="mousedown",g="mouseup",u="mouseover",B="mouseout",s="mousemove",m="keydown",i="keyup",e="touchstart",l="touchmove",f="touchend",p="gesturestart",k="gesturechange",j="gestureend";v[o]=w.MOUSE_DOWN;v[g]=w.MOUSE_UP;v[s]=w.MOUSE_MOVE;v[u]=w.MOUSE_OVER;v[B]=w.MOUSE_OUT;v[m]=x.KEY_DOWN;v[i]=x.KEY_UP;v[e]=y.TOUCH_START;v[l]=y.TOUCH_MOVE;v[f]=y.TOUCH_END;v[p]=q.GESTURE_START;v[k]=q.GESTURE_CHANGE;v[j]=q.GESTURE_END;function h(C){var E=n._getAPITarget(C),D;D={type:C.type,apiTarget:E,clientX:C.clientX,clientY:C.clientY,ctrlKey:C.ctrlKey,shiftKey:C.shiftKey,altKey:C.altKey,detail:C.detail,button:C.button,stopPropagation:function(){C.stopPropagation()},preventDefault:function(){C.preventDefault()}};if(E){n._dispatchMouseEvent(D)}if(E!==r){if(r){D.type=B;D.apiTarget=r;D.apiRelatedTarget=E;D.stopPropagation=b.NO_OP;D.preventDefault=b.NO_OP;n._dispatchMouseEvent(D)}if(E){D.type=u;D.apiTarget=E;D.apiRelatedTarget=r;D.stopPropagation=b.NO_OP;D.preventDefault=b.NO_OP;n._dispatchMouseEvent(D)}}r=E}function A(C){C.apiTarget=r;C.apiRelatedTarget=null;n._dispatchMouseEvent(C);r=null}function z(C){return(C?"add":"remove")+"EventListener"}b.mixin(b.events,{_stopNextNativeMouseEvent:function(F,C,H){var D=b.tree.canvas,E=F.toLowerCase(),G;G=function(I){var J=n.cvClientToRootCoords(I);if(C===J.x&&H===J.y){I.stopPropagation()}D.removeEventListener(E,G,true)};D.addEventListener(E,G,true)},_getAPIType:function(C){return v[C.type]},_getAPITarget:function(C){var D=null,E;if(!C.apiTarget){E=this.cvClientToRootCoords(C);D=b.tree.getNodeAt(E.x,E.y)}else{D=C.apiTarget}return D},_getKeyArgs:function(D,C){D.keyCode=C.keyCode;this._getModifiers(D,C)},_getMouseArgs:function(D,C,F){var E=C.type,G=this.cvClientToRootCoords(C);this.cvSetCoords(D,C,F,G);this._getModifiers(D,C);if(C.button!==undefined){D.button=C.button}if(E===u){D.relatedTarget=C.apiRelatedTarget;this.cvSetCursor(F)}else{if(E===B){D.relatedTarget=C.apiRelatedTarget;this.cvSetCursor(null)}}},_createAPITouch:function(C){var E,D=this.cvClientToRootCoords(C),F=b.tree.getNodeAt(D.x,D.y);if(F){E={identifier:C.identifier,target:F};this.cvSetCoords(E,C,F,D)}return E},_updateAPITouch:function(C,E){var D=this.cvClientToRootCoords(C);this.cvSetCoords(E,C,E.target,D)},_getGestureArgs:function(D,C){D.rotation=C.rotation;D.scale=C.scale},cvClientToRootCoords:function(C){var D=b.tree.cvGetRootClientCoords();return{x:(C.clientX-D.x),y:(C.clientY-D.y)}},cvSetCoords:function(C,E,F,D){var G=F.globalToLocal(D.x,D.y);C.clientX=D.x;C.clientY=D.y;C.userX=G.x;C.userY=G.y;C.screenX=E.screenX;C.screenY=E.screenY},toggleNativeKeys:function(E){var D=b.tree.canvas,C=z(E);D[C](m,this._dispatchKeyEvent,false);D[C](i,this._dispatchKeyEvent,false)},toggleNativeMouse:function(E){var D=b.tree.canvas,C=z(E);D[C](o,this._dispatchMouseEvent,false);D[C](g,this._dispatchMouseEvent,false);D[C](s,h,false);D[C](B,A,false)},toggleNativeTouches:function(E){var D=b.tree.canvas,C=z(E);D[C](e,this._dispatchTouchEvent,false);D[C](l,this._dispatchTouchEvent,false);D[C](f,this._dispatchTouchEvent,false)},toggleNativeGestures:function(E){var D=b.tree.canvas,C=z(E);D[C](p,this._dispatchGestureEvent,false);D[C](k,this._dispatchGestureEvent,false);D[C](j,this._dispatchGestureEvent,false)},cvSetCursor:function(D){var C=b.tree.canvas,E=t;while(D&&E===t){E=D.cursor();D=D.parentNode}C.style.cursor=(typeof E==="object"?"none":E)},cvGetLastTarget:function(){return r}})}());(function(){b.ns("oui.events");b.events.addDragSupport=function(l){var i,j,o,e,n,m,k,f,h,g;j=function(p){var r,q,v,t,u,s,x,w;p.stopPropagation();p.preventDefault();if(p.changedTouches===undefined){r=p.clientX;q=p.clientY}else{w=p.changedTouches[0];r=w.clientX;q=w.clientY}x=n.globalToLocal(r,q);v=x.x;t=x.y;x=n.globalToLocal(h,g);u=x.x;s=x.y;n.dispatchEvent({type:b.DragEvents.DRAG,cancelable:true,dragClientX:(r-h),dragClientY:(q-g),dragUserX:(v-u),dragUserY:(t-s),clientX:r,clientY:q,userX:v,userY:t,shiftKey:p.shiftKey,ctrlKey:p.ctrlKey,defaultAction:n.getDefaultDragAction()});h=r;g=q};o=function(p){var s,q,u,t,x,w,A,y,r,z,v;l.offMouseMove(j);l.offMouseUp(o);l.offTouchMove(j);l.offTouchEnd(o);l.offMouseLeave(o);if(n){A=n.globalToLocal(m,k);x=A.x;w=A.y;s=h;q=g;y=false;r=false;if(p){if(p.changedTouches===undefined){s=p.clientX;q=p.clientY}else{v=p.changedTouches[0];s=v.clientX;q=v.clientY}y=p.shiftKey;r=p.ctrlKey;z=p.timeStamp-f}A=n.globalToLocal(s,q);u=A.x;t=A.y;n.dispatchEvent({type:b.DragEvents.DRAG_END,cancelable:true,shiftKey:y,ctrlKey:r,clientX:s,clientY:q,userX:u,userY:t,totalDragClientX:(s-m),totalDragClientY:(q-k),totalDragUserX:(u-x),totalDragUserY:(t-w),totalDragTime:z});n=undefined}};e=function(){l.onMouseLeave(o)};i=function(t){var v=t.target,s,r,u=t.touches,p,q=false,w;if(u!==undefined){if(u.length===1){p=u[0]}else{q=true}}if(q){o(t)}else{while(v&&!v.draggable()){v=v.parentNode}if(v){n=v;if(p===undefined){s=t.clientX;r=t.clientY}else{s=p.clientX;r=p.clientY}w=n.globalToLocal(s,r);n.dispatchEvent({type:b.DragEvents.DRAG_START,cancelable:true,shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,clientX:s,clientY:r,userX:w.x,userY:w.y,defaultAction:e,stopDrag:o});m=h=s;k=g=r;f=t.timeStamp;l.onMouseMove(j);l.onMouseUp(o);l.onTouchMove(j);l.onTouchEnd(o)}}};l.onMouseDown(i);l.onTouchStart(i)}}());var b=b||{};(function(){function e(t,u,n,p,i,m,k,l,s,h,r,o,q){var j=document.createEvent("MouseEvents");j.initMouseEvent(t,u,n,window,p,i.x,i.y,m,k,l,h,s,r,o,q);return j}function g(u,w,n,q,i,m,k,l,t,h,s,p,r,v,o,x){var j=document.createEvent("TouchEvent");j.initTouchEvent(u,w,n,window,q,i.x,i.y,m,k,l,h,t,s,p,r,v,o,x);return j}function f(h){return{x:h.screenX,y:h.screenY}}b.addGestureSupport=function(n,r,m,u,j,l,h){var s,q,i,t,v,p,o={},k;r=r||e;m=m||g;u=u||f;if(typeof j!=="number"){j=500}if(typeof l!=="number"){l=800}if(typeof h!=="number"){h=10}t=function(w){return function(){var z=o[w.identifier],x,y;if(z&&z.longPressTimeoutID){x=z.event;y=r("touchlongpress",true,true,k,u(w),w.clientX,w.clientY,x.ctrlKey,x.shiftKey,x.altKey,x.metaKey,0,w.target);w.target.dispatchEvent(y);z.longPressTimeoutID=undefined}}};q=function(y){var x=y.changedTouches,w,z=x.length,A,B;for(w=0;w<z;w++){B=x[w];A=o[B.identifier];if(A.longPressTimeoutID&&Math.abs(B.clientX-A.clientX)>h&&Math.abs(B.clientY-A.clientY)>h){clearTimeout(A.longPressTimeoutID);A.longPressTimeoutID=undefined}}};v=function(x){var w;if(x.detail>1&&x.timeStamp-p.timeStamp<j){w=r("dbltap",true,true,x.detail,u(x),x.clientX,x.clientY,x.ctrlKey,x.shiftKey,x.altKey,x.metaKey,0,x.target);x.target.dispatchEvent(w)}p=x};i=function(y){var D,B,C,A,w,x,E,z;n.removeEventListener("touchend",i,true);if(y.fake!==true){D=y.changedTouches;C=D.length;for(B=0;B<C;B++){A=D[B];w=o[A.identifier];if(w){if(w.longPressTimeoutID){clearTimeout(w.longPressTimeoutID);w.longPressTimeoutID=undefined}if(Math.abs(A.clientX-w.clientX)<h&&Math.abs(A.clientY-w.clientY)<h&&y.timeStamp-w.timeStamp<j){y.stopPropagation(true);x=m("touchend",true,true,y.detail,u(y),y.clientX,y.clientY,y.ctrlKey,y.shiftKey,y.altKey,y.metaKey,y.touches,y.targetTouches,y.changedTouches,y.scale,y.rotation);x.fake=true;y.target.dispatchEvent(x);if(x.defaultPrevented===true){y.preventDefault()}if(x.stopped===true){y.stopPropagation()}z=1;if(p&&Math.abs(A.clientX-p.clientX)<h&&Math.abs(A.clientY-p.clientY)<h){z=p.detail+1}E=r("tap",true,true,z,u(A),A.clientX,A.clientY,y.ctrlKey,y.shiftKey,y.altKey,y.metaKey,0,y.target);y.target.dispatchEvent(E);v(E)}o[A.identifier]=undefined}}}};s=function(z){var y=z.changedTouches,x,A=y.length,B,w;k=z.touches.length;for(x=0;x<A;x++){B=y[x];w={identifier:B.identifier,screenX:B.screenX,screenY:B.screenY,clientX:B.clientX,clientY:B.clientY,event:z};o[B.identifier]=w;w.timeStamp=z.timeStamp;w.longPressTimeoutID=setTimeout(t(B,o),l)}n.addEventListener("touchmove",q,true);n.addEventListener("touchend",i,true)};n.addEventListener("touchstart",s,true)}}());(function(){b.ns("oui.events");b.events.addPressNTapSupport=function(e){var f;e.onTouchStart(function(g){f=g});e.onTouchMove(function(){f=undefined});e.onTap(function(g){if(f){if(g.identifier!==f.identifier){f.target.dispatchEvent({type:b.GestureEvents.PRESS_AND_TAP,clientX:f.clientX,clientY:f.clientY,userX:f.userX,userY:f.userY,tapClientX:(g.clientX-f.clientX),tapClientY:(g.clientX-f.clientY),tapUserX:(g.userX-f.userX),tapUserY:(g.userY-f.userY),ctrlKey:f.ctrlKey,shiftKey:f.shiftKey})}f=undefined}});e.onTouchEnd(function(g){if(f&&g.identifier===f.identifier){f=undefined}})}}());(function(){var g=20,e=0.2;function f(j,h){var i=b.geom.centroid(j.touches,"clientX","clientY");b.rootNode.dispatchEvent({type:b.GestureEvents.PINCH,clientX:i.x,clientY:i.y,userX:i.x,userY:i.y,phase:b.GestureEventPhases[h],scale:j.scale,rotation:j.rotation,preventNativeDefault:function(){j.preventNativeDefault()}})}b.ns("oui.events");b.events.addPinchSupport=function(i){var j=false,h=false;i.onTouchStart(function(){j=false;h=false});i.onTouchMove(function(k){if(!j){if(Math.abs(k.rotation)>g){if(h){f(k,"CANCEL")}j=true}else{if(h){f(k,"CHANGE")}else{if(Math.abs(k.scale-1)>e){h=true;f(k,"BEGIN")}}}}});i.onTouchEnd(function(k){if(h&&!j){if(Math.abs(k.rotation)>g){f(k,"CANCEL");j=true}else{f(k,"END");j=true}}})}}());(function(){var g=b.DirectionEnum,e=10,k=Math.PI/4;function i(n,p,m,o){var r,q=Math.atan2((o-p),(m-n));if(Math.abs(q)<k){r=g.RIGHT}else{if(Math.abs(q-Math.PI/2)<k){r=g.DOWN}else{if(Math.abs(q+Math.PI/2)<k){r=g.UP}else{r=g.LEFT}}}return r}function l(n,o){var m=n.length;while(m--){if(o===n[m].identifier){break}}return n[m]}function j(t,p,s,n){var o=p.screenX-t.screenX,m=p.screenY-t.screenY,r=n.screenX-s.screenX,q=n.screenY-s.screenY;return b.geom.dotprod(o,m,r,q)>=0}function f(p){var t=[],o=p.length,n,u,r,q,s=Number.MAX_VALUE,m;while(o--){u=p[o].target.getAncestors();if(u.length<s){s=u.length;m=o}t.push(u)}r=t.splice(m,1)[0];for(o=0;o<s;o++){q=r[o];n=t.length;while(n--){if(t[n][o]!==q){break}}if(n>=0){break}}return r[o-1]}function h(m,o){var n=f(m);if(n){n.dispatchEvent({type:b.GestureEvents.SWIPE,phase:b.GestureEventPhases[o.phase],direction:o.direction,translate:o.translate,velocity:o.velocity})}}b.ns("oui.events");b.events.SwipeSupport={_forEachChangedTouch:function(r,q,m){var p=r.changedTouches,s=r.timeStamp,o,t=p.length;for(o=0;o<t&&(m===null||!m());o++){this[q](p[o],s)}},_handleStartedTouch:function(n){var m=this._touchesStarted;if(m){if(l(m,n.identifier)===undefined){this._touchesStarted.push(n)}else{if(this._nTouchesEnded>0){this._touchesStarted=undefined}}}else{this._touchesStarted=[n];this._touchesMoved={};this._nTouchesMoved=0;this._nTouchesEnded=0;this._centroid=undefined;this._gestureInfo=undefined}},_handleMovedTouch:function(w,n){var p=this._gestureInfo,u,D,m,o,C,z,s,x,E,q,t=0,y=0,B=0,A=true,r=w.identifier,v=l(this._touchesStarted,r);if(v===undefined){if(p){p.phase="CANCEL";h(this._touchesStarted,p)}this._touchesStarted=undefined}else{if(this._touchesMoved[r]===undefined){this._nTouchesMoved++}this._touchesMoved[r]=w;o=this._touchesStarted.length;C=this._nTouchesMoved;if(C===o){if(p===undefined){D={};u=this._centroid;if(u===undefined){u=b.geom.centroid(this._touchesStarted,"screenX","screenY");this._centroid=u}z=this._touchesStarted[0];s=this._touchesMoved[z.identifier];for(x=0;x<o;x++){E=this._touchesStarted[x];q=this._touchesMoved[E.identifier];y+=b.geom.dist(E.screenX,E.screenY,u.x,u.y);t=b.geom.dist(q.screenX,q.screenY,u.x,u.y);B+=t;A=A&&j(z,s,E,q);D[E.identifier]={lastMovedTouch:q,distanceToCentroid:t}}y/=o;B/=C;m=Math.abs(y-B);if(m>e){this._startGestureTime=n;p={phase:"BEGIN",centroid:u,meanDistances:y,newMeanDistances:B,touchesInfo:D,duration:1};if(A){p.direction=i(v.screenX,v.screenY,w.screenX,w.screenY);p.translate=m;p.velocity=m/p.duration;h(this._touchesStarted,p)}else{this._touchesStarted=undefined}this._gestureInfo=p}}else{this._updateGestureEvent(w,n,false)}}}},_updateGestureEvent:function(q,p,t){var s=this._gestureInfo,o=s.touchesInfo[q.identifier],n,r,m;if(o){n=b.geom.dist(q.screenX,q.screenY,this._centroid.x,this._centroid.y);r=s.newMeanDistances+(n-o.distanceToCentroid)/this._touchesStarted.length;s.newMeanDistances=r;s.duration=(p-this._startGestureTime);m=Math.abs(s.meanDistances-r);if(t||(s.direction===i(o.lastMovedTouch.screenX,o.lastMovedTouch.screenY,q.screenX,q.screenY))){if(t){s.phase="END"}else{s.phase="CHANGE"}s.translate=m;s.velocity=m/s.duration;h(this._touchesStarted,s)}else{s.phase="CANCEL";h(this._touchesStarted,s);this._touchesStarted=undefined}o.lastMovedTouch=q;o.distanceToCentroid=n}else{s.phase="CANCEL";h(this._touchesStarted,s);this._touchesStarted=undefined}},_handleEndedTouch:function(n,m){this._nTouchesEnded++;if(this._gestureInfo){this._updateGestureEvent(n,m,true);if(this._touchesStarted.length===this._nTouchesEnded){this._touchesStarted=undefined}}else{this._touchesStarted=undefined}}};b.events.addSwipeSupport=function(n){var o=b.events.SwipeSupport,m;m=function(){return(this._touchesStarted===undefined)};n.onTouchStart(function(p){return o._forEachChangedTouch(p,"_handleStartedTouch",null)});n.onTouchMove(function(p){return o._forEachChangedTouch(p,"_handleMovedTouch",m)});n.onTouchEnd(function(p){return o._forEachChangedTouch(p,"_handleEndedTouch",m)})}}());(function(){b.ns("oui.focus");b.mixin(b.focus,{getFocusableAncestor:function(g){var f=null,e=g.parentNode;if(e){if(b.focus.isFocusableTarget(e)){f=e}else{f=b.focus.getFocusableAncestor(e)}}return f},getFocusableDescendant:function(j,i,f){var e=null,g=true,h,k;if(i===false){g=false}h=g?"firstChild":"lastChild";k=g?"nextSibling":"previousSibling";j=f?f[k]:j[h];while(j&&!e){if(j._style.display){if(j._style.focusable){e=j}else{e=b.focus.getFocusableDescendant(j,g)}}j=j[k]}return e},isFocusableTarget:function(e){return e._style.display&&e._style.focusable}})}());(function(){var f=b.UIEvents.FOCUS_IN,e=b.UIEvents.FOCUS_OUT,g={};g[f]=function(m){var n=m.target,l=n.getLayoutBounds(b.tree.focusLayer),h=n.getFocusOutlineOffset(),k=l.width+h*2,i=l.height+h*2,j;if(k>0&&i>0){j=new b.graphics.Rectangle({x:l.x-h,y:l.y-h,width:k,height:i,fill:b.NO_PAINT,stroke:b.focusManager._strokeFocusOutline||b.GRAY});b.tree.focusLayer.appendChild(j)}};g[e]=function(){b.tree.focusLayer.removeChildren()};b.declare({name:"oui.focus.FocusManager",mixins:[b.events.EventSupport],membersDef:{init:function(h){if(!b.isA(h,b.graphics.AbstractGraphicNode)){h=null}this._focusRoot=h;this._focusOwner=h;b.rootNode.addEventListener(b.ViewEvents.FOCUS_COMPONENT,this.handler("_onFocusCmp"));b.rootNode.addEventListener(b.ViewEvents.BLUR_COMPONENT,this.handler("_onBlurCmp"));b.rootNode.onKeyDown(b.focus.DefaultFocus)},getFocusOwner:function(){return this._focusOwner},setFocusOutline:function(h){if(b.isA(h,b.style.Paint)){this._strokeFocusOutline=h}},requestFocus:function(h,i){if(b.isA(h,b.graphics.AbstractGraphicNode)&&h.getFocusable()){this._moveFocus(this._getValidFocusOwner(h),i)}},releaseFocus:function(){b.events.dispatchExternalEvent({type:b.ViewEvents.RELEASE_FOCUS})},_onFocusCmp:function(){if(this._focusOwner!==this._focusRoot){var h=this._focusOwner;this._focusOwner=this._focusRoot;this._moveFocus(h,undefined,true)}},_onBlurCmp:function(){this._fire(e,this._focusOwner,null,null)},moveFocusDirection:function(i){if(!b.isA(i,Boolean)){i=true}var h=this._getValidFocusOwner(this._focusOwner);h=this._moveFocusDirection(h,i);if(h===null){h=b.focus.getFocusableDescendant(this._focusRoot,i)}this._moveFocus(h)},_getValidFocusOwner:function(h){var k=h.getAncestors(),n=k.length,l=null,j,m=false;for(j=0;j<n;j++){l=k[j];if(l===this._focusRoot){m=true}if(!l.getDisplay()){break}}if(!m){l=null}return l},_moveFocus:function(h,i,j){var k=this._focusOwner;if(h!==null&&h!==k){this._fire(e,k,h,i);this._fire(f,h,k,i,j);this._moveFocusImpl(h);this._focusOwner=h}},_moveFocusImpl:function(h){},reFocus:function(){if(this._focusOwner!==null){this._reFocusImpl(this._focusOwner)}},_reFocusImpl:function(h){},_moveFocusDirection:function(k,j){var i=null,h;if(k!==null){h=k.parentNode;i=b.focus.getFocusableDescendant(h,j,k);if(i===null){i=this._moveFocusDirection(h,j)}}return i},_fire:function(l,m,h,i,k){var j=false,n=false;if(i){j=(i.shiftKey===true);n=(i.ctrlKey===true)}m.dispatchEvent({type:l,target:m,relatedTarget:h,cancelable:true,shiftKey:j,ctrlKey:n,defaultAction:g[l],details:k})}}})}());(function(){b.ns("oui.focus");var e=b.KeyCode;b.focus.DefaultFocus={handleEvent:function(g){var f=b.focusManager;if(b.equalIgnoreCase(b.KeyEvents.KEY_DOWN,g.type)){switch(g.keyCode){case e.TAB:f.moveFocusDirection(!g.shiftKey);break;case e.LEFT_ARROW:f.moveFocusDirection(false);break;case e.RIGHT_ARROW:f.moveFocusDirection(true);break;case e.ESC:f.releaseFocus();break;case e.ENTER:case e.SPACEBAR:g.target.dispatchEvent({type:b.UIEvents.ACTIVATE,defaultAction:g.target.getDefaultActivateAction()});break;default:break}}}}}());(function(){var e=b.KeyCode;b.declare({name:"oui.focus.FocusRing",membersDef:{init:function(){},handleEvent:function(g){var f=false;if(b.equalIgnoreCase(b.KeyEvents.KEY_DOWN,g.type)){this._initFocusRoot(g);switch(g.keyCode){case e.TAB:f=this.moveFocus(!g.shiftKey,g);break;case e.LEFT_ARROW:f=this.moveFocus(false,g);break;case e.RIGHT_ARROW:f=this.moveFocus(true,g);break;case e.ESC:f=this.moveFocusLevel(true,g);break;case e.ENTER:if((g.ctrlKey!==true)&&(g.shiftKey!==true)){f=this.moveFocusLevel(false,g)}break}}if(f){g.stopPropagation()}},moveFocusLevel:function(f,h){var j=false,g=b.focusManager.getFocusOwner(),i;if(g!==null){i=f?b.focus.getFocusableAncestor(g.parentNode):b.focus.getFocusableDescendant(g);if(i!==null){j=true;b.focusManager.requestFocus(i,h)}}return j},moveFocus:function(j,i){var m=false,f=b.focusManager,h=f.getFocusOwner(),k=f._moveFocusDirection(h,j),l=this._rootFocusNode,g;if(k===null){k=b.focus.getFocusableDescendant(b.rootNode,j)}if(h!==l){g=b.focus.getFocusableAncestor(h);if(k!==null&&k.isDescendant(g)!==true){k=b.focus.getFocusableDescendant(g,j)}}else{k=null}if(k!==null){m=true;f.requestFocus(k,i)}return m},_initFocusRoot:function(f){var g=f.currentTarget;if(!b.focus.isFocusableTarget(g)){g=b.focus.getFocusableDescendant(g)}this._rootFocusNode=g}}})}());(function(){var j=b.KeyCode,i=b.DirectionEnum,e=i.UP,h=i.DOWN,f=i.LEFT,g=i.RIGHT;function k(m,l){return b.geom.dist(m.x,m.y,l.x,l.y)}b.declare({name:"oui.focus.SpatialFocus",mixins:[b.events.EventSupport],membersDef:{init:function(m,l){this._keyDownFilter=this._defaultKeyDownFilter;this._focusContainer=null;if(b.isA(m,b.graphics.AbstractGraphicNode)){m.onFocusIn(this.handler("_onFocusIn"));this._focusContainer=m}if(b.isA(l,Function)){this._keyDownFilter=l}},_defaultKeyDownFilter:function(l){return((l.ctrlKey!==true)&&(l.shiftKey!==true))},_onFocusIn:function(l){var m=l.relatedTarget;if(m){m._focusPoint=undefined}},handleEvent:function(m){var l=(m.keyCode===j.TAB);if(this._keyDownFilter(m)===true){switch(m.keyCode){case j.LEFT_ARROW:this._moveFocus(m,f);l=true;break;case j.RIGHT_ARROW:this._moveFocus(m,g);l=true;break;case j.UP_ARROW:this._moveFocus(m,e);l=true;break;case j.DOWN_ARROW:this._moveFocus(m,h);l=true;break;default:}}if(l){m.stopPropagation()}},_moveFocus:function(l,n){this._cacheFocusableNodes();var m=this._getFocusableItem(l.target,n);if(m!==null){m._focusPoint=this._newFocusPoint;b.focusManager.requestFocus(m,l)}},_cacheFocusableNodes:function(){var m=b.focus.getFocusableDescendant(this._focusContainer),l;this._focusableNodes=[];if(m!==null){this._focusableNodes.push(m);l=b.focusManager._moveFocusDirection(m,true);while(l){this._focusableNodes.push(l);l=b.focusManager._moveFocusDirection(l,true)}}},_getFocusableItem:function(y,x){var z=null,o=this._getNodeInfos(y,x),p=o.center,u,q,m,l,n,w,s,r,t,v=this._focusableNodes.length;this._updateEntryPoint(o);for(s=0;s<v;s++){r=this._focusableNodes[s];if(r!==y){u=false;switch(x){case e:t=this._getNodeInfos(r,h);if(t.center.y<p.y){u=true}break;case h:t=this._getNodeInfos(r,e);if(t.center.y>p.y){u=true}break;case f:t=this._getNodeInfos(r,g);if(t.center.x<p.x){u=true}break;case g:t=this._getNodeInfos(r,f);if(t.center.x>p.x){u=true}break;default:}if(u){q=this._getNewFocusPoint(this._entryPoint,t.nodeBorder);l=this._computeFocusDistance(o,t,q);if((m===undefined)||(l<m)){m=l;n=b.geom.dist(p.x,p.y,t.center.x,t.center.y);z=r;this._newFocusPoint=q}else{if(m===l){w=b.geom.dist(p.x,p.y,t.center.x,t.center.y);if(w<n){z=r;this._newFocusPoint=q}}}}}}return z},_getNodeInfos:function(p,s){var q=p.getLayoutBounds(this._focusContainer),n=q.x,m=q.y,t=q.width,l=q.height,o={x:n+t/2,y:m+l/2},r;switch(s){case e:r={x1:n,y1:m,x2:n+t,y2:m};break;case h:r={x1:n,y1:m+l,x2:n+t,y2:m+l};break;case f:r={x1:n,y1:m,x2:n,y2:m+l};break;case g:r={x1:n+t,y1:m,x2:n+t,y2:m+l};break;default:}return{center:o,bounds:q,node:p,nodeBorder:r}},_updateEntryPoint:function(p){var l=false,o=p.node,m=p.bounds,n;if(o._focusPoint){n=o._focusPoint;if(n.x>=m.x&&n.x<=m.x+m.width&&n.y>=m.y&&n.y<=m.y+m.height){this._entryPoint=n;l=true}}if(!l){o._focusPoint=p.center;this._entryPoint=o._focusPoint}},_getNewFocusPoint:function(m,n){var l={};if(n.x1!==n.x2){if(m.x<n.x1){l.x=n.x1}else{if(m.x>n.x2){l.x=n.x2}else{l.x=m.x}}}else{l.x=n.x1}if(n.y1!==n.y2){if(m.y<n.y1){l.y=n.y1}else{if(m.y>n.y2){l.y=n.y2}else{l.y=m.y}}}else{l.y=n.y1}return l},_computeFocusDistance:function(l,r,p){var m=this._getEuclideanDistance(p),q=l.nodeBorder,v=0,t=0,u=0,o=0,s,n;if(q.x1!==q.x2){t=Math.abs(p.y-q.y1);u=Math.abs(p.x-this._entryPoint.x)}else{v=Math.abs(p.x-q.x1);o=Math.abs(p.y-this._entryPoint.y)}s=0;n=b.geom.intersectRect(l.bounds,r.bounds);if(n){s=Math.sqrt(n.width*n.height)}return(m+v+t+u+o-s)},_getEuclideanDistance:function(l){var n=this._entryPoint,m;if((n.x===l.x)||(n.y===l.y)){m=0}else{m=b.geom.dist(n.x,n.y,l.x,l.y)}return m}}})}());(function(){b.ns("oui.utils");var e=76,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b.utils.toBase64=function(l){var p=0,r=l.length,j="",n=0,g=0,m=0,q,h,k,o;while(n<=r){if((n%3)===0&&n!==0){m>>=8;m&=16777215;q=m;q>>=18;q&=63;j+=f.charAt(q);g++;q=m;q>>=12;q&=63;j+=f.charAt(q);g++;q=m;q>>=6;q&=63;j+=f.charAt(q);g++;q=m;q&=63;j+=f.charAt(q);g++;m=0;if(g>=e){j+="\r";j+="\n";g=0}if(r-n<3){break}}q=l[p++];m|=(256+q)%256;m<<=8;n++}h=(r-n)%3;if(h!==0){m=0;for(k=0;k<3;k++){if(k<h){q=l[p++];m|=(256+q)%256;m<<=8;n++}else{m|=0;m<<=8}}m>>=8;m&=16777215;q=m;if(h>=1){q>>=18;q&=63;j+=f.charAt(q);q=m;q>>=12;q&=63;j+=f.charAt(q)}if(h>=2){q=m;q>>=6;q&=63;j+=f.charAt(q)}if(h>=3){q=m;q&=63;j+=f.charAt(q)}for(o=3;o>h;o--){j+="="}}if(j.length===0){c.error("ERR__BASE64")}return j}}());(function(){var e;function g(q,p,h,r,n){var s,m,j,o,l,k;if(q!==undefined){m=e[q.type];if(m!==undefined){s=m.call(null,q,h,r,n);j=q.name;if(h){if(r===false){if(q.shortcutName!==undefined){o=q.shortcutName}}else{if(j!==undefined){o=j}}if(o!==undefined&&n!==undefined){o=n+o}if(o!==undefined){h[o]=s}}if(p){if(j!==undefined&&p!==h){p[j]=s}if(s.constructor===Array){k=s.length;for(l=0;l<k;l++){p.appendChild(s[l])}}else{p.appendChild(s)}}}}return s}function f(i,h){var k,j;if(b.isA(h,Function)){k=h}else{j=i;k=function(l){return new j(l,l.name)}}return k}b._CPGL_JSON_FACTORY=e={array:function(k){var h=[],j,m=k.length,l=k.of;if(b.isA(m,Number)&&l!==undefined){for(j=0;j<m;j++){h[j]=g(l)}}return h}};b.load=function(l,m,q,j,o){var h=null,k,p;if(l){if(l.constructor===Array){h=m||new b.graphics.Group();for(k=0,p=l.length;k<p;k++){g(l[k],h,q,j,o)}}else{if(l.constructor===Object){if(m){g(l,m,q,j,o);h=m}else{h=g(l,null,q,j,o)}}}}return h};b.addJSONLoaderSupport=function(h,j){var i="";if(!b.inheritsFrom(h,b.scene.AbstractNode)){c.error("ERR__JSONLOAD__INV_CLASS")}if(b.isA(j.type,String)){i=j.type}if(i.length>0){if(!e[i]){e[i]=f(h,j.factory)}else{c.warn("WARN__JSONLOAD__DUP_TYPE")}}else{c.warn("WARN__JSONLOAD__EMPTY_STR")}}}());(function(){var g=new RegExp("^(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]{2,6})\\/\\S+$",""),i=b.config.hasOwnProperty("base")?b.config.base+"/":"",j=0;function f(k){if(!g.test(k)&&k.indexOf("/")!==0&&k.indexOf("data")!==0){k=i+k}return k}function h(k){if(k.indexOf(i)===0){k=k.substring(i.length)}return k}function e(){b.tree.layout()}b.declare({name:"oui.utils.ImageLoader",mixins:[b.events.EventSupport],eventsDef:{COMPLETE:"complete",ERROR:"error"},membersDef:{init:function(){},load:function(k){var l=this;j++;if(b.tree.isPlatformAvailable()){this._loadImpl(f(k))}else{b.tree.addEventListener(b.tree.events.PLATFORM_AVAILABLE,function(){l._loadImpl(k)})}},_loadImpl:function(){},_dispatchCompleteEvent:function(l,n,m,k,o){this.dispatchEvent({type:this.events.COMPLETE,url:h(l),data:n,width:m,height:k,info:o,defaultAction:e});j--},_dispatchErrorEvent:function(k,l){this.dispatchEvent({type:this.events.ERROR,url:h(k),message:l});j--}}});b.hasImagesLoading=function(){return(j!==0)}}());(function(){b.mixin(b.utils.ImageLoader,{_loadImpl:function(e){var f=new Image();f.onload=this.handler("cvOnComplete");f.onerror=this.handler("cvOnError");f.onabort=this.handler("cvOnAbort");f.src=e},cvOnComplete:function(f){var e=f.target;this._dispatchCompleteEvent(e.src,e,e.width,e.height)},cvOnError:function(e){this._dispatchErrorEvent(e.target.src)},cvOnAbort:function(e){this._dispatchErrorEvent(e.target.src)}})}());(function(){function f(g,h){if(b.isA(g,Function)){g.call(null,h)}else{if(g&&b.isA(g.resourceUpdate,Function)){g.resourceUpdate(h)}}}function e(h){var g=h.observers.pop();while(g){f(g,h);g=h.observers.pop()}b.tree.layout()}b.declare({name:"oui.utils.ResourcesManager",membersDef:{init:function(){var g,h=b.config.embeddedResourcesMap;this._resources={};if(h){for(g in h){if(h.hasOwnProperty(g)){this._initEmbedImpl(g,h[g])}}}},requestResource:function(h,g){var i;h=this._checkURL(h);i=this._resources[h];if(!i){this._loadResource(h,h,g)}else{if(i.data===null){if(g){i.observers.push(g)}}else{f(g,i)}}},hasResource:function(h){var g=false;if(h.indexOf("@cache;")===0){g=true}else{g=(this._resources[h]!==undefined)}return g},removeObserver:function(h,g){var k,l,j;h=this._checkURL(h);k=this._resources[h];if(k){l=k.observers;j=l.length;while(j--){if(l[j]===g){l.splice(j,1);break}}}},_checkURL:function(g){if(g.indexOf("@cache;")===0){g=g.substr(7)}return g},_initEmbedImpl:function(){},_loadResource:function(i,l,h){var j=this,k,g;k={url:i,data:null,width:0,height:0,observers:[h]};this._resources[i]=k;g=new b.utils.ImageLoader();g.onComplete(function(m){j._onComplete(m,k)});g.onError(function(){j._onError(k)});g.load(l)},_onComplete:function(g,h){h.width=g.width;h.height=g.height;this._onCompleteImpl(g,h);e(h)},_onCompleteImpl:function(g,h){h.data=g.data},_onError:function(g){this._resources[g.url]=undefined;c.warn("WARN__RES_MGR__LOAD_FAIL",g.url)},_getBase64Data:function(){return undefined}}})}());(function(){b.mixin(b.utils.ResourcesManager,{_initEmbedImpl:function(e,f){this._loadResource(e,f.data);f.data=null},_getBase64Data:function(f){var e,h=b.config.embeddedResourcesMap,g;f=this._checkURL(f);if(h!==undefined&&h[f]!==undefined){g=this._resources[f];if(g.data){e=g.data.src}}return e}})}());(function(){var e="Obj_",f=0;b.declare({name:"oui.scene.AbstractNode",isAbstract:true,mixins:[b.events.EventSupport,b.lang.AspectSupport],membersDef:{init:function(g){this.dirtyMarkers={};this._id=e+f++;this.name="";this.setName(g);this._createNodeImpl();this._nativeMode=false},load:function(h,g){return b.load(h,g||this)},setName:function(g){if(typeof g==="string"){this.name=g;this.notifyNative(b.TAGS.NAME)}},getName:function(){return this.name},getFullName:function(){var g=this.name;if(this.parentNode){g=this.parentNode.getFullName()+"."+g}return g},getElementById:function(i){var g=null,h;if(this._id===i){g=this}else{h=this.firstChild;while(h&&!g){g=h.getElementById(i);h=h.nextSibling}}return g},getElementsByName:function(h,g){var i;g=g||[];i=this.firstChild;while(i){if(i.name===h){g.push(i)}i.getElementsByName(h,g);i=i.nextSibling}return g},getFirstElementByName:function(h){var g,i=this.firstChild;while(i&&!g){if(i.name===h){g=i}else{g=i.getFirstElementByName(h)}i=i.nextSibling}return g},getId:function(){return this._id},_isValidChild:function(g){return b.isA(g,b.scene.AbstractNode)},_onInsertChild:function(i,g,h){if(!g){this._appendChildImpl(i)}else{this._insertBeforeImpl(i,g)}if(h!==true){i._onParentChanged()}this._onChildrenChanged()},_onRemoveChild:function(i,h,g){i._onParentChanged();if(h===false){this._removeChildImpl(i);this._onChildrenChanged()}else{if(g===true){this._removeChildrenImpl();this._onChildrenChanged()}}},isDescendant:function(h){var g=false;if(this.parentNode===h){g=true}else{if(this.parentNode){g=this.parentNode.isDescendant(h)}}return g},_createNodeImpl:function(){},_appendChildImpl:function(){},_insertBeforeImpl:function(){},_removeChildImpl:function(){},_removeChildrenImpl:function(){},getAncestors:function(){var h=this,g=[];while(h){g.unshift(h);h=h.parentNode}return g},bringToFront:function(){var g=this.parentNode;if(g&&g.lastChild!==this){g.insertBefore(this,null)}},sendToBack:function(){var g=this.parentNode;if(g&&g.firstChild!==this){g.insertBefore(this,g.firstChild)}},bringForward:function(){var g=this.parentNode,h=this.nextSibling;if(g&&h){g.insertBefore(this,h.nextSibling)}},sendBackward:function(){var g=this.parentNode,h=this.previousSibling;if(g&&h){g.insertBefore(this,h)}},notifyNative:function(g){if(this._nativeMode){this.notifyNativeImpl(g)}else{this.dirtyMarkers[g]=true}},notifyNativeImpl:function(g,h){},_preParentChangedImpl:function(){},_onParentChanged:function(){var g=false;this._preParentChangedImpl();if(this.parentNode){g=this.parentNode._nativeMode}this._setNativeMode(g)},_onChildrenChanged:function(){},_setNativeMode:function(g,k){var j,i,h;if(this._nativeMode!==g){this._nativeMode=g;j=this.firstChild;while(j){j._setNativeMode(g,true);j=j.nextSibling}if(g){i=this.dirtyMarkers;for(h in i){if(i[h]){this.notifyNativeImpl(h,k)}}this.dirtyMarkers={}}}},notifyChildren:function(g){var h;this.notifyNative(g);h=this.firstChild;while(h){h.notifyChildren(g);h=h.nextSibling}}}});b.lang.LinkedListSupport.addLinkedList(b.scene.AbstractNode,b.scene.AbstractNode,"nextSibling","previousSibling","parentNode","firstChild","lastChild","appendChild","removeChild","removeChildren","insertBefore","replaceChild","hasChildNodes","_isValidChild","_onInsertChild","_onRemoveChild","childrenCount","getChildAt","getChildIndex","setChildIndex")}());(function(){b.mixin(b.scene.AbstractNode,{cvPaint:function(e){}})}());(function(){function f(r,s,l,n,h,k,i,j,q,g,p,m,o){return{type:r,canBubble:s,cancelable:l,detail:n,screenX:h.x,screenY:h.y,clientX:k,clientY:i,ctrlKey:j,shiftKey:q,altKey:g,metaKey:p,button:m,relatedTarget:o,preventNativeDefault:b.NO_OP,stopNativePropagation:b.NO_OP}}function e(s,u,l,o,h,k,i,j,r,g,q,n,p,t,m,v){return{type:s,canBubble:u,cancelable:l,detail:o,screenX:h.x,screenY:h.y,clientX:k,clientY:i,ctrlKey:j,shiftKey:r,altKey:g,metaKey:q,touches:n,targetTouches:p,changedTouches:t,scale:m,rotation:v,preventNativeDefault:b.NO_OP,stopNativePropagation:b.NO_OP}}b.declare({name:"oui.scene.Tree",mixins:[b.events.EventSupport,b.lang.AspectSupport],membersDef:{events:{PLATFORM_AVAILABLE:"platformAvailable"},init:function(){this.userLayer=this._createLayer("userLayer");this.focusLayer=this._createLayer("focusLayer");this.tooltipLayer=this._createLayer("tooltipLayer");this.layers=[this.userLayer,this.focusLayer,this.tooltipLayer];this._isReady=false;this.addEventListener(this.events.PLATFORM_AVAILABLE,this.handler("_onReady"))},destroy:function(){b.timer.stop();b.events._userEventsSupport.setProperties({fromPlatform:{keyEvents:false,mouseEvents:false,wheelEvents:false,touchEvents:false,gestureEvents:false}});this._destroyImpl()},layout:function(){var g,j,h=this.layers;for(g=0,j=h.length;g<j;g++){h[g].layout()}},setLayoutDir:function(g){var h,k,j=this.layers;if((g===b.RTL||g===b.LTR)&&g!==b.layoutDir){b.layoutDir=g;b.filters._onLayoutDir(g);for(h=0,k=j.length;h<k;h++){j[h].notifyChildren(b.TAGS.LAYOUT_DIR)}if(typeof this._setLayoutDirImpl==="function"){this._setLayoutDirImpl()}}},getNodeAt:function(g,m){var j=null,h,l=this.layers,k=l.length;for(h=k-1;h>=0&&!j;h--){j=this._getChildAtImpl(l[h],g,m)}return j},getElementById:function(l){var h=null,g,k=this.layers,j=k.length;for(g=j-1;g>=0&&!h;g--){h=k[g].getElementById(l)}return h},isPlatformAvailable:function(){return this._isReady},getCSSValues:function(h,i){var g=null;if(typeof b.config.readCSSValues==="function"){g=b.config.readCSSValues(h,i)}return g},_createLayer:function(g){var i=new b.graphics.Group(undefined,g),h=b.events;h.addDragSupport(i);h.addPressNTapSupport(i);h.addPinchSupport(i);h.addSwipeSupport(i);b.addGestureSupport(i,f,e);return i},_initShadowTree:function(g){g._createNodeImpl();var h=g.firstChild;while(h!==null){this._initShadowTree(h);g._appendChildImpl(h);h=h.nextSibling}g.invalidateLayout()},_onReady:function(){var j,l,h,k=this.layers,g=(b.environment===b.EnvironmentEnum.MOBILE);this._enableTreeOpsImpl();b.events._userEventsSupport.setProperties({fromPlatform:{keyEvents:true,mouseEvents:g?false:true,wheelEvents:true,touchEvents:true,gestureEvents:true}});for(j=0,l=k.length;j<l;j++){h=k[j];this._initShadowTree(h);this._attachLayerImpl(h);h._setNativeMode(true)}this.layout();this._isReady=true},_updateViewport:function(i,h){var g=b.viewportWidth,j=b.viewportHeight;if(g!==i||j!==h){b.viewportWidth=i;b.viewportHeight=h;b.viewportBounds.width=i;b.viewportBounds.height=h;this.userLayer.dispatchEvent({type:b.ViewEvents.VIEWPORT_RESIZE,oldViewportWidth:g,oldViewportHeight:j,newViewportWidth:i,newViewportHeight:h});this.layout()}},_updateDeviceOrientation:function(g){if(b.deviceOrientation!==g){b.deviceOrientation=g;this.userLayer.dispatchEvent({type:b.ViewEvents.DEVICE_ORIENTATION,orientation:b.deviceOrientation})}},_setContainerImpl:function(){},_destroyImpl:function(){},_getChildAtImpl:function(h,g,i){return h.hitTest(g,i)},_enableTreeOpsImpl:function(){},_attachLayerImpl:function(g){}}})}());(function(){var e=b.DeviceOrientationEnum,f={};function g(h){var i=false;while(h){if(h===document){i=true;break}h=h.parentNode}return i}b.mixin(b.scene.Tree,{_setContainerImpl:function(m){var h,p,i,l,n,k,o,q,j;this.document=m.ownerDocument;this.domElement=m;l=this.document.defaultView;h=this.cvCreateCanvasElt(0,0);if(!h.getContext){i=this.document.createElement("div");i.innerHTML="Your web browser does not support Canvas";m.appendChild(i);c.error("ERR__CNV__NO_SUPPORT")}h.setAttribute("style",["-webkit-user-select: none;","-webkit-touch-callout: none;","-webkit-tap-highlight-color: transparent;"].join(""));h.tabIndex=0;h.innerHTML=b.config.altText||"";p=h.getContext("2d");p.globalCompositeOperation="copy";m.appendChild(h);q=l.devicePixelRatio||1;j=p.webkitBackingStorePixelRatio||p.mozBackingStorePixelRatio||p.msBackingStorePixelRatio||p.oBackingStorePixelRatio||p.backingStorePixelRatio||1;this.cvPixelRatio=b.config.hiDPI!==false?q/j:1;this.cvBuffers=[];this.cvDirtyList={};this.canvas=h;this.c2d=p;this.offscreen=this.cvCreateCanvasElt(0,0);this.offscreen.style.display="none";this.offscreen2d=this.offscreen.getContext("2d");n=this.document.createElement("div");n.setAttribute("style","margin: 0; padding: 0;");k=this.document.createElement("span");n.appendChild(k);o=this.document.createElement("div");o.setAttribute("style","display: inline-block; vertical-align: baseline; width: 1px; height: 0px; margin: 0; padding: 0;");n.appendChild(o);this.cvTextMeasurer={div:n,span:k,ref:o};b.timer.addEventListener(b.timer.TIMER_EVENT,this.handler("_timerCallback"));this._orientationHandler=this.handler("cvOnDeviceOrientationChanged");l.addEventListener("orientationchange",this._orientationHandler,false);l.addEventListener("resize",this._orientationHandler,false);this.cvResize();this.cvOnDeviceOrientationChanged();this.dispatchEvent({type:this.events.PLATFORM_AVAILABLE})},_destroyImpl:function(){var i,h=this.document.defaultView;this.removeAspect("layout",this.cvRender);h.removeEventListener("orientationchange",this._orientationHandler,false);h.removeEventListener("resize",this._orientationHandler,false);i=this.cvBuffers.pop();while(i){i.width=0;i.height=0;i=this.cvBuffers.pop()}this.canvas.width=0;this.canvas.height=0;this.offscreen.width=0;this.offscreen.height=0;this.canvas=null;this.c2d=null;this.offscreen=null;this.offscreen2d=null;this.document=null},_enableTreeOpsImpl:function(){var j=function(k){b.tree.cvMarkAsDirty(k)},h=function(){b.tree.cvMarkAsDirty(this)},i=b.scene.AbstractNode.prototype;i._appendChildImpl=j;i._insertBeforeImpl=j;i._removeChildImpl=j;i._removeChildrenImpl=h;i=b.graphics.Text.prototype;i._getBBoxImpl=i.cvGetBBox;i=b.graphics.TextBlock.prototype;i._getBBoxImpl=i.cvGetBBox},_setLayoutDirImpl:function(){var h=b.layoutDir.toLowerCase();this.canvas.setAttribute("dir",h);this.offscreen.setAttribute("dir",h);this.cvMarkAsDirty()},cvCreateCanvasElt:function(i,h){var j=this.document.createElement("canvas");j.width=i;j.height=h;return j},cvRender:function(){var s,o,p,k,r,u,h,q,l,j,m;if(this.cvFullyDirty){r=b.viewportBounds}else{j=this.cvDirtyList;m=b.geom.unionRect;for(q in j){if(j.hasOwnProperty(q)){l=j[q];if(l._nativeMode){u=l._safeGetGlobalTxf();h=l._getBoundsImpl(u,b._BoundsType.RENDER);h=m(h,l.cvLastDrawBounds)}else{h=l.cvLastDrawBounds;l.cvLastDrawBounds=undefined}r=m(r,h)}}if(r){r.x=Math.floor(r.x)-1;r.y=Math.floor(r.y)-1;r.width=Math.ceil(r.width)+2;r.height=Math.ceil(r.height)+2}}if(r){this.domElement.appendChild(this.offscreen);s=this.offscreen2d;s.save();s.scale(this.cvPixelRatio,this.cvPixelRatio);s.clearRect(r.x,r.y,r.width,r.height);s.beginPath();s.rect(r.x,r.y,r.width,r.height);s.clip();o=this.layers;for(p=0,k=o.length;p<k;p++){o[p].cvPaint(s,r)}s.restore();this.c2d.drawImage(this.offscreen,0,0);this.cvDirtyList={};this.cvFullyDirty=false;this.domElement.removeChild(this.offscreen)}},cvMarkAsDirty:function(h){if(!this.cvFullyDirty){if(h){this.cvDirtyList[h._id]=h}else{this.cvFullyDirty=true}}},cvCreateBuffer:function(i,h){var j;if(this.cvBuffers.length===0){j=this.cvCreateCanvasElt(i,h);j.style.display="none"}else{j=this.cvBuffers.pop();j.width=i;j.height=h}this.domElement.appendChild(j);j.setAttribute("dir",b.layoutDir.toLowerCase());return j},cvDisposeBuffer:function(h){this.domElement.removeChild(h);this.cvBuffers.push(h)},_timerCallback:function(){if(!this.canvas.parentNode){this.destroy()}else{this.cvResize()}},cvResize:function(){var i=this.canvas.parentNode.getBoundingClientRect(),l=Math.floor(i.width),h=Math.floor(i.height),k=this.cvPixelRatio*l,m=this.cvPixelRatio*h,j=this.canvas;if(k!==j.width||m!==j.height){if(j.width===0||j.height===0){if(k!==0&&m!==0){this.addAspect("layout",this.cvRender)}}else{if(k===0||m===0){if(!g(j)){b.timer.stop()}this.removeAspect("layout",this.cvRender)}}j.width=k;j.height=m;j.style.width=l+"px";j.style.height=h+"px";this.c2d.globalCompositeOperation="copy";this.offscreen.width=k;this.offscreen.height=m;this.cvMarkAsDirty();this._updateViewport(l,h)}},cvOnDeviceOrientationChanged:function(){var h,i,j=this.document.defaultView;if(j.orientation!==undefined){h=Math.abs(j.orientation)===90?e.LANDSCAPE:e.PORTRAIT}else{i=j.screen;h=i.width>i.height?e.LANDSCAPE:e.PORTRAIT}this._updateDeviceOrientation(h)},cvGetRootClientCoords:function(){var h=this.canvas.getBoundingClientRect();return{x:h.left,y:h.top}},cvTextMetrics:function(m,l){var j=this.cvTextMeasurer,u=this.document,n,i=j.div,v=j.span,k=j.ref,h,r,q=0,s=0,p=0,w=0,t=this.c2d;t.font=l;if(m){q=t.measureText(m).width;if(!f[l]){n=u.body;try{if(b.equalIgnoreCase("body",u.defaultView.top.document.body.nodeName)){n=u.defaultView.top.document.body}}catch(o){c.warn(o)}n.appendChild(i);v.style.font=l;v.innerHTML=m;h=v.getBoundingClientRect();p=k.getBoundingClientRect().top-h.top;s=h.bottom-h.top;w=s-p;n.removeChild(i);f[l]={ascent:p,descent:w}}else{r=f[l];p=r.ascent;w=r.descent;s=p+w}}return{ascent:p,descent:w,width:q,height:s}}})}());(function(){b.declare({name:"oui.timing.Timer",mixins:[b.events.EventSupport],membersDef:{TIMER_EVENT:"TIMER_EVENT",DEFAULT_FRAME_RATE:25,init:function(e){if(b.isFinitePositiveNumber(e,true)){this.frameRate=e}else{this.frameRate=this.DEFAULT_FRAME_RATE}},start:function(){var f=this;function e(){f.dispatchEvent({type:f.TIMER_EVENT});b.tree.layout()}if(this.startImpl){this.startImpl(e)}else{if(setInterval){this.currentIntervalID=setInterval(e,1000/this.frameRate)}else{c.error("ERR__TIMER__START")}}},stop:function(){if(this.stopImpl){this.stopImpl()}else{if(this.currentIntervalID&&clearInterval){clearInterval(this.currentIntervalID);this.currentIntervalID=undefined}else{c.error("ERR__TIMER__STOP")}}}}})}());(function(){var h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,g=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame,f=navigator.userAgent,e=h&&!(f.match(/(iPod|iPhone|iPad)/)&&f.match(/AppleWebKit/));if(e){b.mixin(b.timing.Timer,{startImpl:function(l){var i,j,k=0;i=function(){k=h(i,b.tree.canvas);l()};if(g){j=function(){g(k);k=0}}else{j=function(){i=b.NO_OP}}this._cancelAnimate=j;i()},stopImpl:function(){if(this._cancelAnimate){this._cancelAnimate();this._cancelAnimate=undefined}}})}else{c.warn("WARN__CNV__REQ_ANIM_FRAME")}}());(function(){var e=b.defs,f="trigger",j=1000,h="begin",i="end",g={source:{type:Object,constraint:b.supportsEvents,defaultValue:null},type:e.String(""),offset:e.PositiveNumber(0)};b.declare({name:"oui.timing.TimeInterval",mixins:[b.events.EventSupport,b.lang.PropertiesSupport],membersDef:{init:function(k){this._plugged=true;this._active=false;this._beginSyncValues=[];this._endSyncValues=[];this._eventValues=[];this._initProperties(k);this._timerHandler=this.handler("_onTimer")},_onTimer:function(n){var m=n.timeStamp,k=this._beginTime,l=this._endTime;if(m>=k&&l>=k){if(!this._active){this.dispatchEvent({type:this.events.BEGIN,bubbles:false,syncTime:k});this._curBegin=k;this._curEnd=k+this._simpleDur;this._active=true;this._start(k)}this._repeat(m);if(m>=l){this._stop(l);this._active=false;b.timer.removeEventListener(b.timer.TIMER_EVENT,this._timerHandler);this.dispatchEvent({type:this.events.END,bubbles:false,syncTime:l,scheduled:(l>=this._curEnd)})}else{this._play(m)}}},_start:function(k){},_play:function(k){},_stop:function(k){},beginAt:function(k){this._beginSyncAt(b.currentTimeMillis(),k)},endAt:function(k){this._endSyncAt(b.currentTimeMillis(),k)},_beginSyncAt:function(m,n){var l=this._properties,k;if(isFinite(n)&&n>0){m+=n*j}this._simpleDur=l.dur*j;k=this._simpleDur;if(l.repeatDur!==0&&l.repeatCount!==0){k=Math.min(l.repeatDur*j,l.repeatCount*this._simpleDur)}else{if(l.repeatDur!==0){k=l.repeatDur*j}else{if(l.repeatCount!==0){k=l.repeatCount*this._simpleDur}}}this._endTime=m+k;this._beginTime=m;this._sync(h,this._beginTime);this._sync(i,this._endTime);b.timer.addEventListener(b.timer.TIMER_EVENT,this._timerHandler)},_endSyncAt:function(k,l){if(isFinite(l)&&l>0){k+=l*j}if(k<this._endTime){this._endTime=k;this._sync(i,this._endTime)}},_sync:function(l,p){var o=(l===h)?this._beginSyncValues:this._endSyncValues,k,n=o.length,m;for(k=0;k<n;k++){m=o[k];m.target[m.funcName](p,m.offset)}},_repeat:function(k){var m=this._beginTime,p=this._endTime,s=this._simpleDur,q=this._curBegin,r=this._curEnd,l,n,o;if(k>=r&&r<p){l=Math.floor((q-m)/s);o=Math.floor((k-q)/s);for(n=1;n<=o&&r<p;n++){q+=s;r+=s;this.dispatchEvent({type:this.events.REPEAT,bubbles:false,syncTime:q,detail:l+n})}this._curBegin=q;this._curEnd=r}},onPropChanged:function(k){if(k===f){this.plug()}},addBeginEvent:function(k){this._addEvent(k,"beginEvents",h,[])},addEndEvent:function(k){this._addEvent(k,"endEvents",i,[true])},_addEvent:function(l,p,o,k){var n=this._properties,m;if(n[p].length===0){n[p]=[]}m=n[p];if(b.isObjectValid(l,g,true)){m.push(l);if(this._plugged){this._plug(l,o,k)}}},plug:function(){var l,k,m;this.unplug();l=this._properties.beginEvents;for(k=0,m=l.length;k<m;k++){this._plug(l[k],h)}l=this._properties.endEvents;for(k=0,m=l.length;k<m;k++){this._plug(l[k],i)}this._plugged=true},_plug:function(o,l){var k=this,n="_"+l+"SyncAt",p=o.offset,m;if(o.type===h||o.type===i){m={target:k,funcName:n,offset:p};o.source._addSyncValue(o.type,m)}else{m=function(q){k[n](q.timeStamp,p)};o.source.addEventListener(o.type,m)}this._eventValues.push({desc:o,data:m})},unplug:function(){var k=this._eventValues,l,p,o,m;for(l=0,p=k.length;l<p;l++){o=k[l].desc;m=k[l].data;if(o.type===h||o.type===i){o.source._removeSyncValue(o.type,m)}else{o.source.removeEventListener(o.type,m)}}k.length=0;this._plugged=false},_addSyncValue:function(k,m){var l=(k===h)?this._beginSyncValues:this._endSyncValues;l.push(m)},_removeSyncValue:function(l,o){var n=(l===h)?this._beginSyncValues:this._endSyncValues,k,m=n.length;for(k=0;k<m;k++){if(n[k]===o){n.splice(k,1)}}}},eventsDef:[b.SyncEvents],propertiesDef:{dur:e.PositiveNumber(0),repeatDur:e.PositiveNumber(0),repeatCount:e.PositiveNumber(0),beginEvents:e.ArrayOfProperties(g,0,Number.MAX_VALUE,[],f),endEvents:e.ArrayOfProperties(g,0,Number.MAX_VALUE,[],f)}});b.timing.eventTriggerDefinition=g}());(function(){b.ns("oui.anim");function e(f){return{easeIn:function(g){return g===0?0:f(g)},easeOut:function(g){return 1-f(1-g)},easeInOut:function(g){if(g<0.5){g=f(2*g)/2}else{g=1-f(2*(1-g))/2}return g}}}b.anim.easing={linear:e(function(f){return f}),quadratic:e(function(f){return f*f}),cubic:e(function(f){return f*f*f}),quartic:e(function(f){return f*f*f*f}),quintic:e(function(f){return f*f*f*f*f}),exponential:e(function(f){return Math.pow(2,10*(f-1))}),circular:e(function(f){return 1-Math.sqrt(1-f*f)}),sine:e(function(f){return 1-Math.cos(f*Math.PI/2)}),back:e(function(g,f){f=f||1.70158;return g*g*((f+1)*g-f)}),bounce:e(function(f){f=1-f;if(f<1/2.75){f=2.75*f;f=f*f}else{if(f<2/2.75){f=2.75*f-1.5;f=f*f+0.75}else{if(f<2.5/2.75){f=2.75*f-2.25;f=f*f+0.9375}else{f=2.75*f-2.625;f=f*f+0.984375}}}return 1-f})}}());(function(){b.ns("oui.anim");b.mixin(b.anim,{interpolateDiscrete:function(h,f,g){var e;if(g<=0.5){e=h}else{e=f}return e},interpolateNumber:function(g,e,f){return g+(e-g)*f},interpolateColor:function(f,e,g){return new b.style.Color(f.red()+(e.red()-f.red())*g,f.green()+(e.green()-f.green())*g,f.blue()+(e.blue()-f.blue())*g,f.alpha()+(e.alpha()-f.alpha())*g)}})}());(function(){var e=b.defs,f=b.FillEnum;b.declare({name:"oui.anim.AbstractAnimation",isAbstract:true,extend:b.timing.TimeInterval,membersDef:{_stop:function(h){var g=this._properties.fill;if(g===f.REMOVE||(g===f._LEGACY&&h<this._curEnd)){this._play(this._curBegin)}else{this._play(h)}},_progress:function(h,i,l){var j,m=b.anim.easing[this._properties.easeMode],g=this._properties.easeIn,k=this._properties.easeOut;if(l<h){j=0}else{if(l>i||h===i){j=1}else{j=(l-h)/(i-h);if(m){if(g&&!k){j=m.easeIn(j)}else{if(!g&&k){j=m.easeOut(j)}else{if(g&&k){j=m.easeInOut(j)}}}}}}return j}},propertiesDef:{easeMode:e.String("quadratic"),easeIn:e.Boolean(false),easeOut:e.Boolean(false),fill:e.Enum(f,f.FREEZE)}})}());(function(){var j=b.anim.AbstractAnimation.prototype,f=b.defs,g=b.BASE_VALUE,i=b.anim.interpolateDiscrete,l=b.anim.interpolateNumber,h=b.anim.interpolateColor,m="ANIM_TAG",e,k;e=function(p,n,o){return b.anim.interpolateDiscrete(p,n,o)};k={interpolator:f.Function(3,e),beginValue:f.ObjectOfType(Object,g,true,false),endValue:f.ObjectOfType(Object,g,true,false)};b.declare({name:"oui.anim.AnimateStyle",extend:b.anim.AbstractAnimation,membersDef:{onPropChanged:function(n){var o=this._properties.targetNode;if(n===m){if(o){this._checkInterpolators(this._properties.animValues,o.StyleDefinition.prototype)}}else{j.onPropChanged.call(this,n)}},_checkInterpolators:function(r,p){var o,q,n,s;if(p===undefined){p={}}for(o in r){if(r.hasOwnProperty(o)){q=r[o];n=p[o];if(q.interpolator===undefined){this._checkInterpolators(q,n)}else{if(q.interpolator!==e){q._interpolate=q.interpolator}else{if(n!==undefined){s=n.type;if(s===Boolean){q._interpolate=i}else{if(s===Number){q._interpolate=l}else{if(s===b.style.Color||(s===b.style.Paint&&b.isA(q.beginValue,b.style.Color)&&b.isA(q.endValue,b.style.Color))){q._interpolate=h}else{q._interpolate=e}}}}else{if(b.isA(q.beginValue,Boolean)&&b.isA(q.endValue,Boolean)){q._interpolate=i}else{if(b.isA(q.beginValue,Number)&&b.isA(q.endValue,Number)){q._interpolate=l}else{if(b.isA(q.beginValue,b.style.Color)&&b.isA(q.endValue,b.style.Color)){q._interpolate=h}else{q._interpolate=e}}}}}}}}},_start:function(){var n=this._properties;this._resolveBaseValues(n.animValues,n.targetNode._style)},_play:function(o){var n=this._properties;n.targetNode.applyStyle(this._buildStyleObjectFor(n.animValues,this._progress(this._curBegin,this._curEnd,o)))},_resolveBaseValues:function(r,p){var n,q,o;for(n in r){q=r[n];o=p[n];if(q.hasOwnProperty("_interpolate")){if(q.beginValue===g){q._beginVal=o}else{q._beginVal=q.beginValue}if(q.endValue===g){q._endVal=o}else{q._endVal=q.endValue}}else{this._resolveBaseValues(q,o)}}},_buildStyleObjectFor:function(r,o){var n,q,p={};for(n in r){q=r[n];if(q.hasOwnProperty("_interpolate")){p[n]=q._interpolate(q._beginVal,q._endVal,o)}else{p[n]=this._buildStyleObjectFor(q,o)}}return p}},propertiesDef:{targetNode:{type:Object,constraint:function(n){return(n===undefined)||(b.isA(n.applyStyle,Function)&&b.isA(n.StyleDefinition,Function))},defaultValue:undefined,tag:m},animValues:f.MapOfProperties(k,{},false,true,true,m)}})}());(function(){var f=b.anim.AbstractAnimation.prototype,h="t",e="s",g="r";b.declare({name:"oui.anim.AnimateTransform",extend:b.anim.AbstractAnimation,membersDef:{init:function(j,i){f.init.call(this,j,i);this._interpolatedValue=new b.geom.Matrix();this._transforms=[]},translate:function(j,l,i,k){if(isFinite(j)&&isFinite(l)&&isFinite(i)&&isFinite(k)){this._transforms.push({type:h,x0:j,x1:i,y0:l,y1:k})}},rotate:function(l,k,j,i){if(isFinite(l)&&isFinite(k)){this._transforms.push({type:g,a0:l/180*Math.PI,a1:k/180*Math.PI,cx:j||0,cy:i||0})}},scale:function(j,l,i,k){if(isFinite(j)&&isFinite(l)&&isFinite(i)&&isFinite(k)){this._transforms.push({type:e,x0:j,x1:i,y0:l,y1:k})}},resetTransforms:function(){this._transforms.length=0},_play:function(p){var j=this._progress(this._curBegin,this._curEnd,p),n=this._transforms,l,o=n.length,k,m=this._interpolatedValue;m.init();for(l=0;l<o;l++){k=n[l];if(k.type===h){m._safeTranslate(k.x0+j*(k.x1-k.x0),k.y0+j*(k.y1-k.y0))}else{if(k.type===g){m._safeRotate(k.a0+j*(k.a1-k.a0),k.cx,k.cy)}else{if(k.type===e){m._safeScale(k.x0+j*(k.x1-k.x0),k.y0+j*(k.y1-k.y0))}}}}this._properties.targetNode.setTransformMatrix(m)}},propertiesDef:{targetNode:b.defs.ObjectOfType(b.scene.AbstractNode,undefined,false,true)}})}());(function(){b.declare({name:"oui.anim.AnimateCallback",extend:b.anim.AbstractAnimation,membersDef:{_play:function(e){this._properties.callback.call(this,this._progress(this._curBegin,this._curEnd,e))}},propertiesDef:{callback:{type:Function,defaultValue:b.NO_OP}}})}());(function(){b.ns("oui.anim");b.anim.EffectsSupport={_effectOn:function(h,g,k,l,f,j){var i,e=h+"Effect";if(this[e]===undefined){i={targetNode:this,dur:j,animValues:{}};i.animValues[k]={beginValue:l,endValue:f};this[e]=new b.anim.AnimateStyle(i)}this[e].addBeginEvent(g)},showOn:function(e){this._effectOn("show",e,"display",false,true,0)},hideOn:function(e){this._effectOn("hide",e,"display",true,false,0)},fadeOn:function(h,i,g,j,e){var f=null;if(b.isA(this,b.graphics.Group)||b.isA(this,b.graphics.Image)){f=new b.anim.AnimateStyle({targetNode:this,animValues:{opacity:{beginValue:i,endValue:g}},dur:j})}else{f=new b.anim.AnimateStyle({targetNode:this,animValues:{fillOpacity:{beginValue:i,endValue:g},strokeOpacity:{beginValue:i,endValue:g}},dur:j})}f.addBeginEvent(h);if(b.isA(e,String)){this[e]=f}},slideOn:function(i,j,l,k,h,g,f){var e=new b.anim.AnimateTransform({targetNode:this,dur:j,beginEvents:[i]});e.translate(l,k,h,g);if(b.isA(f,String)){this[f]=e}},scaleOn:function(g,f,i,h,n,k,l){var m,j,e;e=new b.anim.AnimateTransform({targetNode:this,dur:f,beginEvents:[g]});m=(n!==undefined?n:0);j=(k!==undefined?k:0);e.translate(m,j,m,j);e.scale(i,i,h,h);e.translate(-m,-j,-m,-j);if(b.isA(l,String)){this[l]=e}}}}());(function(){var h=b.defs,j=h._createDef,p={definition:h.ArrayOfProperties({type:h.String("image")},1,undefined,[{type:"image"}]),hotspotX:h.FinitePositiveNumber(0),hotspotY:h.FinitePositiveNumber(0)};function k(q){return b.hasOwnValue(b.CursorType,q,true)||b.isValueOfType(q,p,true)}function l(q){return(q===null)||b.isA(q,b.filters.AbstractFilter)}function m(r,q){return(r===q)||b.isFinitePositiveNumber(r)}function f(q){return(q===null)||b.isA(q,b.graphics.PathCommands)}function i(u,t,q){var w,v,s,r;q.value={};for(w in t){if(u[w]!==undefined){v=u[w];s=t[w];if(s.constructor===Object){r={validValue:false};i(v,s,r);if(r.validValue){q.value[w]=r.value}}else{if(s===true){q.value[w]=v;q.validValue=true}}}}}function g(u,t,q){var w,v,s,r;q.value={};for(w in u){if(u[w]!==undefined){v=u[w];s=t[w];if(s!==undefined&&s.constructor===Object){r={validValue:false};g(v,s,r);if(r.validValue){q.value[w]=r.value}}else{if(s!==false){q.value[w]=v;q.validValue=true}}}}}function o(s,q){var r=b.style.makeColor(s);if(r){q.validValue=true;q.value=r}}function n(s,q){var r;if(typeof s==="string"){s=s.toUpperCase();r=b.filters[s];if(r){q.validValue=true;q.value=r}}}function e(r,q){if(b.isA(r,String)){try{q.value=new b.graphics.PathCommands(r,true);q.validValue=true}catch(s){q.value=s.message;q.validValue=false}}}b.mixin(h,{Paint:function(r,q){if(!b.isA(r,b.style.Paint)){r=b.style.makeColor(r)}return j("Paint",b.style.Paint,r,q,o)},Color:function(r,q){r=b.style.makeColor(r);return j("Color",b.style.Color,r,q,o)},Image:function(t,s,r,q){return{src:h.String(t,q),width:h.FinitePositiveNumber(s,q),height:h.FinitePositiveNumber(r,q)}},Cursor:function(r,q){return j("Cursor",Object,r,q,undefined,k)},FilterEffect:function(r,q){return j("FilterEffect",Object,r,q,n,l)},Size:function(r,q){return j("Size",Object,r,q,undefined,[m,r])},PathData:function(r,q){return j("PathData",b.graphics.PathCommands,r,q,e,f,undefined,true)},PropertyFilter:function(r,s,q){return{type:"PropertyFilter",convertor:function(u,t){if(typeof u==="object"){if(r===true){g(u,s,t)}else{i(u,s,t)}}else{t.validValue=false}},tag:q}}});b.mixin(h,{FontStyle:function(t,z,u,y){var x=255,q=0,s=0,v=0,w;if(b.isA(y,b.style.Paint)){w=y}else{if(b.isA(y,Array)&&y.length>=3){q=y[0];s=y[1];v=y[2];if(y.length>3){x=y[3]}w=new b.style.Color(q,s,v,x)}else{w=b.black}}return{fontFamily:h.String(t),fontSize:h.FinitePositiveNumber(z),fontWeight:h.Enum(b.FontWeightEnum,u),fill:h.Paint(w)}},Padding:function(u,t,s,r,q){return{top:h.PositiveNumber(u,q),bottom:h.PositiveNumber(r,q),lineBegin:h.PositiveNumber(t,q),lineEnd:h.PositiveNumber(s,q)}},Marker:function(v,x,w,q,y,s,r,t,A,u,z){return{d:h.String(v,u||A),refX:h.FiniteNumber(x,A),refY:h.FiniteNumber(w,A),width:h.FinitePositiveNumber(q,A),height:h.FinitePositiveNumber(y,A),orient:{type:Object,constraint:function(B){return B===b.AUTO||b.isNumberInRange(B,[0,360],false)},defaultValue:s,tag:A},strokeUnits:h.Boolean(r,A),paint:{type:Object,defaultValue:t,tag:z||A}}}})}());(function(){b.declare({name:"oui.style.Paint",membersDef:{init:function(){},getOpacity:function(){return 1}}});b.NO_PAINT=new b.style.Paint()}());(function(){b.mixin(b.style.Paint,{cvToStyle:function(){return"rgba(255,255,255,0)"}})}());(function(){var h=b.defs,i=[0,255],m="([0-9a-f])",l="([0-9a-f]{2})",j="([0-9]{1,3})",k="\\s*,\\s*",e=new RegExp("^#?"+l+l+l+l+"?$|^#?"+m+m+m+"$"),f=new RegExp("^rgba\\("+j+k+j+k+j+k+j+"\\)$|^rgb\\("+j+k+j+k+j+"\\)$");function g(n){var o="";if(n<16){o="0"}return o+n.toString(16)}b.declare({name:"oui.style.Color",extend:b.style.Paint,mixins:[b.lang.PropertiesSupport],membersDef:{init:function(q,o,n,p){this._initProperties({red:q,green:o,blue:n,alpha:p});this.onPropChanged()},onPropChanged:function(){var p=this._properties,o,n,q,r;p.red=Math.round(p.red);p.green=Math.round(p.green);p.blue=Math.round(p.blue);p.alpha=Math.round(p.alpha);o=g(p.red);n=g(p.green);q=g(p.blue);r=g(p.alpha);this.hexRGB=o+n+q;this.hexRGBA=o+n+q+r;this.hexARGB=r+o+n+q;this._onPropChangedImpl()},_onPropChangedImpl:function(){},modify:function(o){var p=0,n=this._properties;if(b.isA(o,Number)){if(o<0){p=0}else{if(o>1){p=1}else{p=o}}}return new b.style.Color(n.red*p,n.green*p,n.blue*p,n.alpha)},setColor:function(o){if(b.isA(o,b.style.Color)){var n=o._properties;this.setProperties({red:n.red,green:n.green,blue:n.blue,alpha:n.alpha})}},setARGB:function(q,p,o,n){this.setProperties({red:p,green:o,blue:n,alpha:q})},setOpacity:function(n){this.setAlpha(n*255)},getOpacity:function(){return this._properties.alpha/255},toString:function(){var n,o=this._properties;if(o.alpha===255){n="#"+this.hexRGB}else{n="rgba(".concat(o.red,",",o.green,",",o.blue,",",o.alpha/255,")")}return n}},propertiesDef:{red:h.NumberInRange(i,0),green:h.NumberInRange(i,0),blue:h.NumberInRange(i,0),alpha:h.NumberInRange(i,255)}});b.style.makeColor=function(q){var n=null,p,o,t,s,r;if(b.isA(q,String)){q=b.trim(q).toLowerCase();if(b.style.CSS_COLORS.hasOwnProperty(q)){n=b[q]}if((r=e.exec(q))!==null){p=parseInt(r[1]||r[5]+r[5],16);o=parseInt(r[2]||r[6]+r[6],16);t=parseInt(r[3]||r[7]+r[7],16);s=255;if(r[4]){s=parseInt(r[4],16)}n=new b.style.Color(p,o,t,s)}if((r=f.exec(q))!==null){p=parseInt(r[1]||r[5],10);o=parseInt(r[2]||r[6],10);t=parseInt(r[3]||r[7],10);s=255;if(r[4]){s=parseInt(r[4],10)}n=new b.style.Color(p,o,t,s)}}else{if(b.isA(q,Array)&&(q.length===3||q.length===4)){p=q[0];o=q[1];t=q[2];s=255;if(q.length===4){s=q[3]}if(b.isNumberInRange(p,i)&&b.isNumberInRange(o,i)&&b.isNumberInRange(t,i)&&b.isNumberInRange(s,i)){n=new b.style.Color(p,o,t,s)}}else{if(b.isA(q,b.style.Color)){n=q}}}return n}}());(function(){b.mixin(b.style.Color,{_onPropChangedImpl:function(){this.cvColor=this.toString()},cvToStyle:function(){return this.cvColor}})}());b.style=b.style||{};(function(){var f,e;b.style.CSS_COLORS=f={aliceBlue:"F0F8FF",antiqueWhite:"FAEBD7",aqua:"0FF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000",blanchedAlmond:"FFEBCD",blue:"00F",blueViolet:"8A2BE2",brown:"A52A2A",burlyWood:"DEB887",cadetBlue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerBlue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"0FF",darkBlue:"00008B",darkCyan:"008B8B",darkGoldenRod:"B8860B",darkGray:"A9A9A9",darkGreen:"006400",darkKhaki:"BDB76B",darkMagenta:"8B008B",darkOliveGreen:"556B2F",darkOrange:"FF8C00",darkOrchid:"9932CC",darkRed:"8B0000",darkSalmon:"E9967A",darkSeaGreen:"8FBC8F",darkSlateBlue:"483D8B",darkSlateGray:"2F4F4F",darkTurquoise:"00CED1",darkViolet:"9400D3",deepPink:"FF1493",deepSkyBlue:"00BFFF",dimGray:"696969",dodgerBlue:"1E90FF",fireBrick:"B22222",floralWhite:"FFFAF0",forestGreen:"228B22",fuchsia:"F0F",gainsboro:"DCDCDC",ghostWhite:"F8F8FF",gold:"FFD700",goldenRod:"DAA520",gray:"808080",green:"008000",greenYellow:"ADFF2F",honeyDew:"F0FFF0",hotPink:"FF69B4",indianRed:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderBlush:"FFF0F5",lawnGreen:"7CFC00",lemonChiffon:"FFFACD",lightBlue:"ADD8E6",lightCoral:"F08080",lightCyan:"E0FFFF",lightGoldenRodYellow:"FAFAD2",lightGrey:"D3D3D3",lightGreen:"90EE90",lightPink:"FFB6C1",lightSalmon:"FFA07A",lightSeaGreen:"20B2AA",lightSkyBlue:"87CEFA",lightSlateGray:"789",lightSteelBlue:"B0C4DE",lightYellow:"FFFFE0",lime:"0F0",limeGreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumAquaMarine:"66CDAA",mediumBlue:"0000CD",mediumOrchid:"BA55D3",mediumPurple:"9370D8",mediumSeaGreen:"3CB371",mediumSlateBlue:"7B68EE",mediumSpringGreen:"00FA9A",mediumTurquoise:"48D1CC",mediumVioletRed:"C71585",midnightBlue:"191970",mintCream:"F5FFFA",mistyRose:"FFE4E1",moccasin:"FFE4B5",navajoWhite:"FFDEAD",navy:"000080",oldLace:"FDF5E6",olive:"808000",oliveDrab:"6B8E23",orange:"FFA500",orangeRed:"FF4500",orchid:"DA70D6",paleGoldenRod:"EEE8AA",paleGreen:"98FB98",paleTurquoise:"AFEEEE",paleVioletRed:"D87093",papayaWhip:"FFEFD5",peachPuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderBlue:"B0E0E6",purple:"800080",red:"F00",rosyBrown:"BC8F8F",royalBlue:"4169E1",saddleBrown:"8B4513",salmon:"FA8072",sandyBrown:"F4A460",seaGreen:"2E8B57",seaShell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyBlue:"87CEEB",slateBlue:"6A5ACD",slateGray:"708090",snow:"FFFAFA",springGreen:"00FF7F",steelBlue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",transparent:"FFFFFF00",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFF",whiteSmoke:"F5F5F5",yellow:"FF0",yellowGreen:"9ACD32"};if(typeof b.style.makeColor==="function"){for(e in f){if(f.hasOwnProperty(e)){b[e.replace(/(.)([A-Z])/g,"$1_$2").toUpperCase()]=b[e.toLowerCase()]=b[e]=b.style.makeColor(f[e])}}}for(e in f){if(f.hasOwnProperty(e)){f[e]="#"+f[e];f[e.toLowerCase()]=f[e]}}}());(function(){b.declare({name:"oui.style.GradientStop",mixins:[b.lang.PropertiesSupport],membersDef:{init:function(e){this._initProperties(e)}},propertiesDef:{color:b.defs.Color(b.black),offset:b.defs.NumberInRange([0,1],0)}})}());(function(){b.declare({name:"oui.style.GradientPaint",isAbstract:true,extend:b.style.Paint,mixins:[b.lang.PropertiesSupport],membersDef:{init:function(e){this._initImpl();this._initProperties(e)},onPropChanged:function(){this._onPropChangedImpl()},addGradientStop:function(i,e){if(this._properties.stops.length===0){this._properties.stops=[]}var h=new b.style.GradientStop({offset:i,color:e}),g=this._properties.stops,j=g.length,f=0;while(f<=j-1&&i>=g[f].getOffset()){f++}g.splice(f,0,h);this.onPropChanged()},_initImpl:function(){},_onPropChangedImpl:function(){}},propertiesDef:{useObjectBoundingBox:b.defs.Boolean(true),stops:b.defs.ArrayOfType({type:b.style.GradientStop,convertor:function(h,e,g,k){var j,f=null;if(typeof h==="object"&&typeof h.offset==="number"){j=h.offset;f=b.style.makeColor(h.color)}else{if(k>1){j=g/(k-1);f=b.style.makeColor(h)}}if(f){e.validValue=true;e.value=new b.style.GradientStop({offset:j,color:f})}}},0,undefined,[],undefined,false,true)}})}());(function(){var e=b.defs;b.declare({name:"oui.style.LinearGradient",extend:b.style.GradientPaint,propertiesDef:{x1:e.FiniteNumber(0),y1:e.FiniteNumber(0),x2:e.FiniteNumber(1),y2:e.FiniteNumber(0)}});b.mixin(b.style,{deriveGradient:function(i,j,f){var k,h,g;if(f===undefined){f=0.8}k=i.modify(f);if(j===true){h=i;g=k}else{h=k;g=i}return new b.style.LinearGradient({x1:0,y1:0,x2:0,y2:1,stops:[h,g]})}})}());(function(){b.mixin(b.style.LinearGradient,{cvToStyle:function(e,m){var l=this._properties,n=l.stops,k=n.length,f,g,j,h;if(l.useObjectBoundingBox){f=m.createLinearGradient(l.x1*e.width+e.x,l.y1*e.height+e.y,l.x2*e.width+e.x,l.y2*e.height+e.y)}else{f=m.createLinearGradient(l.x1,l.y1,l.x2,l.y2)}for(h=0;h<k;h++){j=n[h];g=j.getColor();f.addColorStop(j.getOffset(),g.cvToStyle())}return f}})}());(function(){var e=b.defs;b.declare({name:"oui.style.RadialGradient",extend:b.style.GradientPaint,propertiesDef:{cx:e.FiniteNumber(0.5),cy:e.FiniteNumber(0.5),radius:e.FiniteNumber(0.5)}})}());(function(){b.mixin(b.style.RadialGradient,{cvToStyle:function(e,n){var m=this._properties,o=m.stops,l=o.length,j,g,k,f,h;if(m.useObjectBoundingBox){f=Math.min(e.width,e.height);j=n.createRadialGradient(m.cx*e.width+e.x,m.cy*e.height+e.y,0,m.cx*e.width+e.x,m.cy*e.height+e.y,m.radius*f)}else{j=n.createRadialGradient(m.cx,m.cy,0,m.cx,m.cy,m.radius)}for(h=0;h<l;h++){k=o[h];g=k.getColor();j.addColorStop(k.getOffset(),g.cvToStyle())}return j}})}());(function(){b.declare({name:"oui.style.PatternPaint",extend:b.style.Paint,mixins:[b.lang.PropertiesSupport,b.events.EventSupport],eventsDef:{PATTERN_READY:"patternReady"},membersDef:{init:function(e){this._srcW=0;this._srcH=0;this._initImpl();this._initProperties(e)},onPropChanged:function(){var e=this._properties.src;if(this.prevRequest){b.resourcesManager.removeObserver(this.prevRequest,this);this.prevRequest=null}else{if(this.imageLoader){this.imageLoader.offComplete(this);this.imageLoader=null}}this._onPropChangedImpl();if(e.length>0){if(b.resourcesManager.hasResource(e)){b.resourcesManager.requestResource(e,this);this.prevRequest=e}else{this.imageLoader=new b.utils.ImageLoader();this.imageLoader.onComplete(this);this.imageLoader.load(e)}}},handleEvent:function(e){this._srcW=e.width;this._srcH=e.height;this._patternReadyImpl(e);this.dispatchEvent({type:this.events.PATTERN_READY})},resourceUpdate:function(e){this.handleEvent(e)},_initImpl:function(){},_onPropChangedImpl:function(){},_patternReadyImpl:function(e){}},propertiesDef:{src:b.defs.String("")}})}());(function(){var e=b.style.Paint.prototype;b.mixin(b.style.PatternPaint,{_onPropChangedImpl:function(){this.cvImg=null},_patternReadyImpl:function(f){this.cvImg=f.data},cvToStyle:function(f,g){return this.cvImg?g.createPattern(this.cvImg,"repeat"):e.cvToStyle.call(this,f,g)}})}());(function(){b.ns("oui.style");var t=b.GENERIC_FONTS.SANS_SERIF,q=b.GENERIC_FONTS.SERIF,e=b.GENERIC_FONTS.MONOSPACE,g=b.GENERIC_FONTS.CURSIVE,o,p,h,l,k,r,s,f;o=[["Arial","'Helvetica Neue'","Helvetica",t],["'Arial Black'","Gadget",t],["'Comic Sans MS'","'Comic Sans'","Textile",g],["'Courier New'","Courier",e],["Georgia",q],["Impact","Charcoal",t],["'Lucida Console'","Monaco",e],["'Lucida Sans Unicode'","'Lucida Grande'",t],["'Palatino Linotype'","'Book Antiqua'","Palatino",q],["Tahoma","Geneva","'Liberation Sans'","'Nimbus Sans L'","FreeSans",t],["'Times New Roman'","Times",q],["'Trebuchet MS'","Trebuchet",t],["Verdana","Geneva",t],["'MS Sans Serif'","Geneva",t],["'MS Serif'","'New York'",q]];b.cssFonts={};for(p=0,h=o.length;p<h;p++){r=o[p];for(l=0,k=r.length-1;l<k;l++){f=r[l].replace(/'/gi,"").toLowerCase();if(b.cssFonts.hasOwnProperty(f)===false){s=r.slice();s.splice(l,1);s.unshift(r[l]);b.cssFonts[f]=s.join(",")}}}}());(function(){b.ns("oui.text.locales");b.text.locales.en_US={eras:["BC","AD"],months:[{l:"January",s:"Jan"},{l:"February",s:"Feb"},{l:"March",s:"Mar"},{l:"April",s:"Apr"},{l:"May",s:"May"},{l:"June",s:"Jun"},{l:"July",s:"Jul"},{l:"August",s:"Aug"},{l:"September",s:"Sep"},{l:"October",s:"Oct"},{l:"November",s:"Nov"},{l:"December",s:"Dec"}],days:[{l:"Sunday",s:"Sun"},{l:"Monday",s:"Mon"},{l:"Tuesday",s:"Tue"},{l:"Wednesday",s:"Wed"},{l:"Thursday",s:"Thu"},{l:"Friday",s:"Fri"},{l:"Saturday",s:"Sat"}],ampm:["AM","PM"],timezones:{0:{std:{l:"Greenwich Mean Time",s:"GMT"},dst:{l:"Greenwich Mean Time",s:"GMT"}},480:{std:{l:"Pacific Standard Time",s:"PST"},dst:{l:"Pacific Daylight Time",s:"PDT"}},420:{std:{l:"Mountain Standard Time",s:"MST"},dst:{l:"Mountain Daylight Time",s:"MDT"}},360:{std:{l:"Central Standard Time",s:"CST"},dst:{l:"Central Daylight Time",s:"CDT"}},300:{std:{l:"Eastern Standard Time",s:"EST"},dst:{l:"Eastern Daylight Time",s:"EDT"}},600:{std:{l:"Hawaii Standard Time",s:"HST"},dst:{l:"Hawaii Standard Time",s:"HST"}},540:{std:{l:"Alaska Standard Time",s:"AKST"},dst:{l:"Alaska Standard Time",s:"AKST"}},240:{std:{l:"Atlantic Standard Time",s:"AST"},dst:{l:"Atlantic Daylight Time",s:"ADT"}},210:{std:{l:"Newfoundland Standard Time",s:"NST"},dst:{l:"Newfoundland Daylight Time",s:"NDT"}}},shortDate:"M/d/yy",medDate:"d-MMM-yy",longDate:"MMMM d, yyyy",fullDate:"EEEE MMMM d, yyyy G",date:"d-MMMM-yy",shortTime:"h:mm a",medTime:"h:mm:ss a",longTime:"h:mm:ss a z",fullTime:"h:mm:ss;S 'o''clock' a z",time:"h:mm:ss a"}}());b.text=b.text||{};(function(){var t,e="0",s="#",i="0",j="E",p="+",k="-",v="\u221E";t=function(){};t.prototype={tempMinIntegerDigits:0,minDecimalPlaces:0,maxDecimalPlaces:0,minIntegerPlaces:1,maxIntegerPlaces:1,prefix:"",suffix:"",integerPattern:"",decimalPattern:"",grouping:3,percentMode:false,permilleMode:false,color:null};function f(y){var B,z=0,A=y.length,x=false;if(y.charAt(z)===j&&A>1){x=true;z+=1;B=y.charAt(z);if(B===p||B===k){z+=1}while(z<A){if(y.charAt(z)===e){z++}else{x=false;break}}}return x}function l(D,x,y){var z=false,A=false,F=D.length>0,E,C,B;for(C=0,B=D.length;C<B;C++){E=D.charAt(C);if(E===s||E===e){continue}else{if(E===x){if(z){F=false;break}else{z=true}}else{if(E===y){if(A){F=false;break}else{if(z){F=false;break}else{A=true}}}else{if(E===j){F=f(D.substring(C,B));break}else{F=false;break}}}}}return F}function h(A,y){var B,x,z;B=A.indexOf("[");x=A.indexOf("]");if(B>-1&&x>B){z=A.substring(B+1,x).toLowerCase();if(b.style.CSS_COLORS.hasOwnProperty(z)){y.color=b.style.CSS_COLORS[z]}else{if(z.match(/^(0x)?[0-9a-fA-F]{6}$/)){y.color="#"+z.replace("0x","")}}if(y.color!==null){A=A.substring(0,B)+A.substring(x+1)}}return A}function q(I,D,x){var y=I.length,L=I.indexOf(s),z=I.indexOf(e),C=I.indexOf(x),H=I.indexOf("%"),B=I.indexOf("\u2030"),M,E,F,G,K,A,J;if(L<0){L=y-1}if(z<0){z=y-1}if(C<0){C=y-1}F=I.lastIndexOf(s);G=I.lastIndexOf(e);K=I.lastIndexOf(x);A=Math.min(L,C,z);A=A<0?0:A;J=Math.max(F,G,K);D.prefix=I.substring(0,A);D.suffix=I.substring(J+1,y);if(A>J+1||(H>=0&&B>=0)||(H>=0&&H!==I.lastIndexOf("%"))||(B>=0&&B!==I.lastIndexOf("\u2030"))){I=""}else{I=I.substring(A,J+1);if(H>0){D.percentMode=true;M=H;E="%"}else{if(B>0){D.permilleMode=true;M=B;E="\u2030"}}if(M>=A&&M<=J){I=I.replace(E,"");D.suffix=E+D.suffix}}return I}function g(A,y,x){var z=A.lastIndexOf(x);if(z>0){y.grouping=A.length-z-1}else{y.grouping=-1}}function m(y,x){x.minDecimalPlaces=0;x.maxDecimalPlaces=0;if(y.length>0){x.minDecimalPlaces=y.lastIndexOf(e)>-1?y.lastIndexOf(e)+1:0;x.maxDecimalPlaces=y.length}}function w(B,y,x){var A,D,z,C;y.minIntegerPlaces=0;y.maxIntegerPlaces=0;for(z=0,C=B.length;z<C;z++){D=B.charAt(z);if(D===e){y.minIntegerPlaces++;y.maxIntegerPlaces++}if(D===s){y.maxIntegerPlaces++}}A=B.lastIndexOf(x);y.tempMinIntegerDigits=A;if(y.tempMinIntegerDigits===-1){y.tempMinIntegerDigits=y.minIntegerPlaces}}function o(D,A,z,y){var x=D.split(j),C,E,B;A.exponent=0;if(x.length===2){C=x[1];B=0;E=C.charAt(B);if(E===p){B+=1}A.exponent=C.length-B}else{A.exponent=0}C=x[0].split(z);if(z===y&&C.length===3){A.intPattern=C[0];A.intPattern+=y;A.intPattern+=C[1];A.decPattern=C[2]}else{if(C.length===2){A.intPattern=C[0];A.decPattern=C[1]}else{A.intPattern=x[0];A.decPattern=""}}}function u(A,z,y){var x=new t();A=h(A,x);A=q(A,x,z);if(l(A,z,y)){o(A,x,z,y);g(x.intPattern,x,y);m(x.decPattern,x);w(x.intPattern,x,y)}else{x=null}return x}function n(E,A,z,y){var F="",x="",B,C=0,D=0;if(E>0){x=E.toString()}A-=x.length;if(A>0){for(C=0;C<A;C++){F+=i}x=F+x}if(z>0&&x.length>z){B=[];for(C=x.length-1;C>=0;C--){if(D===z-1&&C>0){B.unshift(y,x.charAt(C));D=0}else{B.unshift(x.charAt(C));D++}}x=B.join("")}return x}function r(D,C,y,x){var E="",z=0,B="",A;if(D>0){A=C-Math.floor(C);for(z=0;z<x;z++){A*=10;if(Math.floor(A)===0){B+=i}else{break}}if(z<x){B+=D.toString()}z=B.length-1;while(B.charAt(z)===i&&z>=y){z--}B=B.substring(0,z+1)}y-=B.length;if(y>0){for(z=0;z<y;z++){E+=i}B+=E}return B}b.text.NumberFormatter=function(B){var z=".",D=",",y=null,x=null,A,C=null;this.applyPattern=function(K){var G,J,F="",I=0,H="",L="",E;if(typeof K==="string"&&K.length>0&&K!==A){G=K.indexOf("{");J=K.indexOf("}");if(G===0&&J>=2){F=K.substring(G+1,J);I=F.length;if(J>2){H=F.charAt(I-1);L=F.charAt(I-2)}else{H="\uFFFF";L=F.charAt(I-1)}if(H!==L&&!H.match(/[0-9a-zA-Z]/)&&!L.match(/[0-9a-zA-Z]/)){z=H;D=L;K=K.substring(J+1)}}E=K.split(";");if(E&&E.length>0){y=u(E[0],z,D);if(E.length>1&&E[1]&&E[1].length>0){x=u(E[1],z,D)}else{x=y}}else{y=null;x=null}A=K}};this.format=function(L){var U,G,H="",R,N,I,O,S,T,K,P,Q,J,F,E,M;if(typeof L!=="number"||y===null){U=""}else{G=L<0?x:y;C=G.color;R=G.exponent;N=G.tempMinIntegerDigits;I=G.minIntegerPlaces;O=G.minDecimalPlaces;S=G.maxDecimalPlaces;if(L<0&&y===x){H+=k}if(L<0){L=-L}if(G.percentMode){L*=100}else{if(G.permilleMode){L*=1000}}T=0;K=0;if(R>0){K=Math.floor(Math.log(L)/Math.log(10));if(K!==Infinity){P=K;if(I!==0){K-=I-1}T=(L/Math.pow(10,K));K=P-(N-1)}else{T=L}}else{T=L}T+=5*Math.pow(10,-S-1);Q=Math.floor(T);J=T-Q;F=Math.pow(10,-S);E=Math.floor(J/F);U=n(Q,I,G.grouping,D);if(O>0||E>0){U+=z}U+=r(E,T,O,S);if(R>0){if(K===Infinity||K===-Infinity){if(Math.abs(L)<1){U=i}else{U=v}}else{U+=j;if(K<0){U+=k}else{U+=p}for(M=1;M<R;M++){U+=i}U+=Math.abs(K).toString()}}if(U.length>0&&D===U.charAt(0)){U=U.substring(1,U.length)}if(U.length===0){U=i}U=(G.prefix+H+U+G.suffix)}return U};this.getColor=function(){return C};this.hasColor=function(){return C!==null};this.applyPattern(B)};b.formatNumber=function(y,x){return new b.text.NumberFormatter(y).format(x)}}());(function(){var e=/\|/,f=/(?:#|<)/;b.declare({name:"oui.text.ChoiceFormatter",membersDef:{init:function(g){this.applyPattern(g)},applyPattern:function(q){var h=q.split(e),m,j,r,g,s,k,l,p,o;if(h&&h.length>0){o=[];for(m=0,j=h.length;m<j;m++){r=h[m];g=r.match(f);if(g){s=r.indexOf(g);k=r.substring(0,s);l=r.substring(s+1);p={format:l,open:(g[0]==="<"),min:parseInt(k,10),max:Number.POSITIVE_INFINITY};if(o.length>0){o[o.length-1].max=p.min}o.push(p)}}}this.choiceElements=o},format:function(m){var g,l=this.choiceElements,h,j,p=l.length,k=l[0],o=l[p-1];if(isNaN(m)||m<=k.min){g=k.format}else{if(m>=o.max){g=o.format}else{for(j=0;j<p;j++){h=l[j];if((h.open===false&&h.min===m)||(h.min<m&&m<h.max)){g=h.format;break}}}}return g}}});b.formatChoice=function(h,g){return new b.text.ChoiceFormatter(h).format(g)}}());(function(){var y=b.text.locales.en_US,n="G",f="y",F="M",z="w",i="W",u="D",p="d",D="F",m="E",C="a",A="H",j="k",E="K",v="h",o="m",s="s",k="S",l="z",x="Z",B="short",r="medium",h="long",t="full",g=24*60*60*1000,q=1,w=4;function e(J,I){var G="",H=J.toString();for(I-=H.length;I>0;I--){G+="0"}return G+H}b.declare({name:"oui.text.DateFormatter",membersDef:{init:function(G,H){this.applyPattern(G,H)},applyPattern:function(I,K){var H,N,M,G,L,J;I=this._fixPattern(I,K);this.dateElements=[];if(I){for(H=0,N=I.length;H<N;H++){M=I.charAt(H);if(!this._isSupportedToken(M)){J=undefined;if(M==="'"){G="";L=H+1;while(L<N){M=I.charAt(L);if(M==="'"){if(I.charAt(L+1)==="'"){G+=M;L+=2}else{break}}else{G+=M;L+=1}}if(L>=N){L=H}else{this.dateElements.push(G)}H=L}else{if((M<"a"||M>"z")&&(M<"A"||M>"Z")){this.dateElements.push(M)}}}else{if(J&&(M===J.type)){J.size++}else{J={type:M,size:1};this.dateElements.push(J)}}}}},_fixPattern:function(H,I){var G;if(H){switch(H){case B:G=I?y.shortTime:y.shortDate;break;case r:G=I?y.medTime:y.medDate;break;case h:G=I?y.longTime:y.longDate;break;case t:G=I?y.fullTime:y.fullDate;break;default:G=H;break}}else{G=I?y.time:y.date}return G},_isSupportedToken:function(G){return(G===n||G===f||G===F||G===z||G===i||G===u||G===p||G===D||G===m||G===C||G===A||G===j||G===E||G===v||G===o||G===s||G===k||G===l||G===x)},format:function(N){var L="",I,H,J,G,K,M,O;if(b.isA(N,Date)){I=N}else{I=new Date();I.setDate(N)}for(J=0,G=this.dateElements.length;J<G;J++){H=this.dateElements[J];if(b.isA(H,Object)){switch(H.type){case n:L+=y.eras[I.getFullYear()>0?1:0];break;case f:K=I.getFullYear().toString();if(H.size<4){L+=K.substring(K.length-2)}else{L+=K}break;case F:K=I.getMonth();if(H.size<3){L+=e(K+1,H.size)}else{if(H.size<4){L+=y.months[K].s}else{L+=y.months[K].l}}break;case z:L+=e(this._getWeekOfYear(I),H.size);break;case i:L+=e(this._getWeekOfMonth(I),H.size);break;case u:L+=e(this._getDayOfYear(I),H.size);break;case p:L+=e(I.getDate(),H.size);break;case D:L+=e(I.getDay(),H.size);break;case m:K=I.getDay();if(H.size<4){L+=y.days[K].s}else{L+=y.days[K].l}break;case C:L+=y.ampm[I.getHours()<12?0:1];break;case A:L+=e(I.getHours(),H.size);break;case j:L+=e(((I.getHours()+23)%24)+1,H.size);break;case E:L+=e(I.getHours()%12,H.size);break;case v:L+=e(((I.getHours()+11)%12)+1,H.size);break;case o:L+=e(I.getMinutes(),H.size);break;case s:L+=e(I.getSeconds(),H.size);break;case k:L+=e(I.getMilliseconds(),H.size);break;case l:K=I.getTimezoneOffset();if(this._isDST(I)){M=(K+60).toString();O="dst"}else{M=K.toString();O="std"}if(y.timezones.hasOwnProperty(M)){K=y.timezones[M];if(H.size<4){L+=K[O].s}else{L+=K[O].l}}else{L+="GMT"+(K>0?"-":"+")+Math.floor(K/60)+":"+e((K%60),2)}break;case x:K=I.getTimezoneOffset();L+=(K>0?"-":"+")+e(Math.floor(K/60),2)+e((K%60),2);break;default:c.error("ERR__FORMAT__ILLEGAL_DATE_PATTERN",H)}}else{L+=H.toString()}}return L},_getWeekOfYear:function(H,G,L){var K,I,J,M;if(!isFinite(G)){G=q}if(!isFinite(L)){L=w}K=(7+H.getDay()-G)%7;I=(this._getDayOfYear(H)-K+6)/7;J=new Date(H.getFullYear(),0,L);M=(7+J.getDay()-G)%7;if(L-M<1){I++}return Math.floor(I)},_getWeekOfMonth:function(I,H,L){var K,G,J,M;if(!isFinite(H)){H=q}if(!isFinite(L)){L=w}K=(7+I.getDay()-H)%7;G=(I.getDate()-K+6)/7;J=new Date(I.getFullYear(),I.getMonth(),L);M=(7+J.getDay()-H)%7;if(L-M<1){G++}return Math.floor(G)},_getDayOfYear:function(I){var J=I.getFullYear(),M=I.getMonth(),G=I.getDate(),H=new Date(J,0,1,12,0,0),L=new Date(J,M,G,12,0,0),K=(L.getTime()-H.getTime())/g;return(Math.round(K)+1)},_isDST:function(H){var G=new Date(H.getFullYear(),0,1,H.getHours(),H.getMinutes(),H.getSeconds(),H.getMilliseconds());return(H.getTimezoneOffset()!==G.getTimezoneOffset())}}});b.text.DateFormatter.setLocale=function(G){if(typeof G==="string"&&b.text.locales.hasOwnProperty(G)===true){y=b.text.locales[G]}};b.formatDate=function(H,G){return new b.text.DateFormatter(H).format(G)}}());(function(){var e={NUMBER:"number",CHOICE:"choice",DATE:"date",TIME:"time"};b.declare({name:"oui.text.FormatElement",membersDef:{init:function(k,j,i){var h,f,g;if(b.isFinitePositiveNumber(k)){this.argIndex=k}else{c.error("ERR__FORMAT__ILLEGAL_ARG_INDEX")}h=b.isA(j,String);f=b.isA(i,String);if(h&&f){switch(j){case e.NUMBER:g=new b.text.NumberFormatter(i);break;case e.CHOICE:g=new b.text.ChoiceFormatter(i);break;case e.DATE:g=new b.text.DateFormatter(i);break;case e.TIME:g=new b.text.DateFormatter(i,true);break;default:c.error("ERR__FORMAT__ILLEGAL_ARG_TYPE",j)}this.type=j}else{if(h&&!f){c.error("ERR__FORMAT__ILLEGAL_ARG_NO_STYLE")}else{if(!h&&f){c.error("ERR__FORMAT__ILLEGAL_ARG_NO_TYPE")}}}this.format=function(m){var l;if(this.accepts(m)){if(g){l=g.format(m)}else{l=(m===null?"null":m.toString())}}else{c.error("ERR__FORMAT__ILLEGAL_ARG_VALUE")}return l}},accepts:function(h){var g=true,f=this.type;if(f){if(f===e.NUMBER||f===e.CHOICE){g=b.isA(h,Number)}else{if(f===e.DATE||f===e.TIME){g=b.isA(h,Date)}}}return g},toString:function(){return"{"+this.argIndex+"}"}}});b.text.FormatElement.TypeEnum=e}());(function(){var e=/\{\d+(?:\,(?:choice|number|date|time)\,(?:[^\{]|\{[^\{]+\})+)?\}/g;b.declare({name:"oui.text.MessageFormatter",membersDef:{init:function(f){this.applyPattern(f)},applyPattern:function(q){var h=q.match(e),p=q.split(e),o,j,m,t,l,r,s,g,f,k,u=[];if(h&&h.length>0&&p&&p.length>0){for(o=0,j=h.length;o<j;o++){m=undefined;l=undefined;r=undefined;s=h[o];g=s.indexOf(",");if(g<0){t=s.substring(1,s.length-1);m=parseInt(t,10)}else{m=parseInt(s.substring(1,g),10);f=s.indexOf(",",g+1);l=s.substring(g+1,f);r=s.substring(f+1,s.length-1)}k=new b.text.FormatElement(m,l,r);u.push(p[o]);u.push(k)}u.push(p[h.length])}else{u.push(q)}this.parsedPattern=u},format:function(){var g="",k,j=this.parsedPattern.length,m,f,h,l;for(k=0;k<j;k++){m=this.parsedPattern[k];if(b.isA(m,b.text.FormatElement)){f=arguments[m.argIndex];if(f!==undefined){h=m.format(f);if(m.type===b.text.FormatElement.TypeEnum.CHOICE){l=new b.text.MessageFormatter(h);h=l.format.apply(l,arguments)}g+=h}else{g+=m.toString()}}else{if(b.isA(m,String)){g+=m}}}return g}}});b.formatMessage=function(h,g){var f=new b.text.MessageFormatter(h);return f.format.apply(f,g)}}());(function(){var f=new RegExp("\\S+","g");function e(k){var i=[],g,j,h=0;while((g=f.exec(k))!==null){j=g[0];i.push({beginIndex:g.index,endIndex:g.index+(j.length-1),length:j.length,value:j,wordIndex:h});h++}return i}b.declare({name:"oui.text.WordIterator",membersDef:{init:function(g){this._words=e(g);this._wordCount=this._words.length;this._currWord=null},first:function(){var g=null;if(this._wordCount>0){g=this._words[0]}this._currWord=g;return g},last:function(){var g=null;if(this._wordCount>0){g=this._words[this._wordCount-1]}this._currWord=g;return g},next:function(){var i=null,j=this._wordCount,h,g;if(j>0){h=this._currWord;g=0;if(h){g=h.wordIndex+1}if(g<j){i=this._words[g]}}this._currWord=i;return i},previous:function(){var i=null,h=this._wordCount,g,j;if(h>0){g=this._currWord;j=h-1;if(g){j=g.wordIndex-1}if(j>=0){i=this._words[j]}}this._currWord=i;return i},current:function(){return this._currWord},wordAt:function(n){var m=this._words,h=this._wordCount,k=null,l=0,j,g=null;if(this._currWord){l=this._currWord.wordIndex}for(j=l;j<h;j++){g=m[j];if(n<g.beginIndex){break}else{if(n<=g.endIndex){k=g;break}}}this._currWord=g;return k}}})}());(function(){var e="\n";b.declare({name:"oui.text.LineBreakMeasurer",membersDef:{init:function(f){this._textValue=f.textValue();this._position=0;this._wordIterator=new b.text.WordIterator(this._textValue);this._wordIterator.first();this._initOffsetLimits();this._initImpl(f)},nextLine:function(g){var f=this._nextLineImpl(g);if(f&&f.leading===undefined){f.leading=this._computeLeadingApproximation(f)}return f},replaceText:function(g,j,i){var h=this._textValue,f=h.length;if(g<0||j>f||g>j){c.error("ERR__LINEBREAK__ILLEGAL_REPLACE_ARG")}this._textValue="";if(g!==0){this._textValue+=h.slice(0,g)}if(i!==null){this._textValue+=i}if(j!==f){this._textValue+=h.slice(j)}this._position=0;this._wordIterator.init(this._textValue);this._wordIterator.first();this._initOffsetLimits();this._replaceTextImpl(g,j,i)},getRawText:function(){return this._textValue},getTextLength:function(){return this._textValue.length},_initImpl:function(f){},_nextLineImpl:function(l){var k=this._getCurrentOffsetLimit(),n=null,i=this._wordIterator,j=this._position,g=j,f=i.current(),m,h;if(f){m=f.endIndex+1;if(m>k||this._measureImpl(j,m)>l){g=this._fitChars(l,k);h=true}else{g=this._fitWords(l,k);h=false}this._updateOffsetLimit(g);if(g>j){n=this._createLineObjImpl(j,g,h);this._position=g}}return n},_measureImpl:function(g,f){return 0},_createLineObjImpl:function(h,f,g){return{textValue:this._textValue.substring(h,f),textBlockBeginIndex:h,lastWordTruncated:g,lineWidth:0,lineHeight:0,ascent:0,descent:0,userData:null}},_replaceTextImpl:function(f,h,g){},_initOffsetLimits:function(){this._offsetLimits=this._findOffsetLimits(this._textValue);this._offsetLimitsCount=this._offsetLimits.length;this._currOffsetLimit=0},_findOffsetLimits:function(g){var f=[],j=0,h=g.length;for(j=0;j<h;j++){if(e===g.charAt(j)){f.push(j+1)}}return f},_getCurrentOffsetLimit:function(){var f=this._textValue.length;if(this._currOffsetLimit<this._offsetLimitsCount){f=this._offsetLimits[this._currOffsetLimit]}return f},_updateOffsetLimit:function(f){if(f===this._offsetLimits[this._currOffsetLimit]){this._currOffsetLimit++}},_fitChars:function(h,g){var j=this._position,i=this._position+1,f=i;while(i<g&&this._measureImpl(j,i)<=h){f=i;i++}return f},_fitWords:function(g,f){var h=this._wordIterator.current(),j=this._position,i=j;while(h&&(h.endIndex+1)<=f&&this._measureImpl(j,h.endIndex+1)<=g){i=h.endIndex+1;h=this._wordIterator.next()}if(h&&i!==j&&i!==f){if(h.beginIndex>f){i=f}else{i=h.beginIndex}}return i},_computeLeadingApproximation:function(f){return(f.ascent+f.descent)*0.2}}})}());(function(){b.mixin(b.text.LineBreakMeasurer,{_initImpl:function(e){this._font=e.cvGetFont();this._fontSize=e.fontSize();this.cvTextMeasurer=b.tree.canvas.getContext("2d")},_measureImpl:function(h,e){var f,g=this.cvTextMeasurer;g.save();g.font=this._font;f=g.measureText(this._textValue.substring(h,e));g.restore();return f.width},_createLineObjImpl:function(i,e,h){var f=this._textValue.substring(i,e),g=b.tree.cvTextMetrics(f,this._font);return{textValue:f,textBlockBeginIndex:i,textBlockEndIndex:e,lastWordTruncated:h,lineWidth:g.width,lineHeight:g.height,ascent:g.ascent,descent:g.descent,leading:0,userData:null}}})}());(function(){var e="FILTER_EVENT";b.declare({name:"oui.filters.AbstractFilter",isAbstract:true,mixins:[b.events.EventSupport],membersDef:{init:function(f){this._style=new this.Style();this.applyStyle(f)},applyStyle:function(f){var g=this._style.updateObject(f),h;if(this.shadowFilter){for(h in g){if(g.hasOwnProperty(h)){this._updateShadowFilter(h)}}}this.dispatchEvent({type:e})},_getFilteredBounds:function(f){return f},_getShadowFilter:function(){if(!this.shadowFilter){this.shadowFilter=this._createShadowFilter()}return this.shadowFilter},_createShadowFilter:function(){},_updateShadowFilter:function(f){}}});b.filters.FILTER_EVENT=e}());(function(){b.mixin(b.filters.AbstractFilter,{cvApplyFX:function(e,f){return e}})}());(function(){var e={RADIUS:"RADIUS"};b.declare({name:"oui.filters.Blur",extend:b.filters.AbstractFilter,membersDef:{_getFilteredBounds:function(g){var f=this._style.radius;return{x:g.x-f,y:g.y-f,width:g.width+2*f,height:g.height+2*f}},_styleTags:e}});b.addStyleSupport(b.filters.Blur,{radius:b.defs.FinitePositiveNumber(3,e.RADIUS)})}());(function(){var e=b.defs,f={COLOR:"COLOR",OPACITY:"OPACITY",RADIUS:"RADIUS",ANGLE:"ANGLE",OFFSET:"OFFSET",KNOCKOUT:"KNOCKOUT"};b.declare({name:"oui.filters.DropShadow",extend:b.filters.AbstractFilter,membersDef:{_getFilteredBounds:function(i){var h=this._style,k=h.angle*Math.PI/180,j=h.offset,g=h.radius;return b.geom.unionRect(i,{x:i.x+j*Math.cos(k)-g,y:i.y+j*Math.sin(k)-g,width:i.width+2*g,height:i.height+2*g})},_styleTags:f},styleDef:{color:e.Color(b.black,f.COLOR),opacity:e.NumberInRange([0,1],0.5,f.OPACITY),radius:e.FinitePositiveNumber(2,f.RADIUS),angle:e.NumberInRange([0,360],45,f.ANGLE),offset:e.FinitePositiveNumber(2,f.OFFSET),knockout:e.Boolean(false,f.KNOCKOUT)}})}());(function(){b.mixin(b.filters.DropShadow,{isInGlobalSpace:true,cvApplyFX:function(h,e){var g,q,r=b.tree.cvPixelRatio,f=this._style,k=f.color,i=f.angle*Math.PI/180,m=f.offset*r,p=f.radius*r,l=m*Math.cos(i),j=m*Math.sin(i),o=Math.floor(e.x+l-p),n=Math.floor(e.y+j-p);g=b.tree.cvCreateBuffer(e.width,e.height);q=g.getContext("2d");q.translate(-o,-n);q.shadowColor="rgba(".concat(k.getRed(),",",k.getGreen(),",",k.getBlue(),",",(f.opacity*k.getOpacity()),")");q.shadowOffsetX=l;q.shadowOffsetY=j;q.shadowBlur=p;q.drawImage(h,o,n);if(f.knockout){q.globalCompositeOperation="destination-out";q.drawImage(h,o,n)}b.tree.cvDisposeBuffer(h);return g}})}());(function(){var e=b.defs,f={STRENGTH:"STRENGTH",COLOR:"COLOR",OPACITY:"OPACITY"};b.declare({name:"oui.filters.Glow",extend:b.filters.AbstractFilter,membersDef:{_getFilteredBounds:function(g){var h=this._style.strength;return{x:g.x-h,y:g.y-h,width:g.width+2*h,height:g.height+2*h}},_styleTags:f}});b.addStyleSupport(b.filters.Glow,{color:e.Color(b.white,f.COLOR),strength:e.FinitePositiveNumber(3,f.STRENGTH)})}());(function(){b.mixin(b.filters.Glow,{isInGlobalSpace:true,cvApplyFX:function(i,e){var g,l,f=this._style,j=f.color,h=f.strength*b.tree.cvPixelRatio,m=Math.floor(e.x-h),k=Math.floor(e.y-h);g=b.tree.cvCreateBuffer(e.width,e.height);l=g.getContext("2d");l.translate(-m,-k);l.shadowColor="rgba(".concat(j.getRed(),",",j.getGreen(),",",j.getBlue(),",",j.getOpacity(),")");l.shadowBlur=h;l.drawImage(i,m,k);b.tree.cvDisposeBuffer(i);return g}})}());(function(){b.mixin(b.filters,{NONE:null,BLUR:new b.filters.Blur(),DROP_SHADOW:new b.filters.DropShadow(),DROP_SHADOW_KNOCKED_OUT:new b.filters.DropShadow({knockout:true}),_onLayoutDir:function(e){var f=e===b.LTR?45:135;b.filters.DROP_SHADOW.setAngle(f);b.filters.DROP_SHADOW_KNOCKED_OUT.setAngle(f)}})}());(function(){var f=b.scene.AbstractNode.prototype,e=b.defs,g=b.TAGS;b.declare({name:"oui.graphics.AbstractGraphicNode",isAbstract:true,extend:b.scene.AbstractNode,mixins:[b.lang.BindingSupport,b.anim.EffectsSupport],membersDef:{init:function(h,i){f.init.call(this,i);this._globalTxf=undefined;this._globalTxfInv=undefined;this._layoutDirty=true;this._layoutPosDirty=true;this._layoutBox=undefined;this._prevLayoutBox=undefined;this._filterFX=null;this._ctrlPts=[];this._style=new this.Style();this._style.transform=new b.geom.Matrix();this._txf=this._style.transform;if(h){this.styleBinding=h.styleBinding;this.dataBinding=h.dataBinding;this.resourcesBinding=h.resourcesBinding}this.applyStyle(h)},notifyNative:function(i){var h=this.parentNode;if(i===g.TRANSFO){this.clearGlobalTransformMatrix();if(h&&this.preventParentInvalidateLayout!==true){h._clearCtrlPts();h.invalidateLayout()}}else{if(i===g.LAYOUT_DIR){this._onLayoutDirChanged();if(b.isA(this._style.tooltip,b.graphics.AbstractGraphicNode)){this._style.tooltip.notifyChildren(i)}}}f.notifyNative.call(this,i)},_onParentChanged:function(){this.clearGlobalTransformMatrix();f._onParentChanged.call(this)},_onChildrenChanged:function(){this._clearCtrlPts();this.invalidateLayout();f._onChildrenChanged.call(this)},onPropertyChanged:function(){},onStyleChanged:function(h){if(h===b.DEFAULT_TAG){this.onPropertyChanged()}else{if(h===g.VISIBILITY||h===g.SENSITIVITY||h===g.DESC){this.notifyNative(h)}else{if(h===g.LAYOUT||h===g.PREF_SIZE){this.invalidateLayout()}else{if(h===g.DISPLAY||h===g.CLIP){this._clearCtrlPts();this.invalidateLayout();this.notifyNative(h)}else{if(h===g.FILTER){this._updateFilterFX();this.notifyNative(h)}else{if(h===g.CURSOR){this._onCursorChanged();this.notifyNative(h)}else{if(h===g.TRANSFO_SET){this._style.transform=this._style.transform.clone();this._txf=this._style.transform;this.notifyNative(g.TRANSFO)}}}}}}}},applyStyle:function(h){var i,j;if(h){i=this._style.updateObject(h);for(j in i){if(i[j]===true){this.onStyleChanged(j)}}}},applyStyleBinding:function(j,i,h){this._applyBinding(j,i,"styleBinding","styleBindingScope",this.applyStyle,h)},applyDataBinding:function(j,i,h){this._applyBinding(j,i,"dataBinding","dataBindingScope",this.applyStyle,h)},applyResourcesBinding:function(j,i,h){this._applyBinding(j,i,"resourcesBinding","resourcesBindingScope",this.applyStyle,h)},requestFocus:function(){if(b.focusManager){b.focusManager.requestFocus(this)}},getDefaultDragAction:function(){return function(h){var i=h.target;if(i&&i.draggable()){i.translate(h.dragUserX,h.dragUserY)}}},translate:function(i,h){if(i!==0||h!==0){this._txf.translate(i,h);this.notifyNative(g.TRANSFO)}return this},scale:function(i,h){this._txf.scale(i,h);this.notifyNative(g.TRANSFO);return this},rotate:function(j,h,k){var i=j/180*Math.PI;this._txf.rotate(i,h,k);this.notifyNative(g.TRANSFO);return this},setTranslation:function(h,i){if(b.isFiniteNumber(h)&&b.isFiniteNumber(i)){this._setTranslation(h,i)}},_setTranslation:function(h,j){var i=this._txf;if(i.tx!==h||i.ty!==j){i.tx=h;i.ty=j;this.notifyNative(g.TRANSFO)}},getTranslation:function(){return{x:this._txf.tx,y:this._txf.ty}},resetTransform:function(){this._style.transform=b.geom.Matrix.IDENTITY.clone();this._txf=this._style.transform;this.notifyNative(g.TRANSFO)},getTransformMatrix:function(){return this._txf.clone()},setTransformMatrix:function(h){this._txf.set(h);this.notifyNative(g.TRANSFO)},getGlobalTransformMatrix:function(){return this._safeGetGlobalTxf().clone()},getGlobalTransformMatrixInv:function(){return this._safeGetGlobalTxfInv().clone()},_safeGetGlobalTxfInv:function(){if(!this._globalTxfInv){this._globalTxfInv=this._safeGetGlobalTxf().inv()}return this._globalTxfInv},_safeGetGlobalTxf:function(){var h=this._globalTxf;if(!h){if(this.parentNode){h=this.parentNode._safeGetGlobalTxf();if(!this._txf.isIdentity()){h=h.clone();h._concat(this._txf)}}else{h=this._txf}this._globalTxf=h}return h},clearGlobalTransformMatrix:function(h){var i;if(this._globalTxf||this._globalTxfInv){this._globalTxf=undefined;this._globalTxfInv=undefined;i=this.firstChild;while(i){i.clearGlobalTransformMatrix(true);i=i.nextSibling}}this._clearGlobalTxfImpl(h)},_clearGlobalTxfImpl:function(h){},_transformCtrlPts:function(i,j){var h=this._getCtrlPts(j);if(h.length>0){if(j===b._BoundsType.RENDER){h=this._filterCtrlPts(h)}h=this._clipCtrlPts(h);if(i&&!i.isIdentity()){h=i.transformAll(h,[])}}return h},_filterCtrlPts:function(i){var h=i,k=this._filterFX,j;if(k){if(k.isInGlobalSpace){h=this._safeGetGlobalTxf().transformAll(i,[])}j=b.geom.computeBounds(h);j=this._filterFX._getFilteredBounds(j);h=b.geom.getBoxCtrlPts(j.x,j.y,j.width,j.height);if(k.isInGlobalSpace){h=this._safeGetGlobalTxfInv().transformAll(h)}}return h},_clipCtrlPts:function(i){var h=i,k=this._style.clip,j;if(k[2]>=0&&k[3]>=0){j=b.geom.computeBounds(h);j=b.geom.intersectRect(j,{x:k[0],y:k[1],width:k[2],height:k[3]});if(j){h=b.geom.getBoxCtrlPts(j.x,j.y,j.width,j.height)}else{h=[]}}return h},getLayoutBounds:function(i){this.layout();var h=this._txf;if(i&&i.getGlobalTransformMatrixInv){h=i.getGlobalTransformMatrixInv();h._concat(this._safeGetGlobalTxf())}return this._getBoundsImpl(h,b._BoundsType.LAYOUT)},getLocalBounds:function(){if(!this._localBoundsCache){this._localBoundsCache=b.geom.computeBounds(this._clipCtrlPts(this._getCtrlPts(b._BoundsType.RENDER)))}return this._localBoundsCache},_getBoundsImpl:function(h,i){return b.geom.computeBounds(this._transformCtrlPts(h,i))},getTransformToNode:function(k){var i=new b.geom.Matrix(),j,h;if(b.isA(k,b.graphics.AbstractGraphicNode)){j=this.getGlobalTransformMatrix();h=k.getGlobalTransformMatrixInv();i.concat(h);i.concat(j)}return i},_getCtrlPts:function(j){var h,i=this._ctrlPts;if(j!==b._BoundsType.LAYOUT||this._style.display){j=this._fixBoundsType(j);if(!i[j]){i[j]=this._computeCtrlPts(j)}h=i[j]}else{h=[]}return h},_fixBoundsType:function(h){return h},_clearCtrlPts:function(){this._ctrlPts.length=0;this._localBoundsCache=undefined;var h=this.parentNode;if(h&&h._ctrlPts.length>0){h._clearCtrlPts()}},localToGlobal:function(h,i){return this._safeGetGlobalTxf().transform(h,i)},globalToLocal:function(h,i){return this._safeGetGlobalTxfInv().transform(h,i)},hitTest:function(i,k){var h=null,j=this._style;if(j.display&&j.visibility&&j.pointerSensitivity){h=this._hitTest(i,k)}return h},_hitTest:function(h,j){var i=this.globalToLocal(h,j);return this._isWithinBounds(i.x,i.y)?this:null},_isWithinBounds:function(i,h,k){var j=this.getLocalBounds();if(typeof k!=="number"){k=0}return j!==undefined&&i>=j.x-k&&i<=j.x+j.width+k&&h>=j.y-k&&h<=j.y+j.height+k},_updateFilterFX:function(){if(!this._filterFXListener){this._filterFXListener=this._getFilterFXListener()}var h=this._style.filter,i=this._filterFX;if(i){i.removeEventListener(this._filterFXListener)}if(h){h.addEventListener(b.filters.FILTER_EVENT,this._filterFXListener)}this._filterFX=h},_getFilterFXListener:function(){var h=this;return function(){h.notifyNative(g.FILTER)}},_onCursorChanged:function(){var i=this,j=this._style.cursor,h;if(typeof j==="object"){this._customCursor=b.load(j.definition)}else{this._customCursor=null}if(this._customCursor){this._customCursor.setPointerSensitivity(false);if(!this._showCustomCursor){h=function(k){i._customCursor._setTranslation(k.clientX-j.hotspotX,k.clientY-j.hotspotY)};this._showCustomCursor=function(k){b.tree.userLayer.appendChild(i._customCursor);h(k);i.onMouseMove(h)};this._hideCustomCursor=function(){i.offMouseMove(h);b.tree.userLayer.removeChild(i._customCursor)}}this.onMouseOver(this._showCustomCursor);this.onMouseOut(this._hideCustomCursor)}else{this.offMouseOver(this._showCustomCursor);this.offMouseOut(this._hideCustomCursor)}},getPreferredLayoutBox:function(j){var i,l=this._style.display,h=this._style.layout,k;j=j||{};if(l){k=h.padding;if(h.preferredWidth>=0){j.width=h.preferredWidth}if(h.preferredHeight>=0){j.height=h.preferredHeight}if(j.width===undefined||j.height===undefined){i=this._getContentPreferredLayoutBox();if(j.width===undefined){j.width=i.width+k.lineBegin+k.lineEnd}if(j.height===undefined){j.height=i.height+k.top+k.bottom}}}else{j.width=0;j.height=0}return j},_getContentPreferredLayoutBox:function(){this.layout();var i={width:0,height:0},h=this._getBoundsImpl(this._txf,b._BoundsType.LAYOUT);if(h){i.width=h.width;i.height=h.height}return i},setLayoutBox:function(i,m,l,h){var k=this._style.layout.padding.lineBegin,j=this._style.layout.padding.top;if(b.layoutDir===b.RTL){k=this._style.layout.padding.lineEnd}this._layoutBox={x:i+k,y:m+j,width:l-this._style.layout.padding.lineBegin-this._style.layout.padding.lineEnd,height:h-j-this._style.layout.padding.bottom};if(this._layoutBox.width<0){this._layoutBox.width=0}if(this._layoutBox.height<0){this._layoutBox.height=0}if(!this._layoutDirty){if(!this._prevLayoutBox){this._layoutDirty=true}else{if(this._prevLayoutBox.width!==this._layoutBox.width||this._prevLayoutBox.height!==this._layoutBox.height){this._layoutDirty=true}else{if(this._prevLayoutBox.x!==this._layoutBox.x||this._prevLayoutBox.y!==this._layoutBox.y){this._layoutPosDirty=true}}}}this._prevLayoutBox=this._layoutBox;this.layout()},layout:function(){if(!this._layingOut){if(this._layoutDirty){this._layingOut=true;if(this._style.display){this._safeLayout()}this._layoutDirty=false;this._layoutPosDirty=false;this._layingOut=false}else{if(this._layoutPosDirty){this._layingOut=true;if(this._style.display){this._positionInLayoutBox()}this._layoutPosDirty=false;this._layingOut=false}}}},_safeLayout:function(){},_positionInLayoutBox:function(){var l=this._txf,j=this._layoutBox,k=this._style.layout,o,n,m,p,i,h;if(j){m=k.hAlign;i=l.tx;h=l.ty;p=this._getBoundsImpl(l,b._BoundsType.LAYOUT)||{x:i,y:h,width:0,height:0};if(k.xAnchor<0){o=k.hAlign}else{o=k.xAnchor}if(b.layoutDir===b.RTL){o=1-o;m=1-m}o*=p.width;if(k.yAnchor<0){n=k.vAlign}else{n=k.yAnchor}n*=p.height;this._setTranslation(i-o-p.x+j.x+m*j.width,h-n-p.y+j.y+k.vAlign*j.height)}},invalidateLayout:function(){if(this._layingOut!==true&&this._layoutDirty!==true){this._layoutDirty=true;this._layoutPosDirty=true;this._layoutBox=undefined;this._prevLayoutBox=undefined;if(this._ctrlPts.length>0){this._clearCtrlPts()}if(this.parentNode&&this.preventParentInvalidateLayout!==true){this.parentNode.invalidateLayout()}}},_onLayoutDirChanged:function(){this.invalidateLayout()}},eventsDef:[b.MouseEvents,b.KeyEvents,b.DragEvents,b.TouchEvents,b.GenericGestureEvents,b.GestureEvents,b.UIEvents]});b.addStyleSupport(b.graphics.AbstractGraphicNode,{transform:e.Matrix(b.geom.Matrix.IDENTITY,g.TRANSFO_SET),clip:e.ArrayOfType({type:Number},4,4,[0,0,-1,-1],g.CLIP,true),cursor:e.Cursor(b.CursorType.AUTO,g.CURSOR),description:e.String("",g.DESC),display:e.Boolean(true,g.DISPLAY),draggable:e.Boolean(false),filter:e.FilterEffect(null,g.FILTER),focusable:e.Boolean(false,g.FOCUSABLE),focusOutlineOffset:e.Number(2),layout:{hAlign:e.NumberInRange([0,1],b.NodeAlign.CENTER,g.LAYOUT),vAlign:e.NumberInRange([0,1],b.NodeAlign.CENTER,g.LAYOUT),hWeight:e.FinitePositiveNumber(0,g.LAYOUT),vWeight:e.FinitePositiveNumber(0,g.LAYOUT),xAnchor:e.FiniteNumber(-1,g.LAYOUT),yAnchor:e.FiniteNumber(-1,g.LAYOUT),padding:e.Padding(0,0,0,0,g.LAYOUT),preferredWidth:e.FiniteNumber(-1,g.PREF_SIZE),preferredHeight:e.FiniteNumber(-1,g.PREF_SIZE),isLayoutChild:e.Boolean(true,g.LAYOUT)},pointerSensitivity:e.Boolean(true,g.SENSITIVITY),tooltip:e.ObjectOfConstraint([function(h){return b.isA(h,String)||b.isA(h,b.graphics.AbstractGraphicNode)}],null,true,false),visibility:e.Boolean(true,g.VISIBILITY),cacheAsBitmap:e.Boolean(false)})}());(function(){var e=b.TAGS;b.mixin(b.graphics.AbstractGraphicNode,{notifyNativeImpl:function(g,f){if(g===e.CURSOR){if(this===b.events.cvGetLastTarget()){b.events.cvSetCursor(this)}}else{if(g!==e.SENSITIVITY&&g!==e.DESC){if(g!==e.TRANSFO){this.cvClearBuffer(!f)}if(!f){b.tree.cvMarkAsDirty(this)}}}},_clearGlobalTxfImpl:function(f){this.cvClearBuffer(!f)},cvPaint:function(m,n){var g=this._style,o,k,l,q,f,i,h=this._filterFX,j,p=b.tree.cvPixelRatio,r=true;if(this.cvIsInView()){q=this._safeGetGlobalTxf();f=this._getBoundsImpl(q,b._BoundsType.RENDER);if(f){r=false;n=b.geom.intersectRect(f,n,true);if(n){m.save();k=this.cvUseBuffer();if(k){i={x:Math.floor(f.x*p),y:Math.floor(f.y*p)}}l=this.cvBuffer;if(!l){if(k){i.width=Math.ceil(f.width*p);i.height=Math.ceil(f.height*p);l=b.tree.cvCreateBuffer(i.width,i.height);o=l.getContext("2d");o.translate(-i.x,-i.y);o.scale(p,p);o.transform(q.a,q.b,q.c,q.d,q.tx,q.ty)}else{o=m;q=this._txf;o.transform(q.a,q.b,q.c,q.d,q.tx,q.ty)}j=g.clip;if(j[2]>=0&&j[3]>=0){o.beginPath();o.rect(j[0],j[1],j[2],j[3]);o.clip()}this.cvPaintSelf(o,n);if(h){l=h.cvApplyFX(l,i)}this.cvBuffer=l}if(l){q=this.parentNode._safeGetGlobalTxfInv();m.transform(q.a,q.b,q.c,q.d,q.tx,q.ty);m.scale(1/p,1/p);this.cvPaintBuffer(m,l,i.x,i.y)}m.restore();this.cvLastDrawBounds=f}}}if(r){this.cvLastDrawBounds=undefined}},cvIsInView:function(){return this._style.display&&this._style.visibility},cvUseBuffer:function(){return(this._filterFX!==null)||this._style.cacheAsBitmap},cvClearBuffer:function(f){if(this.cvBuffer){b.tree.cvDisposeBuffer(this.cvBuffer);this.cvBuffer=undefined;b.tree.cvMarkAsDirty(this)}if(f&&this.parentNode){this.parentNode.cvClearBuffer(f)}},cvPaintSelf:function(){},cvPaintBuffer:function(g,h,f,i){g.drawImage(h,f,i)}})}());(function(){var f=b.graphics.AbstractGraphicNode.prototype,e=b.defs,g=b.TAGS;b.declare({name:"oui.graphics.AbstractShape",isAbstract:true,extend:b.graphics.AbstractGraphicNode,membersDef:{onStyleChanged:function(h){if(h===g.PAINT){this.notifyNative(h)}else{if(h===g.GEOM){this._clearCtrlPts();this.invalidateLayout();this.notifyNative(h)}else{f.onStyleChanged.call(this,h)}}},_fixBoundsType:function(i){var h=this._style;if(i===b._BoundsType.LAYOUT||(i===b._BoundsType.RENDER&&(h.stroke===b.NO_PAINT||h.strokeThickness===0))){i=b._BoundsType.DEFAULT}return i},getFillBounds:function(){return b.geom.computeBounds(this._clipCtrlPts(this._getCtrlPts(b._BoundsType.DEFAULT)))},_isValidChild:function(){return false},_safeLayout:function(){this._positionInLayoutBox()},_hitTest:function(i,m){var h=null,j=this._style,l=true,k;if(j.fill!==b.NO_PAINT){k=this.globalToLocal(i,m);if(this.hitTestOnFill(k.x,k.y)){h=this}else{l=false}}if(!h&&j.stroke!==b.NO_PAINT&&j.strokeThickness>0){k=k||this.globalToLocal(i,m);if(this.hitTestOnStroke(k.x,k.y,l)){h=this}}return h},hitTestOnFill:function(i,h){return false},hitTestOnStroke:function(j,i,h){return false}},styleDef:{htmlExportClassName:e.String(""),fill:e.Paint(b.black,g.PAINT),fillOpacity:e.NumberInRange([0,1],1,g.PAINT),fixedStrokeWidth:e.Boolean(false,g.PAINT),snapToGrid:e.Boolean(true,g.PAINT),stroke:e.Paint(b.NO_PAINT,g.PAINT),strokeOpacity:e.NumberInRange([0,1],1,g.PAINT),strokeThickness:e.FinitePositiveNumber(1,g.PAINT),strokeLineJoin:e.Enum(b.LineJoin,b.LineJoin.MITER,g.PAINT),strokeLineCap:e.Enum(b.LineCap,b.LineCap.BUTT,g.PAINT),strokeMiterLimit:e.FinitePositiveNumber(3,g.PAINT),strokeDashArray:e.ArrayOfType(e.StrictlyPositiveNumber(1),undefined,undefined,[],g.PAINT)}})}());(function(){var e=b.graphics.AbstractGraphicNode.prototype;b.mixin(b.graphics.AbstractShape,{notifyNativeImpl:function(h,f){var g=this._style;if(h===b.TAGS.PAINT){this.cvCheckPatternPaint(g.fill,"_cvPatternFill");this.cvCheckPatternPaint(g.stroke,"_cvPatternStroke")}e.notifyNativeImpl.call(this,h,f)},cvIsInView:function(){var f=this._style;return e.cvIsInView.call(this)&&((f.fill!==b.NO_PAINT&&f.fillOpacity>0)||(f.stroke!==b.NO_PAINT&&f.strokeOpacity>0&&f.strokeThickness>0))},cvSetFill:function(g){var f=this._style;g.globalAlpha=f.fillOpacity;g.fillStyle=f.fill.cvToStyle(this.getFillBounds(),g)},cvSetStroke:function(g){var f=this._style;g.globalAlpha=f.strokeOpacity;g.strokeStyle=f.stroke.cvToStyle(this.getLocalBounds(),g);g.lineWidth=f.strokeThickness;g.lineCap=f.strokeLineCap;g.lineJoin=f.strokeLineJoin;g.miterLimit=f.strokeMiterLimit;if(g.setLineDash){g.setLineDash(f.strokeDashArray)}},cvGetPatternReadyCallback:function(){var f=this;if(!this.cvPatternReadyCallback){this.cvPatternReadyCallback=function(){b.tree.cvMarkAsDirty(f)}}return this.cvPatternReadyCallback},cvCheckPatternPaint:function(h,g){var f=this[g];if(f&&f!==h){f.offPatternReady(this.cvGetPatternReadyCallback());this[g]=undefined}if(h.onPatternReady&&h!==f){h.onPatternReady(this.cvGetPatternReadyCallback());this[g]=h}}})}());(function(){var h="move",k="close",o="line",l="curve",j="quad",q=b.geom.DEG_TO_RAD,m=Math.PI/2,s={M:"moveTo",L:"lineTo",H:"horizontalLineTo",V:"verticalLineTo",Q:"quadTo",T:"smoothQuadTo",C:"curveTo",S:"smoothCurveTo",Z:"closePath",A:"arc",aM:"arcMoveTo",aL:"arcLineTo"},n,i={},f,g;b.graphics.PathType={MOVE_TO:h,CLOSE:k,LINE_TO:o,CURVE_TO:l,QUAD_TO:j};b.declare({name:"oui.graphics.PathCommands",mixins:[b.events.EventSupport],eventsDef:{DATA_UPDATE:"dataUpdate"},membersDef:{init:function(t,p){this._preventEvents=false;this.set(t,p)},_dispatchDataUpdate:function(){if(!this._preventEvents){this.dispatchEvent({type:this.events.DATA_UPDATE})}},set:function(t,p){this._preventEvents=true;this.resetPath();this._preventEvents=false;if(b.isA(t,String)){this._parseString(t,p)}this._dispatchDataUpdate()},resetPath:function(){this.dataTypes=[];this.dataValues=[];this.x=0;this.y=0;this.lastMX=0;this.lastMY=0;this.lastQX=0;this.lastQY=0;this.lastCX=0;this.lastCY=0;this._hasCubics=false;this._hasQuads=false;this._dispatchDataUpdate()},toString:function(A,D,v){var u=this.dataTypes,t=this.dataValues,C,w=u.length,E=[],B=0,I=(A===true)?" ":"",H,G="Z",x="M",y="L",p="Q",F="C";if(typeof D==="function"){H=D}else{if(typeof D==="number"){H=function(z){return z.toFixed(D)}}else{H=function(z){return z}}}if(v){G=v.CLOSE;x=v.MOVE_TO;y=v.LINE_TO;p=v.QUAD_TO;F=v.CURVE_TO}for(C=0;C<w;C++){switch(u[C]){case k:B+=2;E.push(G,I);break;case h:E.push(x,I,H(t[B++]),",",H(t[B++]),I);break;case o:E.push(y,I,H(t[B++]),",",H(t[B++]),I);break;case j:E.push(p,I,H(t[B++]),",",H(t[B++])," ",H(t[B++]),",",H(t[B++]),I);break;case l:E.push(F,I,H(t[B++]),",",H(t[B++])," ",H(t[B++]),",",H(t[B++])," ",H(t[B++]),",",H(t[B++]),I);break;default:break}}return b.trim(E.join(""))},isPointInPath:function(t,v,u){var p=this._countXings(t,v);if(u===b.WindingRuleEnum.NON_ZERO){p=(p!==0)}else{p=(p%2)!==0}return p},_isPointOnStrokedPath:function(I,G,F){var E=false,H=this.flatten(),A=H.dataTypes,u=H.dataValues,D,B=A.length,C=0,K=F*F,z=b.geom.ptSegDistSq,J,w,t,v,p;for(D=0;D<B&&!E;D++){J=A[D];if(J===h){v=u[C++];p=u[C++];E=(I===v&&G===p)}else{w=u[C++];t=u[C++];E=z(v,p,w,t,I,G)<K;v=w;p=t}}return E},_getStrokeCtrlPts:function(R){var ae=[],F=this.flatten(),z=F.dataTypes,y=F.dataValues,Z,Y=z.length,I,E=0,ah,ag,B,A,ac,ab,aa,v,p,V,U,af,X,ad,W,O,K,N,J,w,aj,t,ai,T,Q,S,P,M,H,L,G,D,x,C,u;for(Z=0;Z<Y;Z++){I=z[Z];if(I===h){w=aj=t=ai=T=Q=S=P=M=H=L=G=D=x=C=u=undefined;B=ac=y[E++];A=ab=y[E++];ae.push(B,A)}else{if(I===k){ah=ac;ag=ab}else{ah=y[E++];ag=y[E++]}v=ah-B;p=ag-A;V=R;if(v!==0||p!==0){U=v!==0?p/v:Number.POSITIVE_INFINITY;U=U>0?1:-1;V=V/Math.sqrt(v*v+p*p);v=U*v*V;p=U*p*V;af=B-p;X=A+v;ad=ah-p;W=ag+v;O=ah+p;K=ag-v;N=B+p;J=A-v;ae.push(af,X,ad,W,O,K,N,J);if(w!==undefined){ae.push.apply(ae,b.geom.intersectLine(af,X,ad,W,w,aj,t,ai));ae.push.apply(ae,b.geom.intersectLine(af,X,ad,W,T,Q,S,P));ae.push.apply(ae,b.geom.intersectLine(O,K,N,J,w,aj,t,ai));ae.push.apply(ae,b.geom.intersectLine(O,K,N,J,T,Q,S,P))}w=af;aj=X;t=ad;ai=W;T=O;Q=K;S=N;P=J}if(I===k&&M!==undefined){ae.push.apply(ae,b.geom.intersectLine(w,aj,t,ai,M,H,L,G));ae.push.apply(ae,b.geom.intersectLine(w,aj,t,ai,D,x,C,u));ae.push.apply(ae,b.geom.intersectLine(T,Q,S,P,M,H,L,G));ae.push.apply(ae,b.geom.intersectLine(T,Q,S,P,D,x,C,u))}B=ah;A=ag;if(aa===h){M=af;H=X;L=ad;G=W;D=O;x=K;C=N;u=J}}aa=I}return ae},flatten:function(x,t){var C,u,p,B,v,z,w,y,A;if(this._hasCubics||this._hasQuads){C=new b.graphics.PathCommands();if(typeof x!=="number"){x=5}u=this.dataTypes;p=this.dataValues;v=u.length;for(B=0,y=0,A=[];B<v;B++){switch(u[B]){case k:y+=2;C.closePath();break;case h:C._M(p[y++],p[y++]);break;case o:C._L(p[y++],p[y++]);break;case j:b.geom.flattenQuad(p[y-2],p[y-1],p[y++],p[y++],p[y++],p[y++],A,x,t);z=0;w=A.length;while(z<w){C._L(A[z++],A[z++])}A.length=0;break;case l:b.geom.flattenCubic(p[y-2],p[y-1],p[y++],p[y++],p[y++],p[y++],p[y++],p[y++],A,x,t);z=0;w=A.length;while(z<w){C._L(A[z++],A[z++])}A.length=0;break;default:break}}}else{C=this}return C},snap:function(D,v,E){var w=this.dataTypes,t=this.dataValues,I,H,u,p,G,F,C,J,B,A,z=w.length;if(typeof E!=="number"){E=0}if(v){C=v.inv()}for(B=0,A=0;B<z;B++){switch(w[B]){case h:case k:u=t[A++];p=t[A++];break;case o:I=G=t[A++];H=F=t[A++];if(v){J=v.transform(u,p);u=J.x;p=J.y;J=v.transform(I,H);I=J.x;H=J.y}if(Math.abs(I-u)<=E){if(D===true){u=Math.floor(u)+0.5}else{if(Math.floor(u)!==u){u=Math.round(u)}}if(C){t[A-4]=C.a*u+C.c*p+C.tx;t[A-2]=C.a*u+C.c*H+C.tx}else{t[A-4]=t[A-2]=u}}if(Math.abs(H-p)<=E){if(D===true){p=Math.floor(p)+0.5}else{if(Math.floor(p)!==p){p=Math.round(p)}}if(C){t[A-3]=C.b*u+C.d*p+C.ty;t[A-1]=C.b*I+C.d*p+C.ty}else{t[A-3]=t[A-1]=p}}u=G;p=F;break;case j:A+=2;u=t[A++];p=t[A++];break;case l:A+=4;u=t[A++];p=t[A++];break;default:break}}this._dispatchDataUpdate()},cubicify:function(){var v=this.dataTypes,t=this.dataValues,p,w=0,x=v.length,u;if(this._hasQuads){for(p=0;p<x;p++){switch(v[p]){case h:case k:case o:w+=2;break;case j:u=b.geom.quad2Cubic(t[w-2],t[w-1],t[w],t[w+1],t[w+2],t[w+3]);v[p]=l;t.splice(w,2,u[0],u[1],u[2],u[3]);w+=6;break;case l:w+=6;break}}this._hasQuads=false;this._dispatchDataUpdate()}},closePath:function(){this.dataTypes.push(k);this.dataValues.push(this.lastMX,this.lastMY);this.x=this.lastMX;this.y=this.lastMY;this._dispatchDataUpdate();return this},_safeMoveTo:function(p,u,t){if(t===true){p+=this.x;u+=this.y}this.dataTypes.push(h);this.dataValues.push(p,u);this.x=p;this.y=u;this.lastMX=p;this.lastMY=u;this.lastQX=p;this.lastQY=u;this.lastCX=p;this.lastCY=u;return this},_safeLineTo:function(p,u,t){if(t===true){p+=this.x;u+=this.y}this.dataTypes.push(o);this.dataValues.push(p,u);this.x=p;this.y=u;this.lastQX=p;this.lastQY=u;this.lastCX=p;this.lastCY=u;return this},_safeHorizontalLineTo:function(p,t){if(t===true){p+=this.x}return this._safeLineTo(p,this.y,false)},_safeVerticalLineTo:function(t,p){if(p===true){t+=this.y}return this._safeLineTo(this.x,t,false)},_safeQuadTo:function(t,v,p,u,w){if(w===true){t+=this.x;v+=this.y;p+=this.x;u+=this.y}this.dataTypes.push(j);this.dataValues.push(t,v,p,u);this.x=p;this.y=u;this.lastQX=t;this.lastQY=v;this.lastCX=p;this.lastCY=u;this._hasQuads=true;return this},_safeSmoothQuadTo:function(p,u,w){var t,v;if(w===true){p+=this.x;u+=this.y}t=2*this.x-this.lastQX;v=2*this.y-this.lastQY;return this._safeQuadTo(t,v,p,u,false)},_safeCurveTo:function(v,x,t,w,p,u,y){if(y===true){v+=this.x;x+=this.y;t+=this.x;w+=this.y;p+=this.x;u+=this.y}this.dataTypes.push(l);this.dataValues.push(v,x,t,w,p,u);this.x=p;this.y=u;this.lastQX=p;this.lastQY=u;this.lastCX=t;this.lastCY=w;this._hasCubics=true;return this},_safeSmoothCurveTo:function(t,w,p,v,y){var u,x;if(y===true){t+=this.x;w+=this.y;p+=this.x;v+=this.y}u=2*this.x-this.lastCX;x=2*this.y-this.lastCY;return this._safeCurveTo(u,x,t,w,p,v,false)},_safeArc:function(t,y,u,p,x,w,v){if(v===true){t+=this.x;y+=this.y}u=u*q;p=p*q;this._arcImpl(t,y,u,p,x,w);return this},_arcImpl:function(x,w,v,t,u,p){var A,z=0.523598775598,y=0.506145483078356;if(t>v){while(t-v>z){A=v+y;this._smallArcACW(x,w,v,A,u,p);v=A}this._smallArcACW(x,w,v,t,u,p)}else{if(v>t){while(v-t>z){A=v-y;this._smallArcCW(x,w,v,A,u,p);v=A}this._smallArcCW(x,w,v,t,u,p)}}},_smallArcACW:function(z,y,x,u,w,t){var B=w*Math.cos(u),A=t*Math.sin(u),C=Math.tan((u-x)/2),D=u-m,v=B+w*C*Math.cos(D),p=A+t*C*Math.sin(D);this._safeQuadTo(v+z,p+y,B+z,A+y)},_smallArcCW:function(B,A,z,w,y,v){var D=y*Math.cos(w),C=v*Math.sin(w),u=y*Math.cos(z),p=v*Math.sin(z),E=Math.tan((z-w)/2),F=(z-m),x=u+y*E*Math.cos(F),t=p+v*E*Math.sin(F);this._safeQuadTo(x+B,t+A,D+B,C+A)},_safeArcMoveTo:function(p,y,x,w,v,u){var t=x*q;return this._safeMoveTo(p+w*Math.cos(t),y+v*Math.sin(t),u)},_safeArcLineTo:function(p,y,x,w,v,u){var t=x*q;return this._safeLineTo(p+w*Math.cos(t),y+v*Math.sin(t),u)},_countXings:function(G,F){var E=b.geom,v=this.dataTypes,t=this.dataValues,w=v.length,A,B=0,u=0,p=0,I=0,H=0,z=0,D=false,C;for(C=0;C<w;C++){A=v[C];switch(A){case h:if(C>0&&v[C-1]!==k){z+=E.crossLine(u,p,I,H,G,F)}I=u=t[B++];H=p=t[B++];break;case k:case o:z+=E.crossLine(u,p,t[B++],t[B++],G,F);u=t[B-2];p=t[B-1];break;case j:z+=E.crossQuad(u,p,t[B++],t[B++],t[B++],t[B++],G,F);u=t[B-2];p=t[B-1];break;case l:z+=E.crossCubic(u,p,t[B++],t[B++],t[B++],t[B++],t[B++],t[B++],G,F);u=t[B-2];p=t[B-1];break}if(u===G&&p===F){z=0;D=true;break}}if(!D&&A!==k){z+=E.crossLine(u,p,I,H,G,F)}return z},_parseString:function(u,v){var t=0,y,x,z,w,p=Number;y=u.replace(/^\s+|\s+$/g,"").replace(/([mlhvcsqtz])/gi,",$1,").replace(/\s+/g,",").replace(/,{2,}/g,",").replace(/^,|,$/g,"").split(",");x=y.length;if(v===true){p=function(B){var A=Number(B);if(isNaN(A)){c.error("ERR__PATH__MALFORMED_DATA",y.slice(0,t).join(" "))}return A}}while(t<x){z=y[t++];w=false;switch(z){case"m":w=true;case"M":this._safeMoveTo(p(y[t++]),p(y[t++]),w);while(!isNaN(Number(y[t]))&&t<x){this._safeLineTo(p(y[t++]),p(y[t++]),w)}break;case"l":w=true;case"L":do{this._safeLineTo(p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"h":w=true;case"H":do{this._safeHorizontalLineTo(p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"v":w=true;case"V":do{this._safeVerticalLineTo(p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"q":w=true;case"Q":do{this._safeQuadTo(p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"t":w=true;case"T":do{this._safeSmoothQuadTo(p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"c":w=true;case"C":do{this._safeCurveTo(p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"s":w=true;case"S":do{this._safeSmoothCurveTo(p(y[t++]),p(y[t++]),p(y[t++]),p(y[t++]),w)}while(!isNaN(Number(y[t]))&&t<x);break;case"a":w=true;case"A":if(v===true){c.error("ERR__PATH__NO_ARCTO")}break;case"z":case"Z":this.closePath();break;default:if(v===true){c.error("ERR__PATH__UNKNOWN_CMD",[z,t])}}}}}});function e(t){var p=t.length-1;return function(){var v=p-1,u=true;do{u=b.isFiniteNumber(arguments[v])}while(v--&&u);if(u){t.apply(this,arguments);this._dispatchDataUpdate()}return this}}n=b.graphics.PathCommands.prototype;for(g in n){if(n.hasOwnProperty(g)&&g.indexOf("_safe")===0){i[g.charAt(5).toLowerCase()+g.substr(6)]=e(n[g])}}b.mixin(b.graphics.PathCommands,i);function r(t,p){return function(){var u=[];u.push.apply(u,arguments);u[t.length-1]=p;return t.apply(this,u)}}for(g in s){if(s.hasOwnProperty(g)){i=s[g];f=n[i];n[g]=r(f,false);n[g.toLowerCase()]=r(f,true);g="_"+g;i="_safe"+i.charAt(0).toUpperCase()+i.substr(1);f=n[i]||f;n[g]=r(f,false);n[g.toLowerCase()]=r(f,true)}}}());(function(){var e=b.graphics.AbstractShape.prototype;b.declare({name:"oui.graphics.AbstractPath",isAbstract:true,extend:b.graphics.AbstractShape,membersDef:{init:function(f,g){this._flattenedPathCache=null;e.init.call(this,f,g)},onStyleChanged:function(f){if(f===b.TAGS.GEOM){this._flattenedPathCache=null}e.onStyleChanged.call(this,f)},_computeCtrlPts:function(h){var g=this.getFlattenedPathCommands(),f=[];if(g){f=b.geom.computeConvexHull(h?g._getStrokeCtrlPts(this._style.strokeThickness/2):g.dataValues)}return f},hitTestOnFill:function(h,g){var f=false,i=this.getFlattenedPathCommands();if(i&&this._isWithinBounds(h,g)){f=i.isPointInPath(h,g,this.getWindingRule())}return f},hitTestOnStroke:function(i,h,g){var f=false,k=this._style.strokeThickness/2,j=this.getFlattenedPathCommands();if(j&&this._isWithinBounds(i,h,k)){f=j._isPointOnStrokedPath(i,h,k)}return f},getPathCommands:function(){c.warn("WARN__PATH__NO_OVERRIDE");return null},getFlattenedPathCommands:function(){var f;if(!this._flattenedPathCache){f=this.getPathCommands();if(f){this._flattenedPathCache=f.flatten(10)}}return this._flattenedPathCache},getWindingRule:function(){return b.WindingRuleEnum.EVEN_ODD}}})}());(function(){var i=b.graphics.PathType,f=i.MOVE_TO,e=i.LINE_TO,g=i.QUAD_TO,h=i.CURVE_TO,j=i.CLOSE;b.mixin(b.graphics.AbstractPath,{cvPaintSelf:function(t,r){var s=this.getPathCommands(),p=0,m,l,q,o,k;if(s){m=s.dataTypes;l=s.dataValues;o=m.length;t.beginPath();for(q=0;q<o;q++){switch(m[q]){case f:t.moveTo(l[p++],l[p++]);break;case e:t.lineTo(l[p++],l[p++]);break;case g:t.quadraticCurveTo(l[p++],l[p++],l[p++],l[p++]);break;case h:t.bezierCurveTo(l[p++],l[p++],l[p++],l[p++],l[p++],l[p++]);break;case j:p+=2;t.closePath();break;default:c.error("ERR__CNV__INV_PATHDATA");break}}k=this._style;if(k.fill!==b.NO_PAINT){this.cvSetFill(t);t.fill()}if(k.stroke!==b.NO_PAINT){this.cvSetStroke(t);t.stroke()}}}})}());(function(){var h=b.graphics.AbstractPath.prototype,e=b.defs,i=b.TAGS,g={markerStart:0,markerEnd:1,markerMid:2},f="pathData";b.declare({name:"oui.graphics.Path",extend:b.graphics.AbstractPath,jsonDef:{type:"path"},membersDef:{init:function(j,k){var l=this;this._markers=[];this._initImpl();this._oldPC=null;this._dataUpdateHandler=function(){l._updateMarkerTxf("markerStart",g.markerStart);l._updateMarkerTxf("markerEnd",g.markerEnd);l.onStyleChanged(b.TAGS.GEOM)};h.init.call(this,j,k)},_initImpl:function(){},_computeCtrlPts:function(m){var k=h._computeCtrlPts.call(this,m),o=this._markers,j,l,p=0;if(k.length>0){for(l=0,p=o.length;l<p;l++){j=o[l];if(j){k.push.apply(k,j._transformCtrlPts(j._txf,m))}}}return p>0?b.geom.computeConvexHull(k):k},onStyleChanged:function(k){var p=this._style,m=p.pathCommands,l,q=this._markers,o,r,j;if(k===f){l=this._oldPC;if(l){l.offDataUpdate(this._dataUpdateHandler)}if(m){m.onDataUpdate(this._dataUpdateHandler)}this._oldPC=m;this._updateMarker("markerStart",g.markerStart);this._updateMarker("markerEnd",g.markerEnd);h.onStyleChanged.call(this,i.GEOM)}else{if(k===i.PAINT){for(o=0,r=q.length;o<r;o++){if(q[o]){q[o].applyStyle({fill:p.stroke,fillOpacity:p.strokeOpacity})}}h.onStyleChanged.call(this,k)}else{if(k===i.MARKER_START_DATA||k===i.MARKER_END_DATA){j=k.substring(0,k.length-4);this._updateMarker(j,g[j]);this.notifyNative(k)}else{if(k===i.MARKER_START||k===i.MARKER_END){this._updateMarkerTxf(k,g[k]);this.notifyNative(k)}else{if(k===i.MARKER_START_PAINT||k===i.MARKER_END_PAINT){j=k.substring(0,k.length-5);this._updateMarkerPaint(j,g[j]);this.notifyNative(k)}else{h.onStyleChanged.call(this,k)}}}}}},_updateMarker:function(k,j){var n=this._style,m=n[k],l=this._markers[j];if(m.d.length===0){this._markers[j]=undefined}else{if(!l){this._markers[j]=new b.graphics.Path({pathCommands:m.d})}else{l.applyStyle({pathCommands:m.d})}this._updateMarkerPaint(k,j);this._updateMarkerTxf(k,j)}},_updateMarkerTxf:function(o,w){var k=this._style[o],m=this._markers[w],t=this._style.pathCommands,j,l,v,r,q=0,p=0,z=k.strokeUnits?this._style.strokeThickness:1,u=k.orient;if(m&&t&&t.dataValues.length>=2){j=t.dataValues;l=j.length;if(w===g.markerStart){v=j[0];r=j[1];if(l>=4){q=j[2]-v;p=j[3]-r}}else{if(w===g.markerEnd){v=j[l-2];r=j[l-1];if(l>=4){q=v-j[l-4];p=r-j[l-3]}}}if(u===b.AUTO){u=Math.atan2(p,q)}else{u*=b.geom.DEG_TO_RAD}m.setTransform(new b.geom.Matrix().translate(v,r).rotate(u).scale(z*k.width,z*k.height).translate(-k.refX,-k.refY))}this._clearCtrlPts()},_updateMarkerPaint:function(k,j){var m=this._style,n={fill:m.stroke,fillOpacity:m.strokeOpacity,stroke:b.NO_PAINT},l=this._markers[j];if(l){b.merge(n,m[k].paint,true);l.applyStyle(n)}}},styleDef:{pathCommands:e.PathData(null,f),windingRule:e.Enum(b.WindingRuleEnum,b.WindingRuleEnum.EVEN_ODD,i.GEOM),markerStart:e.Marker("",0,0,1,1,b.AUTO,true,{},i.MARKER_START,i.MARKER_START_DATA,i.MARKER_START_PAINT),markerEnd:e.Marker("",0,0,1,1,b.AUTO,true,{},i.MARKER_END,i.MARKER_END_DATA,i.MARKER_END_PAINT)}})}());(function(){var e=b.graphics.AbstractPath.prototype;b.mixin(b.graphics.Path,{cvPaintSelf:function(o,k){var g=this._style.pathCommands,l=this._markers,f,j,h,m;e.cvPaintSelf.call(this,o,k);if(g&&g.dataTypes.length>0){for(h=0,m=l.length;h<m;h++){f=l[h];if(f){o.save();j=f._txf;o.transform(j.a,j.b,j.c,j.d,j.tx,j.ty);f.cvPaintSelf(o,k);o.restore()}}}}})}());(function(){var g=b.graphics.AbstractPath.prototype,e=b.defs,h=b.TAGS.GEOM,f;f=function(j,i){if(j>i){j=i}return j};b.declare({name:"oui.graphics.HalfRoundedRectangle",extend:b.graphics.AbstractPath,jsonDef:{type:"hrrect"},membersDef:{init:function(i,j){this._d=new b.graphics.PathCommands();g.init.call(this,i,j)},onStyleChanged:function(i){if(i===h){this._updatePath()}g.onStyleChanged.call(this,i)},getPathCommands:function(){return this._d},_onLayoutDirChanged:function(){this._updatePath();g._onLayoutDirChanged.call(this)},_updatePath:function(){var p=this._style,s=p.x,q=p.y,t=p.width,B=p.height,o=p.rx,m=p.ry,z=p.rounded,D=this._d,C=(b.layoutDir===b.LTR),n=!C,l=(C&&z.topLineBegin)||(n&&z.topLineEnd),i=(C&&z.topLineEnd)||(n&&z.topLineBegin),j=(C&&z.bottomLineBegin)||(n&&z.bottomLineEnd),E=(C&&z.bottomLineEnd)||(n&&z.bottomLineBegin),k=f(o,(l&&i)?t/2:t),A=f(m,(l&&j)?B/2:B),v=f(o,(j&&E)?t/2:t),u=f(m,(i&&E)?B/2:B);D.resetPath();if(l){D._M(s,q+A)._Q(s,q,s+k,q)}else{D._M(s,q)}if(i){D._L(s+t-k,q)._Q(s+t,q,s+t,q+u)}else{D._L(s+t,q)}if(E){D._L(s+t,q+B-u)._Q(s+t,q+B,s+t-v,q+B)}else{D._L(s+t,q+B)}if(j){D._L(s+v,q+B)._Q(s,q+B,s,q+B-A)}else{D._L(s,q+B)}D._Z()},hitTestOnFill:function(i,M){var I=this._style,z=i,v=M,B=I.width,H=I.height,t=I.rx,q=I.ry,p=I.x,E=I.y,u=E+H,K=p+B,A=false,F,J,s,o,k,j,L,m,G,D,C,n,l;if(z>=p&&z<=K&&v>=E&&v<=u){F=I.rounded;J=(b.layoutDir===b.LTR);s=!J;o=(J&&F.topLineBegin)||(s&&F.topLineEnd);k=(J&&F.topLineEnd)||(s&&F.topLineBegin);j=(J&&F.bottomLineBegin)||(s&&F.bottomLineEnd);L=(J&&F.bottomLineEnd)||(s&&F.bottomLineBegin);m=f(t,(o&&k)?B/2:B);G=f(q,(o&&j)?H/2:H);D=f(t,(j&&L)?B/2:B);C=f(q,(k&&L)?H/2:H);if(o&&(z<p+m)&&(v<E+G)){n=p+m;l=E+G;t=m;q=G}else{if(k&&(z>K-m)&&(v<E+C)){n=K-m;l=E+C;t=m;q=C}else{if(L&&(z>K-D)&&(v>u-C)){n=K-D;l=u-C;t=D;q=C}else{if(j&&(z<p+D)&&(v>u-G)){n=p+D;l=u-G;t=D;q=G}}}}if(n!==undefined&&l!==undefined){z=(i-n)/t;v=(M-l)/q;A=((z*z+v*v)<=1)}else{A=true}}return A}},styleDef:{x:e.FiniteNumber(0,h),y:e.FiniteNumber(0,h),width:e.PositiveNumber(0,h),height:e.PositiveNumber(0,h),rx:e.PositiveNumber(10,h),ry:e.PositiveNumber(10,h),rounded:{topLineBegin:e.Boolean(true,h),topLineEnd:e.Boolean(true,h),bottomLineBegin:e.Boolean(false,h),bottomLineEnd:e.Boolean(false,h)}}})}());(function(){var h=b.graphics.AbstractPath.prototype,e=b.defs,i=b.TAGS.GEOM,f=b.geom.DEG_TO_RAD;function g(j){if(j<0){j=360+j}return j}b.declare({name:"oui.graphics.DiskSector",extend:b.graphics.AbstractPath,jsonDef:{type:"diskSector"},membersDef:{init:function(j,k){this._d=new b.graphics.PathCommands();h.init.call(this,j,k)},onStyleChanged:function(j){if(j===i){this._updatePath()}h.onStyleChanged.call(this,j)},getPathCommands:function(){return this._d},_updatePath:function(){var k=this._style,o=this._d,j=k.cx,q=k.cy,n=k.minAngle,p=k.maxAngle,m=k.minRadius,l=k.maxRadius;o.resetPath();o._aM(j,q,n,l,l);o._A(j,q,n,p,l,l);if((p-n)<360){o._aL(j,q,p,m,m);if(m>0){o._A(j,q,p,n,m,m)}}else{if(m>0){o._Z();o._aM(j,q,p,m,m);o._A(j,q,p,n,m,m)}}o._Z()},hitTestOnFill:function(o,n){var k=this._style,s=false,r=o-k.cx,q=n-k.cy,p=Math.sqrt(r*r+q*q),l,j,m;if(p>=k.minRadius&&p<=k.maxRadius){l=k.minAngle;j=k.maxAngle;if(Math.abs(j-l)===360){s=true}else{m=Math.atan2(q,r)*180/Math.PI;m=(m+360)%360;if(l>j){l=j;j=k.minAngle}if(l<0&&j>=0){l=(l+360)%360;s=(m<=360&&m>=l)||m<=j}else{if(l<0&&j<0){l=(l+360)%360;j=(j+360)%360;s=m>=l&&m<=j}else{l=(l+360)%360;j=(j+360)%360;s=m>=l&&m<=j}}}}return s},getInsideGeomPath:function(M){var N=this._style,V=new b.graphics.PathCommands(),H=M/2,I=N.minAngle,O=N.maxAngle,n=N.minRadius,C=N.maxRadius,q,Z,l,w,u,v,B,T,k,K,Q,P,A,r,J,D,j,m,z,E,W,U,S,R,p,o,Y,X,G,F,L,y,x;if(n>C){n=C;C=N.minRadius}if(I>O){I=N.maxAngle;O=N.minAngle}q=f*(O-I);Z=Math.cos(q/2);l=Math.sin(q);w=N.cx;u=N.cy;v=Math.sin(f*I);B=Math.cos(f*I);T=Math.sin(f*O);k=Math.cos(f*O);K=0;if(l!==0){K=M*Z/l}Q=f*(I+(O-I)/2);P=w+K*Math.cos(Q);A=u+K*Math.sin(Q);r=n-K*Z+H;J=r+C-n-M;D=(J+r)/2;C-=H;n+=H;if(r<J){R={x:P+r*B,y:A+r*v};S={x:P+J*B,y:A+J*v};U={x:P+J*k,y:A+J*T};W={x:P+r*k,y:A+r*T};j=g(Math.atan2(R.y-u,R.x-w)/f);m=g(Math.atan2(W.y-u,W.x-w)/f);z=g(Math.atan2(S.y-u,S.x-w)/f);E=g(Math.atan2(U.y-u,U.x-w)/f);if(j>m){m+=360}if(z>E){E+=360}if((E-j)<q/f){if((m-j)>q/f){p=(U.x-W.x);o=(U.y-W.y);Y=(R.x-S.x);X=(R.y-S.y);G=(W.x-S.x);F=(W.y-S.y);L=(p*F-o*G)/(p*X-o*Y);y=S.x+L*Y;x=S.y+L*X;V._M(S.x,S.y)._L(y,x)._L(U.x,U.y);V._A(w,u,E,z,C,C);V._Z()}else{if(O-I<360){V._aM(P,A,O,D,D);V._aL(P,A,O,J,J);V._A(w,u,E,z,C,C);V._aL(P,A,I,r,r);if(n>H){V._A(w,u,j,m,n,n)}V._aL(P,A,O,D,D);V._Z()}else{V._aM(w,u,0,C,C);V._A(w,u,0,360,C,C);if(n>H){V._aM(w,u,360,n,n);V._A(w,u,360,0,n,n)}}}}}return V}},styleDef:{minAngle:e.FiniteNumber(0,i),maxAngle:e.FiniteNumber(360,i),minRadius:e.FinitePositiveNumber(0,i),maxRadius:e.FinitePositiveNumber(100,i),cx:e.Number(0,i),cy:e.Number(0,i)}})}());(function(){var e=b.graphics.AbstractGraphicNode.prototype;b.declare({name:"oui.graphics.Group",extend:b.graphics.AbstractGraphicNode,jsonDef:{type:"group",factory:function(h,j,g,i){var f=new b.graphics.Group(h,h.name);b.load(h.children,f,j,g,i);return f}},membersDef:{onStyleChanged:function(f){if(f===b.TAGS.OPACITY){this.notifyNative(f)}else{e.onStyleChanged.call(this,f)}},_computeCtrlPts:function(h){var f,i,g;if(h===b._BoundsType.LAYOUT){f=this._computeLayoutCtrlPts(h)}else{f=[];i=this.firstChild;while(i){g=i._transformCtrlPts(i._txf,h);f.push.apply(f,g);i=i.nextSibling}f=b.geom.computeConvexHull(f)}return f},_computeLayoutCtrlPts:function(h){var f=[],i=this.firstChild,g;while(i){if(i._style.layout.isLayoutChild){g=i._transformCtrlPts(i._txf,h);f.push.apply(f,g)}i=i.nextSibling}return b.geom.computeConvexHull(f)},_safeLayout:function(){var f=this.firstChild;while(f){f.layout();f=f.nextSibling}this._positionInLayoutBox()},_hitTest:function(g,j){var f=null,h=this.globalToLocal(g,j),i;if(this._isWithinBounds(h.x,h.y)){i=this.lastChild;while(i&&!f){f=i.hitTest(g,j);i=i.previousSibling}}return f}},styleDef:{opacity:b.defs.NumberInRange([0,1],1,b.TAGS.OPACITY)}})}());(function(){var e=b.graphics.AbstractGraphicNode.prototype;b.mixin(b.graphics.Group,{cvIsInView:function(){return e.cvIsInView.call(this)&&this.firstChild!==null},cvUseBuffer:function(){return e.cvUseBuffer.call(this)||this._style.opacity<1},cvPaintSelf:function(f,g){var h=this.firstChild;while(h){h.cvPaint(f,g);h=h.nextSibling}},cvPaintBuffer:function(g,h,f,i){if(this._style.opacity<1){g.globalAlpha=this._style.opacity}e.cvPaintBuffer.call(this,g,h,f,i)}})}());(function(){var f=b.graphics.AbstractGraphicNode.prototype,e=b.defs,g=b.TAGS;b.declare({name:"oui.graphics.Image",extend:b.graphics.AbstractGraphicNode,jsonDef:{type:"image"},membersDef:{init:function(h,i){this._srcWidth=0;this._srcHeight=0;this._actualWidth=0;this._actualHeight=0;f.init.call(this,h,i)},onStyleChanged:function(h){if(h===g.SRC){var i=this._style.src;if(this.prevRequest){b.resourcesManager.removeObserver(this.prevRequest,this);this.prevRequest=null}else{if(this.imageLoader){this.imageLoader.offComplete(this);this.imageLoader=null}}if(b.resourcesManager.hasResource(i)){b.resourcesManager.requestResource(i,this);this.prevRequest=i}else{this.imageLoader=new b.utils.ImageLoader();this.imageLoader.onComplete(this);this.imageLoader.load(i)}}else{if(h===g.GEOM){this._updateActualDimensions();this._clearCtrlPts();this.invalidateLayout();this.notifyNative(h)}else{if(h===g.OPACITY){this.notifyNative(h)}else{f.onStyleChanged.call(this,h)}}}},resourceUpdate:function(h){this._srcWidth=h.width;this._srcHeight=h.height;this._updateActualDimensions();this._resourceUpdateImpl(h)},handleEvent:function(h){this.resourceUpdate(h)},_resourceUpdateImpl:function(h){},_fixBoundsType:function(){return b._BoundsType.DEFAULT},_computeCtrlPts:function(){var h=this._style;return b.geom.getBoxCtrlPts(h.x,h.y,this._actualWidth,this._actualHeight)},_safeLayout:function(){this._positionInLayoutBox()},toDataURL:function(){var i,h=this._style.src;if(b.resourcesManager.hasResource(h)){i=b.resourcesManager._getBase64Data(h)}if(i===undefined){i=this._toDataURLImpl()}if(i===undefined){i=h}return i},_toDataURLImpl:function(){},_isValidChild:function(){return false},_updateActualDimensions:function(){var h=this._style,j=h.preserveAspectRatio,n=this._srcWidth,q=this._srcHeight,l=h.width,k=h.height,i=(l===b.AUTO)?n:l,p=(k===b.AUTO)?q:k,o,m;o=n>0?i/n:1;m=q>0?p/q:1;if(j===b.PreserveAspectRatioEnum.MIN){if(o<m){if(n>0){p=q*o}}else{if(q>0){i=n*m}}}else{if(j===b.PreserveAspectRatioEnum.MAX){if(o<m){if(q>0){i=n*m}}else{if(n>0){p=q*o}}}}if(this._actualWidth!==i||this._actualHeight!==p){this._actualWidth=i;this._actualHeight=p;this._clearCtrlPts();this.invalidateLayout()}}},styleDef:{src:{type:String,constraint:b.isStringNotEmpty,defaultValue:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAEklEQVR4nGNgGAWjYBSMAggAAAQQAAFVN1rQAAAAAElFTkSuQmCC",tag:g.SRC},x:e.FiniteNumber(0,g.GEOM),y:e.FiniteNumber(0,g.GEOM),width:e.Size(b.AUTO,g.GEOM),height:e.Size(b.AUTO,g.GEOM),opacity:e.NumberInRange([0,1],1,g.OPACITY),preserveAspectRatio:e.Enum(b.PreserveAspectRatioEnum,b.PreserveAspectRatioEnum.NONE,g.GEOM)}})}());(function(){b.mixin(b.graphics.Image,{_resourceUpdateImpl:function(e){this.cvImage=e.data;this.cvClearBuffer(true);b.tree.cvMarkAsDirty(this)},_toDataURLImpl:function(){var i,g,f;if(this.cvImage){g=b.tree.cvCreateBuffer(this._srcWidth,this._srcHeight);f=g.getContext("2d");f.drawImage(this.cvImage,0,0);try{i=g.toDataURL()}catch(h){c.warn(h);i=undefined}b.tree.cvDisposeBuffer(g)}return i},cvPaintSelf:function(e,f){var g;if(this.cvImage){g=this._style;if(g.opacity<1){e.globalAlpha=g.opacity}e.drawImage(this.cvImage,g.x,g.y,this._actualWidth,this._actualHeight)}}})}());(function(){var e=b.defs,f=b.TAGS.GEOM;b.declare({name:"oui.graphics.Line",extend:b.graphics.AbstractShape,jsonDef:{type:"line"},membersDef:{_computeCtrlPts:function(k){var i=[],j=this._style,h=j.x1,g=j.x2,n=j.y1,l=j.y2,q=j.strokeThickness,s=j.strokeLineCap,r,p,o,m;if(k){o=q/2;if(s===b.LineCap.SQUARE){m=Math.atan2(l-n,g-h);r=o*Math.cos(m);p=o*Math.sin(m);h-=r;g+=r;n-=p;l+=p}r=g-h;p=l-n;if(s!==b.LineCap.ROUND){if(r!==0||p!==0){o=o/Math.sqrt(r*r+p*p);r=r*o;p=p*o;i.push(h-p,n+r,g-p,l+r,g+p,l-r,h+p,n-r)}else{if(s===b.LineCap.SQUARE){i.push(h-o,n-o,h+o,n-o,h+o,n+o,h-o,n+o)}else{if(s===b.LineCap.BUTT){i.push(h,n)}}}}else{i.push(h-o,n-o,h+o,n+o,h+o,n+o,h+o,n-o,g-o,l-o,g+o,l+o,g+o,l+o,g+o,l-o)}}else{i.push(h,n);if(h!==g||n!==l){i.push(g,l)}}return i},hitTestOnStroke:function(k,j,q){var r=k,n=j,h=this._style,t=h.strokeLineCap,l=h.strokeThickness/2,s=l*l,i=h.x1,p=h.y1,g=h.x2,m=h.y2,w=false,o,v,u;if(t===b.LineCap.SQUARE){o=Math.atan2(m-p,g-i);v=l*Math.cos(o);u=l*Math.sin(o);i-=v;g+=v;p-=u;m+=u}w=b.geom.ptSegDistSq(i,p,g,m,r,n)<=s;if(t!==b.LineCap.ROUND){w=w&&b.geom.dotprod(g-i,m-p,r-i,n-p)>=0&&b.geom.dotprod(g-i,m-p,g-r,m-n)>=0}return w}},styleDef:{x1:e.FiniteNumber(0,f),y1:e.FiniteNumber(0,f),x2:e.FiniteNumber(0,f),y2:e.FiniteNumber(0,f)}})}());(function(){b.mixin(b.graphics.Line,{cvPaintSelf:function(e,f){var g=this._style;if(g.stroke!==b.NO_PAINT){this.cvSetStroke(e);e.beginPath();e.moveTo(g.x1,g.y1);e.lineTo(g.x2,g.y2);e.stroke()}}})}());(function(){var f=b.geom.isPointInEllipse,g=(Math.sqrt(2)-1)/2,e=b.defs,h=b.TAGS.GEOM;b.declare({name:"oui.graphics.Ellipse",extend:b.graphics.AbstractShape,jsonDef:{type:"ellipse"},membersDef:{_computeCtrlPts:function(p){var l,m=this._style,o=m.cx,n=m.cy,j=m.width,s=m.height,q,i,k,r,u,t;if(p){j+=m.strokeThickness;s+=m.strokeThickness}q=n-s/2;i=n+s/2;k=o-j/2;r=o+j/2;if(j===0&&s===0){l=[o,n]}else{if(j===0){l=[o,q,o,i]}else{if(s===0){l=[k,n,r,n]}else{u=j*g;t=s*g;l=[k,n-t,o-u,q,o+u,q,r,n-t,r,n+t,o+u,i,o-u,i,k,n+t]}}}return l},hitTestOnFill:function(j,i){var k=this._style;return f(j,i,k.cx,k.cy,k.width/2,k.height/2)},hitTestOnStroke:function(n,m,q){var j=this._style,r=n,p=m,o=j.cx,l=j.cy,k=j.width/2,i=j.height/2,s=j.strokeThickness/2;q=(q!==false);return f(r,p,o,l,k+s,i+s)&&!(q&&f(r,p,o,l,k-s,i-s))}},styleDef:{cx:e.FiniteNumber(0,h),cy:e.FiniteNumber(0,h),width:e.FinitePositiveNumber(0,h),height:e.FinitePositiveNumber(0,h)}})}());(function(){var f=new b.graphics.PathCommands(),g=new b.graphics.Path({pathCommands:f}),e=2*Math.PI;b.mixin(b.graphics.Ellipse,{cvPaintSelf:function(n,i){var j=this._style,h=j.cx,m=j.cy,l=j.width/2,k=j.height/2;if(l===k){n.beginPath();n.arc(h,m,l,0,e,false);n.closePath();if(j.fill!==b.NO_PAINT){this.cvSetFill(n);n.fill()}if(j.stroke!==b.NO_PAINT){this.cvSetStroke(n);n.stroke()}}else{f.resetPath();f._safeMoveTo(h+l,m)._safeArc(h,m,0,360,l,k).closePath();g.applyStyle(j);g.cvPaintSelf(n,i)}}})}());(function(){var g=b.geom.isPointInEllipse,f=b.geom.isPointInTriangle,e=b.defs,h=b.TAGS.GEOM;b.declare({name:"oui.graphics.Rectangle",extend:b.graphics.AbstractShape,jsonDef:{type:"rect"},membersDef:{_computeCtrlPts:function(n){var l=this._style,k=l.strokeThickness,j=l.x,o=l.y,m=l.width,i=l.height;if(n){j-=k/2;o-=k/2;m+=k;i+=k}return b.geom.getBoxCtrlPts(j,o,m,i)},hitTestOnFill:function(s,o){var k=this._style,w=s,u=o,p=k.x,z=k.y,v=z+k.height,i=p+k.width,m=k.rx,j=k.ry,q,n,A;A=(w>=p&&w<=i&&u>=z&&u<=v);if(A&&m!==0&&j!==0){if(w<p+m){q=p+m}else{if(w>i-m){q=i-m}}if(u<z+j){n=z+j}else{if(u>v-j){n=v-j}}if(q!==undefined&&n!==undefined){A=g(w,u,q,n,m,j)}}return A},hitTestOnStroke:function(i,K,J){var v=false,s=i,p=K,E=this._style,I=E.strokeThickness/2,C=E.x,w=E.y,H=w+E.height,z=C+E.width,n=E.rx,m=E.ry,G=(n!==0&&m!==0),o=E.strokeLineJoin,k,j,B=(G&&n>I)?n:I,A=(G&&m>I)?m:I,u,q,F,D;J=(J!==false);v=(s>=C-I&&s<=z+I&&p>=w-I&&p<=H+I);v=v&&!(J&&((s>=C+B&&s<=z-B&&p>=w+I&&p<=H-I)||(G&&s>=C+I&&s<=z-I&&p>=w+A&&p<=H-A)));if(v){if(G||o===b.LineJoin.ROUND){if(s<C+n){k=C+n}else{if(s>z-n){k=z-n}}if(p<w+m){j=w+m}else{if(p>H-m){j=H-m}}if(k!==undefined&&j!==undefined){v=g(s,p,k,j,n+I,m+I);if(v&&J&&G&&n>I&&m>I){v=!g(s,p,k,j,n-I,m-I)}}}else{if(o===b.LineJoin.BEVEL){if(s<C){u=C-I;F=C;k=C}else{if(s>z){u=z+I;F=z;k=z}}if(p<w){q=w;D=w-I;j=w}else{if(p>H){q=H;D=H+I;j=H}}if(k!==undefined&&j!==undefined){v=f(s,p,u,q,F,D,k,j)}}}}return v}},styleDef:{x:e.FiniteNumber(0,h),y:e.FiniteNumber(0,h),width:e.FinitePositiveNumber(0,h),height:e.FinitePositiveNumber(0,h),rx:e.FinitePositiveNumber(0,h),ry:e.FinitePositiveNumber(0,h)}})}());(function(){var e=new b.graphics.HalfRoundedRectangle({rounded:{topLineBegin:true,topLineEnd:true,bottomLineBegin:true,bottomLineEnd:true}});b.mixin(b.graphics.Rectangle,{cvPaintSelf:function(f,g){var h=this._style;if(h.rx===0&&h.ry===0){if(h.fill!==b.NO_PAINT){this.cvSetFill(f);f.fillRect(h.x,h.y,h.width,h.height)}if(h.stroke!==b.NO_PAINT){this.cvSetStroke(f);f.strokeRect(h.x,h.y,h.width,h.height)}}else{e.applyStyle(h);e.cvPaintSelf(f)}}})}());(function(){var e=b.defs,i=b.TAGS.GEOM,g=b.TextAlignEnum,f=b.GENERIC_FONTS;function h(j){j=j.toLowerCase();return j.indexOf(" ")>=0&&j[0]!=="'"&&j!==f.SERIF&&j!==f.SANS_SERIF&&j!==f.CURSIVE&&j!==f.MONOSPACE}b.declare({name:"oui.graphics.Text",extend:b.graphics.AbstractShape,jsonDef:{type:"text"},membersDef:{_computeCtrlPts:function(){var k=this._style,l,o,n,m,j,p;if(k.textValue.length>0){p=this._getBBoxImpl();if(!p){m=k.fontSize*k.textValue.length/2;j=k.fontSize;o=k.x;if(k.textAlign===g.CENTER){o-=m/2}else{if((b.layoutDir===b.LTR&&k.textAlign===g.LINE_END)||(b.layoutDir===b.RTL&&k.textAlign===g.LINE_BEGIN)){o-=m}}n=k.y-j}else{m=p.width;j=p.height;o=p.x;n=p.y}l=b.geom.getBoxCtrlPts(o,n,m,j)}else{l=[k.x,k.y]}return l},hitTestOnFill:function(k,j){return this._isWithinBounds(k,j)},getBaselineYAnchor:function(){var k=this._style,j=k.layout.yAnchor,l=this._getBBoxImpl();if(l){j=(k.y-l.y)/l.height}return j},_getXAlignOffset:function(l){var k=0,j=(b.layoutDir===b.LTR);switch(this._style.textAlign){case g.JUSTIFY:c.warn("WARN__TEXT__NO_JUSTIFY");case g.LINE_BEGIN:k=j?0:-l;break;case g.CENTER:k=-l/2;break;case g.LINE_END:k=j?-l:0;break}return k},_getCSSFontFamily:function(l){var j=this._style.fontFamily,m,p,k,o;j=j.replace(/\s+/g," ").replace(/\s*,\s*/g,",").replace(/"/g,"'").replace(/^\s+|\s+$/g,"");if(j.indexOf(",")>0){if(l===true){p=j.split(",");for(k=0,o=p.length;k<o;k++){if(h(p[k])){p[k]="'"+p[k]+"'"}}j=p.join(",")}}else{m=j.replace(/'/g,"").toLowerCase();if(b.cssFonts.hasOwnProperty(m)){j=b.cssFonts[m]}else{if(l===true&&h(j)){j="'"+j+"'"}}}if(l!==true){j=j.replace(/'/g,"")}return j},_getBBoxImpl:function(){return null}},styleDef:{textValue:e.String("",i),x:e.FiniteNumber(0,i),y:e.FiniteNumber(0,i),fontFamily:e.String("Verdana",i),fontSize:e.FinitePositiveNumber(12,i),fontWeight:e.Enum(b.FontWeightEnum,b.FontWeightEnum.NORMAL,i),fontStyle:e.Enum(b.FontStyleEnum,b.FontStyleEnum.NORMAL,i),underline:e.Boolean(false,i),textAlign:e.Enum(g,g.LINE_BEGIN,i)}})}());(function(){var e=b.graphics.AbstractShape.prototype,g=new b.graphics.Line(),f=b.TextAlignEnum;b.mixin(b.graphics.Text,{cvPaintSelf:function(h,j){var k=this._style,l=this.cvBBox,i,m;h.font=this.cvGetFont();h.textAlign=this.cvToCSSAlign(this._style.textAlign);if(k.fill!==b.NO_PAINT){this.cvSetFill(h);h.fillText(k.textValue,k.x,k.y);i=k.fill;m=k.fillOpacity}if(k.stroke!==b.NO_PAINT){this.cvSetStroke(h);h.strokeText(k.textValue,k.x,k.y);i=k.stroke;m=k.strokeOpacity}if(k.underline){this.cvPaintUnderline(h,j,l.x,k.y,l.width,i,m)}},cvPaintUnderline:function(p,o,q,n,i,j,m){var h=this._style,l,k;l=Math.round(h.fontSize*5/100);if(l<1){l=1}k=Math.round(n+3*l);if(l%2===1){k+=0.5}g.applyStyle({x1:q,y1:k,x2:q+i,y2:k,strokeThickness:l,stroke:j,strokeOpacity:m});g.cvPaintSelf(p,o)},cvGetBBox:function(){var i=this._style,h=b.tree.cvTextMetrics(i.textValue,this.cvGetFont());return{x:i.x+this._getXAlignOffset(h.width),y:i.y-h.ascent,width:h.width,height:h.height}},notifyNativeImpl:function(h,i){if(h===b.TAGS.GEOM){this.cvCacheFont();this.cvBBox=this.cvGetBBox()}else{if(h===b.TAGS.LAYOUT_DIR){this.cvBBox=this.cvGetBBox()}}e.notifyNativeImpl.call(this,h,i)},cvGetFont:function(){if(!this.cvFont){this.cvCacheFont()}return this.cvFont},cvCacheFont:function(){var i=this._style,h="";if(i.fontStyle===b.FontStyleEnum.ITALIC){h+="italic "}if(i.fontWeight===b.FontWeightEnum.BOLD){h+="bold "}h+=i.fontSize+"px "+this._getCSSFontFamily(true);this.cvFont=h},cvToCSSAlign:function(i){var h=(b.layoutDir===b.LTR);switch(i){case f.CENTER:i="center";break;case f.LINE_END:i=h?"right":"left";break;default:i=h?"left":"right";break}return i}})}());(function(){var e=b.defs,f=b.TAGS.GEOM;b.declare({name:"oui.graphics.TextBlock",extend:b.graphics.Text,jsonDef:{type:"textBlock"},membersDef:{convertToText:function(){var o=[],h=new b.text.LineBreakMeasurer(this),n=this._breakText(h),q=n.length,p,g,k=this._style,j=k.y,m=k.x,l;for(l=0;l<q;l++){g=n[l];if(l!==0){j+=g.leading+g.ascent}p=new b.graphics.Text(k);p.applyStyle({textValue:g.textValue,x:m+this._getXAlignOffset(g.lineWidth),y:j});o.push(p);j+=g.descent}return o},_breakText:function(g){var h=this._style,i=h.textValue,p=h.maxWidth,m=h.maxLines,j=h.autoTooltip,l=h.useEllipsis,n=h.ellipsis,o=false,r=[],q=g.getTextLength(),k;g.replaceText(0,q,i);if(l){q=g.getTextLength();k=this._fitText(g,r,p,m,true);while(k>=1&&k<q){g.replaceText(k-1,q,n);q=g.getTextLength();k=this._fitText(g,r,p,m,true)}o=(k!==i.length)}else{this._fitText(g,r,p,m,false)}if(j&&o){this.setTooltip(i)}else{this.setTooltip(null)}return r},_fitText:function(g,o,m,l,k){var n=0,j=0,h=this._style.minChar,i=g.nextLine(m);o.length=0;while(i){o.push(i);n++;j=i.textBlockEndIndex;if(n===l||(k&&i.lastWordTruncated)){break}i=g.nextLine(m)}if(k){h++}if(n>0&&o[0].lastWordTruncated&&o[0].textValue.length<h){o.length=0;j=0}return j}},styleDef:{maxWidth:e.PositiveNumber(Number.POSITIVE_INFINITY,f),maxLines:e.NumberInRange([1,Number.POSITIVE_INFINITY],Number.POSITIVE_INFINITY,f),minChar:e.FinitePositiveNumber(0,f),useEllipsis:e.Boolean(false),ellipsis:e.Char("\u2026"),autoTooltip:e.Boolean(false)}})}());(function(){b.mixin(b.graphics.TextBlock,{cvPaintSelf:function(l,q){var g=this._style,s,t,k,f,j,e,o=(g.fill!==b.NO_PAINT),r=(g.stroke!==b.NO_PAINT),h=g.underline,p,m;if(o){this.cvSetFill(l);p=g.fill;m=g.fillOpacity}if(r){this.cvSetStroke(l);p=g.stroke;m=g.strokeOpacity}if(o||r){l.font=this.cvGetFont();l.textAlign=this.cvToCSSAlign(this._style.textAlign);s=this.cvTextLines;k=g.x;f=g.y;for(j=0,e=s.length;j<e;j++){t=s[j];if(j!==0){f+=s[j-1].descent+t.leading+t.ascent}if(o){l.fillText(t.textValue,k,f)}if(r){l.strokeText(t.textValue,k,f)}if(h){this.cvPaintUnderline(l,q,g.x+this._getXAlignOffset(t.lineWidth),f,t.lineWidth,p,m)}}}},cvGetBBox:function(){var g=this._style,f=new b.text.LineBreakMeasurer(this),m=this._breakText(f),e=m.length,k=0,l=0,j=0,n,h;for(h=0;h<e;h++){n=m[h];k=Math.max(k,n.lineWidth);l+=n.lineHeight+n.leading}if(e>0){j=m[0].ascent}return{x:g.x+this._getXAlignOffset(k),y:g.y-j,width:k,height:l}},notifyNativeImpl:function(e,g){var f;if(e===b.TAGS.GEOM||e===b.TAGS.LAYOUT_DIR){this.cvCacheFont();f=new b.text.LineBreakMeasurer(this);this.cvTextLines=this._breakText(f);this.cvBBox=this.cvGetBBox()}b.graphics.AbstractShape.prototype.notifyNativeImpl.call(this,e,g)}})}());(function(){var e=b.graphics.Group.prototype,f="background";b.declare({name:"oui.layout.AbstractLayoutBox",isAbstract:true,extend:b.graphics.Group,membersDef:{_computeLayoutCtrlPts:function(){var g=this._box;return b.geom.getBoxCtrlPts(g.x,g.y,g.width,g.height)},invalidateLayout:function(){var g;if(!this._layingOut&&!this._layoutDirty){g=this.getFirstContentChild();this.invalidateLayout=b.NO_OP;while(g){if((g.getLayoutHWeight()!==0)||(g.getLayoutVWeight()!==0)){g.invalidateLayout()}g=g.nextSibling}delete this.invalidateLayout;e.invalidateLayout.call(this)}},_getLayoutInformation:function(){var j,g,h,o,l,i,m,p,k,n;j={maxChildWidth:0,maxChildHeight:0,maxLayoutWidth:Number.MAX_VALUE,maxLayoutHeight:Number.MAX_VALUE,totalChildWidth:0,totalChildHeight:0,totalChildHWeight:0,totalChildVWeight:0,children:[],spacingsCount:0};h=this.getFirstContentChild();while(h){o=h._style;l=h.getPreferredLayoutBox();i=o.layout.hWeight;m=o.layout.vWeight;n=o.display;j.totalChildWidth+=l.width;j.totalChildHWeight+=i;j.totalChildHeight+=l.height;j.totalChildVWeight+=m;if(l.height>j.maxChildHeight){j.maxChildHeight=l.height}if(l.width>j.maxChildWidth){j.maxChildWidth=l.width}j.children.push({node:h,layoutBox:l,hWeight:i,vWeight:m,needSpace:n});if(n){j.spacingsCount++}h=h.nextSibling}if(j.spacingsCount>0){j.spacingsCount--}g=this._layoutBox;if(g){if(j.maxChildHeight>g.height){j.maxChildHeight=g.height}if(j.maxChildWidth>g.width){j.maxChildWidth=g.width}j.maxLayoutWidth=g.width;j.maxLayoutHeight=g.height}p=this._style.layout.preferredWidth;k=this._style.layout.preferredHeight;if(p>=0&&j.maxLayoutWidth>p){j.maxLayoutWidth=p}if(k>=0&&j.maxLayoutHeight>k){j.maxLayoutHeight=k}return j},onStyleChanged:function(g){if(g===f){this._updateBackground()}else{e.onStyleChanged.call(this,g)}},_updateBackground:function(){var g=this._style,h={fill:g.background};if(this._background){this._background.applyStyle(h)}else{this._background=new b.graphics.Rectangle(h);this.insertBefore(this._background,this.firstChild)}},getFirstContentChild:function(){return this._background?this._background.nextSibling:this.firstChild},hasBackground:function(){return(this._background!==undefined)}},styleDef:{background:b.defs.Paint(b.NO_PAINT,f)}})}());(function(){var h=b.defs,n=b.DirectionEnum,o=b.LTR,g=b.RTL,i=b.OrientationEnum.VERTICAL,f=b.OrientationEnum.HORIZONTAL,q=n.UP,p=n.DOWN,e=n.LEFT,m=n.RIGHT,k=n.TO_LINE_BEGIN,l=n.TO_LINE_END,j=b.TAGS.LAYOUT;b.declare({name:"oui.layout.FlowBox",extend:b.layout.AbstractLayoutBox,jsonDef:{type:"flowbox",factory:function(t,v,s,u){var r=new b.layout.FlowBox(t,t.name);b.load(t.children,r,v,s,u);return r}},membersDef:{_safeLayout:function(){var r=this._style.orientation;if(r===f){this._hFlowLayout()}else{this._vFlowLayout()}if(this._background){this._background.applyStyle(this._box)}this._positionInLayoutBox()},_vFlowLayout:function(){var r=this._style,t=0,s=0,A=[],D=0,F=r.wrapLength,z=r.hSpacing,G=r.vSpacing,C,u=this.firstChild,x=0,w=0,E=1,v=0,B=0,y=1;if(this._isRTLLayout()){v=1;E=-1}if(r.vDirection===q){B=1;y=-1}while(u){C=u.getPreferredLayoutBox();if(y*s+C.height>F){this._layoutColumn(A,D,v*E*D);if(x>0){x+=z}x+=D;s=0;t+=E*(D+z);A=[];D=0}A.push({node:u,x:t,y:s+B*y*C.height,width:C.width,height:C.height});if(D<C.width){D=C.width}if(y*s+C.height>w){w=y*s+C.height}s+=y*(C.height+(u._style.display?G:0));u=u.nextSibling}if(A.length>0){this._layoutColumn(A,D,v*E*D);if(x>0){x+=z}x+=D}this._box={x:v*E*x,y:B*y*w,width:x,height:w}},_layoutColumn:function(r,u,t){var s,w,v;for(s=0,w=r.length;s<w;s++){v=r[s];v.node.setLayoutBox(v.x+t,v.y,u,v.height)}},_hFlowLayout:function(){var r=this._style,t=0,s=0,w=[],C=0,F=r.wrapLength,y=r.hSpacing,G=r.vSpacing,B,u=this.firstChild,z=0,E=0,D=1,v=0,A=0,x=1;if(this._isRTLLayout()){v=1;D=-1}if(r.vDirection===q){A=1;x=-1}while(u){B=u.getPreferredLayoutBox();if(D*t+B.width>F){this._layoutRow(w,C,A*x*C);if(z>0){z+=G}z+=C;t=0;s+=x*(C+G);w=[];C=0}w.push({node:u,x:t+v*D*B.width,y:s,width:B.width,height:B.height});if(C<B.height){C=B.height}if(D*t+B.width>E){E=D*t+B.width}t+=D*(B.width+(u._style.display?y:0));u=u.nextSibling}if(w.length>0){this._layoutRow(w,C,A*x*C);if(z>0){z+=G}z+=C}this._box={x:v*D*E,y:A*x*z,width:E,height:z}},_layoutRow:function(u,s,t){var r,w,v=u.length;for(r=0;r<v;r++){w=u[r];w.node.setLayoutBox(w.x,w.y+t,w.width,s)}},_isRTLLayout:function(){var r=this._style.hDirection;return r===e||(r===k&&b.layoutDir===o)||(r===l&&b.layoutDir===g)}},styleDef:{orientation:h.Enum(b.OrientationEnum,i,j),wrapLength:h.PositiveNumber(100,j),hDirection:{type:[e,m,k,l],defaultValue:l,tag:j},vDirection:{type:[q,p],defaultValue:p,tag:j},hSpacing:h.FinitePositiveNumber(5,j),vSpacing:h.FinitePositiveNumber(5,j)}})}());(function(){var f=b.LTR,k=b.RTL,i=b.DirectionEnum,g=i.LEFT,h=i.RIGHT,l=i.TO_LINE_BEGIN,e=i.TO_LINE_END,j=b.TAGS.LAYOUT;b.declare({name:"oui.layout.HBox",extend:b.layout.AbstractLayoutBox,jsonDef:{type:"hbox",factory:function(n,q,m,p){var o=new b.layout.HBox(n,n.name);b.load(n.children,o,q,m,p);return o}},membersDef:{_safeLayout:function(){var y,A,s,m,E,o,u,B,p,w,C,v=this._style,q=0,D=0,z,t=1,n=0,x=v.direction,r=v.spacing;A=this._getLayoutInformation();m=A.maxChildHeight;if(A.maxLayoutHeight!==Number.MAX_VALUE&&((A.totalChildVWeight!==0)||(A.maxLayoutHeight<A.maxChildHeight))){m=A.maxLayoutHeight}p=A.maxLayoutWidth;s=A.children;w=0;E=p;o=s.length;D=A.maxLayoutWidth-A.totalChildWidth-A.spacingsCount*r;if(D<0||A.maxLayoutWidth===Number.MAX_VALUE){D=0}z=A.totalChildHWeight;if(z===0){z=1}if(x===g||(x===l&&b.layoutDir===f)||(x===e&&b.layoutDir===k)){n=1;t=-1}for(C=0;C<o;C++){u=s[C];B=u.node;y=u.layoutBox.width+D*u.hWeight/z;if(y>p){y=p}B.setLayoutBox(w+n*t*y,0,y,m);q=t*w+y;w+=t*(y+(u.needSpace?r:0));if(t*w>E){w=t*E}p=A.maxLayoutWidth-t*w;if(p<0){p=0}}this._box={x:n*t*q,y:0,width:q,height:m};if(this._background){this._background.applyStyle(this._box)}this._positionInLayoutBox()}},styleDef:{spacing:b.defs.FinitePositiveNumber(5,j),direction:{type:[g,h,l,e],defaultValue:e,tag:j}}})}());(function(){var g=b.DirectionEnum,e=g.UP,f=g.DOWN,h=b.TAGS.LAYOUT;b.declare({name:"oui.layout.VBox",extend:b.layout.AbstractLayoutBox,jsonDef:{type:"vbox",factory:function(j,m,i,l){var k=new b.layout.VBox(j,j.name);b.load(j.children,k,m,i,l);return k}},membersDef:{_safeLayout:function(){var p,u,m,n,z,j,o,v,y,r,w,q=this._style,A=0,t=0,k,x=0,s=1,l=q.spacing;u=this._getLayoutInformation();n=u.maxChildWidth;if(u.maxLayoutWidth!==Number.MAX_VALUE&&((u.totalChildHWeight!==0)||(u.maxLayoutWidth<u.maxChildWidth))){n=u.maxLayoutWidth}y=u.maxLayoutHeight;m=u.children;r=0;z=y;j=m.length;t=u.maxLayoutHeight-u.totalChildHeight-u.spacingsCount*l;if(t<0||u.maxLayoutHeight===Number.MAX_VALUE){t=0}k=u.totalChildVWeight;if(k===0){k=1}if(q.direction===e){x=1;s=-1}for(w=0;w<j;w++){o=m[w];v=o.node;p=o.layoutBox.height+t*o.vWeight/k;if(p>y){p=y}v.setLayoutBox(0,r+x*s*p,n,p);A=s*r+p;r+=s*(p+(o.needSpace?l:0));if(s*r>z){r=s*z}y=u.maxLayoutHeight-s*r;if(y<0){y=0}}this._box={x:0,y:x*s*A,width:n,height:A};if(this._background){this._background.applyStyle(this._box)}this._positionInLayoutBox()}},styleDef:{spacing:b.defs.FinitePositiveNumber(5,h),direction:{type:[e,f],defaultValue:f,tag:h}}})}());(function(){var f=b.graphics.Group.prototype,e=b.defs;b.declare({name:"oui.layout.Box",extend:b.graphics.Group,jsonDef:{type:"box",factory:function(h,k,g,j){var i=new b.layout.Box(h,h.name);b.load(h.children,i,k,g,j);return i}},membersDef:{init:function(g,h){f.init.call(this,g,h);this._updateBackground()},onPropertyChanged:function(){this._updateBackground()},_updateBackground:function(){var j=this._style,i=j.border,h=i.rounded,g,k;if((h.topLineBegin===h.topLineEnd&&h.topLineEnd===h.bottomLineBegin&&h.bottomLineBegin===h.bottomLineEnd)){k={stroke:i.stroke,strokeThickness:i.strokeThickness,rx:h.topLineBegin?i.rx:0,ry:h.topLineBegin?i.ry:0,fill:j.background,filter:j.backgroundFilter};if(!this._rect){this._rect=new b.graphics.Rectangle(k)}else{this._rect.applyStyle(k)}g=this._rect}else{k={stroke:i.stroke,strokeThickness:i.strokeThickness,rx:i.rx,ry:i.ry,rounded:i.rounded,fill:j.background,filter:j.backgroundFilter};if(!this._hrrect){this._hrrect=new b.graphics.HalfRoundedRectangle(k)}else{this._hrrect.applyStyle(k)}g=this._hrrect}if(g!==this._background){if(this._background){this.removeChild(this._background)}this.insertBefore(g,this.firstChild);this._background=g}},_safeLayout:function(){var l,h=null,k,g,i,j;if(!this._layoutBox){l=this.getPreferredLayoutBox();this.setLayoutBox(0,0,l.width,l.height)}k=this._layoutBox.width;g=this._layoutBox.height;i=this._style.layout.preferredWidth;j=this._style.layout.preferredHeight;if(i>=0&&i<k){k=i}if(j>=0&&j<g){g=j}if(this._background){h=this._background.nextSibling;this._background.applyStyle({width:k,height:g})}else{h=this.firstChild}while(h){h.setLayoutBox(0,0,k,g);h=h.nextSibling}this._positionInLayoutBox()},_getContentPreferredLayoutBox:function(){var g=null,i,h={width:0,height:0};if(this._background){g=this._background.nextSibling}while(g){i=g.getPreferredLayoutBox();h.width=Math.max(h.width,i.width);h.height=Math.max(h.height,i.height);g=g.nextSibling}return h}},styleDef:{border:{strokeThickness:e.FinitePositiveNumber(1),stroke:e.Paint(b.NO_PAINT),rx:e.PositiveNumber(3),ry:e.PositiveNumber(3),rounded:{topLineBegin:e.Boolean(true),topLineEnd:e.Boolean(true),bottomLineBegin:e.Boolean(false),bottomLineEnd:e.Boolean(false)}},background:e.Paint(b.NO_PAINT),backgroundFilter:e.FilterEffect(null)}})}());(function(){var f=b.graphics.Group.prototype,e=b.defs,g;g={name:"content",type:"box",children:[{name:"shadow",type:"box",background:b.black,border:{stroke:b.black},styleBinding:{display:function(h){return h.shadow!==null},filter:"@shadow",border:{strokeThickness:"@border.strokeThickness",rx:"@border.rx",ry:"@border.ry",rounded:"@border.rounded"}}},{name:"background",type:"box",styleBinding:{border:"@border",background:"@background"}},{name:"data",type:"box",background:b.NO_PAINT,border:{stroke:b.NO_PAINT},styleBinding:{layout:{padding:"@padding"}},children:[{name:"text",type:"textBlock",useEllipsis:true,autoTooltip:false,styleBinding:{fontFamily:"@text.fontFamily",fontSize:"@text.fontSize",fontWeight:"@text.fontWeight",fill:"@text.fill",maxLines:"@text.maxLines",maxWidth:"#_computeMaxWidth"}},{name:"graphics",type:"group"}]}]};b.declare({name:"oui.tooltip.Tooltip",extend:b.graphics.Group,membersDef:{init:function(h,i){f.init.call(this,h,i);this.isShown=false;this._isTextBased=false;this.content=b.load(g);this.appendChild(this.content);this.onPropertyChanged();this.setPointerSensitivity(false);this._viewportResizeHandler=this.handler("_computeMaxWidth")},setContent:function(h){this.content.data.text.setDisplay(false);this.content.data.graphics.setDisplay(false);if(b.isA(h,String)){this._setTextContent(h)}else{if(b.isA(h,b.graphics.AbstractGraphicNode)){this._setGraphicContent(h)}else{if(b.isA(h,Number)){this._setTextContent(h.toString(10))}else{if(b.isA(h,Date)){this._setTextContent(h.toLocaleString())}}}}},show:function(){this.appendChild(this.content);this.isShown=true},hide:function(){this.isShown=false;if(this.firstChild){this.removeChild(this.content)}},onPropertyChanged:function(){if(this.content!==undefined){this.content.applyStyleBinding(this._style,this)}},_setTextContent:function(h){this.content.data.text.applyStyle({display:true,textValue:h,maxWidth:this._computeMaxWidth()});if(!this._isTextBased){b.rootNode.addEventListener(b.ViewEvents.VIEWPORT_RESIZE,this._viewportResizeHandler);this._isTextBased=true}},_setGraphicContent:function(i){var h=this.content.data.graphics;h.removeChildren();h.appendChild(i);h.setDisplay(true);if(this._isTextBased){b.rootNode.removeEventListener(b.ViewEvents.VIEWPORT_RESIZE,this._viewportResizeHandler);this._isTextBased=false}},_computeMaxWidth:function(){var h=this._style,i=h.padding,j=b.viewportWidth-(i.lineBegin+i.lineEnd);return Math.min(h.text.maxWidth,j)}},styleDef:{border:{strokeThickness:e.FinitePositiveNumber(1),stroke:e.Paint(new b.style.Color(204,204,204)),rx:e.PositiveNumber(4),ry:e.PositiveNumber(4),rounded:{topLineBegin:e.Boolean(true),topLineEnd:e.Boolean(true),bottomLineBegin:e.Boolean(true),bottomLineEnd:e.Boolean(true)}},background:e.Paint(new b.style.Color(0,0,0,191)),text:{fontFamily:e.String("Trebuchet MS"),fontSize:e.FinitePositiveNumber(11),fontWeight:e.Enum(b.FontWeightEnum,b.FontWeightEnum.NORMAL),fill:e.Paint(b.white),maxLines:e.NumberInRange([1,Number.POSITIVE_INFINITY],Number.POSITIVE_INFINITY),maxWidth:e.PositiveNumber(Number.POSITIVE_INFINITY,b.TAGS.GEOM)},padding:e.Padding(5,5,5,5),shadow:e.ObjectOfType(b.filters.DropShadow,b.filters.DROP_SHADOW_KNOCKED_OUT,true)}})}());(function(){var e=b.defs;b.declare({name:"oui.tooltip.TooltipManager",mixins:[b.lang.PropertiesSupport],membersDef:{events:{SHOW_TOOLTIP:"showTooltip",HIDE_TOOLTIP:"hideTooltip"},init:function(){var g=this,f=b.tree;this._initProperties();this._initCallbacks();this._initMouseListeners();this._style=new this.Style();this._tooltip=new b.tooltip.Tooltip(this._style);this._ttTarget=null;this._ttX=0;this._ttY=0;if(f.isPlatformAvailable()){this.enableAutoTooltips()}else{f.addEventListener(f.events.PLATFORM_AVAILABLE,function(){f._initShadowTree(g._tooltip);g.enableAutoTooltips()})}},enableAutoTooltips:function(){b.tree.tooltipLayer.appendChild(this._tooltip);this._tooltip.hide();b.rootNode.onMouseOver(this._mouseOverListener)},disableAutoTooltips:function(){b.tree.tooltipLayer.removeChild(this._tooltip);b.rootNode.offMouseOver(this._mouseOverListener)},applyStyle:function(f){this._tooltip.applyStyle(f)},showTooltip:function(h,g,f,i){this.cancelDismissTooltip();this.cancelHideTooltip();if(g!==this._tooltipContent){this._tooltip.setContent(g)}this._tooltip.show();this._positionTooltipTo(f,i);this.scheduleDismissTooltip();this._tooltipContent=g},hideTooltip:function(){this._tooltip.hide()},_initMouseListeners:function(){var j=this,f,i,g;function h(k){var l=null;while(k){l=k.getTooltip();if(l===null||l===""){k=k.parentNode}else{break}}return k}f=function(l){var k=h(l.relatedTarget),m=h(l.target);if(m&&m!==k){m.onMouseMove(g);m.onMouseOut(i)}};i=function(k){var l=k.currentTarget,m=h(k.relatedTarget);if(m!==l){j.cancelShowTooltip();j.cancelDismissTooltip();j.scheduleHideTooltip();l.offMouseMove(g);l.offMouseOut(i)}};g=function(k){j._ttTarget=k.currentTarget;j._ttX=k.clientX;j._ttY=k.clientY;j.cancelShowTooltip();j.scheduleShowTooltip()};this._mouseOverListener=f},_initCallbacks:function(){var f=this;this._showTooltipDefaultAction=function(g){var h=g.target.getTooltip();f.showTooltip(g.target,h,g.tooltipX,g.tooltipY)};this._dispatchShowTooltip=function(){f._ttTarget.dispatchEvent({type:f.events.SHOW_TOOLTIP,tooltipX:f._ttX,tooltipY:f._ttY,cancelable:true,defaultAction:f._showTooltipDefaultAction})};this._hideTooltipDefaultAction=function(){f.hideTooltip()};this._dispatchHideTooltip=function(){if(f._ttTarget){f._ttTarget.dispatchEvent({type:f.events.HIDE_TOOLTIP,defaultAction:f._hideTooltipDefaultAction})}}},scheduleShowTooltip:function(){var f=this._properties.showDelay;if(f===0){this._dispatchShowTooltip()}else{this._showTooltipTimeoutID=setTimeout(this._dispatchShowTooltip,f)}},cancelShowTooltip:function(){if(this._showTooltipTimeoutID){clearTimeout(this._showTooltipTimeoutID);this._showTooltipTimeoutID=undefined}},scheduleHideTooltip:function(){var f=this._properties.hideDelay;if(f===0){this._dispatchHideTooltip()}else{this._hideTooltipTimeoutID=setTimeout(this._dispatchHideTooltip,f)}},cancelHideTooltip:function(){if(this._hideTooltipTimeoutID){clearTimeout(this._hideTooltipTimeoutID);this._hideTooltipTimeoutID=undefined}},scheduleDismissTooltip:function(){var f=this._properties.dismissDelay;if(f===0){this._dispatchHideTooltip()}else{if(isFinite(f)){this._dismissTooltipTimeoutID=setTimeout(this._dispatchHideTooltip,f)}}},cancelDismissTooltip:function(){if(this._dismissTooltipTimeoutID){clearTimeout(this._dismissTooltipTimeoutID);this._dismissTooltipTimeoutID=undefined}},_positionTooltipTo:function(f,k){var j=this._tooltip,i=this._properties,g={x:f,y:k},h;j._setTranslation(f+i.cursorOffset,k+i.cursorOffset);h=j.getLayoutBounds();g=b.geom.getBoundedXY(h,b.viewportBounds,undefined,g);if(g.x!==h.x||g.y!==h.y){j._setTranslation(g.x,g.y)}}},propertiesDef:{showDelay:e.FinitePositiveNumber(200),hideDelay:e.FinitePositiveNumber(250),dismissDelay:e.PositiveNumber(5000),cursorOffset:e.Number(12),followCursor:e.Boolean(false)},styleDef:b.tooltip.Tooltip.StyleDefinition})}());(function(){b.declare({name:"oui.io.JSONExporter",membersDef:{init:function(){this._resources={};this._root={type:"group"};this._containerHierarchy=[this._root];this._curContainer=this._root},snapshotNodes:function(p,s,m,o){var r,q,t;if(b.isA(p,Array)){for(q=0,t=p.length;q<t;q++){this.captureNode(p[q])}r={type:"snapshot",width:m,height:o,viewBox:b.geom.isValidRect(s)?[s.x,s.y,s.width,s.height]:undefined,resources:this._captureResources(),content:this._root}}return r},captureNode:function(m){if(m.jsonNodeExporter!==undefined){m.jsonNodeExporter.captureNode(m,this)}},startNodeExport:function(m){if(this._curContainer.children===undefined){this._curContainer.children=[m]}else{this._curContainer.children.push(m)}this._containerHierarchy.push(m);this._curContainer=m},endNodeExport:function(){var m;this._containerHierarchy.pop();m=this._containerHierarchy.length;this._curContainer=this._containerHierarchy[m-1]},_DEFAULT_RESOURCE_COMPARE:function(n,m){return n===m},getResourceId:function(p,o,t,s){var r=0,m=0,q;if(t===undefined){t=this._DEFAULT_RESOURCE_COMPARE}if(this._resources[o]===undefined){q=[];this._resources[o]=q}else{q=this._resources[o];for(m=0,r=q.length;m<r;m++){if(t(q[m],p)===true){break}}}if(m===r){if(typeof s==="function"){s(p)}q.push(p)}return o.concat(m)},getImgResourceId:function(m,n){return this.getResourceId({type:"imageResource",src:m},"image_",function(p,o){return p.src===o.src},n)},_captureResources:function(){var r=this._resources,m={},o,s,q;for(q in r){if(r.hasOwnProperty(q)===true){m[q]={};for(o=0,s=r[q].length;o<s;o++){m[q][q+o]=this._resourceToJSON(r[q][o])}}}return m},_resourceToJSON:function(n){var m=n;if(b.isA(n.exportValueToJSON,Function)){m=n.exportValueToJSON(this)}return m}}});b.graphics.AbstractGraphicNode.prototype.jsonNodeExporter={exportNode:function(u,o,q){var m,p=u._style,r=u.StyleDefinition.prototype,s=u.jsonExportConfig.styleExporter,t=u.jsonExportConfig.propertiesExporter;for(m in p){if(s.hasOwnProperty(m)){s[m](m,p[m],r[m].defaultValue,o,u,q)}}if(t!==undefined){t(o,u,q)}},captureNode:function(p,o){var m;if(p.shouldCapture()){m={type:p.jsonExportConfig.type,__node:p};this.exportNode(p,m,o);o.startNodeExport(m);this.exportChildren(p,o);o.endNodeExport(m)}},exportChildren:function(m,n){var o=m.firstChild;while(o){n.captureNode(o);o=o.nextSibling}}};var f,l,j,h,e,k,g,i;f=function(n,m){n.prototype.exportToJSON=m};l=function(n,m){n.prototype.exportValueToJSON=m};j=function(n,m){var o=n.prototype.jsonExportConfig;n.prototype.jsonExportConfig=m;if(o!==undefined){b.mixin(m.styleExporter,o.styleExporter)}};b.graphics.AbstractGraphicNode.prototype.shouldCapture=function(){return this._style.display&&this._style.visibility};b.graphics.AbstractPath.prototype.shouldCapture=function(){var m=this.getPathCommands();return this._style.display&&this._style.visibility&&m!==null&&m.dataTypes.length>0};h=function(o,r,m,p,s,q){if(r!==m){p[o]=r}};e=function(o,r,m,p,s,q){if(r!==m){p[o]=r.concat()}};k=function(o,r,m,p,s,q){if(r!==m){p[o]=r.exportToJSON(q)}};g=function(r){var o=[],m,q,p,s=r.length;for(p=0;p<s;p++){q=r[p];m=q.getColor();o.push({type:"stop",offset:q.getOffset(),color:m.exportToJSON(),opacity:m.getOpacity(),origColor:m})}return o};i=function(n,m){return n===m||(n._style.color===m._style.color&&n._style.opacity===m._style.opacity&&n._style.radius===m._style.radius&&n._style.angle===m._style.angle&&n._style.offset===m._style.offset&&n._style.knockout===m._style.knockout)};j(b.graphics.AbstractGraphicNode,{styleExporter:{clip:e,transform:function(o,r,m,p,s,q){if(!r.isIdentity()){p[o]=r.exportToJSON(q)}},filter:function(o,r,m,p,s,q){if(r!==m){s._updateFilterFX();k(o,s._filterFX,m,p,s,q)}}}});j(b.graphics.Group,{type:"group",styleExporter:{opacity:h}});j(b.graphics.AbstractShape,{styleExporter:{fill:k,fillOpacity:h,stroke:k,strokeOpacity:h,strokeThickness:h,strokeLineJoin:h,strokeLineCap:h,strokeMiterLimit:h,htmlExportClassName:h}});j(b.graphics.Ellipse,{type:"ellipse",styleExporter:{cx:h,cy:h,width:h,height:h}});j(b.graphics.Image,{type:"image",styleExporter:{src:function(o,r,m,p,t,q){var s=q.getImgResourceId(r,function(n){n.href=t.toDataURL()});p[o]="#"+s},x:h,y:h,width:h,height:h}});j(b.graphics.Line,{type:"line",styleExporter:{x1:h,y1:h,x2:h,y2:h}});j(b.graphics.AbstractPath,{type:"path",propertiesExporter:function(m,o,n){m.pathCommands=o.getPathCommands().exportToJSON(n)},styleExporter:{}});j(b.graphics.Rectangle,{type:"rect",styleExporter:{x:h,y:h,width:h,height:h,rx:h,ry:h}});j(b.graphics.Text,{type:"text",styleExporter:{x:h,y:h,fontSize:h,fontWeight:h,fontFamily:h,underline:h,textAlign:h,textValue:h}});j(b.graphics.TextBlock,{type:"textBlock",styleExporter:{}});f(b.style.Color,function(){return"#".concat(this.hexRGBA)});f(b.style.GradientPaint,function(m){return"url(#"+m.getResourceId(this,"gradient_")+")"});f(b.style.PatternPaint,function(m){m.getImgResourceId(this._properties.src,function(n){var o=n.src;n.href=b.resourcesManager._getBase64Data(o)||o});return"url(#"+m.getResourceId(this,"pattern_")+")"});f(b.style.Paint,function(){return"none"});f(b.filters.AbstractFilter,function(m){return"url(#"+m.getResourceId(this,"filter_")+")"});f(b.filters.DropShadow,function(m){return"url(#"+m.getResourceId(this,"filter_",i)+")"});l(b.style.LinearGradient,function(){var m=this._properties;return{type:"linearGradient",x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,useObjectBoundingBox:m.useObjectBoundingBox,stops:g(m.stops)}});l(b.style.RadialGradient,function(){var m=this._properties;return{type:"radialGradient",cx:m.cx,cy:m.cy,r:m.radius,useObjectBoundingBox:m.useObjectBoundingBox,stops:g(m.stops)}});l(b.style.PatternPaint,function(m){return{type:"pattern",width:this._srcW,height:this._srcH,src:"#"+m.getImgResourceId(this._properties.src),origSrc:this._properties.src}});l(b.filters.DropShadow,function(){var m=this._style;return{type:"dropShadow",color:m.color.hexRGBA,opacity:m.opacity,radius:m.radius,angle:m.angle,offset:m.offset,knockout:m.knockout}});l(b.filters.Blur,function(){return{type:"blur",radius:this._style.radius}});f(b.geom.Matrix,function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]});f(b.graphics.PathCommands,function(){return{dataTypes:this.dataTypes.concat(),dataValues:this.dataValues.concat()}})}());(function(){b.ns("oui.io");b.io.XMLConverter={convert:function(f,l){var g,j,h,k,e=l;if(typeof f==="string"){e=e.concat(b.xmlSpecialChars(f))}else{e=e.concat("<",f.__type);g=[];if(f.hasOwnProperty("__style")){for(j in f.__style){if(f.__style.hasOwnProperty(j)===true){g.push("".concat(j,":",f.__style[j],";"))}}f.style=g.join("")}g=[];for(j in f){if(j!=="children"&&j!=="__type"&&j!=="__style"&&f.hasOwnProperty(j)===true){g.push(" ".concat(j,"='",f[j],"'"))}}if(g.length>0){g.sort();e=String.prototype.concat.apply(e,g)}if(f.children!==undefined){e=e.concat(">");k=f.children.length;for(h=0;h<k;h++){e=b.io.XMLConverter.convert(f.children[h],e)}e=e.concat("</"+f.__type+">")}else{if(f.__type==="div"||f.__type==="style"){e=e.concat("></"+f.__type+">")}else{e=e.concat(" />")}}}return e}}}());(function(){var u,e=3*Math.sqrt(2*Math.PI),v={LTR:{LINE_BEGIN:"start",LINE_END:"end",CENTER:"middle",JUSTIFY:"start"},RTL:{LINE_BEGIN:"end",LINE_END:"start",CENTER:"middle",JUSTIFY:"start"}},s={},f={};function h(y){if(s[y]===undefined){s[y]=0}else{s[y]++}return y+s[y]}function q(y){return y.substring(0,7)}function w(z){var y=z;if(z&&z.charAt(0)==="#"){y=q(z)}return y}function p(z){var y=z.substr(7),A=1;if(y!=="FF"){A=parseInt(y,16)/255}return A}function m(z){var y=1;if(z&&z.charAt(0)==="#"){y=p(z)}return y}function r(y){return[parseInt(y.substr(0,2),16),parseInt(y.substr(2,2),16),parseInt(y.substr(4,2),16),parseInt(y.substr(6,2),16)]}function k(z,y){if(z){if(!y.children){y.children=[]}y.children.push(z)}}function x(y){return(y*4-2)/e}function o(z,y,A){return{__type:"feFunc"+z,type:"linear",slope:y,intercept:A}}function l(z){var A={},y;for(y in z){if(z.hasOwnProperty(y)===true&&y!=="children"&&y!=="type"&&y!=="__node"){A[y]=z[y]}}if(z.hasOwnProperty("type")===true){A.__type=z.type}return A}function t(z){var A=l(z),y=A.color;A["stop-color"]=q(y);delete A.color;A["stop-opacity"]=p(y);return A}function n(z){var B=l(z),A=B.stops,y,C;B.gradientUnits=B.useObjectBoundingBox?"objectBoundingBox":"userSpaceOnUse";delete B.useObjectBoundingBox;delete B.stops;if(A){for(y=0,C=A.length;y<C;y++){k(t(A[y]),B)}}return B}function j(y){return{__type:"filter",id:y.id,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[]}}function i(A){var D=l(A),z=D.transform,C=D.clip,B,y;delete D.clip;if(C&&C[2]!==-1){y=h("clipPath_");B={__type:"clipPath",id:y,children:[{__type:"rect",x:C[0],y:C[1],width:C[2],height:C[3]}]};D["clip-path"]="url(#"+y+")";k(B,D)}if(z){D.transform="matrix("+z.join(",")+")"}return D}function g(A){var B=i(A),E=w(B.fill),F=m(B.fill),y=B.fillOpacity,D=w(B.stroke),z=B.strokeOpacity,C=m(B.stroke);if(y===undefined){y=1}y*=F;if(z===undefined){z=1}z*=C;if(E){B.fill=E}if(y!==1){B["fill-opacity"]=y}if(D){B.stroke=D}if(z!==1){B["stroke-opacity"]=z}if(B.strokeThickness!==undefined){B["stroke-width"]=B.strokeThickness}if(B.strokeLineJoin!==undefined){B["stroke-linejoin"]=B.strokeLineJoin.toLowerCase()}if(B.strokeLineCap!==undefined){B["stroke-linecap"]=B.strokeLineCap.toLowerCase()}if(B.strokeMiterLimit!==undefined){B["stroke-miter-limit"]=B.strokeMiterLimit}delete B.strokeOpacity;delete B.fillOpacity;delete B.strokeThickness;delete B.strokeLineJoin;delete B.strokeLineCap;delete B.strokeMiterLimit;return B}u={radialGradient:n,linearGradient:n,pattern:function(y){var z={__type:"pattern",id:y.id,patternUnits:"userSpaceOnUse",width:y.width,height:y.height,children:[]};k({__type:"use","xlink:href":y.src,width:y.width,height:y.height},z);return z},blur:function(y){var z=j(y);k({__type:"feGaussianBlur","in":"SourceGraphic",stdDeviation:x(y.radius)},z);return z},dropShadow:function(F){var y=j(F),B,z,D,G,E,A,C;z={__type:"feComponentTransfer","in":"SourceAlpha",result:"compTransfer"};k(z,y);B=r(F.color);k(o("R",0,B[0]/255),z);k(o("G",0,B[1]/255),z);k(o("B",0,B[2]/255),z);k(o("A",F.opacity*B[3]/255,0),z);D={__type:"feGaussianBlur","in":"compTransfer",result:"blur",stdDeviation:x(F.radius)};k(D,y);A=F.angle*Math.PI/180;C=F.offset;G={__type:"feOffset","in":"blur",result:"castShadow",dx:C*Math.cos(A),dy:C*Math.sin(A)};k(G,y);E={__type:"feComposite"};if(F.knockout===true){E["in"]="castShadow";E.in2="SourceGraphic";E.operator="out"}else{E["in"]="SourceGraphic";E.in2="castShadow";E.operator="over"}k(E,y);return y},group:function(A){var B=i(A),z=A.children,y,C;B.__type="g";if(z!==undefined){for(y=0,C=z.length;y<C;y++){k(u[z[y].type](z[y]),B)}}else{B=undefined}return B},ellipse:function(z){var B=g(z),A=B.width,y=B.height;B.rx=A/2;B.ry=y/2;delete B.width;delete B.height;return B},image:function(z){var B=i(z),y,A;y={__type:"use","xlink:href":B.src};B.__type="g";A=z.__node.getLocalBounds();if(B.x!==undefined){y.x=B.x}if(B.y!==undefined){y.y=B.y}if(A){y.width=A.width;y.height=A.height}B.children=[y];delete B.src;delete B.x;delete B.y;delete B.width;delete B.height;return B},imageResource:function(y){return{__type:"symbol",id:y.id,children:[{__type:"image",width:"100%",height:"100%",preserveAspectRatio:"none","xlink:href":y.href}]}},line:g,path:function(z){var A=g(z),y=A.pathCommands;delete A.pathCommands;if(y){A.d=b.graphics.PathCommands.prototype.toString.call(y)}return A},rect:g,text:function(z){var A=g(z),y=b.layoutDir;if(A.fontSize!==undefined){A["font-size"]=A.fontSize}if(A.fontWeight===b.FontWeightEnum.BOLD){A["font-weight"]="bold"}if(A.underline===true){A["text-decoration"]="underline"}delete A.underline;if(A.textAlign!==undefined){A["text-anchor"]=v[y][A.textAlign]}if(A.textValue!==undefined){k(A.textValue,A);delete A.textValue}if(A.fontFamily!==undefined){A["font-family"]=A.fontFamily}A.direction=(y===b.RTL)?"rtl":"ltr";A["unicode-bidi"]="embed";delete A.fontSize;delete A.fontWeight;delete A.textAlign;delete A.fontFamily;return A},textBlock:function(B){var y=(B.x!==undefined)?B.x:0,D,A,F,C,E,z;delete B.textValue;delete B.x;delete B.y;C=B.__node.convertToText();F=C.length;if(F===1){D=u.text(B);D.__type="text";D.x=y;D.y=C[0]._style.y;k(C[0]._style.textValue,D)}else{if(f.noTspan===true){D={__type:"g"};if(B.transform){D.transform="matrix("+B.transform.join(",")+")";delete B.transform}for(A=0;A<F;A++){E=C[A];z=u.text(B);z.__type="text";z.x=E._style.x;z.y=E._style.y;k(E._style.textValue,z);k(z,D)}}else{D=u.text(B);D.__type="text";for(A=0;A<F;A++){E=C[A];z={__type:"tspan",x:y,y:E._style.y};k(E._style.textValue,z);k(z,D)}}}return D}};b.declare({name:"oui.io.svg.SVGExporter",membersDef:{init:function(){},snapshotNodes:function(A,D,y,z,C){var B=new b.io.JSONExporter().snapshotNodes(A,D,y,z);s={};f={noTspan:C};return this._toSVG(B)},_getSVGBoilerPlate:function(){return{__type:"svg",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",stroke:"none",fill:"black","fill-rule":"evenodd","font-size":12,"font-family":"Verdana","text-anchor":v[b.layoutDir].LINE_BEGIN,children:[{__type:"style",type:"text/css",children:["text {stroke: none;}"]}]}},_toSVG:function(I){var H=I.viewBox,C,G,B=I.resources,z=I.content.children,D,A=z?z.length:0,y,F,E;E=this._getSVGBoilerPlate();E.width=I.width;E.height=I.height;E.viewBox=H.join(" ");C={__type:"defs"};E.children.push(C);for(G in B){if(B.hasOwnProperty(G)===true){F=B[G];for(y in F){if(F.hasOwnProperty(y)){F[y].id=y;this._toSVGNode(F[y],C)}}}}for(D=0;D<A;D++){this._toSVGNode(z[D],E)}return E},_toSVGNode:function(z,y){var A=u[z.type];if(A){k(A(z),y)}}}})}());(function(){var j,o="px",e=[1,0,0,1,0,0];function p(q){c.warn("WARN__IO__HTML_FAIL",q.hasOwnProperty("type")?q.type:q)}function f(q){return q?q.y:0}function h(q){return q.substring(0,7)}function i(r){var q=r;if(r&&r.charAt(0)==="#"){q=h(r)}return q}function n(r,q){if(r){if(!q.children){q.children=[]}q.children.push(r)}}function m(r){var s={},q;for(q in r){if(r.hasOwnProperty(q)===true&&q!=="children"&&q!=="type"&&q!=="__node"){s[q]=r[q]}}if(r.hasOwnProperty("type")===true){s.__type=r.type}s.__style={};return s}function l(D){var F=D.stops,v,s,r="",B,t="",z="to ",y,x,E,A,u,w,C,G,q;if(F&&F.length>1){for(v=0,s=F.length;v<s;v++){B=F[v];r+=B.origColor.toString()+" "+Math.round(B.offset*100)+"%";if(v<s-1){r+=", "}}x="background-image: ";E=");";if(D.type==="linearGradient"){A="linear-gradient(";if(D.x1<D.x2){t+="left";z+="right";C=F[0].color;G=F[s-1].color;q=1}else{if(D.x1>D.x2){t+="right";z+="left";C=F[s-1].color;G=F[0].color;q=1}}if(D.y1<D.y2){t+=" top";z+=" bottom";C=F[0].color;G=F[s-1].color;q=0}else{if(D.y1>D.y2){t+=" bottom";z+=" top";C=F[s-1].color;G=F[0].color;q=0}}}else{A="radial-gradient(";t="center, ellipse cover";z="ellipse at center";C=F[0].color;G=F[s-1].color;q=1}w="progid:DXImageTransform.Microsoft.gradient(";u=A+t+", "+r+E;y=x+"-webkit-"+u;y+=x+"-moz-"+u;y+=x+"-ms-"+u;y+=x+"-o-"+u;y+='-ms-filter: "'+w+"startColorstr='"+h(C)+"', endColorstr='"+h(G)+"', GradientType="+q+')";';y+="filter: "+w+"startColorstr='"+h(C)+"', endColorstr='"+h(G)+"', GradientType="+q+E;y+=x+A+z+", "+r+E}else{y="background-color: black;"}return"."+D.id+"{"+y+"}"}function k(r){var t=m(r),q=t.transform,s=t.clip;t["class"]="ouiNodes";delete t.clip;if(s&&s[2]!==-1){p("clip")}if(q){t.__style.left=q[4]+o;t.__style.top=q[5]+o}delete t.transform;return t}function g(q){var r=k(q),t,s;if(q.htmlExportClassName){r["class"]+=" "+q.htmlExportClassName}else{t=i(r.fill);if(t){if(t.indexOf("url(#")===0){r["class"]+=" "+t.substring(5,t.length-1)}else{if(q.type==="text"||q.type==="textBlock"){r.__style.color=t}else{r.__style["background-color"]=t}}}if(r.fillOpacity){p("fill-opacity")}s=i(r.stroke);if(s){r.__style["border-color"]=s}if(r.strokeOpacity){p("stroke-opacity")}if(r.strokeThickness!==undefined){r.__style["border-width"]=r.strokeThickness}if(r.strokeLineJoin!==undefined){p("stroke-linejoin")}if(r.strokeLineCap!==undefined){p("stroke-linecap")}if(r.strokeMiterLimit!==undefined){p("stroke-miterlimit")}}delete r.htmlExportClassName;delete r.fill;delete r.stroke;delete r.strokeOpacity;delete r.fillOpacity;delete r.strokeThickness;delete r.strokeLineJoin;delete r.strokeLineCap;delete r.strokeMiterLimit;return r}j={radialGradient:l,linearGradient:l,pattern:function(r){var q="."+r.id+"{ ",s=r.origSrc;if(b.resourcesManager.hasResource(s)){q+="background-image: url("+b.resourcesManager._getBase64Data(s)+");"}else{p(r)}q+=" }";return q},blur:p,dropShadow:p,group:function(s){var t=k(s),r=s.children,q,u;t.__type="div";if(r!==undefined){for(q=0,u=r.length;q<u;q++){n(j[r[q].type](r[q]),t)}}else{t=undefined}return t},ellipse:p,image:function(r){var s=k(r),q=r.transform||e;s.__type="img";s.src=r.__node.toDataURL();if(s.width){s.__style.width=s.width+o}if(s.height){s.__style.height=s.height+o}if(s.x){s.__style.left=(s.x+q[4])+o}if(s.y){s.__style.top=(s.y+q[5])+o}delete s.x;delete s.y;delete s.width;delete s.height;return s},imageResource:function(){},line:g,path:p,rect:function(r){var s=g(r),q=r.transform||e;s.__type="div";s.__style.overflow="hidden";if(s.width){s.__style.width=s.width+o}if(s.height){s.__style.height=s.height+o}if(s.x){s.__style.left=(s.x+q[4])+o}if(s.y){s.__style.top=(s.y+q[5])+o}delete s.width;delete s.height;delete s.x;delete s.y;return s},text:function(t){var v=g(t),s=b.layoutDir,r=t.transform||e,u=t.__node._getBBoxImpl(),q=(v.x!==undefined)?v.x:0,w=f(u);v.__type="div";v.__style["white-space"]="pre";q+=r[4];if(s===b.RTL&&u){q-=u.width}if(q){v.__style.left=q+o}if(w){v.__style.top=(w+r[5])+o}if(v.fontFamily!==undefined){v.__style["font-family"]=v.fontFamily}if(v.fontSize!==undefined){v.__style["font-size"]=v.fontSize+o}if(v.fontWeight===b.FontWeightEnum.BOLD){v.__style["font-weight"]="bold"}if(v.underline===true){v.__style["text-decoration"]="underline"}if(v.textAlign!==undefined){p("textAlign")}if(v.textValue!==undefined){n(v.textValue,v)}v.dir=(s===b.RTL)?"rtl":"ltr";delete v.x;delete v.y;delete v.fontFamily;delete v.fontSize;delete v.fontWeight;delete v.underline;delete v.textAlign;delete v.textValue;return v},textBlock:function(B){var A=(B.x!==undefined)?B.x:0,w,s,y,u,z,v,r,q=B.transform||e,C;delete B.textValue;delete B.x;delete B.y;z=B.__node.convertToText();u=z.length;if(u===1){w=j.text(B);s=z[0]._getBBoxImpl();A+=q[4];if(b.layoutDir===b.RTL&&s){A-=s.width}w.__style.left=A+o;w.__style.top=(f(s)+q[5])+o;n(z[0]._style.textValue,w)}else{w={__type:"div",__style:{position:"absolute"}};w.__style.left=q[4]+o;w.__style.top=q[5]+o;for(y=0;y<u;y++){v=z[y];C=j.text(B);r=v._getBBoxImpl();C.__style.left=v._style.x+o;C.__style.top=f(r)+o;n(v._style.textValue,C);n(C,w)}}return w}};b.declare({name:"oui.io.html.HTMLExporter",membersDef:{init:function(){},snapshotNodes:function(s,u,q,r){var t=new b.io.JSONExporter().snapshotNodes(s,u,q,r);return this._toHTML(t)},_getHTMLBoilerPlate:function(){return{__type:"div",__style:{"font-size":12,"font-family":"Verdana"},children:[{__type:"style",type:"text/css",children:[".ouiNodes { position: absolute; left: 0px; }"]}]}},_toHTML:function(A){var v,z,u=A.resources,s=A.content.children,w,t=s?s.length:0,q,y,x;x=this._getHTMLBoilerPlate();x.__style={width:A.width+o,height:A.height+o,position:"relative"};x.dir=(b.layoutDir===b.RTL)?"rtl":"ltr";v={__type:"style",type:"text/css"};x.children.push(v);for(z in u){if(u.hasOwnProperty(z)===true){y=u[z];for(q in y){if(y.hasOwnProperty(q)){y[q].id=q;this._toHTMLNode(y[q],v)}}}}for(w=0;w<t;w++){this._toHTMLNode(s[w],x)}return x},_toHTMLNode:function(r,q){var s=j[r.type];if(s){n(s(r),q)}}}})}());(function(){function e(j,f,i){if(j){if(f===undefined){c.info(i?"INFO__I18N__MISSING":"INFO__I18N__INVALID",i)}else{var g,h;for(g in f){if(f.hasOwnProperty(g)&&f[g]){h=i?i+"."+g:g;if(!j[g]){c.info("INFO__I18N__UNSUPP",h)}else{if(b.isA(j[g],String)){j[g]=f[g]}else{e(j[g],f[g],h)}}}}for(g in j){if(j.hasOwnProperty(g)&&(!f.hasOwnProperty(g)||f[g]===undefined)){h=i?i+"."+g:g;c.info("INFO__I18N__MISSING",h)}}}}}b.addI18nSupport=function(g,f){g.Resources=f;g.prototype.Resources=f;g.updateResources=function(h){var j=this.Resources,i=this.prototype;if(i!==undefined&&i.Resources!==undefined){j=i.Resources}if(h!==undefined){e(j,h)}}}}());(function(){b.ns("oui.net");b.mixin(b.net,{goToURL:function(e,f){c.warn("WARN__NET__UNSUPP")}})}());return b}ouilib={createLiveGraphics:function(b,d){var c={};c.aboutInfo="FortKnox1.0#8348/Canvas (c)2008-2014, Oracle Corp.";if(d!==undefined&&d!==null){c.config=d;if(d.name&&c.aboutInfo){c.aboutInfo=d.name+" _ "+c.aboutInfo}}a(c);c.setUp(b);return c}}}());/*!
 * 
 * OracleMaps HTML5 API
 */
(function(h,f){var e={version:"12.2.1.1.0",build:"elocation_12c_1"};
e.$=e.$||jQuery;e.RTree=e.RTree||RTree;e.Hammer=e.Hammer||Hammer;e.layer=e.layer||{};e.filter=e.filter||{};
e.style=e.style||{};e.util=e.util||{};e.proj=e.proj||{};e.event=e.event||{};e.geometry=e.geometry||{};
e.universe=e.universe||{};e.visualfilter=e.visualfilter||{};e.infowindow=e.infowindow||{};e.tool=e.tool||{};
e.control=e.control||{};e.template=e.template||{};e.lbs=e.lbs||{};e.edit=e.edit||{};e.server=e.server||{};
e.Class=e.Class||function(){};(function(){if(e.Class.extend){return;}var s=false;e.Class.extend=function(v){var y=this.prototype;
s=true;var x=new this();s=false;if(v.mixin){e.util.MiscUtil.mixin(x,v.mixin);delete v.mixin;}var z=null,u=null;
for(var t in v){z=v[t];u=y[t];if(typeof z==="function"&&typeof u==="function"&&z!==u){z.base=u;}x[t]=z;
}function w(){if(!s&&this.initialize){this.initialize.apply(this,arguments);}}w.prototype=x;w.prototype.constructor=w;
w.extend=arguments.callee;return w;};}());e.setJQuery=function(s){e.$=s;};e.setRTree=function(s){e.RTree=s;
};e.setHammer=function(s){e.Hammer=s;};e.notNull=function(s){return(typeof s!=="undefined")&&(s!==null);
};e.isNotNull=e.notNull;e.isNull=function(s){return(typeof s==="undefined")||(s===null);};e.isUndefined=e.isNull;
(function(u){var s=navigator.userAgent.toLowerCase(),A=/webkit/.test(s),t=typeof orientation!=="undefined"?true:false,v=/android/.test(s),x=/chrome/.test(s),y=/firefox/.test(s),B=/(mozilla)(?:.*? rv:([\w.]+))?/.test(s),w=/(opera)(?:.*version)?[ \/]([\w.]+)/.test(s),z=/(msie) ([\w.]+)/.test(s);
u.browser={msie:z,msie6:z&&!h.XMLHttpRequest,mozilla:B,webkit:A,safari:A,firefox:y,webkit3d:A&&("WebKitCSSMatrix" in h)&&("m11" in new h.WebKitCSSMatrix()),chrome:x,gecko:s.indexOf("gecko")!==-1,opera:w,android:v,mobileWebkit:t&&A,mobileOpera:t&&w,mobile:t,touchSupported:("ontouchstart" in h)||h.DocumentTouch&&document instanceof DocumentTouch};
if(u.browser.android){u.browser.androidVersion=parseFloat((s.match(/.+(?:android)[\/: ]([\d.]+)/)||[0,0])[1]);
}})(e);e.MapContext=function(u){var t=u.getMapContextToken();var s={getUniverse:function(){return t.universe;
},getPreviousZoomLevel:function(){return t.previousZoomLevel;},getZoomLevel:function(){return t.zoomLevel;
},getPreviousCenterPoint:function(){return t.previousCenterPoint;},getCenterPoint:function(){return t.centerPoint;
},getTransform:function(){if(!t.transform){var A=t.universe.getZoomLevels()[t.zoomLevel];var v=this.getDeviceWidth()*A.resolution;
var z=this.getDeviceHeight()*A.resolution*A.stretchRatio;var x={x:t.centerPoint.getX()-v/2,y:t.centerPoint.getY()-z/2,w:v,h:z};
var y={x:0,y:0,w:this.getDeviceWidth(),h:this.getDeviceHeight()};t.transform=new e.util.ScreenTransform(x,y);
}return t.transform;},getDeviceWindow:function(){return t.deviceWindow;},getDeviceWidth:function(){return t.deviceWindow.w;
},getDeviceHeight:function(){return t.deviceWindow.h;},getQueryWindow:function(){var w=t.universe.getZoomLevels()[t.zoomLevel];
var A=t.centerPoint.getX();var y=t.centerPoint.getY();var v=A-t.deviceWindow.w*w.resolution/2;var z=A+t.deviceWindow.w*w.resolution/2;
var B=y-t.deviceWindow.h*w.resolution*w.stretchRatio/2;var x=y+t.deviceWindow.h*w.resolution*w.stretchRatio/2;
return new e.geometry.Rectangle(v,B,z,x,t.universe.getSRID());},getGraphics:function(){return t.graphics;
},getRoundMapCenterPoint:function(){return t.roundMapCenterPoint;},getWholeMapNum:function(){var w=t.universe.getZoomLevels()[t.zoomLevel];
var A=t.centerPoint.getX();var B=t.universe.getMapBounds().getWidth();var x=t.xRatio;var z=A-t.deviceWindow.w*x*w.resolution/2-B/2;
var v=A+t.deviceWindow.w*x*w.resolution/2+B/2;var D=Math.ceil((-z-B/2)/B);var C=Math.ceil((v-B/2)/B);
var y=D+C+1;if(u.wraparound===false){y=1;}return y;},getBaseWholeMapIndex:function(){var A=t.universe.getZoomLevels()[t.zoomLevel];
var C=t.centerPoint.getX();var w=t.universe.getMapBounds().getWidth();var z=t.xRatio;var v=C-t.deviceWindow.w*z*A.resolution/2-w/2;
var y=this.getWholeMapNum();var x;for(var B=0;B<y;B++){if((v+w*B)>=-w/2&&(v+w*B)<=w/2){x=B;}}if(y==1){x=0;
}return x;}};return s;};e.Messages={};e.Messages.getErrorMessage=function(t){var u=e.Messages;var s=u[t];
if(s){return t+": "+s;}else{return t;}};e.Messages.getString=function(u){var t=e.Messages;var s=t[u];
if(s){return s;}else{return u;}};e.Messages.fetched=false;e.Messages.timeoutCount=0;e.$.i18n.map.MAPVIEWER_9001="Map tile layer not found. Check map tile layer name and/or data source name.";
e.$.i18n.map.MAPVIEWER_9002="Register theme failed.";e.$.i18n.map.MAPVIEWER_9003="Error when loading Nokia map lib.";
e.$.i18n.map.MAPVIEWER_9004="Please provide TomTom map API key.";e.$.i18n.map.MAPVIEWER_9005="Feature ID is already used, please pick a new ID.";
e.$.i18n.map.MAPVIEWER_9006="Error occurred when sending request to data server.";e.$.i18n.map.MAPVIEWER_9007="Cannot get data from data server.";
e.$.i18n.map.MAPVIEWER_9008="Error occurred when getting RSS feed";e.$.i18n.map.MAPVIEWER_9009="Error occurred when sending request to map cache server.";
e.$.i18n.map.MAPVIEWER_9010="Unsupported editing geometry.";e.$.i18n.map.MAPVIEWER_9011="A line needs at least 2 shape points.";
e.$.i18n.map.MAPVIEWER_9012="A polygon needs at least 3 shape points.";e.$.i18n.map.MAPVIEWER_9013="Error occurred when parsing JSON format data.";
e.$.i18n.map.MAPVIEWER_9014="Error occurred when sending HTTP request.";e.$.i18n.map.MAPVIEWER_9015="Not a valid line or polygon type.";
e.$.i18n.map.MAPVIEWER_9016="Error occurred when calculating length in server side.";e.$.i18n.map.MAPVIEWER_9017="Not a geodetic point.";
e.$.i18n.map.MAPVIEWER_9018="One or more parameter is missing or invalid.";e.$.i18n.map.MAPVIEWER_9019="Geometry SRID is null.";
e.$.i18n.map.MAPVIEWER_9020="Invalid URL.";e.$.i18n.map.MAPVIEWER_9021="Cannot undo.";e.$.i18n.map.MAPVIEWER_9022="Cannot redo.";
e.$.i18n.map.MAPVIEWER_9023="Cannot load style.";e.$.i18n.map.MAPVIEWER_9024="Either a base marker or a set of marker styles must be specified.";
e.$.i18n.map.MAPVIEWER_9025="Must specify either a baseColor or a pair of fromColor and toColor.";e.$.i18n.map.MAPVIEWER_9026="Invalid classification specified.";
e.$.i18n.map.MAPVIEWER_9027="Generating buckets.";e.$.i18n.map.MAPVIEWER_9028="Buckets exist, but classification is not 'custom'.";
e.$.i18n.map.MAPVIEWER_9029="No styles found in the options.";e.$.i18n.map.MAPVIEWER_9030="Styles and buckets must be arrays of the same length.";
e.$.i18n.map.MAPVIEWER_9031="Cannot switch tile layer.";e.$.i18n.map.MAPVIEWER_9032="Error when calling event listener.";
e.$.i18n.map.MAPVIEWER_9033="SRID is different.";e.$.i18n.map.MAPVIEWER_9034="No valid URL in selected text.";
e.$.i18n.map.MAPVIEWER_9036="A subclass must implement the method: start";e.$.i18n.map.MAPVIEWER_9037="A subclass must implement the method: clear";
e.$.i18n.map.MAPVIEWER_9038="Please select exactly one polygon feature first.";e.$.i18n.map.MAPVIEWER_9039="Invalid zoom level number.";
e.$.i18n.map.MAPVIEWER_9040="You are running in SVG mode. To get map image, please include canvg.js(http://code.google.com/p/canvg/), or switch to canvas mode.";
e.$.i18n.map.MAPVIEWER_9041="localStorage is not supported in your browser.";e.$.i18n.map.MAPVIEWER_9042="Must specify style attributes for bucket style.";
e.$.i18n.map.MAPVIEWER_9043="Cannot load NSDP data from the specified URL.";e.$.i18n.map.MAPVIEWER_9044="Cannot find the tiles folder. ";
e.$.i18n.map.MAPVIEWER_9045="The end point should not be the same with the start point.";e.$.i18n.map.MAPVIEWER_9046="Not a valid geometry for this method.";
e.$.i18n.map.MAPVIEWER_9047="Error occurred when calculating area in server side.";e.$.i18n.map.MAPVIEWER_9048="Toolbar ID is already used, please pick a new ID.";
e.$.i18n.map.MAPVIEWER_9049="Cannot load bounding box from vector layer.";e.$.i18n.map.MAPVIEWER_9050="Invalid map container div";
e.$.i18n.map.MAPVIEWER_WB_TTILE="Add Text";e.$.i18n.map.MAPVIEWER_WB_TEXT="Text";e.$.i18n.map.MAPVIEWER_WB_X="Orientation value X axis";
e.$.i18n.map.MAPVIEWER_WB_Y="Y axis";e.$.i18n.map.MAPVIEWER_WB_BOLD="Bold";e.$.i18n.map.MAPVIEWER_WB_ITALIC="Italic";
e.$.i18n.map.MAPVIEWER_WB_ALIGN_LEFT="left align format";e.$.i18n.map.MAPVIEWER_WB_ALIGN_CENTER="center align format";
e.$.i18n.map.MAPVIEWER_WB_ALIGN_RIGHT="right align format";e.$.i18n.map.MAPVIEWER_WB_VALIGN_TOP="top align vertical format";
e.$.i18n.map.MAPVIEWER_WB_VALIGN_CENTER="center align vertical format";e.$.i18n.map.MAPVIEWER_WB_VALIGN_BOTTOM="bottom align vertical format";
e.$.i18n.map.MAPVIEWER_WB_OK="OK";e.$.i18n.map.MAPVIEWER_WB_PREVIEW="Preview";e.$.i18n.map.MAPVIEWER_LC_TITLE="Vector layer list";
e.$.i18n.map.MAPVIEWER_TB_TIP_CLEAR="clear";e.$.i18n.map.MAPVIEWER_TB_TIP_CIRCLE="circle";e.$.i18n.map.MAPVIEWER_TB_TIP_RECTANGLE="rectangle";
e.$.i18n.map.MAPVIEWER_TB_TIP_REDLINE="redline";e.$.i18n.map.MAPVIEWER_TB_TIP_DISTANCE="distance";e.$.i18n.map.MAPVIEWER_TB_TIP_ZOOM="zoom";
e.$.i18n.map.MAPVIEWER_SB_KILOMETERS="km";e.$.i18n.map.MAPVIEWER_SB_METERS="m";e.$.i18n.map.MAPVIEWER_SB_MILES="mi";
e.$.i18n.map.MAPVIEWER_SB_FEET="ft";e.$.i18n.map.MAPVIEWER_SB_CENTIMETER="cm";e.$.i18n.map.MAPVIEWER_SB_YARD="yd";
e.$.i18n.map.MAPVIEWER_SB_TOTAL_DISTANCE="Total Distance";e.$.i18n.map.MAPVIEWER_SB_SUB_DISTANCE="Sub Distance";
e.CursorTypes={AUTO:"AUTO",MOVE:"MOVE",POINTER:"POINTER",DEFAULT:"DEFAULT",TEXT:"TEXT",WAIT:"WAIT",NONE:"NONE",CUSTOM:"CUSTOM"};
e.LayerTypes={TILE:0,VECTOR:1,EXTERNAL:2,DYNAMIC_TILE:3};e.LineCaps={BUTT:"BUTT",ROUND:"ROUND",SQUARE:"SQUARE"};
e.LineJoins={MITER:"MITER",ROUND:"ROUND",BEVEL:"BEVEL"};e.GeomTypes={POINT:"Point",MULTIPOINT:"MultiPoint",ORIENTEDPOINT:"OrientedPoint",ORIENTEDMULTIPOINT:"OrientedMultiPoint",LINESTRING:"LineString",MULTILINESTRING:"MultiLineString",POLYGON:"Polygon",MULTIPOLYGON:"MultiPolygon",CIRCLE:"Circle",RECTANGLE:"Rectangle",GEOMETRYCOLLECTION:"GeometryCollection"};
e.Text={FONTSTYLE_NORMAL:"NORMAL",FONTSTYLE_ITALIC:"ITALIC",FONTWEIGHT_NORMAL:"NORMAL",FONTWEIGHT_BOLD:"BOLD",HORIZONTALALIGN_LEFT:"LEFT",HORIZONTALALIGN_CENTER:"CENTER",HORIZONTALALIGN_RIGHT:"RIGHT",VERTICALALIGN_TOP:"TOP",VERTICALALIGN_CENTER:"CENTERV",VERTICALALIGN_BOTTOM:"BOTTOM"};
e.PaintTypes={NO_PAINT:0};e.gv=e.gv||{};e.gv.proxyPath="/mapviewer/proxy";e.gv.setProxyPath=function(s){if(s){e.gv.proxyPath=s;
}};e.gv.getProxyPath=function(){return e.gv.proxyPath;};e.gv.proxyEnabled=false;e.gv.enableProxy=function(s){if(s!==null){e.gv.proxyEnabled=s;
}};e.gv.isProxyEnabled=function(){return e.gv.proxyEnabled;};e.gv._baseURL=document.location.protocol+"//"+document.location.host+"/mapviewer";
e.gv.localbaseURL=function(){return e.gv._baseURL;};e.gv.setBaseMapViewerURL=function(s){if(s&&s.indexOf("/mapviewer")&&s.indexOf("http")===0){e.gv._baseURL=s;
}else{}};e.gv.getBaseMapViewerURL=function(){return e.gv._baseURL;};e.gv.defaultDataSource=null;e.gv._resPath=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/images/";
e.gv._cssResPath=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/css/";e.gv.getImgResourcePath=function(){return e.gv._resPath;
};e.gv.resourcePath=e.gv.getImgResourcePath;e.gv.getCSSResourcePath=function(){return e.gv._cssResPath;
};e.gv.cssResourcePath=e.gv.getCSSResourcePath;e.gv.setResourcePath=function(u){if(!u){return;}if(u.indexOf("/",u.length-1)<0){u+="/";
}var s=u+"css/";var t=u+"images/";e.gv._cssResPath=s;e.gv._resPath=t;e.gv.messagePath=u+"messages/";e.control.MapDecoration.setIconsPath();
if(e.tool.WhiteBoardTool){e.tool.WhiteBoardTool.setIconsPath();}};e.gv._secureHttp=document.location.protocol;
if(e.gv._secureHttp==="file:"){e.gv._secureHttp="http:";}e.gv.secureHttp=function(){return e.gv._secureHttp;
};e.gv.setSecureHttp=function(s){if(s){e.gv._secureHttp="https:";}else{e.gv._secureHttp="http:";}};e.gv.useSecureHTTP=function(s){if(s){e.gv._secureHttp="https:";
}else{e.gv._secureHttp="http:";}};e.gv.isSecureHTTPEnabled=function(){return(e.gv._secureHttp==="https:");
};e.gv.CacheConfig=new Array(30);e.gv.infoWindowWidth=180;e.gv.infoWindowHeight=100;e.gv.infoWindowTabsWidth=240;
e.gv.infoWindowTabsHeight=130;e.gv.decorationCollapseButtonSizeTouch=24;e.gv.decorationCollapseButtonSizeNoTouch=18;
e.gv.unitFactors={SQ_MM:0.000001,SQ_KILOMETER:1000000,SQ_CENTIMETER:0.0001,SQ_MILLIMETER:0.000001,SQ_CH:404.6856,SQ_FT:0.09290304,SQ_IN:0.00064516,SQ_LI:0.04046856,SQ_CHAIN:404.6856,SQ_FOOT:0.09290304,SQ_INCH:0.00064516,SQ_LINK:0.04046856,SQ_MILE:2589988,SQ_ROD:25.29285,SQ_SURVEY_FOOT:0.09290341,SQ_YARD:0.8361274,ACRE:4046.856,HECTARE:10000,PERCH:25.29285,ROOD:1011.714,M:1,METER:1,METRE:1,KM:1000,KILOMETER:1000,CM:0.01,CENTIMETER:0.01,MM:0.001,MILLIMETER:0.001,MILE:1609.344,NAUT_MILE:1852,SURVEY_FOOT:0.3048006096012,FOOT:0.3048,"U.S FOOT":0.3048,FEET:0.3048,INCH:0.0254,YARD:0.9144,CHAIN:20.1168,ROD:5.0292,LINK:0.201166195,MOD_USFT:0.304812253,CL_FT:0.304797265,IND_FT:0.304799518,LINK_BEN:0.201167651,LINK_SRS:0.201167651,CHN_BEN:20.1167825,CHN_SRS:20.1167651,IND_YARD:0.914398554,SRS_YARD:0.914398415,FATHOM:1.8288,SQ_M:1,SQ_METER:1,SQ_KM:1000000,SQ_CM:0.0001};
e.gv.toolButtonW=14;e.gv.toolButtonH=14;e.gv.DPI=96;e.gv.getUnitFactor=function(s){if(s){s=s.toUpperCase();
}else{return 0;}if(e.gv.unitFactors[s]){return e.gv.unitFactors[s];}else{return 0;}};e.gv.defaultMarkerStyleWidth=15;
e.gv.defaultMarkerStyleHeight=15;e.gv.defaultMarkerStyle={fill:"#ff2244",stroke:"#ff2244",strokeThickness:1,fillOpacity:0.5};
e.gv.loadingIcon="o_loading.gif";e.gv.defaultTextStyleConfig={fontSize:12,fill:"#ff0000"};e.gv.labelDisplayOrder=["R","L","B","T"];
e.gv.orientedLabelDisplayOrder=["R","L"];e.gv.mapInstanceId=0;e.gv.enableSelfDestroy=true;e.gv.mapInstances=[];
e.gv.mvKeyMap=[];e.gv.clearMapInstanceByDiv=function(t){var y=e.gv.mapInstances;var s=y.length;for(var u=0;
u<s;u++){var w=y[u];if(w&&w.$containerDiv){var x=w.$containerDiv[0];if(x===t){w.destroyMap();}else{var v=false;
while(x&&x.parentNode){x=x.parentNode;if(x===document.body){v=true;break;}}if(!v){w.destroyMap();}}}}};
e.gv.addMapInstance=function(t,s){if(e.gv.enableSelfDestroy){e.gv.clearMapInstanceByDiv(s);}e.gv.mapInstances.push(t);
};e.gv.addCSTransformFunction=function(t,s,u){e.util.CSTransformUtil.addCSTransformFunction(t,s,u);};
e.gv.sridToSRS=function(s){return e.gv.sridToSRSLookupTable[s];};e.gv.sridToSRSLookupTable={"8307":"EPSG:4326","54004":"EPSG:54004","8265":"EPSG:4269","8260":"EPSG:4267","3875":"EPSG:3857","3857":"EPSG:3857"};
e.gv.srs={};e.gv.addSRS=function(w,v,x){e.gv.srs[x]={type:w,unit:v,srid:x};};e.gv.getSRS=function(s){return e.gv.srs[s];
};e.gv.clearAllMapInstance=function(){if(e.notNull(e.gv.mapInstances)){var t=e.gv.mapInstances;while(t.length>0){var s=t.pop();
if(!s.over){s.destroyMap();}}}};e.gv.messagePath="/mapviewer/jslib/v2/messages/";e.gv.msgLoaded=false;
e.gv.loadMessage=function(u){e.gv.msgLoaded=true;var s;var v=["en","zh-CN","ar","cs","da","de","el","es","fi","fr","hu","it","iw","ja","ko","nl","no","pl","pt","pt-BR","ro","ru","sk","sv","th","tr","zh-TW"];
if(e.isNull(u)||u===""){u=h.navigator.languages?h.navigator.languages[0]:null;u=u||h.navigator.language||h.navigator.browserLanguage||h.navigator.userLanguage;
}if(u&&v.indexOf(u)>-1){s=u;}else{if(u&&u.length>2&&v.indexOf(u.substring(0,2))){s=u.substring(0,2);}else{s="en";
}}var t=e.gv.messagePath;if(e.util.HttpRequest.isLocalDomain(t)){e.$.i18n.properties({name:"Messages",path:t,mode:"both",language:s});
}else{if(e.gv.proxyEnabled){t=e.util.HttpRequest.localDomain+e.gv.proxyPath+"?rtarget="+t;e.$.i18n.properties({name:"Messages",path:t,mode:"both",language:s});
}else{e.util.Logger.warning(null,"Cannot load message files from "+t);}}};e.$(h).unload(function(){e.gv.clearAllMapInstance();
});if(e.browser.msie){document.msCSSOMElementFloatMetrics=true;}e.gv.getLabel=function(t,s){var u=e.$.i18n.prop(t);
if(s){u=u.replace(/\s/g,"&nbsp;");}return u;};e.gv.setHttpMethod=function(s){if(s&&s.toUpperCase()==="GET"){e.gv._httpMethod="GET";
}else{e.gv._httpMethod="POST";}};e.gv.setHttpMethod("POST");e.gv.isWin8Touch=false;if(h.navigator.msMaxTouchPoints&&h.navigator.msPointerEnabled){e.gv.isWin8Touch=true;
}e.gv.tabIndexEnabled=true;e.gv.setTabIndexEnabled=function(s){if(s){e.gv.tabIndexEnabled=true;}else{e.gv.tabIndexEnabled=false;
}};e.gv.setLogLevel=function(t){if(e.isNull(t)){return;}t=t.toLowerCase();var s=e.util.Logger.LEVELS[t];
if(e.isNull(s)){e.util.Logger.warning(null,"OM.gv.setLogLevel","Invalid log level specified.");return;
}e.util.Logger.currentLevel=s;if(s>=e.util.Logger.LEVELS.finest){e.util.Logger.DEBUG=false;}};e.gv.showManipulator=true;
e.gv.setShowManipulator=function(s){if(s){e.gv.showManipulator=true;}else{e.gv.showManipulator=false;
}};e.gv.featureDrag=true;e.gv.enableFeatureDragging=function(s){if(s){e.gv.featureDrag=true;}else{e.gv.featureDrag=false;
}};e.gv.featureDragDisabled=function(t){var s=(t.geo.type==="Point"||t.geo.type==="OrientedPoint");return(e.isNull(t.parentFeature)&&!s&&!e.gv.featureDrag);
};e.gv.internalLayersEnabled=true;e.gv.useRTree=false;e.gv.setUseRTree=function(s){if(s){e.gv.useRTree=s;
}};e.gv.getUseRTree=function(){return e.gv.useRTree;};e.gv.allowFeaturePointsInteraction=true;e.gv.MAX_ZOOM="MAX_ZOOM";
e.gv.MID_ZOOM="MID_ZOOM";e.gv.pointZoomLevel=e.gv.MID_ZOOM;e.Graphics=function(t){this.div=t;var s=e.$(this.div);
this.width=s.width();this.height=s.height();this.oui=ouilib.createLiveGraphics(this.div,{defaultViewportWidth:this.width,defaultViewportHeight:this.height,frameRate:60});
this.oui.tooltipManager._properties.cursorOffset=10;this.oui.tooltipManager._properties.dismissDelay=5000;
this.oui.tooltipManager.setHideDelay(0);this.setDefaultTooltipStyle();};e.Graphics.EVENT_CLICK="click";
e.Graphics.EVENT_DOUBLE_CLICK="doubleClick";e.Graphics.EVENT_MOUSE_DOWN="mouseDown";e.Graphics.EVENT_MOUSE_UP="mouseUp";
e.Graphics.EVENT_MOUSE_OVER="mouseOver";e.Graphics.EVENT_MOUSE_OUT="mouseOut";e.Graphics.EVENT_MOUSE_LEAVE="mouseLeave";
e.Graphics.EVENT_MOUSE_MOVE="mouseMove";e.Graphics.EVENT_MOUSE_DRAG="drag";e.Graphics.TYPE_GROUP=1;e.Graphics.TYPE_IMAGE=2;
e.Graphics.TYPE_IMAGE_MARKER=3;e.Graphics.TYPE_SIMPLE_VECTOR_MARKER=4;e.Graphics.TYPE_COMPOUND_VECTOR_MARKER=5;
e.Graphics.TYPE_PATH=6;e.Graphics.TYPE_RECTANGLE=7;e.Graphics.TYPE_ELLIPSE=8;e.Graphics.prototype.createGroup=function(s){var t=new this.oui.graphics.Group(s);
t.vtype=e.Graphics.TYPE_GROUP;return t;};e.Graphics.prototype.setTooltipStyle=function(s){this.oui.tooltipManager.applyStyle(s);
};e.Graphics.prototype.getTooltipManager=function(){return this.oui.tooltipManager;};e.Graphics.prototype.setDefaultTooltipStyle=function(){var v=new e.style.Text({styleName:"title",fill:"#000000",fontStyle:e.Text.FONTSTYLE_NORMAL,fontWeight:e.Text.FONTWEIGHT_BOLD,fontFamily:"Helvetica Neue",fontSize:11,hAlign:0,vAlign:0.5});
var u=new e.style.Text({styleName:"header",fill:"#B5B5B5",fontStyle:e.Text.FONTSTYLE_NORMAL,fontFamily:"Helvetica Neue",fontSize:10,hAlign:1,vAlign:0.5});
var t=new e.style.Text({styleName:"txt",fill:"#000000",fontStyle:e.Text.FONTSTYLE_NORMAL,fontFamily:"Helvetica Neue",fontSize:10,hAlign:0,vAlign:0.5});
var s={top:9,lineBegin:9,bottom:9,lineEnd:9};this.defaultTooltipStyle={background:this.oui.WHITE,border:{stroke:"#3B3B3B",rx:0,ry:0,thickness:4},text:{fill:this.oui.BLACK,fontSize:11},shadow:this.getGraphicFilter({type:"DROPSHADOW",offset:5})};
this.currentTooltipStyle={titleStyle:v,headerStyle:u,contentStyle:t,padding:s};this.setTooltipStyle(this.defaultTooltipStyle);
};e.Graphics.prototype.getInnerTooltipStyle=function(){return this.currentTooltipStyle;};e.Graphics.prototype.storeCustomTooltipTextStyle=function(s){if(e.notNull(s)){if(e.notNull(s.titleStyle)&&Object.getOwnPropertyNames(s.titleStyle).length>0){this.currentTooltipStyle.titleStyle=s.titleStyle;
}if(e.notNull(s.headerStyle)&&Object.getOwnPropertyNames(s.headerStyle).length>0){this.currentTooltipStyle.headerStyle=s.headerStyle;
}if(e.notNull(s.contentStyle)&&Object.getOwnPropertyNames(s.contentStyle).length>0){this.currentTooltipStyle.contentStyle=s.contentStyle;
}}};e.Graphics.prototype.addGroup=function(t,s){if(e.notNull(s)){s.appendChild(t);}else{this.oui.rootNode.appendChild(t);
}};e.Graphics.prototype.setCursor=function(t,u){if(e.notNull(this.oui.tree.canvas)){var s=this.oui.tree.canvas,v="AUTO";
while(t&&v==="AUTO"){v=u;t=t.parentNode;}s.style.cursor=(typeof u==="object"?"none":v);}else{if(e.notNull(this.oui.tree.svgNode)){this.oui.tree.svgNode.attr("cursor",typeof u==="object"?"none":u);
}}};e.Graphics.prototype.drawImage=function(t,w,v){if(!t){return null;}var y=v.group;if(!y){y=this.oui.rootNode;
}this.setId(y,v);w.x=t.x;w.y=t.y;if(w.width&&w.height){w.preserveAspectRatio=true;}if(v&&v.angle){var s=t.x+w.width/2;
var z=t.y+w.height/2;var u=(new this.oui.geom.Matrix()).rotate(v.angle,s,z);w.transform=u;}var x=new this.oui.graphics.Image(w);
y.appendChild(x);x.vtype=e.Graphics.TYPE_IMAGE;return x;};e.Graphics.prototype.drawImageMarker=function(s,v,u){var t;
if(u.xOffset){s.x+=u.xOffset;}if(u.yOffset){s.y+=u.yOffset;}if(v&&v.src){if(v.width){s.x-=v.width/2;}if(v.height){s.y-=v.height/2;
}t=this.drawImage(s,v,u);return t;}else{return null;}};e.Graphics.prototype.drawVectorMarker=function(D,s,F){if(F.xOffset){D.x+=F.xOffset;
}if(F.yOffset){D.y+=F.yOffset;}if(F.width){D.x-=F.width/2;}if(F.height){D.y-=F.height/2;}F.transform=(new this.oui.geom.Matrix()).translate(D.x,D.y);
var E=F.xScale?F.xScale:1;var v=F.yScale?F.yScale:1;if(E!=1||v!=1){F.transform=F.transform.scale(E,v);
}if(F.angle){var y=F.width/2/E;var x=F.height/2/v;F.transform.rotate(F.angle,y,x);}if(s&&s.length>0){var A;
var t;var B=F.group;if(s.length>=1){F.group=this.createGroup({transform:F.transform});F.transform=null;
}var w=null;for(var z=0;z<s.length;z++){A=s[z].shape;t=s[z].style;t.transform=F.transform;if(!t.fill){t.fill="#ffffff";
t.fillOpacity=0;}if(e.notNull(F.gradient)){t.fill=F.gradient;}var C=A.type;if(C=="path"){w=this.drawPath(A.coords,t,F);
}else{if(C=="rectangle"){w=this.drawRectangle(A,t,F);}else{w=this.drawEllipse(A,t,F);}}}if(B==F.group){w.vtype=e.Graphics.TYPE_SIMPLE_VECTOR_MARKER;
return w;}else{this.addGroup(F.group,B);F.group.vtype=e.Graphics.TYPE_COMPOUND_VECTOR_MARKER;var u=F.group;
F.group=B;return u;}}else{return null;}};e.Graphics.prototype.drawRectangle=function(u,t,s){if(!u||e.isNull(u.x)||e.isNull(u.y)||e.isNull(u.width)&&e.isNull(u.rx)||e.isNull(u.height)&&e.isNull(u.ry)){return null;
}var w=s.group;if(!w){w=this.oui.rootNode;}this.setId(w,s);if(e.isNull(t.fill)){t.fill=this.oui.NO_PAINT;
}t.x=u.x;t.y=u.y;if(e.notNull(u.width)){t.width=u.width;}if(e.notNull(u.rx)){t.rx=u.rx;}if(e.notNull(u.height)){t.height=u.height;
}if(e.notNull(u.ry)){t.ry=u.ry;}var v=new this.oui.graphics.Rectangle(t);v.vtype=e.Graphics.TYPE_RECTANGLE;
w.appendChild(v);return v;};e.Graphics.prototype.drawEllipse=function(v,u,s){if(!v||e.isNull(v.cx)||e.isNull(v.cy)||e.isNull(v.width)||e.isNull(v.height)){return null;
}var y=s.group;if(!y){y=this.oui.rootNode;}this.setId(y,s);if(e.isNull(u.fill)){u.fill=this.oui.NO_PAINT;
}u.cx=v.cx;u.cy=v.cy;u.width=v.width;u.height=v.height;var x=new this.oui.graphics.Ellipse(u);x.vtype=e.Graphics.TYPE_ELLIPSE;
y.appendChild(x);if(e.notNull(u.inset)){var w=e.isNull(u.insetThickness)?1.25/s.xScale:u.insetThickness;
var z=e.isNull(u.strokeThickness)?1.75/s.xScale:u.strokeThickness;var t={fill:this.oui.NO_PAINT,cx:v.cx,cy:v.cy,width:v.width-z*2-w,height:v.height-z*2-w,stroke:u.inset,strokeThickness:w};
x=new this.oui.graphics.Ellipse(t);x.vtype=e.Graphics.TYPE_ELLIPSE;y.appendChild(x);}return x;};e.Graphics.prototype.drawPath=function(t,w,u){var z=new this.oui.graphics.PathCommands();
for(var v=0,s=t.length;v<s;v++){this.drawSegment(z,t[v],u);}var y=u.group;if(!y){y=this.oui.rootNode;
}this.setId(y,u);if(e.isNull(w.fill)){w.fill=this.oui.NO_PAINT;}w.pathCommands=z;var x=new this.oui.graphics.Path(w);
y.appendChild(x);x.vtype=e.Graphics.TYPE_PATH;return x;};e.Graphics.prototype.drawText=function(t,s){var u=s.group;
if(!u){u=this.oui.rootNode;}var v=new this.oui.graphics.Text(t);u.appendChild(v);v.vtype="TEXT";return v;
};e.Graphics.prototype.attachEventListener=function(s,t,u){if(e.isNull(u)){u=this.oui.rootNode;}u.addEventListener(s,t);
};e.Graphics.prototype.detachEventListener=function(s,t,u){if(e.isNull(u)){u=this.oui.rootNode;}u.removeEventListener(s,t);
};e.Graphics.prototype.getLeftTop=function(s){return s.getTranslation();};e.Graphics.prototype.setLeftTop=function(u,t,s){return u.setTranslation(t,s);
};e.Graphics.prototype.setImageMarker=function(x,t,v){if(v){if(t){var s=x.getWidth();var u=x.getHeight();
if(v.width){s=v.width;}if(v.height){u=v.height;}v.x=t.x-s/2;v.y=t.y-u/2;}else{if(v.width){v.x=x.getX()-(v.width-x.getWidth())/2;
}if(v.height){v.y=x.getY()-(v.height-x.getHeight())/2;}}x.applyStyle(v);}else{if(t){t.x=t.x-x.getWidth()/2;
t.y=t.y-x.getHeight()/2;x.applyStyle(t);}}};e.Graphics.prototype.setImage=function(u,s,t){if(t){if(s){t.x=s.x;
t.y=s.y;}if(t.width&&t.height){t.preserveAspectRatio=true;}u.applyStyle(t);}else{if(s){u.applyStyle(s);
}}};e.Graphics.prototype.setRectangle=function(u,s,t){if(u.vtype==e.Graphics.TYPE_RECTANGLE){if(t){if(s){t.x=s.x;
t.y=s.y;if(e.notNull(s.width)){t.width=s.width;}else{t.rx=s.rx;}if(e.notNull(s.height)){t.height=s.height;
}else{t.ry=s.ry;}}u.applyStyle(t);}else{u.applyStyle(s);}}};e.Graphics.prototype.setEllipse=function(u,s,t){if(u.vtype===e.Graphics.TYPE_ELLIPSE){if(t){if(s){if(e.notNull(s.cx)){t.cx=s.cx;
}if(e.notNull(s.cy)){t.cy=s.cy;}if(e.notNull(s.width)){t.width=s.width;}if(e.notNull(s.height)){t.height=s.height;
}}u.applyStyle(t);}else{if(s){u.applyStyle(s);}}}};e.Graphics.prototype.setPath=function(w,t,v){if(w.vtype===e.Graphics.TYPE_PATH){var x=null;
if(t){x=new this.oui.graphics.PathCommands();for(var u=0,s=t.length;u<s;u++){this.drawSegment(x,t[u]);
}}if(v){v.pathCommands=x;w.applyStyle(v);}else{if(x){w.applyStyle({pathCommands:x});}}}};e.Graphics.prototype.remove=function(s){if(s&&s.parentNode){s.parentNode.removeChild(s);
}};e.Graphics.prototype.removeAll=function(){this.oui.rootNode.removeChildren();};e.Graphics.prototype.bringForward=function(s){s.bringForward();
};e.Graphics.prototype.bringToTop=function(s){s.bringToFront();};e.Graphics.prototype.sendBackward=function(s){s.sendBackward();
};e.Graphics.prototype.sendToBottom=function(s){s.sendToBack();};e.Graphics.prototype.getDisplayIndex=function(s){if(s.parentNode){return s.parentNode.getChildIndex(s);
}else{return -1;}};e.Graphics.prototype.setDisplayIndex=function(t,s){if(t.parentNode){t.parentNode.setChildIndex(t,s);
}};e.Graphics.prototype.applyStyle=function(t,s){t.applyStyle(s);};e.Graphics.prototype.drawSegment=function(w,v,t){if(!v||!v.length||v.length<2){return;
}if(isNaN(v[0])||isNaN(v[1])){return;}if(t&&t.scTransform){if(!t.genThreshold){t.genThreshold=1;}this.drawSegmentWithTransform(w,v,t);
return;}w._safeMoveTo(Math.round(v[0]),Math.round(v[1]));for(var u=2,s=v.length;u<s;u+=2){w._safeLineTo(Math.round(v[u]),Math.round(v[u+1]));
}if(v[0]==v[s-2]&&v[1]==v[s-1]){w.closePath();}};e.Graphics.prototype.drawSegmentWithTransform=function(G,A,I){var v=I.scTransform;
var s=v.transformPoint(A[0],A[1]);var u=s.x,t=s.y;G._safeMoveTo(Math.round(s.x),Math.round(s.y));var z=I.genThreshold;
for(var w=2,B=A.length-2;w<B;w+=2){s=v.transformPoint(A[w],A[w+1]);var F=Math.round(s.x),D=Math.round(s.y);
var E=F-u,C=D-t;if(E>z||E<-z||C>z||C<-z){continue;}else{G._safeLineTo(F,D);}}s=v.transformPoint(A[B-2],A[B-1]);
G._safeLineTo(Math.round(s.x),Math.round(s.y));};e.Graphics.prototype.setId=function(t,s){if(e.isNull(s.id)){s.id=t.length;
}if(s.id){s.name="path_"+s.id;}else{s.name="path_"+t.length;}};e.Graphics.prototype.setImageStyleLocation=function(t,s){t.x=s.x;
t.y=s.y;if(t.width&&t.height){t.preserveAspectRatio=true;}};e.Graphics.prototype.setImageStyle=function(s){if(s.width&&s.height){s.preserveAspectRatio=true;
}};e.Graphics.prototype.zoom=function(u,s){u.curScaleX=s.beginValue;u.curScaleY=s.beginValue;u.zoomPointXOffset=s.zoomPointXOffset;
u.zoomPointYOffset=s.zoomPointYOffset;var t=new this.oui.anim.AnimateStyle({targetNode:u,beginValue:s.beginValue,endValue:s.endValue,dur:s.duration,interpolator:function(G,E,v){var A=(E-G)*v+G;
var z=1,w=1;var F=0,D=0;if(e.notNull(s.zoomPointXOffset)){var C=u.zoomPointXOffset/A*u.curScaleX;F=-C+u.zoomPointXOffset;
z=A/u.curScaleX;}if(e.notNull(s.zoomPointYOffset)){var B=u.zoomPointYOffset/A*u.curScaleY;D=-B+u.zoomPointYOffset;
w=A/u.curScaleX;}u.scale(z,w);u.translate(-F,-D);u.curScaleX=A;u.curScaleY=A;}});if(s.endListener){t.addEventListener(this.oui.EventTypes.END,function(v){s.endListener(v);
});}t.beginAt(0);};e.Graphics.prototype.setVisible=function(s,t){s.setVisibility(t);};e.Graphics.prototype.isVisible=function(s){return s.getVisibility();
};e.Graphics.prototype.clearGroup=function(s){if(s){s.removeChildren();}};e.Graphics.prototype.getGraphicFilter=function(s){if(s&&s.type=="DROPSHADOW"){return new this.oui.filters.DropShadow({opacity:s.opacity,color:s.color,offset:s.offset,radius:s.radius,knockout:s.knockout,angle:s.angle});
}else{if(s&&s.type=="BLUR"){return new this.oui.filters.Blur();}else{if(s&&s.type=="GLOW"){return new this.oui.filters.Glow({color:"#ffff00",strength:10});
}}}};e.Graphics.prototype.setRotationTransform=function(v,u){if(v&&u){if(e.isNull(v.width)){v.width=0;
}if(e.isNull(v.height)){v.height=0;}var s=v.x+v.width/2;var w=v.y+v.height/2;var t=(new this.oui.geom.Matrix()).rotate(u,s,w);
v.transform=t;}return v;};e.Graphics.prototype.getWidthHeight=function(t){if(e.isNull(t)){return null;
}var s=t.getLocalBounds();return{w:s.width,h:s.height};};e.Graphics.prototype.setOpacity=function(t,s){if(t){t.setOpacity(s);
}};e.Graphics.prototype.getTextSize=function(x,v){var t=x.indexOf("\n")>0,s;if(!t){s=this.createTextNode(x,v,0,0);
}else{var w=this.createTextBlock(x,v,0,0);s=w.node;}this.oui.rootNode.appendChild(s);s.setDisplay(false);
var u=this.getWidthHeight(s);this.remove(s);return u;};e.Graphics.prototype.createTextNode=function(u,t,s,v){if(t){return this.oui.load({type:"text",textValue:u,fontFamily:t.fontFamily,fontSize:t.fontSize,fontStyle:t.fontStyle,fontWeight:t.fontWeight,fill:t.fill,x:s,y:v,textAlign:t.textAlign});
}else{return this.oui.load({type:"text",textValue:u,x:s,y:v});}};e.Graphics.prototype.drawPieChart=function(t,z,C,u){if(!t||e.isNull(t.cx)||e.isNull(t.cy)||e.isNull(t.width)||e.isNull(t.height)||e.isNull(z)||z.length===0||e.isNull(C)||C.length!==z.length){return null;
}var G=u.offsetAngle?u.offsetAngle:0;var J=[];J.push(0);var x=0;var w=t.width/2;var v=t.height/2;var y=u.group;
if(!y){y=this.oui.rootNode;}this.setId(y,u);var E=this.createGroup();this.addGroup(E,y);for(var A=0;A<z.length;
A++){x=x+z[A];J.push(x);}for(var D=0;D<z.length;D++){var K=u.orientation&&u.orientation==2?((J[D]/x)*360+G):-((J[D]/x)*360+G);
var I=u.orientation&&u.orientation==2?((J[D+1]/x)*360+G):-((J[D+1]/x)*360+G);var s=Math.round((z[D]/x)*10000)/100+"%";
var F=u.description&&u.description[D]?u.description[D]+" \n value:"+z[D]+" \n percent:"+s:null;var B=this.drawSector(t.cx,t.cy,K,I,w,v,{fill:C[D],stroke:u.stroke,strokeThickness:u.strokeThickness},u.plugable,F);
E.appendChild(B);B.vtype=e.Graphics.TYPE_PATH;}E.applyStyle({filter:u.filter});return E;};e.Graphics.prototype.drawSector=function(y,x,B,v,u,s,t,A,z){if(e.isNull(t.fill)){t.fill=this.oui.NO_PAINT;
}t.cx=y;t.cy=x;t.maxAngle=v;t.minAngle=B;t.minRadius=0;t.maxRadius=u;var w=new this.oui.graphics.DiskSector(t);
if(!A||(A&&A===true)){this.attachEventListener(e.Graphics.EVENT_MOUSE_OVER,function(C){C.target.parentNode.bringToFront();
C.target.bringToFront();C.target.applyStyle({maxRadius:u*1.1});var E=C.target.parentNode.childrenCount;
for(var D=0;D<E;D++){if(C.target.parentNode.getChildAt(D)!==C.target){C.target.parentNode.getChildAt(D).applyStyle({fillOpacity:0.5});
}}},w);this.attachEventListener(e.Graphics.EVENT_MOUSE_OUT,function(C){C.target.applyStyle({maxRadius:u});
var E=C.target.parentNode.childrenCount;for(var D=0;D<E;D++){C.target.parentNode.getChildAt(D).applyStyle({fillOpacity:1});
}},w);w.applyStyle({tooltip:z});}return w;};e.Graphics.prototype.drawBarChart=function(t,B,G,w){if(!t||e.isNull(t.cx)||e.isNull(t.cy)||e.isNull(t.width)||e.isNull(t.height)||e.isNull(B)||B.length===0||e.isNull(G)||G.length!==B.length){return null;
}var z=w.group;if(!z){z=this.oui.rootNode;}this.setId(z,w);var L=this.createGroup();this.addGroup(L,z);
var M=0;var y=0;for(var C=0;C<B.length;C++){y=y+B[C];if(M<B[C]){M=B[C];}}var v=t.width;var D=t.height;
var J=v/B.length;var x;var F=function(N){N.target.parentNode.bringToFront();N.target.bringToFront();N.target.scale(1.1,1.1);
var P=N.target.parentNode.childrenCount;for(var O=0;O<P;O++){if(N.target.parentNode.getChildAt(O)!=N.target){N.target.parentNode.getChildAt(O).applyStyle({fillOpacity:0.4});
}}};var E=function(N){N.target.scale(1/1.1,1/1.1);var P=N.target.parentNode.childrenCount;for(var O=0;
O<P;O++){N.target.parentNode.getChildAt(O).applyStyle({fillOpacity:1});}};for(var I=0;I<B.length;I++){x=D*(B[I]/M);
var u=this.drawRectangle({x:0,y:x<0?0:-x,width:J,height:Math.abs(x)},{fill:G[I],stroke:w.stroke,strokeThickness:w.strokeThickness},{group:L});
u.translate(J*I,0);if(!w.plugable||(w&&w.plugable===true)){this.attachEventListener(e.Graphics.EVENT_MOUSE_OVER,F,u);
this.attachEventListener(e.Graphics.EVENT_MOUSE_OUT,E,u);}var s=Math.round((B[I]/y)*10000)/100+"%";var K=w.description&&w.description[I]?w.description[I]+" \n value:"+B[I]+" \n percent:"+s:null;
u.applyStyle({tooltip:K});}var A=this.getWidthHeight(L);this.setLeftTop(L,t.cx-A.w/2,t.cy+(2*D-A.h)/2);
L.applyStyle({filter:w.filter});return L;};e.Graphics.prototype.getScaleValue=function(u){if(e.isNull(u)){return null;
}var s=u.getTransformMatrix();if(e.isNull(s)){return;}var t=s.exportToJSON();var w=Math.sqrt(t[0]*t[0]+t[1]*t[1]);
var v=Math.sqrt(t[2]*t[2]+t[3]*t[3]);return{scaleX:w,scaleY:v};};e.Graphics.prototype.clearToolTips=function(){this.oui.tooltipManager.hideTooltip();
};e.Graphics.prototype.createTextBlock=function(B,s,w,v,A,z){var C={textValue:B,maxWidth:A,maxLines:z,x:w,y:v,textAlign:e.Text.HORIZONTALALIGN_CENTER};
if(s){C.fontFamily=s.fontFamily;C.fontSize=s.fontSize;C.fontStyle=s.fontStyle;C.fontWeight=s.fontWeight;
C.fill=s.fill;}var u=new this.oui.graphics.TextBlock(C);u.setDisplay(false);this.oui.rootNode.appendChild(u);
var t=u.getLocalBounds();this.remove(u);u.setDisplay(true);return{node:u,w:t.width,h:t.height};};e.Graphics.prototype.cloneText=function(I){if(I.hasChildNodes()){var M=this.createGroup();
for(var K=0;K<I.childrenCount;K++){var D=this.cloneText(I.getChildAt(K));M.appendChild(D);}return M;}var w=I.vtype;
if(w===e.Graphics.TYPE_IMAGE){var L={src:I.src(),x:I.x(),y:I.y(),width:I.width(),height:I.height()};var F=new this.oui.graphics.Image(L);
F.vtype=e.Graphics.TYPE_IMAGE;return F;}try{var E=I.getTextValue();var z=I.getTransform();var C=I.getFontStyle();
var u=I.getFontFamily();var O=I.getFontWeight();var J=I.getFontSize();var B=I.getX();var A=I.getY();var P=I.getFill();
if(!I.getMaxWidth){return this.oui.load({type:"text",textValue:E,fontFamily:u,fontSize:J,fontStyle:C,fontWeight:O,fill:P,transform:z,x:B,y:A});
}else{var s=I.getMaxLines();var G=I.getMaxWidth();var v={textValue:E,maxWidth:G,maxLines:s,x:B,y:A,textAlign:e.Text.HORIZONTALALIGN_CENTER,fontFamily:u,fontSize:J,fontStyle:C,fontWeight:O,fill:P,transform:z};
return new this.oui.graphics.TextBlock(v);}}catch(N){return null;}};e.UndoManager=e.Class.extend({initialize:function(){this.reset();
},reset:function(){this.index=0;this.undoStack=[];},addEdit:function(s){this.undoStack[this.index++]=s;
this.undoStack.splice(this.index);return this.index-1;},undo:function(){try{var u=0;do{var s=this.editToUndo();
s.undo();this.index--;if(s.type){if(s.type===e.UndoManager.ENDBLOCK){u++;}else{if(s.type===e.UndoManager.STARTBLOCK){u--;
}}}}while(u>0);}catch(t){e.util.Logger.alert("MAPVIEWER_9021","OM.UndoManager.undo",t.message);}},redo:function(){try{var u=0;
do{var s=this.editToRedo();s.redo();this.index++;if(s.type){if(s.type===e.UndoManager.ENDBLOCK){u--;}else{if(s.type===e.UndoManager.STARTBLOCK){u++;
}}}}while(u>0);}catch(t){e.util.Logger.alert("MAPVIEWER_9021","OM.UndoManager.redo",t.message);}},editToUndo:function(){return this.undoStack[this.index-1];
},editToRedo:function(){return this.undoStack[this.index];},canUndo:function(){var s=this.editToUndo();
try{return s&&s.canUndo();}catch(t){throw t;}return false;},canRedo:function(){var s=this.editToRedo();
try{return s&&s.canRedo();}catch(t){throw t;}return false;},canUndoOrRedo:function(){return this.canRedo()||this.canUndo();
},trimEdits:function(y,x){y=y||0;x=x||this.undoStack.length;var t=x-y;var s=this.undoStack.splice(y,t);
var u=[];var w=0;for(var v in this.undoStack){u[w++]=this.undoStack[v];}this.undoStack=u;if(this.index>=x){this.index-=t;
}else{if(this.index>=y){this.index=y;}}return s;},getRedoPresentationName:function(){var s=this.editToRedo();
try{return s.getPresentationName();}catch(t){throw t;}return null;},getUndoOrRedoPresentationName:function(){var s=this.getUndoPresentationName();
if(e.isNull(s)){s=this.getRedoPresentationName();}return s;},getUndoPresentationName:function(){var s=this.editToUndo();
try{return s.getPresentationName();}catch(t){throw t;}return null;},startChangeBlock:function(s){s=s||"start change block";
return this.addEdit(new e.UndoManager.SpecialEdit(s,e.UndoManager.STARTBLOCK));},endChangeBlock:function(s){s=s||"end change block";
return this.addEdit(new e.UndoManager.SpecialEdit(s,e.UndoManager.ENDBLOCK));},destroy:function(){this.index=f;
this.undoStack=f;},print:function(){var v="\n";var x="Undo stack:"+v;var s=this.undoStack.length;for(var u=0;
u<s;u++){var w=this.undoStack[u];if(u===this.index){x+=">";}else{x+=" ";}x+="["+u+"] ";try{x+=w.getPresentationName();
}catch(t){x+=t;}x+=v;}return x;}});e.UndoManager.SpecialEdit=e.Class.extend({initialize:function(s,t){this.name=s;
this.type=t;},canUndo:function(){return true;},canRedo:function(){return true;},undo:function(){},redo:function(){},getPresentationName:function(){return this.name;
}});e.UndoManager.STARTBLOCK="START_CHANGE_BLOCK";e.UndoManager.ENDBLOCK="END_CHANGE_BLOCK";e.proj.ProjUtil=e.proj.ProjUtil||{};
e.proj.ProjUtil.EPSLN=1e-10;e.proj.ProjUtil.TWO_PI=Math.PI*2;e.proj.ProjUtil.LONG_MAX=Math.pow(2,32)+1;
e.proj.ProjUtil.DBLLONG=4611686010000000000;e.proj.ProjUtil.RADIAN=Math.PI/180;e.proj.ProjUtil.DEGREE=180/Math.PI;
e.proj.ProjUtil.radians=function(s){return s*e.proj.ProjUtil.RADIAN;};e.proj.ProjUtil.degrees=function(s){return s*e.proj.ProjUtil.DEGREE;
};e.proj.ProjUtil.adjustLon=function(s){while(s<-180){s+=360;}while(s>180){s-=360;}return s;};e.proj.Albers=function(v){this.name=v.name||"ALBERS CONICAL EQUAL-AREA";
var D=e.proj.ProjUtil;var B=D.radians(v.standardParallel_1);var z=D.radians(v.standardParallel_2);var w=D.radians(v.latOrigin);
var x=D.radians(v.lonCenter);var A=v.rMajor||6378206.4;var t=0.5*(Math.sin(B)+Math.sin(z)),y=Math.cos(B),s=y*y+2*t*Math.sin(B),E=Math.sqrt(s-2*t*Math.sin(w))/t;
return{forward:function(G,F){var u=t*(D.radians(G)-x),C=Math.sqrt(s-2*t*Math.sin(D.radians(F)))/t;return{x:(C*Math.sin(u))*A,y:(E-C*Math.cos(u))*A};
},inverse:function(u,J){u=u/A;J=J/A;var C=Math.atan(u/(E-J)),G=Math.sqrt(u*u+Math.pow(E-J,2));var I=D.degrees(x+C/t);
var F=D.degrees(Math.asin((s-G*G*t*t)/(2*t)));return{x:I,y:F};}};};e.proj.ablers_mainland=new e.proj.Albers({standardParallel_1:29.5,standardParallel_2:45.5,lonCenter:-96,latOrigin:23});
e.proj.albers_hawaii=new e.proj.Albers({standardParallel_1:8,standardParallel_2:18,lonCenter:-160,latOrigin:20});
e.proj.albers_hawaii.forward2=function(s){s.x=s.x-1200000;s.y=s.y+400000;return s;};e.proj.albers_hawaii.inverse2=function(s,t){s=s+1200000;
t=t-400000;return{x:s,y:t};};e.proj.albers_alaska=new e.proj.Albers({standardParallel_1:55,standardParallel_2:65,lonCenter:-160,latOrigin:60});
e.proj.albers_alaska.forward2=function(s){s.x=s.x*0.4-2200000;s.y=s.y*0.4+400000;return s;};e.proj.albers_alaska.inverse2=function(s,t){s=(s+2200000)/0.4;
t=(t-400000)/0.4;return{x:s,y:t};};e.proj.albers_puertorico=new e.proj.Albers({standardParallel_1:8,standardParallel_2:18,lonCenter:-60,latOrigin:10});
e.proj.AlbersUSA=(function(){var u=e.proj.albers_alaska;var s=e.proj.albers_hawaii;var t=e.proj.albers_puertorico;
var v=e.proj.ablers_mainland;return{forward:function(z,y){var w=y>50?u:z<-140?s:y<21?t:v;var x=w.forward(z,y);
if(w.forward2){return w.forward2(x);}else{return x;}},inverse:function(w,B){var A=null;var z=(w<-1450000&&B<930000)?u:(w<-650000&&w>-1250000&&B<660000)?s:v;
if(z.inverse2){A=z.inverse2(w,B);return z.inverse(A.x,A.y);}else{return z.inverse(w,B);}}};}());e.proj.Robinson=function(z){var v=e.proj.ProjUtil,s=6378137,y=0.8487*s,x=1.3523*s,t=[[1,0],[0.9986,0.062],[0.9954,0.124],[0.99,0.186],[0.9822,0.248],[0.973,0.31],[0.96,0.372],[0.9427,0.434],[0.9216,0.4958],[0.8962,0.5571],[0.8679,0.6176],[0.835,0.6769],[0.7986,0.7346],[0.7597,0.7903],[0.7186,0.8435],[0.6732,0.8936],[0.6213,0.9394],[0.5722,0.9761],[0.5322,1],[0.5322,1]];
var w=0;try{w=parseInt(z,10)||0;w=v.adjustLon(w);}catch(A){}return{forward:function(F,E){var B,D,C,u;
F=v.adjustLon(F);F=F-w;F=v.adjustLon(F);if(Math.abs(E)>90){E=90*(E>0?1:-1);}B=parseInt(Math.abs(E)/5,10);
D=Math.abs(E)/5-B;F=v.radians(F);E=v.radians(E);C=t[B][0]+D*(t[B+1][0]-t[B][0]);u=t[B][1]+D*(t[B+1][1]-t[B][1]);
C=y*C*F;u=x*u;if(E<0){u=-u;}return{x:C,y:u};},inverse:function(C,G){var D,B,E,u=0,F;if(Math.abs(G)>=x){B=90;
D=t[18][0];}else{B=Math.abs(G/x);for(E=0;E<19;E++){if(t[E+1][1]>B){u=E;break;}}F=(B-t[u][1])/(t[u+1][1]-t[u][1]);
B=(u+F)*5;D=t[u][0]+F*(t[u+1][0]-t[u][0]);}D=v.degrees(C/(D*y))+w;D=v.adjustLon(D);if(G<0){B=-B;}return{x:D,y:B};
}};};e.proj.Winkel3=function(s){var C=e.proj.ProjUtil,z=6378137,A=0.000001,t=Math.PI/2,B=0;try{B=parseInt(s,10)||0;
B=C.adjustLon(B);}catch(y){B=0;}var v=function(u){return u?u/Math.sin(u):1;};var x=function(u){return u>1?0:(u<-1?Math.PI:Math.acos(u));
};var w=function(F,E){var u=Math.cos(E),D=v(x(u*Math.cos(F/=2)));return[2*u*Math.sin(F)*D,Math.sin(E)*D];
};return{forward:function(E,D){E=C.adjustLon(E);E=E-B;E=C.adjustLon(E);E=C.radians(E);D=C.radians(D);
var u=w(E,D);return{x:z*((u[0]+E/t)/2),y:z*((u[1]+D)/2)};},inverse:function(S,P){S/=z;P/=z;var K=S,M=P,ad=25,W=0,O,V;
do{var ae=Math.cos(M),ab=Math.sin(M),T=Math.sin(2*M),aa=ab*ab,R=ae*ae,U=Math.sin(K),L=Math.cos(K/2),Q=Math.sin(K/2),N=Q*Q,Z=1-R*L*L,X=Z?x(ae*L)*Math.sqrt(W=1/Z):W=0,J=0.5*(2*X*ae*Q+K/t)-S,G=0.5*(X*ab+M)-P,u=0.5*W*(R*N+X*ae*L*aa)+0.5/t,I=W*(U*T/4-X*ab*Q),Y=0.125*W*(T*Q-X*ab*R*U),ac=0.5*W*(aa*L+X*N*ae)+0.5,D=I*Y-ac*u;
O=(G*I-J*ac)/D;V=(J*Y-G*u)/D;K=K-O;M=M-V;}while((Math.abs(O)>A||Math.abs(V)>A)&&--ad>0);K=C.degrees(K)+B;
K=C.adjustLon(K);M=C.degrees(M);return{x:K,y:M};}};};e.util.Logger=e.util.Logger||{};e.util.Logger.LEVELS={finest:0,finer:1,fine:2,info:3,config:4,warning:5,severe:6};
e.util.Logger.currentLevel=e.util.Logger.LEVELS.warning;e.util.Logger.DEBUG=(typeof console!=="undefined"&&typeof(console.time)!=="undefined");
e.util.Logger.NO_ALERT_BOX=false;e.util.Logger._log=function(s){if(typeof console==="object"){console.log(s);
}else{if(typeof opera==="object"){opera.postError(s);}else{if(typeof java==="object"&&typeof java.lang==="object"){java.lang.System.out.println(s);
}}}};e.util.Logger.finest=function(u,s,t){if(e.util.Logger.LEVELS.finest>=e.util.Logger.currentLevel){e.util.Logger._log("[FINEST]  "+e.util.Logger._mix(u,s,t));
}};e.util.Logger.finer=function(u,s,t){if(e.util.Logger.LEVELS.finer>=e.util.Logger.currentLevel){e.util.Logger._log("[FINER]  "+e.util.Logger._mix(u,s,t));
}};e.util.Logger.fine=function(u,s,t){if(e.util.Logger.LEVELS.fine>=e.util.Logger.currentLevel){e.util.Logger._log("[FINE]  "+e.util.Logger._mix(u,s,t));
}};e.util.Logger.info=function(u,s,t){if(e.util.Logger.LEVELS.info>=e.util.Logger.currentLevel){e.util.Logger._log("[INFO]  "+e.util.Logger._mix(u,s,t));
}};e.util.Logger.config=function(u,s,t){if(e.util.Logger.LEVELS.config>=e.util.Logger.currentLevel){e.util.Logger._log("[CONFIG]  "+e.util.Logger._mix(u,s,t));
}};e.util.Logger.warning=function(u,s,t){if(e.util.Logger.LEVELS.warning>=e.util.Logger.currentLevel){e.util.Logger._log("[WARNING]  "+e.util.Logger._mix(u,s,t));
}};e.util.Logger.severe=function(u,s,t){if(e.util.Logger.LEVELS.severe>=e.util.Logger.currentLevel){e.util.Logger._log("[SEVERE]  "+e.util.Logger._mix(u,s,t));
}};e.util.Logger.alert=function(v,t,u){var s=e.util.Logger._mix(v,t,u);e.util.Logger._log("[ALERT]  "+s);
if(e.util.Logger.errorHandler){e.util.Logger.errorHandler(s);}else{if(!e.util.Logger.NO_ALERT_BOX){alert(s);
}}};e.util.Logger.throwErr=function(w,t,v){var s=e.util.Logger._mix(w,t,v);var u=new Error(s);if(u.stack){e.util.Logger.warning(w,t,u.stack);
}throw u;};e.util.Logger._mix=function(v,t,u){var s=null;if(v){s=e.$.i18n.prop(v);if(s=="["+v+"]"){s=e.Messages.getErrorMessage(v);
}else{s=v+":"+s;}}if(t){if(s){s+="\n    "+e.Messages.getString("Source")+": "+t;}else{s=e.Messages.getString("Source")+": "+t;
}}if(u){if(s){s+="\n    "+u;}else{s=u;}}return s;};e.util.ScreenTransform=function(t,s){this.dw=t;this.sw=s;
this.sx=s.w/t.w;this.sy=-s.h/t.h;this.tx=-t.x*this.sx+s.x;this.ty=-t.y*this.sy+s.y+s.h;this.xtr=t.w/s.w;
this.ytr=t.h/s.h;this.rsx=1/this.sx;this.rsy=1/this.sy;this.rtx=-s.x*this.rsx+t.x;this.rty=-s.y*this.rsy+t.y+t.h;
};e.util.ScreenTransform.prototype.toScreenPoint=function(s,u){var t={};t.x=Math.round(s*this.sx+this.tx);
t.y=Math.round(u*this.sy+this.ty);return t;};e.util.ScreenTransform.prototype.toMapDataPoint=function(s,u){var t={};
t.x=s*this.rsx+this.rtx;t.y=u*this.rsy+this.rty;return t;};e.util.ScreenTransform.prototype.toScreenXLength=function(s){return s*this.sx;
};e.util.ScreenTransform.prototype.toScreenYLength=function(s){return -s*this.sy;};e.util.ScreenTransform.prototype.transformSegment=function(C,z,u){if(e.isNull(u)){u=2;
}if(!C.length||C.length<=2){return null;}var E=z*this.xtr;var v=z*this.ytr;var F=[];var D=C[0],B=C[1];
var t=D,s=B;D=Math.round(D*this.sx+this.tx);B=Math.round(B*this.sy+this.ty);F.push(D);F.push(B);for(var w=u,A=C.length;
w<A;w+=u){D=C[w];B=C[w+1];if(Math.abs(D-t)>E||Math.abs(B-s)>v){t=D;s=B;D=Math.round(D*this.sx+this.tx);
B=Math.round(B*this.sy+this.ty);F.push(D,B);}}if(F.length<=2){return null;}else{if(C[0]===C[A-2]&&C[1]===C[A-1]&&(F[0]!==F[F.length-2]||F[1]!==F[F.length-1])){F.push(F[0],F[1]);
}return F;}};e.util.ScreenTransform.getScreenCoordinates=function(z,A,w,u,t,v,F,D,B){var E=(D-A)*v/(u-A)-z.divLeft;
var C=(t-B)*F/(t-w)-z.divTop;var s={x:E,y:C};return s;};e.util.ScreenTransform.prototype.toHeatMapPoint=function(t,z,s,w,v){var u={};
u.x=Math.round((t*this.sx+this.tx-s)/v);u.y=Math.round((z*this.sy+this.ty-w)/v);return u;};e.util.ScreenTransform.prototype.transformHeatMapSegment=function(G,C,z,w,u,v){if(e.isNull(z)){z=2;
}if(!G.length||G.length<=2){return null;}var I=C*this.xtr;var A=C*this.ytr;var J=[];var F=G[0],E=G[1];
var t=F,s=E;F=Math.round((F*this.sx+this.tx-w)/v);E=Math.round((E*this.sy+this.ty-u)/v);J.push(F);J.push(E);
for(var B=z,D=G.length;B<D;B+=z){F=G[B];E=G[B+1];if(Math.abs(F-t)>I||Math.abs(E-s)>A){t=F;s=E;F=Math.round(F*this.sx+this.tx);
E=Math.round(E*this.sy+this.ty);J.push((F-w)/v,(E-u)/v);}}if(J.length<=2){return null;}else{if(G[0]===G[D-2]&&G[1]===G[D-1]&&(J[0]!==J[J.length-2]||J[1]!==J[J.length-1])){J.push(J[0],J[1]);
}return J;}};e.util.GeomUtil=e.util.GeomUtil||{};e.util.GeomUtil.earthRadius=6372795;e.util.GeomUtil.distance=function(t,v,s,u){return Math.sqrt(Math.pow(s-t,2)+Math.pow(u-v,2));
};e.util.GeomUtil.pointLineDistance=function(B,v,t,C,s,z){var A=C-z,w=s-t,u=t*z-C*s;return Math.abs(A*B+w*v+u)/Math.sqrt(A*A+w*w);
};e.util.GeomUtil.pointSegmentDistance=function(C,A,u,D,s,B){var z=e.util.GeomUtil.distance(C,A,u,D);
var w=e.util.GeomUtil.distance(C,A,s,B);var v=e.util.GeomUtil.distance(u,D,s,B);if(v===0){return z;}var E=((C-u)*(s-u)+(A-D)*(B-D))/(v*v);
if(E<0||E>1){return Math.min(z,w);}else{return e.util.GeomUtil.pointLineDistance(C,A,u,D,s,B);}};e.util.GeomUtil.pointInRect=function(t,x,u,s,w,v){return(t<=w)&&(t>=u)&&(x<=v)&&(x>=s);
};e.util.GeomUtil.pointInPolygon=function(s,z,t,x,w){var v,u,y=0;for(v=0,u=t-1;v<t;u=v++){if(((w[v]>z)!=(w[u]>z))&&(s<(x[u]-x[v])*(z-w[v])/(w[u]-w[v])+x[v])){y=!y;
}}return y;};e.util.GeomUtil.getPointAtBearing=function(B,A,z,D){var C=e.util.GeomUtil.getRadiansFromLatLon(B,A);
var v=C.x;var t=C.y;var w=z/e.util.GeomUtil.earthRadius;var s=Math.asin(Math.sin(t)*Math.cos(w)+Math.cos(t)*Math.sin(w)*Math.cos(D));
var u=v+Math.atan2(Math.sin(D)*Math.sin(w)*Math.cos(t),Math.cos(w)-Math.sin(t)*Math.sin(s));return e.util.GeomUtil.getLatLonFromRadians(u,s);
};e.util.GeomUtil.getRadiansFromLatLon=function(s,t){while(s<-180){s+=360;}while(s>180){s-=360;}s=s*Math.PI/180;
t=t*Math.PI/180;return{x:s,y:t};};e.util.GeomUtil.getLatLonFromRadians=function(s,t){s=s*180/Math.PI;
t=t*180/Math.PI;return{x:s,y:t};};e.util.GeomUtil.densifyOrdinates=function(v,z){if(!v||v.length<4){return v;
}var s=[];for(var A=0;A<v.length-2;A+=2){var w=v[A];var C=v[A+1];var t=v[A+2];var B=v[A+3];var F=t-w;
var E=B-C;s.push(w);s.push(C);var y=Math.ceil(Math.abs(F)/z);var x=Math.ceil(Math.abs(E)/z);var u=Math.max(y,x);
if(u>0){F=F*1/u;E=E*1/u;for(var D=0;D<u-1;D++){w+=F;C+=E;s.push(w);s.push(C);}}}s.push(v[v.length-2]);
s.push(v[v.length-1]);return s;};e.util.GeomUtil.SimplifyCoordinates=function(v){var t=v.length;var s=v[0];
var z=v[1];var w=new Array(s,z);for(var u=2;u<t;u+=2){if(Math.abs(s-v[u])>=1||(Math.abs(z-v[u+1]))>=1){s=v[u];
z=v[u+1];w.push(s);w.push(z);}}return w;};e.util.GeomUtil.getLength=function(z,D,u){var I=z?z.type:"";
var M=z.srid;var A=null;if(I!=="LineString"&&I!=="MultiLineString"&&I!=="Polygon"&&I!=="MultiPolygon"&&I!=="Rectangle"){e.util.Logger.alert("MAPVIEWER_9015","OM.util.GeomUtil.getLength","");
A=-1;return A;}var O=function(V){var R=0,T=2,S=V.length;if(V&&S>3){for(;T<S;T+=2){var U=V[T]-V[T-2];var W=V[T+1]-V[T-1];
R+=Math.sqrt(U*U+W*W);}return R;}else{return 0;}};var F,E,L,P,N,w;if(u){F=u.idx?u.idx:0;E=u.unit?u.unit:"METER";
L=u.transformToGeodetic;P=u.foiURL;N=u.dataSource?u.dataSource:e.gv.defaultDataSource;if(u.toServerTranform===false){w=false;
}else{w=true;}}if(!M){A=O(z.coordinates);if(D){D(A,F);}return A;}var Q=e.gv.getSRS(M);if(!Q){if(e.util.GeomUtil.isGeo(M)){Q={type:"GEODETIC",distConvFactor:1,maxX:180,maxY:90,minX:-180,minY:-90};
}else{Q={type:"",distConvFactor:1,maxX:180,maxY:90,minX:-180,minY:-90};}}else{if(e.util.GeomUtil.isGeo(M)){Q.type="GEODETIC";
}Q.distConvFactor=e.gv.getUnitFactor(Q.unit);}var s=null;if(L){s=e.util.CSTransformUtil.getCSTransformFunction(M,8307);
}if(!L||e.util.GeomUtil.isGeo(M)||L&&s||e.isNull(N)){var K=0;if(!E){K=1;}else{K=e.gv.getUnitFactor(E);
if(Q.distConvFactor&&!L){K=K/Q.distConvFactor;}}var J=z.coordinates.slice(0);if(s){J=e.util.CSTransformUtil.transformOrdinates(s,J,z.dimension);
}if(K){if(Q&&Q.type!=="GEODETIC"&&!L){A=O(J)/K;}else{A=e.util.GeomUtil.getGreatCircleLength(J)/K;}if(D){D(A,F);
}return A;}}if(e.$("#sub_tr_"+1)&&!s&&L){e.$("#sub_tr_"+1).hide();}var G=z.toString();var B=e.gv.localbaseURL()+"/foi";
var C={request:"getlength",version:1,figord:G};if(E){C.unit=E;}if(L){var v=(L===true)?"yes":"no";C.togeodetic=v;
}if(N){C.datasource=N;}var t=function(R){R=1*R;if(D){D(R,F);}A=R;};try{if(w){e.util.HttpRequest.send(B,C,t,"text");
}}catch(y){var x=(y.stack)?y.message+"\nStack: "+y.stack:y.message;e.util.Logger.alert("MAPVIEWER_9016","OM.util.GeomUtil.getLength",x);
A=-1;}return A;};e.util.GeomUtil.getArea=function(D,z,I){var v=D?D.type:"";if(v!=="Polygon"&&v!=="MultiPolygon"){e.util.Logger.alert("MAPVIEWER_9046","OM.util.GeomUtil.getArea","");
y=-1;return y;}var E,u,F,s;if(I){E=I.unit?I.unit:"SQ_METER";u=I.transformToGeodetic;F=I.foiURL;s=I.dataSource?I.dataSource:e.gv.defaultDataSource;
}var y;var t=D.toString();var x=e.gv.localbaseURL()+"/foi";var C={request:"getarea",version:1,figord:t};
if(E){C.unit=E;}if(u){var G=(u===true)?"yes":"no";C.togeodetic=G;}if(s){C.datasource=s;}var A=function(J){J=1*J;
if(z){z(J);}y=J;};try{e.util.HttpRequest.send(x,C,A,"text");}catch(B){var w=(B.stack)?B.message+"\nStack: "+B.stack:B.message;
e.util.Logger.alert("MAPVIEWER_9047","OM.util.GeomUtil.getArea",w);y=-1;}return y;};e.util.GeomUtil.moveCoordinates=function(E,D,C,u,z){var t=function(J,G,L){if(!J){return;
}var F=J.length;var K=2;if(e.notNull(z)){K=z;}if(u){K+=K;}for(var I=0;I<F;I+=K){J[I]+=G;J[I+1]+=L;}};
var B=e.util.ValidationUtil.isNumberArray;if(B(E)){t(E,D,C);}else{var A=E.length;for(var w=0;w<A;w++){if(B(E[w])){t(E[w],D,C);
}else{var v=E[w].length;for(var s=0;s<v;s++){t(E[w][s],D,C);}}}}};e.util.GeomUtil.moveGeometry=function(z,x,v){var s=z.getOrdinates();
var A=z.getType();var y=z.getDimension();var w,u,t;if(A==="Polygon"||A=="MultiLineString"){for(w=0;w<s.length;
w++){for(u=0;u<s[w].length;u+=y){s[w][u]+=x;s[w][u+1]+=v;}}}else{if(A==="MultiPolygon"){for(u=0;u<s.length;
u++){for(w=0;w<s[u].length;w++){for(t=0;t<s[u][w].length;t+=y){s[u][w][t]+=x;s[u][w][t+1]+=v;}}}}else{if(A==="LineString"){for(w=0;
w<s.length;w++){s[w]+=x;s[w]+=v;}}else{if(A==="Rectangle"){z.move(x,v);}else{throw new Error("Unsupported geometry type:"+A);
}}}}};e.util.GeomUtil.getGreatCircleLength=function(v){var t=0;var u=e.util.GeomUtil;for(var s=0;s<v.length-2;
s+=2){t+=u.getGreatCircleDistance({x:v[s],y:v[s+1]},{x:v[s+2],y:v[s+3]});}return t;};e.util.GeomUtil.getGreatCircleDistance=function(z,x){var u=e.util.GeomUtil;
z=u.getRadiansFromLatLon(z.x,z.y);x=u.getRadiansFromLatLon(x.x,x.y);var v=x.x-z.x;var t=x.y-z.y;var y=Math.sin(t/2);
var s=Math.sin(v/2);var A=y*y+Math.cos(z.y)*Math.cos(x.y)*s*s;var w=2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A));
return w*u.earthRadius;};e.util.GeomUtil.getOGCOrdinateString=function(v,x){var w=2;if(e.notNull(x)){w=x;
}var u=0;var s="";for(;u<v.length;u+=w){if(u>0){s+=" ";}s+=v[u]+","+v[u+1];for(var t=2;t<w;t++){s+=","+v[u+t];
}}return s;};e.util.GeomUtil.getWktCoordinateStringFromPoint=function(v,x){var w=2;if(e.notNull(x)){w=x;
}var u=0;var s="";for(;u<v.length;u+=w){if(u>0){s+=" ";}var t=0;for(;t<w;t++){s+=v[u+t];if(t<w-1){s+=" ";
}}}return s;};e.util.GeomUtil.getWktCoordinateStringFromOrientedPoint=function(v,x){var w=2;if(e.notNull(x)){w=x;
}var u=0;var s="";for(;u<w;u+=w){if(u>0){s+=" ";}var t=0;for(;t<w;t++){s+=v[u+t];if(t<w-1){s+=" ";}}}return s;
};e.util.GeomUtil.getWktCoordinateStringFromLine=function(v,x){var w=2;if(e.notNull(x)){w=x;}var u=0;
var s="";for(;u<v.length;u+=w){if(u>0){s+=" ";}var t=0;for(;t<w;t++){s+=v[u+t];if(t<w-1){s+=" ";}}s+=",";
}return s;};e.util.GeomUtil.getCurrentDistancePerPixelPrivate=function(u){var y=u.getUniverse();var z=u.getZoomLevel();
var v=y.getZoomLevels();var x=v[z];if(e.notNull(x.distancePerPixel)){return x.distancePerPixel;}var t=y.getSRID();
var w=null;if(e.util.GeomUtil.isGeo(t)){var s=111195;w=s*x.resolution;x.distancePerPixel=w;return w;}else{w=x.resolution;
x.distancePerPixel=w;return w;}};e.util.GeomUtil.getCurrentDistancePerPixel=function(u,s){var v=e.util.GeomUtil.getCurrentDistancePerPixelPrivate(u);
if(e.isNull(s)){return v;}else{if(s==="pixel"){v=1;}else{var t=e.gv.getUnitFactor(s);if(t!==0){v/=t;}}}return v;
};e.util.GeomUtil.calculateGreatCircle=function(u,t,K,D){var N=u.clone();var M=t.clone();var x=N.getY()*Math.PI/180;
var L=N.getX()*Math.PI/180;var w=M.getY()*Math.PI/180;var J=M.getX()*Math.PI/180;var C=K;var G=D;var v=[];
var E=0;var B=Math.PI/180;if(Math.abs(J-L)===Math.PI){if(x+w===0){w+=Math.PI/180000000;}}var y=K*Math.PI/180;
D*=Math.PI/180;while(y<=D){var z=Math.atan((Math.sin(x)*Math.cos(w)*Math.sin(y-J)-Math.sin(w)*Math.cos(x)*Math.sin(y-L))/(Math.cos(x)*Math.cos(w)*Math.sin(L-J)));
v[2*E]=y*180/Math.PI;v[2*E+1]=z*180/Math.PI;E++;if(y<D&&(y+B)>=D){y=D;}else{y=y+B;}}var I=[];var F;if(u.getX()>t.getX()&&!(G===180||C===-180)){for(F=0;
F<v.length/2;F++){I[F*2]=v[v.length-F*2-2];I[F*2+1]=v[v.length-F*2-1];}v=I;}if(u.getX()<t.getX()&&(G===180||C===-180)){for(F=0;
F<v.length/2;F++){I[F*2]=v[v.length-F*2-2];I[F*2+1]=v[v.length-F*2-1];}v=I;}var A=new e.geometry.LineString(v,8307);
return A;};e.util.GeomUtil.createGreatCircle=function(x,t){var v=e.util.GeomUtil.isGeo;if(!v(x.srid)||!v(t.srid)){e.util.Logger.alert("MAPVIEWER_9017","OM.util.GeomUtil.getGreatCircle","");
return;}var w=x.getX();var u=t.getX();var s=[];if(w<u&&(u-w)<180){s[0]=e.util.GeomUtil.calculateGreatCircle(x,t,w,u);
return(s[0]);}if(Math.abs(w-u)<180){s[0]=e.util.GeomUtil.calculateGreatCircle(x,t,u,w);return(s[0]);}if(w>u){s[0]=e.util.GeomUtil.calculateGreatCircle(x,t,w,180);
s[1]=e.util.GeomUtil.calculateGreatCircle(x,t,-180,u);return(new e.geometry.MultiLineString([s[0].coordinates,s[1].coordinates],8307));
}else{s[0]=e.util.GeomUtil.calculateGreatCircle(x,t,u,180);s[1]=e.util.GeomUtil.calculateGreatCircle(x,t,-180,w);
return(new e.geometry.MultiLineString([s[0].coordinates,s[1].coordinates],8307));}};e.util.GeomUtil.flatten=function(w,u,s){var t=[];
if(!w){return null;}var y=w.length;var A=0;for(var x=0;x<y;x++){var z=w[x];if(!(z instanceof e.geometry.Geometry)||(z.getType().indexOf(u)<0)){return null;
}var v=z.getSRID();if(!A){A=v;}if(A!==v){return null;}if(s){t.push(z.coordinates);}else{t.push(z.getX());
t.push(z.getY());}}return{ordinates:t,srid:A};};e.util.GeomUtil.getOutCode=function(t,s,u){if(t.minX>s){if(t.minY>u){return 3;
}else{if(t.maxY<u){return 9;}else{return 1;}}}else{if(t.maxX<s){if(t.minY>u){return 6;}else{if(t.maxY<u){return 12;
}else{return 4;}}}else{if(t.minY>u){return 2;}else{if(t.maxY<u){return 8;}else{return 0;}}}}};e.util.GeomUtil.clipLineSegment=function(z,t,E,s,D){var u=e.util.GeomUtil.getOutCode;
var w=u(z,t,E);var v=u(z,s,D);while(true){if((w|v)===0){return{x0:t,y0:E,x1:s,y1:D};}if((w&v)!==0){return null;
}var A=(w!==0)?w:v;var C=null;var B=null;if((A&8)!==0){C=t+(s-t)*(z.maxY-E)/(D-E);B=z.maxY;}else{if((A&2)!==0){C=t+(s-t)*(z.minY-E)/(D-E);
B=z.minY;}else{if((A&4)!==0){C=z.maxX;B=E+(D-E)*(z.maxX-t)/(s-t);}else{C=z.minX;B=E+(D-E)*(z.minX-t)/(s-t);
}}}if(A===w){t=C;E=B;w=u(z,t,E);}else{s=C;D=B;v=u(z,s,D);}}};e.util.GeomUtil.clipLine=function(y,B){var C=[];
e.util.GeomUtil.concatMultiLine(B);for(var t=0,w=B.length;t<w;t++){if(!B[t]||!B[t][0]){continue;}var s=B[t][0];
for(var x=3,z=s.length;x<z;x+=2){var v=e.util.GeomUtil.clipLineSegment(y,s[x-3],s[x-2],s[x-1],s[x]);if(v){var A=C.length-1;
if(A>=0){var u=C[A].length;if(u>1&&v.x0===C[A][u-2]&&v.y0===C[A][u-1]){C[A].push(v.x1,v.y1);continue;
}}C.push([v.x0,v.y0,v.x1,v.y1]);}}}return C;};e.util.GeomUtil.getSegmentLength=function(t,v,s,u){return Math.sqrt((t-s)*(t-s)+(v-u)*(v-u));
};e.util.GeomUtil.getScreenLength=function(v){var t=0;for(var u=0,s=v.length-3;u<s;u+=2){t+=e.util.GeomUtil.getSegmentLength(v[u],v[u+1],v[u+2],v[u+3]);
}return t;};e.util.GeomUtil.getPointByPercent=function(A,y,x){var B=[];var w=e.util.GeomUtil;for(var v=0,u=A.length;
v<u;v++){var t=A[v];var z=w.getScreenLength(t);if(z<x/2){continue;}z*=y;var s=w.getPointByLength(z,t);
if(s){B.push(s);}}return B;};e.util.GeomUtil.getPointByLength=function(B,s){var z=e.util.GeomUtil;for(var w=0,v=s.length-3;
w<v;w+=2){var u=z.getSegmentLength(s[w],s[w+1],s[w+2],s[w+3]);if(u>=B){var t=B/u;var C=(s[w]+(s[w+2]-s[w])*t);
var A=(s[w+1]+(s[w+3]-s[w+1])*t);return({x:C,y:A,pos:w,len:u});}B-=u;}return null;};e.util.GeomUtil.getPoinsByLength=function(t,A,D,B,v,w){var z=e.util.GeomUtil.getSegmentLength(t[A],t[A+1],D,B);
var E=t.length;while(z<v&&A>=2&&A<E-2){if(z>=5){v-=z;}A+=w;z=e.util.GeomUtil.getSegmentLength(t[A],t[A+1],D,B);
}if(z>=v){var s=v/z;var u=(t[A-w]+(t[A]-t[A-w])*s);var C=(t[A+1-w]+(t[A+1]-t[A+1-w])*s);return{x:u,y:C};
}return{x:t[A],y:t[A+1]};};e.util.GeomUtil.getCircle=function(A,K,w,G,u,E){var L=Math.sqrt((A-w)*(A-w)+(K-G)*(K-G));
var I=Math.sqrt((w-u)*(w-u)+(G-E)*(G-E));var D=Math.sqrt((A-u)*(A-u)+(K-E)*(K-E));var z=(L+I+D)/2;var M=Math.sqrt(z*(z-L)*(z-I)*(z-D));
var t=L*I*D/4/M;var J=((A*A-w*w+K*K-G*G)*(K-E)-(A*A-u*u+K*K-E*E)*(K-G))/(2*(K-E)*(A-w)-2*(K-G)*(A-u));
var F=((A*A-w*w+K*K-G*G)*(A-u)-(A*A-u*u+K*K-E*E)*(A-w))/(2*(K-G)*(A-u)-2*(K-E)*(A-w));var B=Math.atan2(K-F,A-J);
if(B<0){B+=Math.PI*2;}var v=Math.atan2(E-F,u-J);if(v<0){v+=Math.PI*2;}var C=Math.atan2(G-F,w-J);if(C<0){C+=Math.PI*2;
}if(B<C&&B>v){v+=Math.PI*2;}else{if(B<C&&C>v){B+=Math.PI*2;}else{if(B>C&&B<v){v-=Math.PI*2;}else{if(B>C&&C<v){B-=Math.PI*2;
}}}}return{x:J,y:F,r:t,sAngle:B,eAngle:v};};e.util.GeomUtil.isGeo=function(s){return(s===8307||s===8265||s===4326||s===4269);
};e.util.GeomUtil.isClockwise=function(s,t){return e.util.GeomUtil.polygonArea(s,t)>=0;};e.util.GeomUtil.polylineLength=function(u,z){var y=u.length/z;
var s=0,x=0,w,t;for(var v=1;v<y;v++){w=v*z;t=x*z;s=s+Math.sqrt((u[w]-u[t])*(u[w]-u[t])+(u[w+1]-u[t+1])*(u[w+1]-u[t+1]));
x=v;}return s;};e.util.GeomUtil.polygonArea=function(w,y){var x=y||2;var v=w.length/x;var t=0,s=v-1,u=0;
for(t=0;t<v;t++){u=u+(w[s*x]+w[t*x])*(w[s*x+1]-w[t*x+1]);s=t;}return u/2;};e.util.GeomUtil.reverseCoordinates=function(u){var t=[];
for(var s=0;s<u.length-1;s+=2){t.unshift(u[s+1]);t.unshift(u[s]);}return t;};e.util.GeomUtil.getTransformedGeometry=function(y,t){var B=[];
var s=y.getOrdinates();var z=y.getType();var v=y.getDimension();var x,w,u;if(z==="Polygon"||z=="MultiLineString"){for(w=0;
w<s.length;w++){x=e.util.GeomUtil.getTransformedCoordinates(s[w],v,t);B[w]=x;}}else{if(z==="MultiPolygon"){for(u=0;
u<s.length;u++){B[u]=[];for(w=0;w<s[u].length;w++){x=e.util.GeomUtil.getTransformedCoordinates(s[u][w],v,t);
B[u][w]=x;}}}else{B=e.util.GeomUtil.getTransformedCoordinates(s,v,t);}}var A;if(z==="Polygon"){A=new e.geometry.Polygon(B,y.srid,y.dim);
}else{if(z==="MultiPolygon"){A=new e.geometry.MultiPolygon(B,y.srid,y.dim);}else{if(z==="LineString"){A=new e.geometry.LineString(B,y.srid,y.dim);
}else{if(z==="MultiLineString"){A=new e.geometry.MultiLineString(B,y.srid,y.dim);}else{throw new Error("Unsupported geometry type:"+z);
}}}}return A;};e.util.GeomUtil.getTransformedCoordinates=function(E,z,s){var I=[];if(z===2){s.transformAll(E,I);
}else{var w=E.length||0,G,D,F,C,B,A,v,u;I=I||E;F=s.a;C=s.b;B=s.c;A=s.d;v=s.tx;u=s.ty;for(w=0;w<E.length;
w+=z){G=E[w];D=E[w+1];I[w]=F*G+B*D+v;I[w+1]=C*G+A*D+u;if(z>2){for(var t=2;t<z;t++){I[w+t]=E[w+t];}}}}return I;
};e.util.GeomUtil.parseGeoJson=function(x){if(!x.type){return null;}var w=x.coordinates?x.coordinates:x.geometries,s=w.length;
var t=Array.prototype.concat;var v;switch(x.type){case"Point":x.dimension=s;return x;case"OrientedPoint":if(typeof w[0]!=="number"){x.coordinates=t.apply([],w);
}x.dimension=s/2;return x;case"MultiPoint":x.dimension=w[0].length;return x;case"OrientedMultiPoint":if(typeof w[0][0]!=="number"){for(v=0;
v<s;v++){x.coordinates[v]=t.apply([],w[v]);}}x.dimension=w[0].length/2;return x;case"LineString":if(typeof w[0]!=="number"){x.dimension=w[0].length;
x.coordinates=t.apply([],w);}return x;case"MultiLineString":for(v=0;v<s;v++){if(typeof w[v][0]!=="number"){x.dimension=w[v][0].length;
x.coordinates[v]=t.apply([],w[v]);}}return x;case"Polygon":for(v=0;v<s;v++){if(typeof w[v][0]!=="number"){x.dimension=w[v][0].length;
x.coordinates[v]=t.apply([],w[v]);}}return x;case"MultiPolygon":for(v=0;v<s;v++){for(var u=0;u<w[v].length;
u++){if(typeof w[v][u][0]!=="number"){x.dimension=w[v][u][0].length;x.coordinates[v][u]=t.apply([],w[v][u]);
}}}return x;case"GeometryCollection":for(v=0;v<s;v++){w[v]=e.util.GeomUtil.parseGeoJson(w[v]);}x.dimension=x.geometries[0].dimension;
return x;case"Circle":x.dimension=2;for(v=0;v<s;v++){if(isNaN(w[v][0])){x.coordinates[v]=w[v];}}return x;
}};e.util.GeomUtil.parseCRSName=function(s){if(s.indexOf("EPSG")>-1){}var u=s.split(":");if(u.length===1){u=s.split(" ");
}for(var t=u.length-1;t>-1;t--){u[t]=u[t].trim();if(u[t]===""){u.splice(t,1);}}for(t=0;t<(u.length-1);
t++){if(u[t].toUpperCase()==="EPSG"){return e.util.GeomUtil.EPSG_SDO_Map[u[t+1]];}}return null;};e.util.GeomUtil.concatMultiLine=function(x){var t=x.length;
for(var s=0,w=t-1;s<w;s++){if(!x[s]||!x[s][0]){continue;}for(var y=s+1;y<t;y++){if(!x[y]||!x[y][0]){continue;
}var v=x[s][0].length,u=x[y][0].length;if(Math.abs(x[s][0][v-2]-x[y][0][0])<3&&Math.abs(x[s][0][v-1]-x[y][0][1])<3){Array.prototype.push.apply(x[s][0],x[y][0]);
x.splice(y,1);t--;w--;y--;}else{if(Math.abs(x[s][0][0]-x[y][0][u-2])<3&&Math.abs(x[s][0][1]-x[y][0][u-1])<3){Array.prototype.push.apply(x[y][0],x[s][0]);
x[s]=x[y];x.splice(y,1);t--;w--;y--;}}}}};e.util.GeomUtil.distanceToSegment=function(w,v,y,x,t,z){var s=[];
var u;if((w-y)*(t-y)+(v-x)*(z-x)<=0){s[0]=Math.sqrt((w-y)*(w-y)+(v-x)*(v-x));s[1]=0;return s;}else{if((w-t)*(y-t)+(v-z)*(x-z)<=0){s[0]=Math.sqrt((w-t)*(w-t)+(v-z)*(v-z));
s[1]=1;return s;}}s[1]=2;u=Math.sqrt((t-y)*(t-y)+(z-x)*(z-x));if(u===0){s[0]=Math.sqrt((w-y)*(w-y)+(v-x)*(v-x));
return s;}s[0]=Math.abs((w-y)*(z-x)-(v-x)*(t-y))/u;return s;};e.util.GeomUtil.getSegmentPoint=function(D,C,K,u,J,t){var E,I;
var F=K;var G=J;var M=u;var s=t;var w=D;var v=C;var B=G-F;var A=s-M;if(B===0){E=F;I=v;}else{if(A===0){E=w;
I=M;}else{var L=A/B;E=(w+L*(v-M)+L*L*F)/(1+L*L);I=(w-E)/L+v;}}var z=[E,I];return z;};e.util.GeomUtil.poinInPolygonGeometry=function(D,s,v){if(e.isNull(D)){return false;
}var C=D.getType();if(C!=="Polygon"){return false;}var x=D.getDimension();var E=D.coordinates.length;
var u=D.coordinates[0].length;var A=[];var y=[];var F=u/x;for(var w=0;w<u;w+=x){A[w/x]=D.coordinates[0][w];
y[w/x]=D.coordinates[0][w+1];}if(e.util.GeomUtil.pointInPolygon(s,v,F,A,y)){var B=false;for(var z=1;z<E;
z++){u=D.coordinates[z].length;A=[];y=[];F=u/x;for(var t=0;t<u;t+=x){A[t/x]=D.coordinates[z][t];y[t/x]=D.coordinates[z][t+1];
}if(e.util.GeomUtil.pointInPolygon(s,v,F,A,y)){B=true;break;}}if(B===false){return true;}}return false;
};e.util.GeomUtil.findGeometryElement=function(C,A,I,J){if(e.isNull(C)){return false;}var t=C.getType();
var G=C.getDimension();var w=-1;var z;var y;var u;var s=Number.MAX_VALUE;var D=C.getOrdinates();switch(t){case"Point":z=C.getX()-A;
y=C.getY()-I;u=Math.sqrt((z*z)+(y*y));if(u<=J){w=0;}break;case"MultiPoint":for(var K=0;K<D.length;K++){z=D[K][0]-A;
y=D[K][1]-I;u=Math.sqrt((z*z)+(y*y));if(u<=J&&u<s){s=u;w=K;}}break;case"OrientedMultiPoint":break;case"LineString":for(var x=0;
x<(D.length-G);x+=G){u=e.util.GeomUtil.distanceToSegment(A,I,D[x],D[x+1],D[x+G],D[x+G+1]);if(u[0]<=J){w=0;
break;}}break;case"MultiLineString":for(var B=0;B<D.length;B++){for(var E=0;E<(D[B].length-G);E+=G){u=e.util.GeomUtil.distanceToSegment(A,I,D[B][E],D[B][E+1],D[B][E+G],D[B][E+G+1]);
if(u[0]<=J&&u[0]<s){w=B;s=u[0];break;}}}break;case"Polygon":if(e.util.GeomUtil.poinInPolygonGeometry(C,A,I)){w=0;
}break;case"MultiPolygon":for(var F=0;F<D.length;F++){var v=new e.geometry.Polygon(D[F],C.getSRID(),C.dim);
if(e.util.GeomUtil.poinInPolygonGeometry(v,A,I)){w=F;break;}}break;case"GeometryCollection":break;default:break;
}return w;};e.util.GeomUtil.removeGeometryElement=function(v,s){if(e.isNull(v)||s<0){return null;}var x=v.getType();
if(x!=="MultiPoint"&&x!=="MultiLineString"&&x!=="OrientedMultiPoint"&&x!=="MultiPolygon"&&x!=="GeometryCollection"){return null;
}var y=v.getDimension();var w=v.getOrdinates();if(e.isNull(w)){return null;}var u=w.length;if(s>=u){return null;
}switch(x){case"MultiPoint":w.splice(s,1);if(u===2){v=new e.geometry.Point(w[0][0],w[0][1],v.getSRID());
if(y>2){for(var t=2;t<y;t++){v.addDimension(w[0][t]);}}}break;case"OrientedMultiPoint":return null;case"MultiLineString":w.splice(s,1);
if(u===2){v=new e.geometry.LineString(w[0],v.getSRID(),y);}break;case"MultiPolygon":w.splice(s,1);if(u===2){v=new e.geometry.Polygon(w[0],v.getSRID(),y);
}break;case"GeometryCollection":return null;default:return null;}v.mbr=null;v.getMBR();return v;};e.util.GeomUtil.cloneGeometryElement=function(A,B){if(e.isNull(A)||B<0){return null;
}var z=A.getType();if(z!=="MultiPoint"&&z!=="MultiLineString"&&z!=="OrientedMultiPoint"&&z!=="MultiPolygon"&&z!=="GeometryCollection"){return null;
}var x=A.getDimension();var v=A.getOrdinates();if(e.isNull(v)){return null;}var t=v.length;if(B>=t){return null;
}var s=null;var y=[];var u=function(D){var E=[];for(var C=0;C<D.length;C++){if(D[C] instanceof Array){E[C]=u(D[C]);
}else{E[C]=D[C];}}return E;};switch(z){case"MultiPoint":s=new e.geometry.Point(v[B][0],v[B][1],A.getSRID());
if(x>2){for(var w=2;w<x;w++){s.addDimension(v[B][w]);}}break;case"OrientedMultiPoint":return null;case"MultiLineString":y=u(v[B]);
s=new e.geometry.LineString(y,A.getSRID(),x);break;case"MultiPolygon":y=u(v[B]);s=new e.geometry.Polygon(y,A.getSRID(),x);
break;case"GeometryCollection":return null;default:return null;}s.mbr=null;s.getMBR();return s;};e.util.GeomUtil.getSquareDistance=function(v,u){var t=v.x-u.x,s=v.y-u.y;
return t*t+s*s;};e.util.GeomUtil.getSquareSegmentDistance=function(A,B,z){var s=B.x,C=B.y,v=z.x-s,u=z.y-C,w;
if(v!==0||u!==0){w=((A.x-s)*v+(A.y-C)*u)/(v*v+u*u);if(w>1){s=z.x;C=z.y;}else{if(w>0){s+=v*w;C+=u*w;}}}v=A.x-s;
u=A.y-C;return v*v+u*u;};e.util.GeomUtil.simplifyRadialDistance=function(x,v){var w,t=x.length,s,u=x[0],y=[u];
for(w=1;w<t;w++){s=x[w];if(this.getSquareDistance(s,u)>v){y.push(s);u=s;}}if(u!==s){y.push(s);}return y;
};e.util.GeomUtil.simplifyDouglasPeucker=function(E,s){var A=E.length;var C=(typeof Uint8Array!==f+"")?Uint8Array:Array;
var u=new C(A);var y=0,D=A-1,w,v,x,z,t=[],B=[],F=[];u[y]=u[D]=1;while(D){v=0;for(w=y+1;w<D;w++){x=this.getSquareSegmentDistance(E[w],E[y],E[D]);
if(x>v){z=w;v=x;}}if(v>s){u[z]=1;t.push(y);B.push(z);t.push(z);B.push(D);}y=t.pop();D=B.pop();}for(w=0;
w<A;w++){if(u[w]){F.push(E[w]);}}return F;};e.util.GeomUtil.simplify=function(u,s){var t=(s!==f)?s*s:1;
u=this.simplifyRadialDistance(u,t);u=this.simplifyDouglasPeucker(u,t);return u;};e.util.GeomUtil.simplifyCoordinates=function(u,s){var t=this.coordinates2points(u);
t=this.simplify(t,s);return this.points2coordinates(t);};e.util.GeomUtil.points2coordinates=function(t){var u=[];
for(var s=0;s<t.length;s++){u.push(t[s].x);u.push(t[s].y);}return u;};e.util.GeomUtil.coordinates2points=function(u){var t=[];
for(var s=0;s<u.length;){t.push({x:u[s],y:u[s+1]});s+=2;}return t;};e.util.GeomUtil.toValidCoordinate=function(w,u){var y=u;
var x=w.getUniverse().getMapBounds();var t=x.getWidth();var s=x.getMinX();var z=x.getMaxX();for(var v=0;
v<u.length;v++){if(u[v*2]<s){y[v*2]=u[v*2]-Math.floor((u[v*2]+t/2)/t)*t;}if(u[v*2]>z){y[v*2]=u[v*2]-Math.ceil((u[v*2]-t/2)/t)*t;
}}return y;};e.util.GeomUtil.screenPointsXOffset=function(t,v,y){var s=y.getUniverse().getMapBounds().getWidth();
var w=y.getBaseWholeMapIndex();var u=y.getUniverse().getZoomLevels()[y.getZoomLevel()].resolution;var z;
if(y.getWholeMapNum()>1){z=t+s*(v-w)/u+(y.getRoundMapCenterPoint().getX()-y.getCenterPoint().getX())/u;
}else{z=t+s*(v-w)/u;}return z;};e.util.GeomUtil.EPSG_SDO_Map={"3857":3857,"3875":3857,"4326":8307,"4269":8265,"4267":8260,"4202":81920,"4203":81921,"20248":81922,"20249":81924,"20250":81926,"20251":81928,"20252":81930,"20253":81932,"20254":81934,"20255":81936,"20256":81938,"20257":81940,"20258":81942,"20348":81923,"20349":81925,"20350":81927,"20351":81929,"20352":81931,"20353":81933,"20354":81935,"20355":81937,"20356":81939,"20357":81941,"20358":81943,"23028":82323,"23029":82328,"23030":82337,"23031":82340,"23032":82343,"23033":82346,"23034":82349,"23035":82352,"23036":82355,"23037":82358,"23038":82361};
e.util.DomUtil=function(){};e.util.DomUtil.css=function(u){var w=document.styleSheets;var y={};for(var s in w){try{var x=w[s].rules||w[s].cssRules;
for(var t in x){if(u.is(x[t].selectorText)){e.$.extend(y,e.util.DomUtil.css2json(x[t].style));}}}catch(v){}}e.$.extend(y,e.util.DomUtil.css2json(u.attr("style")));
return y;};e.util.DomUtil.css2json=function(v){var w={};if(!v){return w;}var u;if(v instanceof CSSStyleDeclaration){for(u in v){if((v[u]).toLowerCase){w[(v[u]).toLowerCase()]=(v[v[u]]);
}}}else{if(typeof v=="string"){v=v.split(";");for(u in v){var t=v[u].split(":");w[t[0].toLowerCase()]=(t[1]);
}}}return w;};e.util.DomUtil.getComputedStyle=function(y){var t;var A={};if(h.getComputedStyle){var w=function(D,C){return C.toUpperCase();
};t=h.getComputedStyle(y,null);for(var z=0,x=t.length;z<x;z++){var s=t[z];var B=s.replace(/\-([a-z])/g,w);
var v=t.getPropertyValue(s);A[B]=v;}}else{if(y.currentStyle){t=y.currentStyle;for(var u in t){A[u]=t[u];
}}}return A;};e.util.DomUtil.setImageSrc=function(u,v,s){var t=e.$(u);if(v){t.css("opacity",s);t.attr("src",v);
}else{t.attr("src",e.util.MiscUtil.transparentImgURL);}t[0].onerror=function(){t.attr("src",e.gv.resourcePath()+"blank.gif");
e.util.Logger.warning("","OM.util.DomUtil.setImageSrc","Failed fetching image from: "+v);};};e.util.DomUtil.changeOpacity=function(u,s){var t=e.$(u);
t.css("opacity",s);};e.util.DomUtil.pixel=function(s){return Math.round(s)+"px";};e.util.DomUtil.createImageNode=function(u,t){var s=null;
s=document.createElement("img");s.src=u;if(e.browser.msie&&!t){s.galleryImg="no";}if(e.browser.mozilla){s.style.MozUserSelect="none";
}else{if(e.browser.safari){s.style.KhtmlUserSelect="none";}else{if(e.browser.msie){s.unselectable="on";
}}}return s;};e.util.DomUtil.FigLayer=function(u,t,w,x,y,v){var z=null;var s=e.util.DomUtil;z=document.createElement("img");
z.src=u;if(t&&w){z.style.width=s.pixel(t);z.style.height=s.pixel(w);z.width=t;z.height=w;}if(y||(x||(y===0||x===0))){z.style.position="absolute";
z.style.left=s.pixel(x);z.style.top=s.pixel(y);}if(v||v===0){z.style.zIndex=v;}z.style.MozUserSelect="none";
z.style.border="0";z.style.padding="0";z.style.margin="0";z.oncontextmenu=s.falseFunc;return z;};e.util.DomUtil.setCursor=function(s,t){try{if(t.indexOf(".")>-1){t='url("'+t+'"),auto';
}s.style.cursor=t;}catch(u){if(t=="pointer"){e.util.DomUtil.setCursor(s,"hand");}}};e.util.DomUtil.falseFunc=function(){return false;
};e.util.DomUtil.strEndWith=function(t,s){return t.substring(t.length-s.length,t.length)==s;};e.util.DomUtil.getTouchCount=function(s){if(s.originalEvent){s=s.originalEvent;
}if(s.type.toUpperCase()=="TOUCHSTART"){return s.touches.length;}else{if(s.type.toUpperCase()=="TOUCHEND"){return s.changedTouches.length;
}}};e.util.DomUtil.getTouchesPosition=function(w){if(w.originalEvent){w=w.originalEvent;}if(w.touches){var u=w.touches.length;
var t=[];for(var v=0;v<u;v++){var s=w.touches[v].pageX;var z=w.touches[v].pageY;t.push({x:s,y:z});}if(t.length==1){return t[0];
}else{return t;}}return[];};e.util.DomUtil.getTouchesClientPosition=function(w){if(w.originalEvent){w=w.originalEvent;
}if(w.touches){var u=w.touches.length;var t=[];for(var v=0;v<u;v++){var s=w.touches[v].clientX;var z=w.touches[v].clientY;
t.push({x:s,y:z});}if(t.length===1){return t[0];}else{return t;}}return[];};e.util.DomUtil.getChangedTouchesPosition=function(w){if(w.originalEvent){w=w.originalEvent;
}if(w.changedTouches){var u=w.changedTouches.length;var t=[];for(var v=0;v<u;v++){var s=w.changedTouches[v].pageX;
var z=w.changedTouches[v].pageY;t.push({x:s,y:z});}return t;}else{return[];}};e.util.DomUtil.getTouchesScale=function(s){if(s.originalEvent){s=s.originalEvent;
}return s.scale;};e.util.DomUtil.getElementPos=function(s){if(!s){return;}return s.position();};e.util.DomUtil.getPageDirection=function(w){this.$div=e.$("<div style='position:absolute;width:0px;height:0px;z-index:3000'></div>");
w.$fixedLayerDIV.append(this.$div);var v=document.createElement("table");var t=document.createElement("tr");
var s=document.createElement("td");var y=document.createElement("td");var u=document.createElement("tbody");
v.cellSpacing=0;v.cellPadding=0;s.innerHTML="fsdfsds";y.innerHTML="p";u.appendChild(t);v.appendChild(u);
t.appendChild(s);t.appendChild(y);this.$div[0].appendChild(v);var x=s.offsetLeft;if(x===0){this.pageDirection=true;
}else{this.pageDirection=false;}this.$div[0].removeChild(v);this.$div.remove();return this.pageDirection;
};e.util.DomUtil.isHtml=function(s){if(s.indexOf("<!DOCTYPE")>=0){return true;}if(s.toUpperCase().indexOf("<HTML")>=0){return true;
}if(s.toUpperCase().indexOf("<BODY")>=0){return true;}if(s.toUpperCase().indexOf("<IMG")>=0){return true;
}if(s.toUpperCase().indexOf("<DIV")>=0){return true;}if(s.toUpperCase().indexOf("<P>")>=0){return true;
}if(s.toUpperCase().indexOf("<BR")>=0){return true;}if(s.toUpperCase().indexOf("<A")>=0){return true;
}if(s.toUpperCase().indexOf("<TABLE")>=0){return true;}if(s.toUpperCase().indexOf("<TEXTAREA")>=0){return true;
}if(s.toUpperCase().indexOf("<INPUT")>=0){return true;}if(s.toUpperCase().indexOf("<FONT")>=0){return true;
}if(s.toUpperCase().indexOf("<AREA")>=0){return true;}if(s.toUpperCase().indexOf("<LABEL")>=0){return true;
}if(s.toUpperCase().indexOf("<TD")>=0){return true;}if(s.toUpperCase().indexOf("<SPAN")>=0){return true;
}else{return false;}};e.util.DomUtil.setFontIcon=function(v,s,t){if(!v){return;}var u=e.$(v);u.attr("omv2-font-icon",s);
if(e.notNull(t)){u.css("color",t);}return u;};e.util.XMLUtil={};e.util.XMLUtil.parse=typeof h.DOMParser!=="undefined"?function(s){var t=new DOMParser();
return t.parseFromString(s,"text/xml");}:function(t){var s=new ActiveXObject("Microsoft.XMLDOM");s.async="false";
s.loadXML(t);return s;};e.util.XMLUtil.xmlToString=typeof XMLSerializer!=="undefined"?function(t){var u=new XMLSerializer();
return u.serializeToString(t);}:function(s){return s.xml;};e.util.ValidationUtil=e.util.ValidationUtil||{};
e.util.ValidationUtil.isNumber=function(s){return !isNaN(parseFloat(s))&&isFinite(s);};e.util.ValidationUtil.isNumber2=function(s){return s!==null&&typeof s==="number";
};e.util.ValidationUtil.isObject=function(s){return s!==null&&typeof s==="object";};e.util.ValidationUtil.isNumberArray=function(v){if(!v||typeof v!=="object"){return false;
}var s=v.length;if(s===0){return false;}var t=e.util.ValidationUtil.isNumber;for(var u=0;u<s;u++){if(!t(v[u])){return false;
}}return true;};e.util.ValidationUtil.getColor=function(v){if(e.isNull(v)){return null;}var s=typeof v;
if(s==="string"){if(/#[0-9a-fA-F]{6}/.test(v)){return v;}else{if(/[0-9a-fA-F]{6}/.test(v)){return"#"+v;
}else{return null;}}}else{if(s==="number"){if(v===0){return"#000000";}else{var u=Math.round(v).toString(16);
while(u.length<6){u="0"+u;}return"#"+u;}}else{return null;}}};e.util.CSTransformUtil=e.util.CSTransformUtil||{};
e.util.CSTransformUtil.csTransformFunctions=[];e.util.CSTransformUtil.getCSTransformFunction=function(v,t){var x=e.util.CSTransformUtil.csTransformFunctions[v];
if(x){if(e.notNull(x[t])){return x[t];}else{var s=x[8307];var u=e.util.CSTransformUtil.csTransformFunctions[8307];
var w=u[t];if(e.notNull(s)&&e.notNull(w)){return function(z,B){var A=s(z,B);return w(A.x,A.y);};}else{return null;
}}}else{return null;}};e.util.CSTransformUtil.addCSTransformFunction=function(t,s,u){var v=e.util.CSTransformUtil.csTransformFunctions[t];
if(!v){v=e.util.CSTransformUtil.csTransformFunctions[t]=[];}v[s]=u;};e.util.CSTransformUtil.transOrdinatesArray=function(y,z,x){var t=y.length;
var w=new Array(t);for(var v=0;v<t;v+=z){var s=x(y[v],y[v+1]);w[v]=s.x;w[v+1]=s.y;for(var u=2;u<z;u++){w[v+u]=y[v+u];
}}return w;};e.util.CSTransformUtil.transformOrdinates=function(v,s,z){var B=e.util.ValidationUtil;var t=null;
if(!z){z=2;}var u=e.util.CSTransformUtil.transOrdinatesArray;if(B.isNumberArray(s)){t=u(s,z,v);}else{var A=s.length;
t=new Array(A);for(var y=0;y<A;y++){if(B.isNumberArray(s[y])){t[y]=u(s[y],z,v);}else{var x=s[y].length;
t[y]=new Array(x);for(var w=0;w<x;w++){t[y][w]=u(s[y][w],z,v);}}}}return t;};e.util.CSTransformUtil.loadCSTransformFunction=function(){var t=e.util.CSTransformUtil;
var v=t.addCSTransformFunction;v(54004,8307,function(z,A){return t.mercatorToGeodetic(z,A,54004,8307);
});v(8307,54004,function(z,A){return t.geodeticToMercator(z,A,8307,54004);});v(3785,8307,function(z,A){return t.SphereMercatorToGeodetic(z,A,6378137);
});v(8307,3785,function(z,A){return t.geodeticToSphereMercator(z,A,6378137);});v(3857,8307,function(z,A){return t.SphereMercatorToGeodetic(z,A,6378137);
});v(8307,3857,function(z,A){return t.geodeticToSphereMercator(z,A,6378137);});v(53004,8307,function(z,A){return t.SphereMercatorToGeodetic(z,A,6371000);
});v(8307,53004,function(z,A){return t.geodeticToSphereMercator(z,A,6371000);});v(54004,4326,function(z,A){return t.mercatorToGeodetic(z,A,54004,8307);
});v(4326,54004,function(z,A){return t.geodeticToMercator(z,A,8307,54004);});v(3785,4326,function(z,A){return t.SphereMercatorToGeodetic(z,A,6378137);
});v(4326,3785,function(z,A){return t.geodeticToSphereMercator(z,A,6378137);});v(3857,4326,function(z,A){return t.SphereMercatorToGeodetic(z,A,6378137);
});v(4326,3857,function(z,A){return t.geodeticToSphereMercator(z,A,6378137);});v(53004,4326,function(z,A){return t.SphereMercatorToGeodetic(z,A,6371000);
});v(4326,53004,function(z,A){return t.geodeticToSphereMercator(z,A,6371000);});v(53004,54004,function(z,B){var A=t.SphereMercatorToGeodetic(z,B,6371000);
return t.geodeticToMercator(A.x,A.y,8307,54004);});v(54004,53004,function(z,B){var A=t.mercatorToGeodetic(z,B,54004,8307);
return t.geodeticToSphereMercator(A.x,A.y,6371000);});v(3785,54004,function(z,B){var A=t.SphereMercatorToGeodetic(z,B,6378137);
return t.geodeticToMercator(A.x,A.y,8307,54004);});v(54004,3785,function(z,B){var A=t.mercatorToGeodetic(z,B,54004,8307);
return t.geodeticToSphereMercator(A.x,A.y,6378137);});v(3857,54004,function(z,B){var A=t.SphereMercatorToGeodetic(z,B,6378137);
return t.geodeticToMercator(A.x,A.y,8307,54004);});v(54004,3857,function(z,B){var A=t.mercatorToGeodetic(z,B,54004,8307);
return t.geodeticToSphereMercator(A.x,A.y,6378137);});v(3785,53004,function(z,B){var A=t.SphereMercatorToGeodetic(z,B,6378137);
return t.geodeticToSphereMercator(A.x,A.y,6371000);});v(53004,3785,function(z,B){var A=t.SphereMercatorToGeodetic(z,B,6371000);
return t.geodeticToSphereMercator(A.x,A.y,6378137);});v(3857,53004,function(z,B){var A=t.SphereMercatorToGeodetic(z,B,6378137);
return t.geodeticToSphereMercator(A.x,A.y,6371000);});v(53004,3857,function(z,B){var A=t.SphereMercatorToGeodetic(z,B,6371000);
return t.geodeticToSphereMercator(A.x,A.y,6378137);});v(3857,3785,function(z,A){return{x:z,y:A};});v(3785,3857,function(z,A){return{x:z,y:A};
});var s=new e.proj.Albers({standardParallel_1:29.5,standardParallel_2:45.5,lonCenter:-96,latOrigin:23});
v(8307,32775,s.forward);v(32775,8307,s.inverse);v(8307,505050,e.proj.AlbersUSA.forward);v(505050,8307,e.proj.AlbersUSA.inverse);
v(4326,505050,e.proj.AlbersUSA.forward);v(505050,4326,e.proj.AlbersUSA.inverse);var u=new e.proj.Winkel3(0);
v(8307,1009801,u.forward);v(1009801,8307,u.inverse);var w=new e.proj.Robinson(0);v(8307,180224,w.forward);
v(180224,8307,w.inverse);};e.util.CSTransformUtil.csParameters=[{srid:54004,params:[0,0,1,0,0]},{srid:8307,params:[6378137,298.257223563]}];
e.util.CSTransformUtil.geodeticToMercator=function(u,y,A,C){var t=e.util.CSTransformUtil.getCSParameters(C);
var N=e.util.CSTransformUtil.getCSParameters(A);if(!t||!N){return null;}var M=e.util.GeomUtil.getRadiansFromLatLon(u,y);
u=M.x;y=M.y;var J=t[3];var B=t[4];var z=t[2];var K=t[1];var L=N[0];var F=1/N[1];var I=Math.sqrt(2*F-F*F);
var x=J+L*z*(u-K);var s=Math.sin(y);var G=Math.tan(Math.PI/4+y/2);var E=(1-I*s)/(1+I*s);var D=I/2;var v=Math.pow(E,D);
var w=B+L*z*Math.log(G*v);return{x:x,y:w};};e.util.CSTransformUtil.mercatorToGeodetic=function(U,T,A,s){var D=e.util.CSTransformUtil.getCSParameters(A);
var ab=e.util.CSTransformUtil.getCSParameters(s);if(!D||!ab){return null;}var P=D[3];var I=D[4];var O=D[2];
var u=D[1];var aj=ab[0];var af=1/ab[1];var ah=Math.sqrt(2*af-af*af);var w=T;var z=U;var C=Math.E;var W=Math.pow(C,((I-w)/(aj*O)));
var F=Math.PI/2-2*Math.atan2(W,1);var V=Math.pow(ah,4);var S=Math.pow(ah,6);var R=Math.pow(ah,8);var ai=ah*ah/2;
var ag=5*V/24;var ae=S/12;var ad=13*R/360;var ac=Math.sin(2*F);var aa=7*V/48;var Z=29*S/240;var Y=811*R/11520;
var X=Math.sin(2*F);var M=7*S/120;var L=81*R/1120;var K=Math.sin(6*F);var J=4279*R/161280;var G=Math.sin(8*F);
var Q=F+(ai+ag+ae+ad)*ac+(aa+Z+Y)*X+(M+L)*K+J*G;var v=((z-P)/(aj*O))+u;return e.util.GeomUtil.getLatLonFromRadians(v,Q);
};e.util.CSTransformUtil.getCSParameters=function(t){var v=e.util.CSTransformUtil.csParameters;var s=v.length;
for(var u=0;u<s;u++){if(v[u].srid===t){return v[u].params;}}return null;};e.util.CSTransformUtil.geodeticToSphereMercator=function(z,y,t){if(y>85){y=85;
}else{if(y<-85){y=-85;}}var x=e.util.GeomUtil.getRadiansFromLatLon(z,y);z=x.x;y=x.y;var s=Math.sin(y);
var u=Math.log((1+s)/(1-s));var w=t*z;var v=u*t/2;return{x:w,y:v};};e.util.CSTransformUtil.SphereMercatorToGeodetic=function(s,B,u){var A=s/u;
var v=B*2/u;var z=Math.pow(Math.E,v);var t=(z-1)/(z+1);var w=Math.asin(t);return e.util.GeomUtil.getLatLonFromRadians(A,w);
};e.util.CSTransformUtil.loadCSTransformFunction();e.util.HttpRequest={};e.util.HttpRequest.localDomain=document.location.protocol+"//"+document.location.host;
e.util.HttpRequest.instanceId=Math.round(Math.random()*10000);e.util.HttpRequest.reqCount=0;e.util.HttpRequest.scriptTagCount=0;
e.util.HttpRequest.requests=[];e.util.HttpRequest.urlMaxLength=4000;e.util.HttpRequest.instanceIdTable={};
e.util.HttpRequest.send=function(s,x,u,C,y,t,A){if(!s){return;}if(e.isNull(A)){A=e.gv.proxyEnabled;}var D=e.util.HttpRequest;
var w=function(F,I,G){if(G==="abort"){return;}if(y){y(F,I,G);return;}var E="URL: "+s;if(G){E+="\nError: "+G;
}if(F&&F.responseText){E+="\nResponse : "+F.responseText;}e.util.Logger.alert("MAPVIEWER_9014","OM.util.HttpRequest.send",E);
};var B=e.$.post;if(e.gv._httpMethod==="GET"){B=e.$.get;}var v=false;if(x.$enableXHR){v=true;delete x.$enableXHR;
}if(D.isLocalDomain(s)||v){if(C==="json"||C==="jsonp"){return new D.XHR(B(s,x,function(I){try{var F=null;
F=e.$.parseJSON(I);u(F);}catch(E){var G=E.message;if(E.stack){G+="\n  Stack: "+E.stack;}e.util.Logger.warning("MAPVIEWER_9013","OM.util.HttpRequest.send",G);
if(y){y(this.jqXHR,"Error parsing response as JSON data.",E);}}},"text")).setErrorHandler(w);}else{return new D.XHR(B(s,x,u,C)).setErrorHandler(w);
}}else{if(C==="jsonp"){return new D.XHR(B(s,x,u,C)).setErrorHandler(w);}else{if(A){var z=e.util.HttpRequest.localDomain+e.gv.proxyPath;
x.rtarget=s;return new D.XHR(B(z,x,function(E){u(E);},C)).setErrorHandler(w);}else{return D.sendAsScripts(s,x,u,C,t);
}}}};e.util.HttpRequest.sendAsScripts=function(s,v,u,B,t){if(!s){return null;}var C=e.util.HttpRequest;
var y=C.instanceIdTable[s];if(e.isNull(y)){var x="v2"+C.reqCount++;var D=s;if(D.indexOf("?")>0){D+="&";
}else{D+="?";}D+="callback_id="+x+"&";var w="text";var z=A;if(t){C.instanceIdTable[s]="_1";w=B;z=u;}else{D+="getinstid=true";
}D+="&"+e.$.param(v);return C.sendAsScript(D,z,w,x);}else{return C.sendAsScriptsWithId(s,v,u,B,y);}function A(E){y=E;
C.instanceIdTable[s]=E;C.sendAsScriptsWithId(s,v,u,B,y);}};e.util.HttpRequest.sendAsScriptsWithId=function(u,A,y,E,D){var F=e.util.HttpRequest;
var G=new F.XHR();var C="v2"+D+"_"+F.reqCount++;if(u.indexOf("?")>0){u+="&";}else{u+="?";}u+="callback_id="+C+"&";
var x=u+e.$.param(A);if(x.length>F.urlMaxLength){var t={};for(var w in A){t[w]=A[w]+"";}var z;var B=1;
u+="ref="+(Math.floor(Math.random()*10000))+"&";while(true){var v=u+"pn="+B;var s=F.getParameters(t,F.urlMaxLength-v.length);
if(F.getParametersCount(t)>0){z=F.sendAsScript(v+s,y,E,C,B);G.addScriptId(z.getScriptIds()[0]);}else{z=F.sendAsScript(u+"pn=e"+B+s,y,E,C,B);
G.addScriptId(z.getScriptIds()[0]);break;}B++;}return G;}else{return F.sendAsScript(x,y,E,C);}};e.util.HttpRequest.sendAsScript=function(s,w,y,v,x){if(!s){return null;
}var u=e.util.HttpRequest;var t=document.createElement("script");t.id="OMV_XHR_"+u.scriptTagCount++;t.src=s;
t.type="text/javascript";t.charset="utf-8";u.requests.push({jsNode:t,callBack:w,reqId:v,format:y,parts:x});
document.body.appendChild(t);var z=new u.XHR();z.addScriptId(t.id);return z;};e.util.HttpRequest.callBack=function(z,x,w){var y=e.util.HttpRequest.requests;
var u=null;while(y.length>0){u=y[0];if(!u.callBack&&!u.parts){if(u.jsNode){try{document.body.removeChild(u.jsNode);
}catch(t){}u.jsNode=null;}y.shift();}else{break;}}var s=0;for(;s<y.length;s++){u=y[s];if(u.reqId===z&&u.parts===w){var v=false;
u=y[s];try{document.body.removeChild(u.jsNode);}catch(t){v=true;}u.jsNode=null;if(s===0){y.shift();}if(!v&&e.notNull(x)&&u.callBack){if(u.format==="json"){if(typeof x==="string"){u.callBack(e.$.parseJSON(x));
}else{u.callBack(x);}}else{if(u.format==="xml"){u.callBack(e.util.XMLUtil.parse(x));}else{u.callBack(x);
}}}u.callBack=null;return;}}};e.util.HttpRequest.isLocalDomain=function(s){var t=e.util.HttpRequest;s=e.$.trim(s);
if(s.toLowerCase().indexOf("http://")===0||s.toLowerCase().indexOf("https://")===0){return(t.getDomain(s)===t.localDomain);
}else{return true;}};e.util.HttpRequest.getDomain=function(s){if(!s){return null;}var u=s.indexOf("://");
if(u>0){u+=3;var t=s.indexOf("/",u);if(t>0){return s.substring(0,t);}else{return s.substring(0);}}else{return null;
}};e.util.HttpRequest.getParameters=function(w,s){var D="";for(var t in w){var z=("&"+t+"=");if(D.length+z.length>=s){return D;
}D+=z;s=s-D.length;var B=w[t];var y=encodeURIComponent(B);var u=y.length;if(u<=s){D+=y;delete w[t];}else{var v=B.length;
var A=Math.floor(s*(v*1/u));for(var x=A;x>=0;x--){var C=B.substring(0,x);y=encodeURIComponent(C);if(y.length<=s){w[t]=B.substring(x);
return D+=y;}}}}return D;};e.util.HttpRequest.getParametersCount=function(u){var t=0;var s;for(s in u){++t;
}return t;};e.util.HttpRequest.XHR=function(s){this.scriptTags=[];this.jQXHR=null;this.error=null;if(s){this.jQXHR=s;
}};e.util.HttpRequest.XHR.prototype.addScriptId=function(s){this.scriptTags.push(s);};e.util.HttpRequest.XHR.prototype.getScriptIds=function(){return this.scriptTags;
};e.util.HttpRequest.XHR.prototype.abort=function(){if(this.jQXHR){this.jQXHR.abort();}else{for(var t=0;
t<this.scriptTags.length;t++){var s=document.getElementById(this.scriptTags[t]);if(s&&s.parentNode){try{s.parentNode.removeChild(s);
}catch(u){}}}}};e.util.HttpRequest.XHR.prototype.setErrorHandler=function(s){if(this.jQXHR){this.jQXHR.error(s);
}else{this.error=s;}return this;};e.util.CoverageGrid=function(s){this.xResolution=null;this.yResolution=null;
this.grid={};this.gridWidth=128;this.gridHeight=128;this.gridDeviceSize=128;this.setBox(s);};e.util.CoverageGrid.prototype.setBox=function(s){this.minX=s.minX;
this.minY=s.minY;this.maxX=s.maxX;this.maxY=s.maxY;if(e.notNull(s.gridSize)){this.gridDeviceSize=s.gridSize;
}};e.util.CoverageGrid.prototype.init=function(){this.clear();};e.util.CoverageGrid.prototype.clear=function(){var t=this.grid;
for(var s in t){delete t[s];}};e.util.CoverageGrid.prototype.conflicts=function(w){var y=Math.floor((w[0]-this.minX)/this.gridWidth);
var x=Math.floor((w[1]-this.minY)/this.gridHeight);var v=Math.floor((w[2]-this.minX)/this.gridWidth);
var u=Math.floor((w[3]-this.minY)/this.gridHeight);for(var t=y;t<=v;t++){for(var s=x;s<=u;s++){if(this.conflictsWithCell(t,s,w)){return true;
}}}return false;};e.util.CoverageGrid.prototype.insert=function(w){var y=Math.floor((w[0]-this.minX)/this.gridWidth);
var x=Math.floor((w[1]-this.minY)/this.gridHeight);var v=Math.floor((w[2]-this.minX)/this.gridWidth);
var u=Math.floor((w[3]-this.minY)/this.gridHeight);for(var t=y;t<=v;t++){for(var s=x;s<=u;s++){this.insertToCell(t,s,w);
}}};e.util.CoverageGrid.prototype.remove=function(w){var y=Math.floor((w[0]-this.minX)/this.gridWidth);
var x=Math.floor((w[1]-this.minY)/this.gridHeight);var v=Math.floor((w[2]-this.minX)/this.gridWidth);
var u=Math.floor((w[3]-this.minY)/this.gridHeight);for(var t=y;t<=v;t++){for(var s=x;s<=u;s++){this.removeFromCell(t,s,w);
}}};e.util.CoverageGrid.prototype.insertToCell=function(u,t,s){if(!this.grid[u]){this.grid[u]={};}if(!this.grid[u][t]){this.grid[u][t]=[];
}this.grid[u][t].push(s);};e.util.CoverageGrid.prototype.conflictsWithCell=function(x,w,u){if(!this.grid[x]){return false;
}if(!this.grid[x][w]){return false;}var s=this.grid[x][w];for(var t=0;t<s.length;t++){var v=s[t];if(v[2]<=u[0]||v[0]>=u[2]||v[3]<u[1]||v[1]>u[3]){continue;
}else{return true;}}return false;};e.util.CoverageGrid.prototype.removeFromCell=function(w,v,u){if(!this.grid[w]){return;
}if(!this.grid[w][v]){return;}var s=this.grid[w][v];for(var t=0;t<s.length;t++){if(s[t]===u){this.grid[w].splice(t,1);
return;}}};e.util.MiscUtil=e.util.MiscUtil||{arraysAreEqual:function(u,t){if(u===t||(e.isNull(u)&&e.isNull(t))||(e.isNull(u)&&t.length===0)||(u.length===0&&e.isNull(t))){return true;
}else{if(u===null||t===null||u.length!==t.length){return false;}else{for(var v=0,s=u.length;v<s;v++){if(u[v]!=t[v]){return false;
}}}}return true;},mixin:function(w){var s=Array.prototype.slice.call(arguments,1),u=s.length,x;for(var t=0;
t<u;t++){x=s[t];if(x){for(var v in x){if(x.hasOwnProperty(v)){w[v]=x[v];}}}}return w;},mark:(function(){var t=0,s="_omapsid_";
return function(u){u[s]=u[s]||++t;return u[s];};}()),signURL:function(v,s){if(e.isNull(CryptoJS)){return null;
}if(e.isNull(v)||e.isNull(s)){return null;}var u=v.replace("-","+");u=u.replace("_","/");var w=CryptoJS.enc.Base64.parse(u);
var x=CryptoJS.HmacSHA1(s,w);var t=CryptoJS.enc.Base64.stringify(x);t=t.replace("+","-");t=t.replace("/","_");
return t;},generateUid:function(t){var u=t||"-";function s(){return(((1+Math.random())*65536)|0).toString(16).substring(1);
}return(s()+s()+u+s()+u+s()+u+s()+u+s()+s()+s());},parseNumberAndUnit:function(x){var t={};if(e.isNull(x)){return t;
}if(e.util.ValidationUtil.isNumber(x)){t.value=x;return t;}var s=x.trim();var w="";var v=null;for(var u=0;
u<s.length;u++){var y=s.charAt(u);if(e.util.ValidationUtil.isNumber(y)||(y==="-"&&u===0)){w+=y;}else{if(y==="."){if(e.util.ValidationUtil.isNumber(s.charAt(u+1))){w+=y;
}}else{v=s.substring(u,s.length).trim();break;}}}if(w.length>0){t.value=w;}if(e.isNotNull(v)){t.unit=v;
}return t;},debounce:function(s,u){var t;return function(){var x=this,w=arguments;var v=function(){t=null;
s.apply(x,w);};clearTimeout(t);t=setTimeout(v,u);};},md5Hash:(function(){var w=[0,8,16,24];function u(J,T){var U=T[0],S=T[1],R=T[2],Q=T[3],P=T[4],O=T[5],N=T[6],M=T[7],L=T[8],K=T[9],I=T[10],G=T[11],F=T[12],E=T[13],D=T[14],C=T[15];
var Y=J[0],X=J[1],W=J[2],V=J[3];Y=z((X&W)|((~X)&V),Y,X,U,7,-680876936);V=z((Y&X)|((~Y)&W),V,Y,S,12,-389564586);
W=z((V&Y)|((~V)&X),W,V,R,17,606105819);X=z((W&V)|((~W)&Y),X,W,Q,22,-1044525330);Y=z((X&W)|((~X)&V),Y,X,P,7,-176418897);
V=z((Y&X)|((~Y)&W),V,Y,O,12,1200080426);W=z((V&Y)|((~V)&X),W,V,N,17,-1473231341);X=z((W&V)|((~W)&Y),X,W,M,22,-45705983);
Y=z((X&W)|((~X)&V),Y,X,L,7,1770035416);V=z((Y&X)|((~Y)&W),V,Y,K,12,-1958414417);W=z((V&Y)|((~V)&X),W,V,I,17,-42063);
X=z((W&V)|((~W)&Y),X,W,G,22,-1990404162);Y=z((X&W)|((~X)&V),Y,X,F,7,1804603682);V=z((Y&X)|((~Y)&W),V,Y,E,12,-40341101);
W=z((V&Y)|((~V)&X),W,V,D,17,-1502002290);X=z((W&V)|((~W)&Y),X,W,C,22,1236535329);Y=z((X&V)|(W&(~V)),Y,X,S,5,-165796510);
V=z((Y&W)|(X&(~W)),V,Y,N,9,-1069501632);W=z((V&X)|(Y&(~X)),W,V,G,14,643717713);X=z((W&Y)|(V&(~Y)),X,W,U,20,-373897302);
Y=z((X&V)|(W&(~V)),Y,X,O,5,-701558691);V=z((Y&W)|(X&(~W)),V,Y,I,9,38016083);W=z((V&X)|(Y&(~X)),W,V,C,14,-660478335);
X=z((W&Y)|(V&(~Y)),X,W,P,20,-405537848);Y=z((X&V)|(W&(~V)),Y,X,K,5,568446438);V=z((Y&W)|(X&(~W)),V,Y,D,9,-1019803690);
W=z((V&X)|(Y&(~X)),W,V,Q,14,-187363961);X=z((W&Y)|(V&(~Y)),X,W,L,20,1163531501);Y=z((X&V)|(W&(~V)),Y,X,E,5,-1444681467);
V=z((Y&W)|(X&(~W)),V,Y,R,9,-51403784);W=z((V&X)|(Y&(~X)),W,V,M,14,1735328473);X=z((W&Y)|(V&(~Y)),X,W,F,20,-1926607734);
Y=z(X^W^V,Y,X,O,4,-378558);V=z(Y^X^W,V,Y,L,11,-2022574463);W=z(V^Y^X,W,V,G,16,1839030562);X=z(W^V^Y,X,W,D,23,-35309556);
Y=z(X^W^V,Y,X,S,4,-1530992060);V=z(Y^X^W,V,Y,P,11,1272893353);W=z(V^Y^X,W,V,M,16,-155497632);X=z(W^V^Y,X,W,I,23,-1094730640);
Y=z(X^W^V,Y,X,E,4,681279174);V=z(Y^X^W,V,Y,U,11,-358537222);W=z(V^Y^X,W,V,Q,16,-722521979);X=z(W^V^Y,X,W,N,23,76029189);
Y=z(X^W^V,Y,X,K,4,-640364487);V=z(Y^X^W,V,Y,F,11,-421815835);W=z(V^Y^X,W,V,C,16,530742520);X=z(W^V^Y,X,W,R,23,-995338651);
Y=z(W^(X|(~V)),Y,X,U,6,-198630844);V=z(X^(Y|(~W)),V,Y,M,10,1126891415);W=z(Y^(V|(~X)),W,V,D,15,-1416354905);
X=z(V^(W|(~Y)),X,W,O,21,-57434055);Y=z(W^(X|(~V)),Y,X,F,6,1700485571);V=z(X^(Y|(~W)),V,Y,Q,10,-1894986606);
W=z(Y^(V|(~X)),W,V,I,15,-1051523);X=z(V^(W|(~Y)),X,W,S,21,-2054922799);Y=z(W^(X|(~V)),Y,X,L,6,1873313359);
V=z(X^(Y|(~W)),V,Y,C,10,-30611744);W=z(Y^(V|(~X)),W,V,N,15,-1560198380);X=z(V^(W|(~Y)),X,W,E,21,1309151649);
Y=z(W^(X|(~V)),Y,X,P,6,-145523070);V=z(X^(Y|(~W)),V,Y,G,10,-1120210379);W=z(Y^(V|(~X)),W,V,R,15,718787259);
X=z(V^(W|(~Y)),X,W,K,21,-343485551);J[0]=~~(Y+J[0]);J[1]=~~(X+J[1]);J[2]=~~(W+J[2]);J[3]=~~(V+J[3]);}function z(I,E,D,C,G,F){E=~~(~~(E+I)+~~(C+F));
return ~~(((E<<G)|(E>>>(32-G)))+D);}function t(G){var D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var F=G.length;
var E=[1732584193,-271733879,-1732584194,271733878];for(var C=64;C<=F;C+=64){B(D,G,C-64);u(E,D);}x(C-64,G,E,F);
return E;}var x=function(D,K,E,J){var G=K.substring(D);var F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var C=G.length&~3;
for(D=0;D<C;D+=4){F[D>>2]=G.charCodeAt(D)|(G.charCodeAt(D+1)<<8)|(G.charCodeAt(D+2)<<16)|(G.charCodeAt(D+3)<<24);
}C=G.length;var I=D>>2;for(;D<C;++D){F[I]|=G.charCodeAt(D)<<w[(D&3)];}F[I]|=128<<w[(D&3)];if(D>55){u(E,F);
F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];}F[14]=J*8;u(E,F);};function B(C,D,E){C[0]=D.charCodeAt(E)+(D.charCodeAt(1+E)<<8)+(D.charCodeAt(2+E)<<16)+(D.charCodeAt(3+E)<<24);
C[1]=D.charCodeAt(4+E)+(D.charCodeAt(5+E)<<8)+(D.charCodeAt(6+E)<<16)+(D.charCodeAt(7+E)<<24);C[2]=D.charCodeAt(8+E)+(D.charCodeAt(9+E)<<8)+(D.charCodeAt(10+E)<<16)+(D.charCodeAt(11+E)<<24);
C[3]=D.charCodeAt(12+E)+(D.charCodeAt(13+E)<<8)+(D.charCodeAt(14+E)<<16)+(D.charCodeAt(15+E)<<24);C[4]=D.charCodeAt(16+E)+(D.charCodeAt(17+E)<<8)+(D.charCodeAt(18+E)<<16)+(D.charCodeAt(19+E)<<24);
C[5]=D.charCodeAt(20+E)+(D.charCodeAt(21+E)<<8)+(D.charCodeAt(22+E)<<16)+(D.charCodeAt(23+E)<<24);C[6]=D.charCodeAt(24+E)+(D.charCodeAt(25+E)<<8)+(D.charCodeAt(26+E)<<16)+(D.charCodeAt(27+E)<<24);
C[7]=D.charCodeAt(28+E)+(D.charCodeAt(29+E)<<8)+(D.charCodeAt(30+E)<<16)+(D.charCodeAt(31+E)<<24);C[8]=D.charCodeAt(32+E)+(D.charCodeAt(33+E)<<8)+(D.charCodeAt(34+E)<<16)+(D.charCodeAt(35+E)<<24);
C[9]=D.charCodeAt(36+E)+(D.charCodeAt(37+E)<<8)+(D.charCodeAt(38+E)<<16)+(D.charCodeAt(39+E)<<24);C[10]=D.charCodeAt(40+E)+(D.charCodeAt(41+E)<<8)+(D.charCodeAt(42+E)<<16)+(D.charCodeAt(43+E)<<24);
C[11]=D.charCodeAt(44+E)+(D.charCodeAt(45+E)<<8)+(D.charCodeAt(46+E)<<16)+(D.charCodeAt(47+E)<<24);C[12]=D.charCodeAt(48+E)+(D.charCodeAt(49+E)<<8)+(D.charCodeAt(50+E)<<16)+(D.charCodeAt(51+E)<<24);
C[13]=D.charCodeAt(52+E)+(D.charCodeAt(53+E)<<8)+(D.charCodeAt(54+E)<<16)+(D.charCodeAt(55+E)<<24);C[14]=D.charCodeAt(56+E)+(D.charCodeAt(57+E)<<8)+(D.charCodeAt(58+E)<<16)+(D.charCodeAt(59+E)<<24);
C[15]=D.charCodeAt(60+E)+(D.charCodeAt(61+E)<<8)+(D.charCodeAt(62+E)<<16)+(D.charCodeAt(63+E)<<24);}var v=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];
function A(D){var C=v[(D>>(4))&15]+v[(D>>(0))&15]+v[(D>>(12))&15]+v[(D>>(8))&15]+v[(D>>(20))&15]+v[(D>>(16))&15]+v[(D>>(28))&15]+v[(D>>(24))&15];
return C;}function s(D){var C=A(D[0])+A(D[1])+A(D[2])+A(D[3]);return C;}function y(C){if(e.isNull(C)){return"";
}else{return s(t(C));}}return y;})(),transparentImgURL:"data:image/gif;base64,R0lGODlhBQAFAIAAAP///wAAACH5BAEAAAAALAAAAAAFAAUAAAIEhI+pWAA7"};
e.util.GeoDataCache=function(t,s){this.url=null;this.name=t;this._data={};this._count=0;this._mbr=null;
this._restrictedArea=null;this._srid=s?s:8307;};e.util.GeoDataCache.prototype.destroy=function(){this._data=null;
this._restrictedArea=null;};e.util.GeoDataCache.prototype.setRestrictedArea=function(s){this._restrictedArea=s;
};e.util.GeoDataCache.prototype.getRestrictedArea=function(){return this._restrictedArea;};e.util.GeoDataCache.prototype.size=function(){return this._count;
};e.util.GeoDataCache.prototype.get=function(s){if(this._data[s]){return this._data[s];}else{return null;
}};e.util.GeoDataCache.prototype.put=function(s,t,v){if(!s||!t){return null;}if(!this.isAllowed(t,v)){return null;
}var u=this.get(s);this._data[s]=t;if(!u){this._count++;}if(!this._mbr){this._mbr=new e.geometry.Rectangle(v.minX,v.minY,v.maxX,v.maxY,v.srid);
}else{this._mbr.expand(v);}return u;};e.util.GeoDataCache.remove=function(s){if(!s){return;}if(this._data[s]){delete this._data[s];
this._count--;}};e.util.GeoDataCache.isAllowed=function(s,t){if(!this._restrictedArea){return true;}else{}};
e.util.LoadFileUtil={};e.util.LoadFileUtil.CssLoaded=false;e.util.LoadFileUtil.JsLoaded=false;e.util.LoadFileUtil.JsLoadedTwice=false;
e.util.LoadFileUtil.LoadCss=function(u){var t=document.getElementsByTagName("head")[0];var s=document.createElement("link");
s.setAttribute("rel","stylesheet");s.setAttribute("href",u);t.appendChild(s);s.onload=s.onreadystatechange=function(){e.util.LoadFileUtil.CssLoaded=true;
s.onload=s.onreadystatechange=null;};};e.util.LoadFileUtil.LoadJs=function(v,s){var u=document.getElementsByTagName("head")[0];
var t=document.createElement("script");t.setAttribute("type","text/javascript");t.setAttribute("src",v);
u.appendChild(t);t.onload=t.onreadystatechange=function(){if(e.isNull(s)){e.util.LoadFileUtil.JsLoaded=true;
}else{e.util.LoadFileUtil.JsLoadedTwice=true;}t.onload=t.onreadystatechange=null;};};e.util.TimerManager=function(u){var t=function(){var v=this;
v.schedule=function(x,w){v.cancel();v.time=w;v.callback=x;v.timeout=setTimeout(v.doCallback,w);};v.reset=function(){if(v.timeout){v.schedule(v.callback,v.time);
}};v.cancel=function(){if(v.timeout){clearTimeout(v.timeout);v.timeout=f;}};v.doCallback=function(){try{v.callback();
}catch(w){}};return{reset:v.reset,schedule:v.schedule,cancel:v.cancel};};var s=this;s.defaultTime=u?u:2000;
s.timers=[];s.getTimer=function(v){if(!v){v="NO_NAME";}if(!s.timers[v]){s.timers[v]=new t();}return s.timers[v];
};s.schedule=function(v,w,y){if(w!==0&&!w){w=s.defaultTime;}var x=s.getTimer(v);x.schedule(y,w);};s.reset=function(v){var w=s.getTimer(v);
w.reset();};s.cancel=function(v){var w=s.getTimer(v);w.cancel();};return{schedule:s.schedule,reset:s.reset,cancel:s.cancel};
};e.geometry.Geometry=e.Class.extend({initialize:function(s){this.type=null;this.srid=null;if(e.isNull(s)){this.srid=8307;
}else{if(!e.util.ValidationUtil.isNumber(s)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Geometry","srid:"+s);
return null;}else{this.srid=(typeof s==="number")?s:parseInt(s);}}this.coordinates=null;this.geometries=null;
this.mbr=null;this.dim=2;},getMBR:function(){var t=e.geometry;if(!this.mbr){var s=t.Geometry.calculateMBR(this.coordinates,this.type,this.dim);
this.mbr=new t.Rectangle(s.minX,s.minY,s.maxX,s.maxY,this.srid);}return this.mbr;},getMIR:function(){var w=[];
var z=this.dim?this.dim:2;var x=this.coordinates;var y=this.getMBR();w[0]=y.getMinX();w[1]=y.getMinY();
w[2]=y.getMaxX();w[3]=y.getMaxY();if(this.type=="Polygon"){w=this.getLabelBox(x,z);}else{if(this.type=="MultiPolygon"){var t=-1;
var u=null;for(var v=0;v<x.length;v++){u=this.getLabelBox(x[v],z);if(this.getRectangleArea(u)>t){w=u;
t=this.getRectangleArea(w);}}}}if(e.isNull(w)){return null;}var s=new e.geometry.Rectangle(w[0],w[1],w[2],w[3],this.srid);
return s;},getDimension:function(){return this.dim;},_getMeasure:function(w){var t=this.coordinates;var s=this.geometries;
var y=null;var v=0;if(e.isNull(t)){if(e.isNull(s)){return 0;}else{for(var x=0;x<s.length;x++){v=v+s[x]._getMeasure(w);
}return v;}}if(w==="area"){y=e.util.GeomUtil.polygonArea;}else{if(w==="length"){y=e.util.GeomUtil.polylineLength;
}}if(e.$.isArray(t[0])){for(var u=0;u<t.length;u++){v=v+y(t[u],this.dim);}return v;}else{return y(t,this.dim);
}},getLength:function(){return this._getMeasure("length");},getArea:function(){return this._getMeasure("area");
},getLabelBox:function(D,y){var F=D[0];var C=e.geometry.Geometry.calculateMBR(D,"Polygon",y);var E=new e.geometry.Rectangle(C.minX,C.minY,C.maxX,C.maxY,this.srid);
var B=100;var v=(E.getMaxY()-E.getMinY())/B;var I=[];for(var z=0;z<B;z++){I[z]=this.findIntersections(F,y,E,B,z);
}var J=Math.floor(B/2);var s=this.findLongestSegment(I[J]);var A=null;var G,x,t,w;if(s!=-1){G=J;x=I[J][s];
t=I[J][s+1];w=E.getMinY()+(J+1)*v;A=this.getOptimalBox(I,E,B,x,t,w,G);}for(z=0;z<B;z++){s=this.findLongestSegment(I[z]);
if(s==-1){continue;}G=z;x=I[z][s];t=I[z][s+1];w=E.getMinY()+(z+1)*v;var u=this.getOptimalBox(I,E,B,x,t,w,G);
if(this.getRectangleArea(u)>1*this.getRectangleArea(A)){A=u;}}return A;},getOptimalBox:function(K,D,z,u,s,A,J){var x=[u,A,s,A];
var t=true;var C=true;var I=(D.getMaxY()-D.getMinY())/z;for(var w=J+1,G=J-1;t||C;w++,G--){if(w>=z){t=false;
}if(G<0){C=false;}var E=null;var B=null;var F;if(t){F=D.getMinY()+(w+1)*I;E=this.expandBox(x,K[w],F);
}if(C){F=D.getMinY()+(G+1)*I;B=this.expandBox(x,K[G],F);}var v=E;if(this.getRectangleArea(E)<this.getRectangleArea(B)){v=B;
if(t){w--;}}else{if(C){G++;}}if(e.isNull(v)||this.getRectangleArea(v)<this.getRectangleArea(x)){break;
}else{x=v;}}return x;},expandBox:function(C,F,E){var w=C[0];var t=C[2];var z=w;var x=t;var v=0;if(e.isNull(F)){return null;
}if(F.length<2){return null;}for(var B=1;B<F.length;B+=2){var u=F[B-1];var s=F[B];if(u>=t){break;}if(s<=w){continue;
}u=Math.max(u,w);s=Math.min(s,t);if(s>u){var D=s-u;if(D>v){v=D;z=u;x=s;}}}if(v<=0){return null;}var A=[];
A[0]=z;A[1]=Math.min(C[1],E);A[2]=x;A[3]=Math.max(C[3],E);return A;},findLongestSegment:function(w){var t=-1;
var v=0;if(e.isNull(w)){return -1;}if(w.length<2){return -1;}for(var u=1;u<w.length;u+=2){var s=w[u]-w[u-1];
if(s>t){t=s;v=u-1;}}return v;},findIntersections:function(B,G,u,v,z){var M=(u.getMaxY()-u.getMinY())/v;
var w=u.getMinY()+(z+1)*M;var x=[];for(var C=G;C<B.length;C+=G){var E=B[C-G];var t=B[C-G+1];var D=B[C];
var s=B[C+1];var F,L;if(t>s){F=t;L=E;t=s;E=D;s=F;D=L;}if(w<t||w>s){continue;}if(t!=s){var K=(D-E);var J=(s-t);
var A=(K*(w-t))/J+E;x.push(A);}else{x.push(E);x.push(D);}}x.sort(function(I,y){return I-y;});return x;
},getRectangleArea:function(s){if(e.isNull(s)){return 0;}return(s[2]-s[0])*(s[3]-s[1]);},transform:function(u,v,y,s){var C=e.geometry;
if(e.isNull(this.srid)||e.isNull(u)){e.util.Logger.warning("MAPVIEWER_9019","geom.Geometry.transform","");
return null;}if(this.srid===u){if(v){v(this);return;}else{return this;}}var A=e.util.CSTransformUtil.getCSTransformFunction(this.srid,u);
if(A){var B=null;try{if(this instanceof C.GeometryCollection){B=this.clientTransform(u);}else{var x=e.util.CSTransformUtil.transformOrdinates(A,this.coordinates,this.dim);
B=C.Geometry.createGeometry({type:this.type,dim:this.dim,coordinates:x},u);B.dim=this.dim;}if(v){v(B);
return;}else{return B;}}catch(w){e.util.Logger.warning(null,"geom.Geometry.transform","Cannot transform geometry coordinates: "+this.toString());
return null;}}var t=e.gv.localbaseURL();if(!y&&t){y=t+"/mcserver";}else{if(!y){e.util.Logger.warning("MAPVIEWER_9020","geom.Geometry.transform","");
return;}}var D={request:"cstransform",gformat:"geojson",dstsrid:u,datasource:s,geometry:this.toString()};
var z=function(E){if(E){e.util.Logger.warning("MAPVIEWER_9018","geom.Geometry.transform",E.responseText);
}else{e.util.Logger.warning("MAPVIEWER_9018","geom.Geometry.transform","");}return;};e.util.HttpRequest.send(y,D,function(E){if(E){var F=C.Geometry.createGeometry(E,u);
v(F);}else{e.util.Logger.warning("MAPVIEWER_9018","geom.Geometry.transform","");}},"json",z);},clone:function(x){var z=e.geometry;
var s=this.coordinates;if(x&&s){var t=function(C){var D=[];for(var B=0;B<C.length;B++){if(C[B] instanceof Array){D[B]=t(C[B]);
}else{D[B]=C[B];}}return D;};s=t(this.coordinates);}if(this instanceof z.Circle){return new z.Circle(this.getCenterX(),this.getCenterY(),this.getRadius(),this.srid);
}switch(this.type){case"Point":var w=new z.Point(this.getX(),this.getY(),this.srid);if(this.dim>2){w.coordinates=s;
w.dim=this.dim;}return w;case"OrientedPoint":var y=new z.Point(this.getX(),this.getY(),this.srid,this.getOrientationX(),this.getOrientationY());
if(this.dim>2){y.coordinates=s;y.dim=this.dim;}return y;case"MultiPoint":case"OrientedMultiPoint":return new z.MultiPoint(s,this.srid,this.dim);
case"LineString":return new z.LineString(s,this.srid,this.dim);case"MultiLineString":return new z.MultiLineString(s,this.srid,this.dim);
case"Polygon":return new z.Polygon(s,this.srid,this.dim);case"MultiPolygon":return new z.MultiPolygon(s,this.srid,this.dim);
case"Rectangle":return new z.Rectangle(this.getMinX(),this.getMinY(),this.getMaxX(),this.getMaxY(),this.srid);
case"GeometryCollection":var A=[];for(var u=0,v=this.geometries;u<v;u++){A.push(this.geometries[u].clone(x));
}return new z.GeometryCollection(A,this.srid);default:return new z.Geometry(s,this.srid,this.dim);}},toString:function(){var u="{";
u+='"type":"'+this.type+'",';if(e.isNull(this.srid)){u+='"srid":8307,';}else{u+='"srid":'+this.srid+",";
}u+='"coordinates":';var t=e.GeomTypes;if(this.type===t.MULTIPOINT||this.type===t.MULTILINESTRING||this.type===t.MULTIPOLYGON||this.type===t.POLYGON||this.type===t.ORIENTEDMULTIPOINT){u+="[";
var s=this.coordinates.length;for(var x=0;x<s;x++){u+="[";if(this.type===t.MULTIPOLYGON){var w=this.coordinates[x].length;
for(var v=0;v<w;v++){u+="["+this.coordinates[x][v]+"],";}w=u.length;u=u.substring(0,w-1);}else{u+=this.coordinates[x];
}u+="],";}s=u.length;u=u.substring(0,s-1);u+="]";}else{u+="["+this.coordinates+"]";}u+="}";return u;},densify:function(){var s=e.GeomTypes;
if(this.type===s.POINT||this.type===s.MULTIPOINT||this.type===s.ORIENTEDPOINT||this.type===s.ORIENTEDMULTIPOINT){return this;
}var t={type:"GEODETIC",distConvFactor:1};if(this.srid!==8307&&this.srid!==8265&&this.srid!==4326&&this.srid!==4269&&(!t||t.type!=="GEODETIC"&&t.type!=="PROJECTED")){return this;
}var v=1;if(t&&t.type==="PROJECTED"){v=100000*t.distConvFactor;}var u=null;var A=null;if(this.type===s.LINESTRING){u=e.util.GeomUtil.densifyOrdinates(this.coordinates,v);
A=this.type;}else{if(this.type===s.RECTANGLE){var C=[this.getMinX(),this.getMinY(),this.getMinX(),this.getMaxY(),this.getMaxX(),this.getMaxY(),this.getMaxX(),this.getMinY(),this.getMinX(),this.getMinY()];
u=e.util.GeomUtil.densifyOrdinates(C,v);A="Polygon";}else{if(this.type===s.GEOMETRYCOLLECTION){var z=this.geometries.length;
var E=new Array(z);for(var y=0;y<z;y++){E[y]=this.geometries[y].densify();}return new e.geometry.GeometryCollection(E,this.srid);
}else{var B=this.coordinates.length;u=new Array(B);for(var D=0;D<B;D++){if(this.type===s.MULTIPOLYGON){var x=this.coordinates[D].length;
u[D]=new Array(x);for(var w=0;w<x;w++){u[D][w]=e.util.GeomUtil.densifyOrdinates(this.coordinates[D][w],v);
}}else{u[D]=e.util.GeomUtil.densifyOrdinates(this.coordinates[D],v);}}A=this.type;}}}return new e.geometry.Geometry.createGeometry({type:A,coordinates:u},this.srid);
},move:function(v,u,t){var s=this.type==="OrientedPoint"||this.type==="OrientedMultiPoint"?true:false;
e.util.GeomUtil.moveCoordinates(this.coordinates,v,u,s,this.dim,t);if(this.mbr){this.mbr.move(v,u);}},getSRID:function(){return this.srid;
},getOrdinates:function(){return this.coordinates;},getType:function(){return this.type;},toJSON:function(){if(this.type===e.GeomTypes.GEOMETRYCOLLECTION){return{type:this.type,srid:this.srid,geometries:this.geometries};
}else{return{type:this.type,srid:this.srid,coordinates:this.coordinates};}}});e.geometry.Geometry.createGeometry=function(z,O){var B,A;
var F=e.geometry,I=e.GeomTypes;var t=z.type;var L=2;if(z.dim){L=z.dim;}var s=z.coordinates;var K=null;
var v=F.Geometry;var M;if(t===I.POINT){B=s[0];A=s[1];K=new F.Point(B,A,O);if(L>2){for(M=2;M<L;M++){K.addDimension(s[M]);
}}}else{if(t===I.ORIENTEDPOINT){B=s[0];A=s[1];var G=s[L];var E=s[L+1];K=new F.Point(B,A,O,G,E);if(L>2){for(M=2;
M<L;M++){K.addDimension(s[M],s[L+M]);}}}else{if(t===I.LINESTRING){K=new F.LineString(s,O,L);}else{if(t===I.RECTANGLE){var S=s[0];
var Q=s[1];var R=s[2];var P=s[3];K=new F.Rectangle(S,Q,R,P,O);}else{if(t===I.POLYGON){K=new F.Polygon(s,O,L);
}else{if(t===I.MULTIPOINT||t===I.ORIENTEDMULTIPOINT){K=new F.MultiPoint(s,O,L);}else{if(t===I.MULTILINESTRING){K=new F.MultiLineString(s,O,L);
}else{if(t===I.MULTIPOLYGON){K=new F.MultiPolygon(s,O,L);}else{if(t===I.CIRCLE){var J=s[0];var D=s[1];
var u=s[2];K=new F.Circle(J,D,u,O);}else{if(t===I.GEOMETRYCOLLECTION){var C=z.geometries;var N=C.length;
var w=v.createGeometry;for(M=0;M<N;M++){C[M]=w(C[M],O);}K=new F.GeometryCollection(C,O);}}}}}}}}}}if(z.mbr&&!(z.mbr instanceof v)){K.mbr=new F.Rectangle(z.mbr.minX,z.mbr.minY,z.mbr.maxX,z.mbr.maxY,O);
}return K;};e.geometry.Geometry.calculateMBR=function(B,A,t){var z={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};
var s=e.geometry.Geometry.getCoordsMBR;var y=B.length;var v=t?t:2;if(A==="Polygon"){z=s(B[0],v,z);}else{if(A==="MultiPolygon"){for(var u=0;
u<y;u++){z=s(B[u][0],v,z);}}else{if(A==="LineString"){z=s(B,v,z);}else{if(A==="MultiLineString"){for(var w=0;
w<y;w++){z=s(B[w],v,z);}}else{if(A==="Rectangle"){z={minX:B[0],minY:B[1],maxX:B[2],maxY:B[3]};}else{if(A==="Point"||A==="OrientedPoint"){z={minX:B[0],minY:B[1],maxX:B[0],maxY:B[1]};
}else{if(A==="MultiPoint"){for(var x=0;x<y;x++){z=s(B[x],v,z);}}else{if(A==="OrientedMultiPoint"){for(var C=0;
C<y;C++){z=s([B[C][0],B[C][1]],v,z);}}}}}}}}}return z;};e.geometry.Geometry.getCoordsMBR=function(u,w,v){if(u[0]<v.minX){v.minX=u[0];
}if(u[0]>v.maxX){v.maxX=u[0];}if(u[1]<v.minY){v.minY=u[1];}if(u[1]>v.maxY){v.maxY=u[1];}for(var t=w,s=u.length;
t<s;t+=w){if(u[t]<v.minX){v.minX=u[t];}else{if(u[t]>v.maxX){v.maxX=u[t];}}if(u[t+1]<v.minY){v.minY=u[t+1];
}else{if(u[t+1]>v.maxY){v.maxY=u[t+1];}}}return v;};e.geometry.Geometry.calculateGeomCollectionMBR=function(u,v){if(!u||u.length===0||v!==e.GeomTypes.GEOMETRYCOLLECTION){return null;
}var w;var x=null,s=null;for(var t=0;t<u.length;t++){w=u[t].coordinates;if(!w){continue;}s=e.geometry.Geometry.calculateMBR(w,u[t].type);
if(!x){x={};x.minX=s.minX;x.minY=s.minY;x.maxX=s.maxX;x.maxY=s.maxY;}else{if(x.minX>s.minX){x.minX=s.minX;
}if(x.minY>s.minY){x.minY=s.minY;}if(x.maxX<s.maxX){x.maxX=s.maxX;}if(x.maxY<s.maxY){x.maxY=s.maxY;}}}return x;
};e.geometry.Geometry.findSubstring=function(v,u){var t=u.wkti;var w=u.wktStr;var s=w.substring(t).match(v);
if(!s){return null;}else{t+=s[0].length;u.wkti=t;u.wktMatch=s[0];return u;}};e.geometry.Geometry.wktGetCoords=function(t){var u=[];
var v;var w=e.geometry;var s=w.Geometry.findSubstring;while(s(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,t)||s(/^(\,)/,t)){v=t.wktMatch;
if(v!=","){u.push(parseFloat(v));}s(/^\s*/,t);}t.wktCoords=u;return u.length?t:null;};e.geometry.Geometry.wktGetMulticoords=function(u){var z=e.geometry;
var t=z.Geometry.findSubstring;t(/^\s*/,u);var y=0,w=[],s=[],x=w,v;while(t(/^(\()/,u)||t(/^(\))/,u)||t(/^(\,)/,u)||t(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,u)){v=u.wktMatch;
if(v=="("){s.push(x);x=[];s[s.length-1].push(x);y++;}else{if(v==")"){x=s.pop();if(!x){return null;}y--;
if(y===0){break;}}else{if(v===","){}else{if(!isNaN(parseFloat(v))){x.push(parseFloat(v));}else{return null;
}}}}t(/^\s*/,u);}if(y!==0){return null;}u.wktCoords=w[0];return u;};e.geometry.Geometry.wktGetMulticoordsPoint=function(u){var z=e.geometry;
var t=z.Geometry.findSubstring;t(/^\s*/,u);var y=0,w=[],s=[w],x=w,v;while(t(/^(\()/,u)||t(/^(\))/,u)||t(/^(\,)/,u)||t(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,u)){v=u.wktMatch;
if(v=="("){s.push(x);x=[];s[s.length-1].push(x);y++;}else{if(v==")"){x=s.pop();if(!x){return;}y--;if(y===0){break;
}}else{if(v==","){x=[];s[s.length-1].push(x);}else{if(!isNaN(parseFloat(v))){x.push(parseFloat(v));}else{return null;
}}}}t(/^\s*/,u);}if(y!==0){return null;}u.wktCoords=w;return u;};e.geometry.Geometry.wktToPoint=function(v){var x=e.geometry;
var u=x.Geometry.findSubstring;if(!u(/^(point)/i,v)){return null;}u(/^\s*/,v);if(u(/^z/i,v)){v.wktDim=3;
u(/^\s*/,v);}if(!u(/^(\()/,v)){return null;}var w=[];if(!x.Geometry.wktGetCoords(v)){return null;}else{w=v.wktCoords;
}u(/^\s*/,v);if(!u(/^(\))/,v)){return null;}var s=8307;var t=new x.Point(w[0],w[1],s);if(v.wktDim==3){t.addDimension(w[2]);
}return t;};e.geometry.Geometry.wktToLinestring=function(u){var w=e.geometry;var t=w.Geometry.findSubstring;
if(!t(/^(linestring)/i,u)){return null;}t(/^\s*/,u);if(t(/^z/i,u)){u.wktDim=3;t(/^\s*/,u);}if(!t(/^(\()/,u)){return null;
}var v=[];if(!w.Geometry.wktGetCoords(u)){return null;}else{v=u.wktCoords;}if(!v){return null;}if(!t(/^(\))/,u)){return null;
}var s;if(u.wktDim==2){s=new w.LineString(v);}else{s=new w.LineString(v,8307,u.wktDim);}return s;};e.geometry.Geometry.wktToPolygon=function(u){var w=e.geometry;
var t=w.Geometry.findSubstring;if(!t(/^(polygon)/i,u)){return null;}t(/^\s*/,u);if(t(/^z/i,u)){u.wktDim=3;
t(/^\s*/,u);}var v=[];if(!w.Geometry.wktGetMulticoords(u)){return null;}else{v=u.wktCoords;}var s;if(u.wktDim==2){s=new w.Polygon(v);
}else{s=new w.Polygon(v,8307,u.wktDim);}return s;};e.geometry.Geometry.wktToMultipoint=function(u){var w=e.geometry;
var t=w.Geometry.findSubstring;if(!t(/^(multipoint)/i,u)){return null;}t(/^\s*/,u);if(t(/^z/i,u)){u.wktDim=3;
t(/^\s*/,u);}var v=[];if(!w.Geometry.wktGetMulticoordsPoint(u)){return null;}else{v=u.wktCoords;}t(/^\s*/,u);
var s;if(u.wktDim==2){s=new w.MultiPoint(v);}else{s=new w.MultiPoint(v,8307,u.wktDim);}return s;};e.geometry.Geometry.wktToMultilinestring=function(u){var w=e.geometry;
var t=w.Geometry.findSubstring;if(!t(/^(multilinestring)/i,u)){return null;}t(/^\s*/,u);if(t(/^z/i,u)){u.wktDim=3;
t(/^\s*/,u);}var v=[];if(!w.Geometry.wktGetMulticoords(u)){return null;}else{v=u.wktCoords;}var s;if(u.wktDim==2){s=new w.MultiLineString(v);
}else{s=new w.MultiLineString(v,8307,u.wktDim);}return s;};e.geometry.Geometry.wktToMultipolygon=function(u){var w=e.geometry;
var t=w.Geometry.findSubstring;if(!t(/^(multipolygon)/i,u)){return null;}t(/^\s*/,u);if(t(/^z/i,u)){u.wktDim=3;
t(/^\s*/,u);}var v=[];if(!w.Geometry.wktGetMulticoords(u)){return null;}else{v=u.wktCoords;}var s;if(u.wktDim==2){s=new w.MultiPolygon(v);
}else{s=new w.MultiPolygon(v,8307,u.wktDim);}return s;};e.geometry.Geometry.wktToGeometrycollection=function(v){var x=e.geometry;
var t=x.Geometry.findSubstring;var u=[],w;if(!t(/^(geometrycollection)/i,v)){return null;}t(/^\s*/,v);
if(t(/^z/i,v)){v.wktDim=3;t(/^\s*/,v);}if(!t(/^(\()/,v)){return null;}do{w=x.Geometry.root(v);if(w){u.push(w);
t(/^\s*/,v);t(/^(\,)/,v);t(/^\s*/,v);}else{break;}}while(w);if(!t(/^(\))/,v)){return null;}var s=new x.GeometryCollection(u);
return s;};e.geometry.Geometry.root=function(s){var t=e.geometry;return t.Geometry.wktToGeometrycollection(s)||t.Geometry.wktToPoint(s)||t.Geometry.wktToLinestring(s)||t.Geometry.wktToPolygon(s)||t.Geometry.wktToMultipoint(s)||t.Geometry.wktToMultilinestring(s)||t.Geometry.wktToMultipolygon(s);
};e.geometry.Geometry.createGeometryFromWKT=function(t){var s={wktStr:t,wkti:0,wktMatch:"",wktCoords:[],wktDim:2};
return e.geometry.Geometry.root(s);};e.geometry.Rectangle=e.geometry.Geometry.extend({initialize:function b(s,w,v,u,t){b.base.call(this,t);
this.setRectangle(s,w,v,u);},getCenter:function(){return new e.geometry.Point((this.getMaxX()-this.getMinX())/2+this.getMinX(),(this.getMaxY()-this.getMinY())/2+this.getMinY(),this.srid);
},getMinX:function(){return this.coordinates[0];},getMinY:function(){return this.coordinates[1];},getMaxX:function(){return this.coordinates[2];
},getMaxY:function(){return this.coordinates[3];},getWidth:function(){return this.coordinates[2]-this.coordinates[0];
},getHeight:function(){return this.coordinates[3]-this.coordinates[1];},setRectangle:function(s,x,w,v){var u=e.util.ValidationUtil.isNumber;
if(!u(s)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangle","minX:"+s);}if(!u(w)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangle","maxX:"+w);
}if(!u(x)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangle","minY:"+x);}if(!u(v)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangles","maxY:"+v);
}s=Number(s);x=Number(x);w=Number(w);v=Number(v);var t;if(s>w){t=w;w=s;s=t;}if(x>v){t=v;v=x;x=t;}this.type="Rectangle";
this.coordinates=[s,x,w,v];},getLength:function(){var s=this.coordinates;return(s[2]-s[0])*2+(s[3]-s[1])*2;
},getArea:function(){return this.getWidth()*this.getHeight();},move:function(t,s){this.coordinates[0]+=t;
this.coordinates[1]+=s;this.coordinates[2]+=t;this.coordinates[3]+=s;},expand:function(s){if(!s||s.type!==this.type){return;
}if(this.coordinates[0]>s.coordinates[0]){this.coordinates[0]=s.coordinates[0];}if(this.coordinates[1]>s.coordinates[1]){this.coordinates[1]=s.coordinates[1];
}if(this.coordinates[2]<s.coordinates[2]){this.coordinates[2]=s.coordinates[2];}if(this.coordinates[3]<s.coordinates[3]){this.coordinates[3]=s.coordinates[3];
}},toGML:function(){var s='<gml:Polygon srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml">';
s+="<gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>";s+=this.getMinX()+","+this.getMinY()+" "+this.getMaxX()+","+this.getMinY()+" ";
s+=this.getMaxX()+","+this.getMaxY()+" "+this.getMinX()+","+this.getMaxY()+" ";s+=this.getMinX()+","+this.getMinY()+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs>";
s+="</gml:Polygon>";return s;},toWKT:function(){if(this.type!="Rectangle"){return null;}var s="POLYGON ("+this.coordinates[0]+" "+this.coordinates[1]+", "+this.coordinates[0]+" "+this.coordinates[3]+", "+this.coordinates[2]+" "+this.coordinates[3]+", "+this.coordinates[2]+" "+this.coordinates[1]+", "+this.coordinates[0]+" "+this.coordinates[1]+")";
return s;}});e.geometry.Point=e.geometry.Geometry.extend({initialize:function b(s,z,u,v,t){b.base.call(this,u);
var w=e.util.ValidationUtil.isNumber;if(!w(s)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","x:"+s);
}if(!w(z)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","y:"+z);}if(e.notNull(v)&&e.notNull(t)){if(!w(v)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","orientationX:"+v);
}if(!w(t)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","orientationY:"+t);}this.type="OrientedPoint";
this.coordinates=[Number(s),Number(z),Number(v),Number(t)];}else{this.type="Point";this.coordinates=[Number(s),Number(z)];
}},setPointIndex:function(s){if(e.notNull(s)){this.wraparoundMapIndex=s;}},equals:function(s){if(e.isNull(s)){return false;
}if(s.type!==this.type){return false;}if(s.srid!==this.srid){return false;}if(s.dim!==this.dim){return false;
}if(s.coordinates.length!==this.coordinates.length){return false;}for(var t=0;t<this.coordinates.length;
t++){if(this.coordinates[t]!==s.coordinates[t]){return false;}}return true;},getX:function(){return this.coordinates[0];
},getY:function(){return this.coordinates[1];},getDimensionValue:function(s){if(s<0||s>(this.dim-1)){return f;
}return this.coordinates[s];},getOrientationX:function(){if(this.type==="OrientedPoint"){return this.coordinates[this.dim];
}else{return f;}},getOrientationY:function(){if(this.type==="OrientedPoint"){return this.coordinates[this.dim+1];
}else{return f;}},getOrientationValue:function(s){if(s<0||s>(this.dim-1)||this.type!=="OrientedPoint"){return f;
}return this.coordinates[this.dim+s];},isOriented:function(){if(this.coordinates.length>this.dim){return true;
}else{return false;}},getLength:function(){return 0;},getArea:function(){return 0;},setPoint:function(s,u){var t=e.util.ValidationUtil.isNumber;
if(!t(s)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","x:"+s);}if(!t(u)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","y:"+u);
}this.coordinates[0]=Number(s);this.coordinates[1]=Number(u);},setDimensionValue:function(t,s){if(t<0||t>(this.dim-1)){return;
}this.coordinates[t]=s;},setOrientationValue:function(t,s){if(t<0||t>(this.dim-1)||this.type!=="OrientedPoint"){return;
}this.coordinates[this.dim+t]=s;},move:function i(t,s){this.x+=t;this.y+=s;i.base.call(this,t,s);},toGML:function(){var t=e.util.GeomUtil.getOGCOrdinateString(this.coordinates,this.dim);
var s='<gml:Point srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml"><gml:coordinates decimal="." cs="," ts=" ">';
s=s+t+"</gml:coordinates></gml:Point>";return s;},toWKT:function(){if((this.type!=="Point")&&(this.type!=="OrientedPoint")){return null;
}var t;var s=this.dim;if(this.type==="Point"){t=e.util.GeomUtil.getWktCoordinateStringFromPoint(this.coordinates,s);
}else{t=e.util.GeomUtil.getWktCoordinateStringFromOrientedPoint(this.coordinates,s);}var u="POINT";if(s==2){u+=" (";
}else{if(s==3){u+=" Z (";}else{return null;}}u+=t+")";return u;},getOrientationPoint:function(s,v,w){if(e.isNull(w)){if(this.isOriented()){w=Math.atan2(this.coordinates[this.dim+1],this.coordinates[this.dim]);
}else{return null;}}var t=s*Math.cos(w)*v.resolution;var u=s*Math.sin(w)*v.resolution*v.stretchRatio;
return new e.geometry.Point(this.coordinates[0]+t,this.coordinates[1]+u,this.srid);},addDimension:function(s,t){if(this.type==="OrientedPoint"){if(e.isNull(t)){this.coordinates.push(0);
}else{this.coordinates.push(t);}this.coordinates.splice(this.dim,0,s);}else{this.coordinates.push(s);
}this.dim++;},removeDimension:function(s){if(s<2||s>(this.dim-1)){return;}if(this.type==="OrientedPoint"){this.coordinates.splice(this.dim+s,1);
}this.coordinates.splice(this.dim-1,1);this.dim--;}});e.geometry.LineString=e.geometry.Geometry.extend({initialize:function b(t,s,u){b.base.call(this,s);
if(e.isNull(t)||!e.util.ValidationUtil.isNumberArray(t)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.LineString","ordinates:"+t);
}if(t.length<4){e.util.Logger.throwErr("MAPVIEWER_9011","geom.LineString","ordinates:"+t);}this.dim=u||2;
this.type="LineString";this.coordinates=t;},toGML:function(){var t=e.util.GeomUtil.getOGCOrdinateString(this.coordinates,this.dim);
var s='<gml:LineString srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml"><gml:coordinates decimal="." cs="," ts=" ">';
s=s+t+"</gml:coordinates></gml:LineString>";return s;},toWKT:function(){if(this.type!="LineString"){return null;
}var s="LINESTRING";var t=this.dim;if(t==2){s+=" (";}else{if(t==3){s+=" Z (";}else{return null;}}var u=e.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates,t);
s+=u;s=s.substring(0,s.length-1);s+=")";return s;},getFirstPoint:function(){var s=this.coordinates;if(s.length<2){return null;
}return new e.geometry.Point(s[0],s[1],this.srid);},getLastPoint:function(){var t=this.coordinates;if(t.length<2){return null;
}var s=t.length;return new e.geometry.Point(t[s-2],t[s-1],this.srid);}});e.geometry.LineString.create=function(t){if(e.isNull(t)||t.length<2){e.util.Logger.throwErr("MAPVIEWER_9018","geom.LineString.create","pointArray:"+t);
}var s=e.util.GeomUtil.flatten(t,"Point");if(!s){e.util.Logger.throwErr("MAPVIEWER_9018","geom.LineString.create","pointArray:"+t);
}return new e.geometry.LineString(s.ordinates,s.srid);};e.geometry.Polygon=e.geometry.Geometry.extend({initialize:function b(u,s,v){b.base.call(this,s);
var t=e.util.ValidationUtil;if(e.isNull(u)||u.length===0){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon","ordinates:"+u);
}if(t.isNumberArray(u)){u=[u];}if(!t.isNumberArray(u[0])){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon","ordinates:"+u);
}if(e.notNull(v)){this.dim=v;}this.type="Polygon";this.coordinates=u;},toGML:function(){var v=e.util.GeomUtil.getOGCOrdinateString(this.coordinates[0],this.dim);
var s='<gml:Polygon srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml">';s+='<gml:outerBoundaryIs><gml:LinearRing><gml:coordinates decimal="." cs="," ts=" ">';
s+=v+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs>";if(this.coordinates.length>1){for(var u=1;
u<this.coordinates.length;u++){var t=e.util.GeomUtil.getOGCOrdinateString(this.coordinates[u],this.dim);
s+='<gml:innerBoundaryIs><gml:LinearRing><gml:coordinates decimal="." cs="," ts=" ">';s+=t+"</gml:coordinates></gml:LinearRing></gml:innerBoundaryIs>";
}}s+="</gml:Polygon>";return s;},toWKT:function(){if(this.type!=="Polygon"){return null;}var u=this.coordinates.length;
var t="POLYGON";var v=this.dim;if(v==2){t+=" (";}else{if(v==3){t+=" Z (";}else{return null;}}for(var s=0;
s<u;s++){var w=e.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates[s],v);t+="("+w;t=t.substring(0,t.length-1);
t+="), ";}t=t.substring(0,t.length-2);t+=")";return t;}});e.geometry.Polygon.createCirclePolygon=function(v,u,x,A){if(!A){A=8307;
}var z=[];var y=480;var s=Math.PI*2/y;for(var w=0;w<y;w++){var t=w*s;z[w*2]=v+x*Math.cos(t);z[w*2+1]=u+x*Math.sin(t);
}z[y*2]=z[0];z[y*2+1]=z[1];return new e.geometry.Polygon(z,A);};e.geometry.Polygon.createGeodeticCirclePolygon=function(y,x,t,u){if(!u){u=8307;
}var w=[];for(var v=0;v<36;v++){var s=e.util.GeomUtil.getPointAtBearing(y,x,t,v*Math.PI/18);w[v*2]=s.x;
w[v*2+1]=s.y;}w[72]=w[0];w[73]=w[1];return new e.geometry.Polygon(w,u);};e.geometry.Polygon.create=function(s,v){if(e.isNull(s)||s.length<3){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon.create","pointArray:"+s);
}var u=e.util.GeomUtil.flatten(s,"Point");if(!u){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon.create","pointArray:"+s);
}if(v&&v.length>2){var t=e.util.GeomUtil.flatten(v,"Point");if(!t){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon.create","outerPointArray:"+v);
}else{if(u.srid!==t.srid){e.util.Logger.throwErr("MAPVIEWER_9033","geom.Polygon.create","");}}return new e.geometry.Polygon([u.ordinates,t.ordinates],u.srid);
}return new e.geometry.Polygon([u.ordinates],u.srid);};e.geometry.Circle=e.geometry.Geometry.extend({initialize:function b(w,v,s,t){b.base.call(this,t);
var u=e.util.ValidationUtil.isNumber;if(!u(w)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle","centerX:"+w);
}if(!u(v)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle","centerY:"+v);}if(!u(s)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle","radius:"+s);
}this.centerX=Number(w);this.centerY=Number(v);this.radius=Number(s);this.toCirclePolygon();this.type="Polygon";
},getRadius:function(){return this.radius;},getCenterX:function(){return this.centerX;},getLength:function(){return 2*3.141592653589793*this.radius;
},getArea:function(){return 3.141592653589793*this.radius*this.radius;},getCenterY:function(){return this.centerY;
},setCircle:function(v,u,s){var t=e.util.ValidationUtil.isNumber;if(!t(v)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle","centerX:"+v);
}if(!t(u)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle","centerY:"+u);}if(!t(s)){e.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle","radius:"+s);
}this.centerX=Number(v);this.centerY=Number(u);this.radius=Number(s);this.toCirclePolygon();},toCirclePolygon:function(){if(this.circlePolygon){return;
}this.circlePolygon=e.geometry.Polygon.createCirclePolygon(this.centerX,this.centerY,this.radius,this.srid);
this.coordinates=this.circlePolygon.coordinates;},move:function i(t,s){this.centerX+=t;this.centerY+=s;
i.base.call(this,t,s);},toGML:function(){return this.circlePolygon.toGML();},toWKT:function(){return this.circlePolygon.toWKT();
}});e.geometry.MultiPoint=e.geometry.Geometry.extend({initialize:function b(x,t,y){b.base.call(this,t);
var v=e.util.ValidationUtil;if(e.isNull(x)||x.length<1){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint","ordinates:"+x);
}if(!v.isNumberArray(x[0])){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint","ordinates:"+x);
}if(e.notNull(y)){this.dim=y;}var s=x.length;var u=true;for(var w=0;w<s;w++){if(x[w].length<(this.dim*2)){u=false;
}}if(u){this.type="OrientedMultiPoint";}else{this.type="MultiPoint";}this.coordinates=x;},getLength:function(){return 0;
},getArea:function(){return 0;},toGML:function(){var s=this.coordinates.length;var u='<gml:MultiPoint srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml">';
for(var t=0;t<s;t++){var v=e.util.GeomUtil.getOGCOrdinateString(this.coordinates[t],this.dim);u+="<gml:pointMember>";
u+='<gml:Point srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml"><gml:coordinates decimal="." cs="," ts=" ">';
u+=v+"</gml:coordinates></gml:Point>";u+="</gml:pointMember>";}u+="</gml:MultiPoint>";return u;},toWKT:function(){if(this.type!="MultiPoint"){return null;
}var t=this.coordinates.length;var s="MULTIPOINT";var v=this.dim;if(v==2){s+=" (";}else{if(v==3){s+=" Z (";
}else{return null;}}for(var u=0;u<t;u++){var w=e.util.GeomUtil.getWktCoordinateStringFromPoint(this.coordinates[u],v);
s+=w+", ";}s=s.substring(0,s.length-2);s+=")";return s;}});e.geometry.MultiPoint.create=function(t){if(e.isNull(t)||t.length<2){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint.create","pointArray:"+t);
}var s=e.util.GeomUtil.flatten(t,"Point",true);if(!s){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint.create","pointArray:"+t);
}return new e.geometry.MultiPoint(s.ordinates,s.srid);};e.geometry.MultiLineString=e.geometry.Geometry.extend({initialize:function b(w,t,x){b.base.call(this,t);
var u=e.util.ValidationUtil;var s=e.isNull(w)?0:w.length;if(s<1){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString","ordinates:"+w);
}for(var v=0;v<s;v++){if(e.isNull(w[v])||!u.isNumberArray(w[v])){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString","ordinates:"+w);
}}if(e.notNull(x)){this.dim=x;}this.type="MultiLineString";this.coordinates=w;},toGML:function(){var u=this.coordinates.length;
var s='<gml:MultiLineString srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml">';for(var t=0;
t<u;t++){s=s+"<gml:lineStringMember>";var v=e.util.GeomUtil.getOGCOrdinateString(this.coordinates[t],this.dim);
s+='<gml:LineString srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml"><gml:coordinates decimal="." cs="," ts=" ">';
s+=v+"</gml:coordinates></gml:LineString>";s=s+"</gml:lineStringMember>";}s=s+"</gml:MultiLineString>";
return s;},toWKT:function(){if(this.type!=="MultiLineString"){return null;}var u=this.coordinates.length;
var s="MULTILINESTRING";var v=this.dim;if(v==2){s+=" (";}else{if(v==3){s+=" Z (";}else{return null;}}for(var t=0;
t<u;t++){var w=e.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates[t],v);s+="("+w;s=s.substring(0,s.length-1);
s+="), ";}s=s.substring(0,s.length-2);s+=")";return s;}});e.geometry.MultiLineString.create=function(t){if(e.isNull(t)||t.length<2){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString.create","lineArray:"+t);
}var s=e.util.GeomUtil.flatten(t,"LineString",true);if(!s){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString.create","lineArray:"+t);
}return new e.geometry.MultiLineString(s.ordinates,s.srid);};e.geometry.MultiPolygon=e.geometry.Geometry.extend({initialize:function b(w,t,x){b.base.call(this,t);
var u=e.util.ValidationUtil;var s=e.isNull(w)?0:w.length;if(s<1){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon","ordinates:"+w);
}for(var v=0;v<s;v++){if(e.isNull(w[v])||w[v].length===0){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon","ordinates:"+w);
}if(u.isNumberArray(w[v])){w[v]=[w[v]];}if(!u.isNumberArray(w[v][0])){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon","ordinates:"+w);
}}if(e.notNull(x)){this.dim=x;}this.type="MultiPolygon";this.coordinates=w;},_getMeasure:function(y){var v=this.coordinates,u=v.length,s;
var z=null;var x=0;if(y==="area"){z=e.util.GeomUtil.polygonArea;}else{if(y==="length"){z=e.util.GeomUtil.polylineLength;
}}for(var w=0;w<u;w++){s=v[w];if(e.$.isArray(s[0])){for(var t=0;t<s.length;t++){x=x+z(s[t],this.dim);
}}else{x=x+z(s,this.dim);}}return x;},toGML:function(){var s=this.coordinates.length;var x='<gml:MultiPolygon srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml">';
for(var w=0;w<s;w++){x+="<gml:polygonMember>";var v=e.util.GeomUtil.getOGCOrdinateString(this.coordinates[w][0],this.dim);
x+='<gml:Polygon srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml">';x+='<gml:outerBoundaryIs><gml:LinearRing><gml:coordinates decimal="." cs="," ts=" ">';
x+=v+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs>";if(this.coordinates[w].length>1){for(var u=1;
u<this.coordinates[w].length;u++){var t=e.util.GeomUtil.getOGCOrdinateString(this.coordinates[w][u],this.dim);
x+='<gml:innerBoundaryIs><gml:LinearRing><gml:coordinates decimal="." cs="," ts=" ">';x+=t+"</gml:coordinates></gml:LinearRing></gml:innerBoundaryIs>";
}}x+="</gml:Polygon>";x+="</gml:polygonMember>";}x+="</gml:MultiPolygon>";return x;},toWKT:function(){if(this.type!=="MultiPolygon"){return null;
}var w=this.coordinates.length;var z="MULTIPOLYGON";var x=this.dim;if(x==2){z+=" (";}else{if(x==3){z+=" Z (";
}else{return null;}}for(var u=0;u<w;u++){var s=this.coordinates[u].length;var v=this.coordinates[u];z+="(";
for(var t=0;t<s;t++){var y=e.util.GeomUtil.getWktCoordinateStringFromLine(v[t],x);z+="("+y;z=z.substring(0,z.length-1);
z+="), ";}z=z.substring(0,z.length-2);z+="), ";}z=z.substring(0,z.length-2);z+=")";return z;}});e.geometry.MultiPolygon.create=function(t){if(e.isNull(t)||t.length<2){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon.create","polygonArray:"+t);
}var s=e.util.GeomUtil.flatten(t,"Polygon",true);if(!s){e.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon.create","polygonArray:"+t);
}return new e.geometry.MultiPolygon(s.ordinates,s.srid);};e.geometry.GeometryCollection=e.geometry.Geometry.extend({initialize:function b(u,t){b.base.call(this,t);
var s=u.length;for(var v=0;v<s;v++){if(u[v] instanceof e.geometry.Geometry){if(e.isNull(t)){u[v].srid=t;
}else{if(u[v].srid!==t){u[v]=u[v].transform(t);}}}else{e.util.Logger.throwErr("MAPVIEWER_9018","geom.GeometryCollection","geometryArray:"+u);
}}this.geometries=u;this.type="GeometryCollection";},getMBR:function(){if(!this.mbr){var s=e.geometry.Geometry.calculateGeomCollectionMBR(this.geometries,this.type);
this.mbr=new e.geometry.Rectangle(s.minX,s.minY,s.maxX,s.maxY,this.srid);}return this.mbr;},toString:function(){var t="{";
t+='"type":"'+this.type+'",';t+='"srid":'+this.srid+",";t+='"geometries":[';var s=this.geometries.length;
for(var u=0;u<s;u++){t+=this.geometries[u].toString()+",";}s=t.length;t=t.substring(0,s-1);t+="]}";return t;
},clientTransform:function(u){var t=this.geometries.length;var s=new Array(t);for(var v=0;v<t;v++){s[v]=this.geometries[v].transform(u);
}return new e.geometry.GeometryCollection(s,u);},move:function(v,u){var s=this.geometries.length;for(var t=0;
t<s;t++){this.geometries[t].move(v,u);}if(this.mbr){this.mbr.move(v,u);}},toGML:function(){var s=this.geometries.length;
var u='<gml:MultiGeometry srsName="SDO:'+this.srid+'" xmlns:gml="http://www.opengis.net/gml">';for(var t=0;
t<s;t++){u+="<gml:geometryMember>";u+=this.geometries[t].toGML();u+="</gml:geometryMember>";}u+="</gml:MultiGeometry>";
return u;},toWKT:function(){if(this.type!="GeometryCollection"){return null;}var s=this.geometries.length;
var t="GEOMETRYCOLLECTION (";for(var u=0;u<s;u++){t+=this.geometries[u].toWKT();t+=", ";}t=t.substring(0,t.length-2);
t+=")";return t;}});e.event.EventSource={addListener:function(t,v,s){this._omListeners=this._omListeners||{};
var u=this._omListeners;u[t]=u[t]||[];u[t].push({listener:v,context:s||this});return this;},hasListener:function(t){var s="_omListeners";
return(s in this)&&(t in this[s])&&(this[s][t].length>0);},getListeners:function(s){if(this.hasListener(s)){return this._omListeners[s];
}else{return[];}},deleteListener:function(v,x,u){if(!this.hasListener(v)){return this;}for(var t=0,w=this._omListeners,s=w[v].length;
t<s;t++){if((w[v][t].listener===x)&&(!u||(w[v][t].context===u))){w[v].splice(t,1);return this;}}return this;
},deleteListeners:function(s){if(!this.hasListener(s)){return this;}this._omListeners[s]=[];return this;
},deleteAllListeners:function(){this._omListeners={};return this;},fire:function(s){if(!this.hasListener(s)){return this;
}var z=this._omListeners[s].slice(),y=[].slice.apply(arguments),w,A;if(y.length>=2){y.splice(0,1);}for(var v=0,x=z.length;
v<x;v++){w=z[v].listener;if(!w){continue;}A=z[v].context||this;try{if(y.length>0){w.apply(A,y);}else{w.call(A);
}}catch(u){var t=u.message;if(u.stack){t+="\nStack: "+u.stack;}e.util.Logger.warning("MAPVIEWER_9032","EventSource.fire",t);
}}return this;},stopEvents:{}};e.event.EventSource.on=e.event.EventSource.addListener;e.event.Event=e.Class.extend({initialize:function b(s,t){if(e.isNull(s)||e.isNull(t)){return null;
}this.type=s;this.target=t;this.evt=null;}});e.event.MapEvent=e.event.Event.extend({initialize:function b(s,t){b.base.call(this,s,t);
this.beforeZoomLevel=null;this.affectedLayer=null;this.preMapCenter=null;}});e.event.MapEvent.I_MAP_CENTER_ZOOM="i_mapCenterZoom";
e.event.MapEvent.I_MAP_DRAGGING="i_mapDragging";e.event.MapEvent.MAP_BEFORE_ZOOM="mapBeforeZoom";e.event.MapEvent.MAP_AFTER_ZOOM="mapAfterZoom";
e.event.MapEvent.MAP_RECENTERED="mapRecentered";e.event.MapEvent.MAP_INITIALIZED="mapInitialized";e.event.MapEvent.MAP_RESET_UNIVERSE="mapResetUniverse";
e.event.MapEvent.MAP_RESIZED="mapResized";e.event.MapEvent.MAP_BEFORE_REFRESH="mapBeforeRefresh";e.event.MapEvent.MAP_AFTER_REFRESH="mapAfterRefresh";
e.event.MapEvent.MAP_REDRAW="mapRedraw";e.event.MapEvent.LAYER_ADDED="layerAdded";e.event.MapEvent.LAYER_DELETED="layerDeleted";
e.event.MapEvent.LAYER_REORDERED="layerReordered";e.event.MapEvent.MAP_DESTROY="mapDestroy";e.event.MapEvent.MAP_RESTRICT_CENTER="mapRestrictCenter";
e.event.MapEvent.MAP_STYLE_CHANGED="mapStyleChanged";e.event.MapEvent.MAP_CLEAN="mapClean";e.event.MapEvent.I_MAP_NSDP_MAPPED="mapNSDPMapped";
e.event.KeyboardEvent=e.event.Event.extend({initialize:function b(s,t){b.base.call(this,s,t);this.event=null;
}});e.event.KeyboardEvent.KEY_DOWN="keyDown";e.event.KeyboardEvent.KEY_UP="keyUp";e.event.LayerEvent=e.event.Event.extend({initialize:function b(s,t){b.base.call(this,s,t);
this.affectedFeature=null;}});e.event.LayerEvent.BEFORE_REFRESH="beforeFresh";e.event.LayerEvent.AFTER_REFRESH="afterFresh";
e.event.LayerEvent.FEATURE_SELECTED="featureSelected";e.event.LayerEvent.FEATURE_DESELECTED="featureDeselected";
e.event.LayerEvent.RENDERING_STYLE_CHANGED="renderingStyleChanged";e.event.LayerEvent.LABELING_STYLE_CHANGED="labelingStyleChanged";
e.event.LayerEvent.SELECTION_STYLE_CHANGED="selectionStyleChanged";e.event.LayerEvent.HOVER_STYLE_CHANGED="hoverStyleChanged";
e.event.LayerEvent.RESULT_STYLE_CHANGED="resultStyleChanged";e.event.LayerEvent.LABEL_VISIBILITY_CHANGED="labelVisibilityChanged";
e.event.LayerEvent.LAYER_VISIBILITY_CHANGED="layerVisibilityChanged";e.event.LayerEvent.LAYER_REMOVED="layerRemoved";
e.event.LayerEvent.LAYER_INITIALIZED="layerInitialized";e.event.LayerEvent.FEATURE_MOVING="featureMoving";
e.event.LayerEvent.FEATURE_MOVED="featureMoved";e.event.LayerEvent.FEATURE_EDITED="featureEdited";e.event.LayerEvent.FEATURE_ORIENTATION_CHANGING="featureOrientationChanging";
e.event.LayerEvent.LAYER_Z_INDEX_CHANGED="layerZIndexChanged";e.event.LayerEvent.LAYER_INIT="layerInit";
e.event.LayerEvent.FINISH_GOT_CONFIG="layerFinishGotConfig";e.event.LayerEvent.FINISH_LOAD="layerFinishLoad";
e.event.LayerEvent.TILE_IMG_LOADED="tileImgLoaded";e.event.LayerEvent.ALL_TILES_LOADED="allTilesImgLoaded";
e.event.LayerEvent.TILE_IMG_LOAD_ERROR="tileImgLoadError";e.event.LayerEvent.TILE_IMG_LOADING="tileImgLoading";
e.event.LayerEvent.VECTOR_LAYER_LOADING_THEME="GETTING_THEME_DATA";e.event.LayerEvent.VECTOR_LAYER_PARSING_THEME="PARSING_THEME_DATA";
e.event.LayerEvent.FEATURES_LOADED="featuresLoad";e.event.LayerEvent.FEATURES_DISPLAYED="featuresDisplay";
e.event.LayerEvent.INIT_ERROR="initError";e.event.LayerEvent.NSDP_MAPPED="nsdpMapped";e.event.MapDecorationEvent=e.event.Event.extend({initialize:function b(s,t){b.base.call(this,s,t);
}});e.event.MapDecorationEvent.BEFORE_COLLAPSE="beforeCollapse";e.event.MapDecorationEvent.AFTER_COLLAPSE="afterCollapse";
e.event.MapDecorationEvent.BEFORE_RESTORE="beforeRestore";e.event.MapDecorationEvent.AFTER_RESTORE="afterRestore";
e.event.MapDecorationEvent.DRAG_START="dragStart";e.event.MapDecorationEvent.DRAG="drag";e.event.MapDecorationEvent.DRAG_END="dragEnd";
e.event.MapDecorationEvent.DISPLAYED="displayed";e.event.MouseEvent=e.event.Event.extend({initialize:function b(s,t){b.base.call(this,s,t);
this.location=null;this.feature=null;}});e.event.MouseEvent.MOUSE_DOWN="mouseDown";e.event.MouseEvent.MOUSE_UP="mouseUp";
e.event.MouseEvent.MOUSE_MOVE="mouseMove";e.event.MouseEvent.MOUSE_OVER="mouseOver";e.event.MouseEvent.MOUSE_OUT="mouseOut";
e.event.MouseEvent.MOUSE_CLICK="click";e.event.MouseEvent.MOUSE_RIGHT_CLICK="rightClick";e.event.MouseEvent.MOUSE_DOUBLE_CLICK="doubleClick";
e.event.MouseEvent.WHEEL_SCROLL="wheelScroll";e.event.MouseEvent.TOUCH_TAP="tap";e.event.MouseEvent.TOUCH_LONG_PRESS="touchlongpress";
e.event.MouseEvent.TOUCH_END="touchend";e.event.MouseEvent.TOUCH_START="touchstart";e.event.MouseEvent.MOUSE_ENTER="mouseEnter";
e.event.MouseEvent.MOUSE_LEAVE="mouseLeave";e.event.ToolEvent=e.event.Event.extend({initialize:function b(s,t){b.base.call(this,s,t);
this.location=null;}});e.event.ToolEvent.TOOL_START="toolStart";e.event.ToolEvent.TOOL_END="toolEnd";
e.event.ToolEvent.TOOL_CLEAR="toolClear";e.event.ToolEvent.RECTANGLE_DRAG="rectangleDrag";e.event.ToolEvent.CIRCLE_DRAG="circleDrag";
e.event.ToolEvent.REDLINE_POINT_CREATE="redlinePointCreate";e.event.ToolEvent.REDLINE_POINT_REMOVE="redlinePointRemove";
e.event.ToolEvent.REDLINE_DRAW="redlineDraw";e.event.ToolEvent.REDLINE_EDITED="redlineEdited";e.event.ToolEvent.DISTANCE_UPDATE="distanceUpdate";
e.event.ToolEvent.SNAP_POINT="snapPoint";e.event.ToolEvent.MOUSE_RIGHT_CLICK="mouseRightClick";e.event.ToolbarEvent=e.event.Event.extend({initialize:function b(s,t){b.base.call(this,s,t);
}});e.event.ToolbarEvent.BUTTON_STATE_CHANGE="buttonStateChange";e.event.ToolbarEvent.BUTTON_DOWN="buttonDown";
e.event.ToolbarEvent.BUTTON_UP="buttonUp";e.universe.ZoomLevel=e.Class.extend({initialize:function(t,s){if(e.isNull(t)||!e.util.ValidationUtil.isNumber(t)){return;
}this.resolution=t;this.stretchRatio=1;if(s&&s.stretchRatio){this.stretchRatio=s.stretchRatio;}this.infotip=null;
if(s&&s.infotip){this.infotip=s.infotip;}}});e.universe.Universe=e.Class.extend({initialize:function(t){if(e.isNull(t)||!e.util.ValidationUtil.isObject(t)||e.isNull(t.srid)||!t.bounds){return null;
}this.srid=t.srid;this.bound=t.bounds;if(this.bound.srid!==this.srid){this.bound=this.bound.transform(this.srid);
}if(t.geodetic){this.geodetic=t.geodetic;}else{this.geodetic=(this.srid&&this.srid===8307);}if(!t.zoomLevels&&t.numberOfZoomLevels){this.zoomLevels=[];
var v=this.bound;var w=Math.abs(v.getMaxX()-v.getMinX())/256;var s=Math.abs(v.getMaxY()-v.getMinY())/256;
if(s>w){w=s;}for(var u=0;u<t.numberOfZoomLevels;u++){this.zoomLevels[u]=new e.universe.ZoomLevel(w);w=w/2;
}}else{this.zoomLevels=t.zoomLevels;}this.homeCenter=null;this.homeZoomlevel=null;},getSRID:function(){return this.srid;
},getMapBounds:function(){return this.bound;},getZoomLevelNumber:function(){return this.zoomLevels.length;
},getZoomLevels:function(){return this.zoomLevels;},equals:function(u){if(this.srid!==u.srid){return false;
}if(this.zoomLevels&&u.zoomLevels&&this.zoomLevels.length!==u.zoomLevels.length){return false;}var s=this.zoomLevels.length;
for(var t=0;t<s;t++){if(this.zoomLevels[t].resolution!==u.zoomLevels[t].resolution||this.zoomLevels[t].stretchRatio!==u.zoomLevels[t].stretchRatio){return false;
}}return true;},clone:function(){var s={};e.$.extend(s,this);return s;},copy:function(s){this.homeCenter=s.homeCenter;
this.homeZoomlevel=s.homeZoomlevel;return this;}});e.universe.WorldMercatorUniverse=e.universe.Universe.extend({initialize:function b(){var t=e.universe.ZoomLevel;
var s={srid:3857,bounds:new e.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new t(78271.515625),new t(39135.7578125),new t(19567.87890625),new t(9783.939453125),new t(4891.9697265625),new t(2445.98486328125),new t(1222.992431640625),new t(611.4962158203125),new t(305.74810791015625),new t(152.87405395507812),new t(76.43702697753906),new t(38.21851348876953),new t(19.109256744384766),new t(9.554628372192383),new t(4.777314186096191),new t(2.3886570930480957),new t(1.1943285465240479),new t(0.5971642732620239),new t(0.29858213663101196)]};
b.base.call(this,s);}});e.universe.ElocationUniverse=e.universe.Universe.extend({initialize:function b(){var t=e.universe.ZoomLevel;
var s={srid:3857,bounds:new e.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new t(78271.515625),new t(39135.7578125),new t(19567.87890625),new t(9783.939453125),new t(4891.9697265625),new t(2445.98486328125),new t(1222.992431640625),new t(611.4962158203125),new t(305.74810791015625),new t(152.87405395507812),new t(76.43702697753906),new t(38.21851348876953),new t(19.109256744384766),new t(9.554628372192383),new t(4.777314186096191),new t(2.3886570930480957),new t(1.1943285465240479),new t(0.5971642732620239),new t(0.29858213663101196)]};
b.base.call(this,s);}});e.universe.SElocationUniverse=e.universe.Universe.extend({initialize:function b(){var t=e.universe.ZoomLevel;
var s={srid:3857,bounds:new e.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new t(52181.010416666664),new t(31308.60625),new t(17393.67013888889),new t(9208.413602941177),new t(4743.72821969697),new t(2371.864109848485),new t(1185.9320549242425),new t(592.9660274621212),new t(297.04560009487665),new t(148.52280004743832),new t(74.26140002371916),new t(37.12189500829974),new t(18.56314849401162),new t(9.28157424700581),new t(4.640511983458825),new t(2.3201184380187336),new t(1.1599302843826644),new t(0.5799651421913322),new t(0.2897185251365837)]};
b.base.call(this,s);}});e.universe.LatLonUniverse=e.universe.Universe.extend({initialize:function b(){var t=e.universe.ZoomLevel;
var s={srid:8307,bounds:new e.geometry.Rectangle(-180,-90,180,90,8307),zoomLevels:[new t(180/256),new t(90/256),new t(45/256),new t(22.5/256),new t(11.25/256),new t(5.625/256),new t(2.8125/256),new t(1.40625/256),new t(0.703125/256),new t(0.3515625/256),new t(0.17578125/256),new t(0.087890625/256),new t(0.0439453125/256),new t(0.02197265625/256),new t(0.010986328125/256),new t(0.0054931640625/256),new t(0.00274658203125/256),new t(0.001373291015625/256),new t(0.0006866455078125/256)]};
b.base.call(this,s);}});e.universe.OSMUniverse=e.universe.Universe.extend({initialize:function b(){var t=e.universe.ZoomLevel;
var s={srid:3857,bounds:new e.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new t(156543.03125),new t(78271.515625),new t(39135.7578125),new t(19567.87890625),new t(9783.939453125),new t(4891.9697265625),new t(2445.98486328125),new t(1222.992431640625),new t(611.4962158203125),new t(305.74810791015625),new t(152.87405395507812),new t(76.43702697753906),new t(38.21851348876953),new t(19.109256744384766),new t(9.554628372192383),new t(4.777314186096191),new t(2.3886570930480957),new t(1.1943285465240479),new t(0.5971642732620239)]};
b.base.call(this,s);}});e.universe.TomTomUniverse=e.universe.Universe.extend({initialize:function b(){var t=e.universe.ZoomLevel;
var s={srid:3857,bounds:new e.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new t(5009382.4/256),new t(2504678.4/256),new t(1252352/256),new t(626176/256),new t(313088/256),new t(156544/256),new t(78259.2/256),new t(39142.4/256),new t(19558.4/256),new t(9779.2/256),new t(4889.6/256),new t(2457.6/256),new t(1228.8/256),new t(614.4/256),new t(307.2/256),new t(152.8/256)]};
b.base.call(this,s);}});e.universe.LocationBoxUniverse=e.universe.Universe.extend({initialize:function b(){var t=e.universe.ZoomLevel;
var s={srid:3857,bounds:new e.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new t(4891.9697265625),new t(2445.98486328125),new t(1222.992431640625),new t(611.4962158203125),new t(305.74810791015625),new t(152.87405395507812),new t(76.43702697753906),new t(38.21851348876953),new t(19.109256744384766),new t(9.554628372192383),new t(4.777314186096191),new t(2.3886570930480957),new t(1.1943285465240479),new t(0.5971642732620239),new t(0.29858213663101196)]};
b.base.call(this,s);}});e.style.Style=e.Class.extend({initialize:function(s){this.origConfig=e.isNull(s)?null:e.$.extend(true,{},s);
this.styleName=(s&&s.styleName)?s.styleName:this.generateName();this.styleType=(s&&s.styleType)?s.styleType:"Style";
this.effects=(s&&s.effects)?s.effects:[];this.animation=(s&&s.animationStyle)?s.animationStyle:null;this.bindings=null;
},clone:function(){return e.$.extend(true,{},this);},generateName:(function(){var s=0;return function(){return"_om_style"+(++s);
};}()),getConfig:function(){return this.origConfig;},getStyleName:function(){return this.styleName;},draw:function(u,t,s){},getBindables:function(){return[];
},isBindable:function(s){var t=this.getBindables();if(!s||!t||t.length===0){return false;}for(var u=0;
u<t.length;u++){if(s.toUpperCase()===t[u].toUpperCase()){return true;}}return false;},isBound:function(s){var t=this.bindings;
if(e.isNull(s)||e.isNull(t)||t.length===0){return false;}if(s&&!this.isBindable(s)){return false;}for(var u=0;
u<t.length;u++){if(s.toUpperCase()===t[u].attribute.toUpperCase()){return true;}}return false;},hasBinding:function(){return(e.notNull(this.bindings)&&this.bindings.length>0);
},isFeatureBound:function(w){var t=this.bindings;if(e.isNull(t)||t.length===0){return false;}var x,v=false,s=t.length;
for(var u=0;u<s;u++){x=this.resolveDataValue(t[u],w);if(e.notNull(x)){v=true;}}return v;},bindData:function(u,t,s){if(!u||!t||!this.isBindable(u)){e.util.Logger.warning(null,"Style.bindData","Invalid binding attribute or column");
return;}if(e.isNull(this.bindings)){this.bindings=[];}var v={};v.attribute=u.toUpperCase();if(typeof t==="string"){v.column=t.toUpperCase();
}else{v.column=t;}if(e.notNull(s)){if((s instanceof e.style.Formatter)){v.formatter=s;}else{v.resolver=s.resolver;
v.attrList=s.attrList;v.classification=s.classification?s.classification:"equal";}}else{e.util.Logger.throwErr("MAPVIEWER_9051","style.bindData","Must specify a Formatter.");
}this.bindings.push(v);},unbindData:function(u){if(!u||!this.bindings||!this.isBound(u)){return;}var s=this.bindings;
for(var t=0;t<s.length;t++){if(u.toUpperCase()===s[t].attribute.toUpperCase()){s.splice(t,1);this.initialize(this.origConfig);
this.bindings=s;}}},unbindAllData:function(u){if(!u||!this.isBound(u)){return;}var s=this.bindings;for(var t=0;
t<s.length;t++){if(u===s[t].attribute){s.splice(t,1);this.initialize(this.origConfig);this.bindings=s;
return;}}},resolveDataValue:function(s,v){var t;if(typeof s.column==="string"){s._colName=s.column;var w=s.column,u=v.parentLayer;
if(e.isNull(u)){return f;}s.column=new e.Column({data:u.getAllFeatures(),keyGetter:function(){return this.id;
},valueGetter:function(){var x=(this.attributes&&this.attributes[w])?this.attributes[w]:null;if(!isNaN(parseFloat(x))&&isFinite(x)){return parseFloat(x);
}else{return x;}}});}t=s.column.getValueOfRow(v.id);return t;},resolveBinding:function(z,E){var D;var x=null,v,A;
D=this.resolveDataValue(z,E);if(e.notNull(z.formatter)){x=z.formatter.resolve(D,z.column,E);return x;
}if(e.notNull(z.resolver)){x=z.resolver(D,z.column);}else{v=z.column.getMin();A=z.column.getMax();if(z.attrList&&z.attrList.length>0){if(v===A){return z.attrList[0];
}if(z.classification==="logarithmic"){if(v<1){v=1;}var s=Math.log(v),u=Math.log(A);var t=(u-s)/z.attrList.length;
for(var w=0;w<z.attrList.length;w++){var y=Math.exp(s+t*(w+1));if(w===0&&D<=y||D>=v&&D<=y){x=z.attrList[w];
break;}v=y;}}else{var C=(A-v)/z.attrList.length;var B=parseInt((D-v)/C);if(B>=z.attrList.length){B=z.attrList.length-1;
}x=z.attrList[B];}}}return x;}});e.style.Style.calculateStyleSize=function(s,x){if(e.isNull(s)||(e.notNull(s.realWidth)&&e.notNull(s.realHeight))){return;
}var B=s.lengthUnit?s.lengthUnit:"pixel";B=B.toLowerCase();var w=e.util.GeomUtil.getCurrentDistancePerPixel(x);
if(B!=="pixel"){var z=e.gv.getUnitFactor(B);if(z===0){B="pixel";}else{w/=z;}}if(B==="pixel"){s.realWidth=s.width;
s.realHeight=s.height;}else{if(s.unitFontSize){s.fontSize=parseFloat(s.unitFontSize/w);}else{if(s.unitFillWidth||s.unitCenterLineWidth||s.unitStrokeThickness){s.fillWidth=parseFloat(s.unitFillWidth/w);
s.centerLineWidth=parseFloat(s.unitCenterLineWidth/w);s.strokeThickness=parseFloat(s.unitStrokeThickness/w);
s.calculateRealSize();}else{if(s.unitSpotlightRadius){s.spotlightRadius=parseFloat(s.unitSpotlightRadius/w);
}else{var u=s.width;var C=s.height;var v=parseFloat(u/w);var t=parseFloat(C/w);v=v<parseFloat(s.minlength)?parseFloat(s.minlength):v;
t=t<parseFloat(s.minlength)?parseFloat(s.minlength):t;s.realWidth=v>parseFloat(s.maxlength)?parseFloat(s.maxlength):v;
s.realHeight=t>parseFloat(s.maxlength)?parseFloat(s.maxlength):t;if(!e.isNull(s.max_size_in_px)&&s.max_size_in_px>0){if(s.realWidth>s.max_size_in_px||s.realHeight>s.max_size_in_px){var A=Math.max(s.realWidth,s.realHeight);
var y=s.max_size_in_px/A;s.realWidth=y*s.realWidth;s.realHeight=y*s.realHeight;}}}}}}};e.style.Style.rgbToHsv=function(u){var A,v,t;
var w=u.r/255;var C=u.g/255;var s=u.b/255;var x=Math.min(w,C,s);var z=Math.max(w,C,s);var y=z-x;if(y===0){A=0;
}else{if(z===C){A=60*(s-w)/y+120;}else{if(z===s){A=60*(w-C)/y+240;}else{if(z===w){if(C>=s){A=60*(C-s)/y+0;
}else{A=60*(C-s)/y+360;}}}}}if(z===0){v=0;}else{v=y/z;}t=z;return{h:Math.round(A),s:Math.round(v*100),v:Math.round(t*100)};
};e.style.Style.hsvToRgb=function(s){var w=s.h,v=s.s,u=s.v;var x,C,D;var t,y,B,A,z;if(v===0){w=v=u=Math.round(255*u/100);
x=w;C=v;D=u;}else{v=v/100;u=u/100;t=Math.floor(w/60)%6;y=w/60-t;B=u*(1-v);A=u*(1-v*y);z=u*(1-v*(1-y));
switch(t){case 0:x=u;C=z;D=B;break;case 1:x=A;C=u;D=B;break;case 2:x=B;C=u;D=z;break;case 3:x=B;C=A;D=u;
break;case 4:x=z;C=B;D=u;break;case 5:x=u;C=B;D=A;break;}x=Math.round(255*x);C=Math.round(255*C);D=Math.round(255*D);
}return{r:x,g:C,b:D};};e.style.Style.ColorLuminance=function(v,s){v=String(v).replace(/[^0-9a-f]/gi,"");
if(v.length<6){v=v[0]+v[0]+v[1]+v[1]+v[2]+v[2];}s=s||0;var t="#",w,u;for(u=0;u<3;u++){w=parseInt(v.substr(u*2,2),16);
w=Math.round(Math.min(Math.max(0,w+(w*s)),255)).toString(16);t+=("00"+w).substr(w.length);}return t;};
e.style.colorbrewer={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}};
e.style.Text=e.style.Style.extend({initialize:function b(s){s=s||{};s.styleType="Text";b.base.call(this,s);
this.fontFamily=e.notNull(s.fontFamily)?s.fontFamily:null;this.fontStyle=e.notNull(s.fontStyle)?s.fontStyle:e.Text.FONTSTYLE_NORMAL;
this.fontWeight=e.notNull(s.fontWeight)?s.fontWeight:e.Text.FONTWEIGHT_NORMAL;this.fill=e.notNull(s.fill)?s.fill:null;
this.lengthUnit=e.notNull(s.sizeUnit)?s.sizeUnit:"pixel";if(this.lengthUnit==="pixel"){this.fontSize=e.notNull(s.fontSize)?parseInt(s.fontSize):12;
}else{this.unitFontSize=e.notNull(s.fontSize)?parseInt(s.fontSize):10;}this.hAlign=e.notNull(s.hAlign)?s.hAlign:e.Text.HORIZONTALALIGN_CENTER;
this.vAlign=e.notNull(s.vAlign)?s.vAlign:e.Text.VERTICALALIGN_CENTER;this.sticky=e.notNull(s.sticky)?s.sticky:false;
},toXMLString:function(){var v="";var t="";if(e.notNull(this.fontStyle)&&this.fontStyle===e.Text.FONTSTYLE_ITALIC){t="font-style:italic;";
}else{t="font-style:plain;";}if(e.notNull(this.hAlign)&&this.hAlign===e.HORIZONTALALIGN_LEFT){v="text-align:left;";
}else{if(e.notNull(this.hAlign)&&this.hAlign===e.HORIZONTALALIGN_RIGHT){v="text-align:right;";}else{v="text-align:center;";
}}var u="";u+='<style name="'+this.getStyleName()+'">';u+='<g class="text" style="';u+=t;u+=(e.notNull(this.fontFamily)?"font-family:"+this.fontFamily+";":"");
u+=(e.notNull(this.fontSize)?"font-size:"+this.fontSize+"pt;":"");u+=v;u+=(e.notNull(this.fill)?"fill:"+this.fill:"");
u+='"></g></style>';return u;},draw:function(u,t,s){this.resolve(u);var x=u.geo;var v=u.geo.type;if(s.markerPoint&&u.shapeGroup){u.shapeGroup.push(this.drawText(t,s.group,s.markerPoint,u.markerText));
return;}else{if(s.sPoint){u.shape=this.drawText(t,s.group,s.sPoint,u.markerText);return;}}if(v==="LineString"||v==="MultiLineString"){return;
}if(v==="Polygon"||v==="MultiPolygon"){if(!u.screenPoints){var w=null;if(u.labelBox){w=new e.geometry.Point((u.labelBox[0]+u.labelBox[2])/2,(u.labelBox[1]+u.labelBox[3])/2,x.srid);
}else{if(x.mbr){w=new e.geometry.Point((x.mbr.getMinX()+x.mbr.getMaxX())/2,(x.mbr.getMinY()+x.mbr.getMaxY())/2,x.srid);
}}w=u.transformGeometry(w);if(!u.screenPoints){u.screenPoints=w;}}u.shape=this.drawText(t,s.group,u.screenPoints,u.markerText);
}else{if(!u.screenPoints){u.transformGeometry(x);}if(v==="Point"||v==="OrientedPoint"){u.shape=this.drawText(t,s.group,u.screenPoints,u.text);
if(!e.isNull(u.renderingStyle)){u.markerWidth=this.realWidthInPx;u.markerHeight=this.realWidthInPx;}}}},drawText:function(u,z,y,A){if(this.width===0||this.height===0){return;
}var B={group:z,xOffset:this.xOffset,yOffset:this.yOffset};if(y.angle){B.angle=y.angle;}var v;var x=u.getGraphics();
var s;v=x.createTextNode(A,this,y.x,y.y);z.appendChild(v);this.size=x.getWidthHeight(v);e.style.Style.calculateStyleSize(this,u);
var t=0;var w=0;if(e.notNull(this.hAlign)){switch(this.hAlign){case e.Text.HORIZONTALALIGN_CENTER:t=(0-this.size.w)/2;
break;case e.Text.HORIZONTALALIGN_RIGHT:t=-this.size.w;break;}}if(e.notNull(this.vAlign)){switch(this.hAlign){case e.Text.VERTICALALIGN_CENTER:w=(this.size.h-4)/2;
break;case e.Text.VERTICALALIGN_TOP:w=this.size.h;break;}}s=new x.oui.geom.Matrix();s.translate(t,w);
return v;},getBindables:function(){if(e.isNull(this.bindableAttrs)){this.bindableAttrs=["Color","FontSize","FontFamily","FontStyle"];
}return this.bindableAttrs;},resolve:function(w){if(!this.bindings||this.bindings.length===0){return this;
}for(var v=0,t=this.bindings.length;v<t;v++){var s=this.bindings[v];var u=this.resolveBinding(s,w);if(s.attribute==="COLOR"){this.fill=u;
if(this.isBound("COLOR")&&this.bindings.length===1){if(u===e.PaintTypes.NO_PAINT){this.width=0;}}}else{if(s.attribute==="FONTSIZE"){this.fontSize=u;
}else{if(s.attribute==="FONTFAMILY"){this.fontFamily=u;}else{if(s.attribute==="FONSTYLE"){this.fontStyle=u;
}}}}}return this;}});e.style.Gradient=e.style.Style.extend({initialize:function b(s){s=s||{};s.styleType=(s&&s.styleType)?s.styleType:"AbstractGradient";
b.base.call(this,s);if(e.isNull(s.stops)){e.util.Logger.throwErr(null,"Gradient.initialize","Color stops not provided.");
return null;}this.copyOrigStops();this.useFeatureBoundingBox=s&&e.notNull(s.useFeatureBoundingBox)?s.useFeatureBoundingBox:true;
this.stroke=s&&e.notNull(s.stroke)?s.stroke:null;this.strokeThickness=s&&e.notNull(s.strokeThickness)?parseFloat(s.strokeThickness):1;
this.strokeOpacity=s&&e.notNull(s.strokeOpacity)?s.strokeOpacity:1;this.fillOpacity=s&&e.notNull(s.fillOpacity)?s.fillOpacity:1;
this.strokeDash=e.notNull(s.strokeDash)?s.strokeDash:[];},copyOrigStops:function(){this.stops1=[];var u;
var s=this.origConfig;for(var t=0;t<s.stops.length;t++){u=s.stops[t];this.stops1.push({offset:u.offset,color:u.color});
}},createGradientStop:function(u){var t=u.oui.style.GradientStop;if(this.stops1){var s=this.stops1.length;
this.stops=[];for(var v=0;v<s;v++){if(this.stops1[v] instanceof t){continue;}this.stops[v]=new t({offset:this.stops1[v].offset,color:this.stops1[v].color});
}}},draw:function(J,z,K){var B=J.geo;var F=K.type?K.type:B.type;var G=z.getGraphics();var v;var s;var A;
var D;var E;if(K.screenPoints){v=K.screenPoints;}else{if(!J.screenPoints){J.transformGeometry(B);}v=J.screenPoints;
}this.resolve(J,G);if((F==="LineString"||F==="MultiLineString")&&v&&v.length>0){s={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness};
if(F==="LineString"){J.shape=G.drawPath(v,s,K);}else{E=G.createGroup();K.group.appendChild(E);K.group=E;
for(A=0,D=v.length;A<D;A++){G.drawPath(v[A],s,K);}J.shape=E;}return;}this.createStyle(G);s={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,fill:this.fill,fillOpacity:this.fillOpacity,strokeDashArray:this.strokeDash};
if(F==="Point"||F==="OrientedPoint"||F==="MultiPoint"||F==="OrientedMultiPoint"){var I=e.gv.defaultMarkerStyleWidth;
var C=e.gv.defaultMarkerStyleHeight;var t=[{shape:{type:"circle",cx:I/2,cy:C/2,width:I,height:C,scaleX:1,scaleY:1},style:s}];
if(F==="MultiPoint"||F==="OrientedMultiPoint"){E=G.createGroup();K.group.appendChild(E);K.group=E;for(A=0,D=v.length;
A<D;A++){G.drawVectorMarker({x:v[A].x,y:v[A].y},t,K);}J.shape=E;}else{J.shape=G.drawVectorMarker({x:v.x,y:v.y},t,K);
}return;}else{if(!v||v.length===0){return;}}if(F==="Rectangle"){J.shape=G.drawRectangle(v,s,K);}else{if(F==="Polygon"){J.shape=G.drawPath(v,s,K);
}else{if(F==="MultiPolygon"){var u=G.createGroup();K.group.appendChild(u);K.group=u;for(var y=0,x=v.length;
y<x;y++){G.drawPath(v[y],s,K);}J.shape=u;}}}},getBindables:function(){return["StartColor","EndColor"];
},resolve:function(w){var v,t;if(!this.bindings||this.bindings.length===0){t=this.stops1.length;if(this.stops1[0].color!==this.origConfig.stops[0].color||this.stops1[t-1].color!==this.origConfig.stops[t-1].color){this.copyOrigStops();
}return this;}for(v=0,t=this.bindings.length;v<t;v++){var s=this.bindings[v];var u=this.resolveBinding(s,w);
if(s.attribute==="STARTCOLOR"){if(e.notNull(u)&&e.util.ValidationUtil.getColor(u)){this.stops1[0].color=u;
}else{this.stops1[0].color=this.origConfig.stops[0].color;}}else{if(s.attribute==="ENDCOLOR"){if(e.notNull(u)&&e.util.ValidationUtil.getColor(u)){t=this.stops1.length;
this.stops1[t-1].color=u;}else{t=this.origConfig.stops.length;this.origConfig.stops[t-1].color=u;}}}}return this;
}});e.style.LinearGradient=e.style.Gradient.extend({initialize:function b(s){s.styleType="LinearGradient";
b.base.call(this,s);this.x1=s.x1||0;this.y1=s.y1||0;this.x2=s.x2||0;this.y2=s.y2||0;},createStyle:function(s){this.createGradientStop(s);
this.fill=new s.oui.style.LinearGradient({x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,stops:this.stops});
}});e.style.Color=e.style.Style.extend({initialize:function b(s){s=s||{};s.styleType="Color";b.base.call(this,s);
var t=e.util.ValidationUtil.getColor;this.stroke=e.notNull(s.stroke)&&(t(s.stroke))?t(s.stroke):e.PaintTypes.NO_PAINT;
this.strokeOpacity=e.notNull(s.strokeOpacity)?s.strokeOpacity:1;this.strokeThickness=e.notNull(s.strokeThickness)?parseFloat(s.strokeThickness):1;
this.strokeDash=e.notNull(s.strokeDash)?s.strokeDash:[];this.fill=e.notNull(s.fill)&&(t(s.fill))?t(s.fill):e.PaintTypes.NO_PAINT;
this.fillOpacity=e.notNull(s.fillOpacity)?s.fillOpacity:1;this.gradient=s.gradient||"off";this.outlineStroke=e.notNull(s.outlineStroke)&&(t(s.outlineStroke))?t(s.outlineStroke):null;
this.outlineStrokeThickness=e.notNull(s.outlineStrokeThickness)?parseFloat(s.outlineStrokeThickness):1;
if(this.fill===e.PaintTypes.NO_PAINT){this.fillOpacity=0;this.noNativeFill=true;}else{this.noNativeFill=false;
}if(e.notNull(s.stroke)){s.stroke=t(s.stroke);}if(e.notNull(s.outlineStroke)){s.outlineStroke=t(s.outlineStroke);
}if(e.notNull(s.fill)){s.fill=t(s.fill);}},resolve:function(w){if(!this.bindings||this.bindings.length===0){return this;
}for(var v=0,t=this.bindings.length;v<t;v++){var s=this.bindings[v];var u=this.resolveBinding(s,w);if(s.attribute==="FILL"){this.fill=u;
if(!u||!e.util.ValidationUtil.getColor(u)){this.fillOpacity=0;}else{if(this.noNativeFill&&this.fillOpacity===0){this.fillOpacity=1;
}}}else{if(s.attribute==="STROKE"){this.stroke=u;if(!u||!e.util.ValidationUtil.getColor(u)){this.stroke=e.PaintTypes.NO_PAINT;
}}else{if(s.attribute==="STROKETHICKNESS"){this.strokeThickness=Number(u);if(isNaN(u)||u<0){u=1;}}}}}return this;
},draw:function(I,x,J){this.resolve(I,F);var y=I.geo;var D=J.type?J.type:y.type;var F=x.getGraphics();
if(this.gradient!=="off"&&this.fillOpacity!==0&&!(this.fill instanceof F.oui.style.LinearGradient)){this.fill=new F.oui.style.LinearGradient({x1:0,y1:0,x2:1,y2:1,stops:[new F.oui.style.GradientStop({offset:0,color:"#eeffffff"}),new F.oui.style.GradientStop({offset:1,color:this.fill})]});
}var z;var B;var C;var v;if(J.screenPoints){v=J.screenPoints;}else{if(!I.screenPoints){I.transformGeometry(y);
}v=I.screenPoints;}if(D==="Point"||D==="OrientedPoint"||D==="MultiPoint"||D==="OrientedMultiPoint"){var G=e.gv.defaultMarkerStyleWidth;
var A=e.gv.defaultMarkerStyleHeight;var u=[{shape:{type:"circle",cx:G/2,cy:A/2,width:G,height:A,scaleX:1,scaleY:1},style:this}];
J.width=G;J.height=A;if(D==="MultiPoint"||D==="OrientedMultiPoint"){C=F.createGroup();J.group.appendChild(C);
J.group=C;for(z=0,B=v.length;z<B;z++){F.drawVectorMarker({x:v[z].x,y:v[z].y},u,J);}I.shape=C;}else{I.shape=F.drawVectorMarker({x:v.x,y:v.y},u,J);
}return;}else{if(!v||v.length===0){return;}}var t={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDash,fill:this.fill,fillOpacity:this.fillOpacity};
var E=null;if(e.notNull(this.outlineStroke)){E={stroke:this.outlineStroke,strokeThickness:this.outlineStrokeThickness*2+this.strokeThickness,fill:this.fill,fillOpacity:this.fillOpacity};
}if(D==="LineString"||D==="MultiLineString"){if(!t.stroke){t.stroke=t.fill?t.fill:"#000000";}t.fill=null;
}else{if(t.fill===e.PaintTypes.NO_PAINT){t.fill="#ffffff";t.fillOpacity=0;}}if(D==="LineString"||D==="Polygon"||D==="Rectangle"){var s=F.drawPath;
if(D==="Rectangle"){s=F.drawRectangle;}if(e.isNull(E)){I.shape=s.call(F,v,t,J);}else{C=F.createGroup();
J.group.appendChild(C);J.group=C;s.call(F,v,E,J);s.call(F,v,t,J);I.shape=C;}}else{if(D==="MultiLineString"||D==="MultiPolygon"){C=F.createGroup();
J.group.appendChild(C);J.group=C;for(z=0,B=v.length;z<B;z++){if(e.notNull(E)){F.drawPath(v[z],E,J);}F.drawPath(v[z],t,J);
}I.shape=C;}}},getBindables:function(){if(this.bindableAttrs){return this.bindableAttrs;}this.bindableAttrs=["Fill","Stroke","StrokeThickness"];
return this.bindableAttrs;},toXMLString:function(){var t="";t+='<style name="'+this.getStyleName()+'">';
t+='<g class="color" style="';t+=(e.notNull(this.stroke)?"stroke:"+this.stroke+";":"");t+=(e.notNull(this.strokeOpacity)?"stroke-opacity:"+Math.min(Math.round(this.strokeOpacity*255),255)+";":"");
t+=(e.notNull(this.fill)?"fill:"+this.fill+";":"");t+=(e.notNull(this.fillOpacity)?"fill-opacity:"+Math.min(Math.round(this.fillOpacity*255),255)+";":"");
t+='"></g></style>';return t;}});e.style.Bucket=e.Class.extend({initialize:function(s){this.seq=s.seq||0;
if(s.label){this.label=s.label;}if(s.labelStyle){this.labelStyle=s.labelStyle;}},evaluate:function(){return false;
},clone:function(){return e.$.extend(true,{},this);}});e.style.RangedBucket=e.style.Bucket.extend({initialize:function b(s){b.base.call(this,s);
this.low=e.notNull(s.low)?s.low:Number.NEGATIVE_INFINITY;this.high=e.notNull(s.high)?s.high:Number.POSITIVE_INFINITY;
this.includeHighValue=e.notNull(s.includeHighValue)?s.includeHighValue:false;},evaluate:function(s){if(e.isNull(s)){return false;
}if(e.$.isArray(s)){s=s[0];}if(this.includeHighValue){return s>=this.low&&s<=this.high;}else{return s>=this.low&&s<this.high;
}},setIncludeHighValue:function(s){this.includeHighValue=s;},toXMLString:function(){var t="<RangedBucket";
t+=(e.isNull(this.seq)?"":' seq="'+this.seq+'"');t+=(e.isNull(this.label)?"":' label="'+this.label+'"');
t+=(e.isNull(this.labelStyle)?"":' label_style="'+this.label+'"');t+=(e.isNull(this.low)?"":' low="'+this.low+'"');
t+=(e.isNull(this.high)?"":' high="'+this.high+'"');t+="/>";return t;}});e.style.CollectionBucket=e.style.Bucket.extend({initialize:function b(s){b.base.call(this,s);
this.keepWhiteSpace=s.keepWhiteSpace||false;this.dataType=s.dataType||"string";this.values=s.values||[];
},evaluate:function(u){var s=this.values.length;if(e.isNull(u)||s===0){return false;}if(e.$.isArray(u)){u=u[0];
}for(var t=0;t<s;t++){if(this.values[t]==u){return true;}}return false;}});e.style.BucketStyle=e.style.Style.extend({initialize:function b(u){u=u||{};
u.styleType=u.styleType||"BucketStyle";b.base.call(this,u);if(u.style&&u.buckets&&u.style!==u.buckets){e.util.Logger.warning("MAPVIEWER_9030","OM.style.BucketStyle","");
}this.styles=u.styles||[];if(this.styles.length===0&&u.styleType!=="ColorScheme"&&u.styleType!=="VariableMarker"){e.util.Logger.warning("MAPVIEWER_9029","OM.style.BucketStyle","");
}this.gradient=u.gradient||"off";var y=this.styles.length;var z=[];var w=this;if((y!==0)&&(this.styles[0] instanceof e.style.Style)){if(this.gradient!=="off"&&this.styles[0] instanceof e.style.Color){this.createGradients();
}}else{for(var A=0;A<y;A++){var t=this.styles[A].dataSource;var B=this.styles[A].style;var s=this.styles[A].url;
e.style.StyleStore.getServerSideStyle(t,B,{url:s,callback:v});}}function v(C){var x=z.length+1;z[x-1]=C;
if(x===y){w.styles=z;if(w.gradient!=="off"&&z[0] instanceof e.style.Color){w.createGradients();}}}this.numClasses=u.numClasses||5;
this.defaultStyle=u.defaultStyle||null;this.buckets=u.buckets||[];if(!u.classification&&u.low!==f&&u.high!==f){this.buckets=this.createEqualBuckets(u.high,u.low);
}this.classification=u.classification||"equal";if(this.buckets.length>0){if(this.classification!=="custom"){e.util.Logger.info("MAPVIEWER_9028","OM.style.BucketStyle","");
this.classification="custom";}}this.algorithm=u.algorithm||null;this.effects=u.effects||null;this.isNumeric=(typeof u.isNumeric==="undefined")?true:u.isNumeric;
this.gradient=u.gradient||"off";this.checkRangedBuckets();},resolve:function(v){var x=v.parentLayer.styleAttributes;
this.generateBuckets(v.parentLayer.featureArray,x,false);var t=v.attributes;if(t){var w=null;var s=e.notNull(x)?x.length:0;
if(s>0){w=t[x[0].toUpperCase()];if(s>1){w=[w];for(var u=1;u<s;u++){w.push(t[x[u].toUpperCase()]);}}return this.getRealStyle(w);
}else{if(v.columns){w=t[v.columns[0].toUpperCase()];return this.getRealStyle(w);}}}return null;},draw:function(u,t,s){var v=this.resolve(u);
if(v){v.draw(u,t,s);}},generateBuckets:function(u,t,v){if(this.buckets&&this.buckets.length>0&&(!v||this.buckets[0] instanceof e.style.CollectionBucket)){return;
}if(!u||u.length===0){return;}t=t||u[0].columns;if(!t){return;}var s=(t instanceof Array)?t[0]:t;s=s.toUpperCase();
if(this.classification==="equal"){this.buckets=this.equalRangeMethod(u,s);}else{if(this.classification==="quantile"||this.classification==="quantiles"){this.buckets=this.quantilesMethod(u,s);
}else{if(this.classification==="logarithmic"){this.buckets=this.logarithmicMethod(u,s);}else{if(this.algorithm){this.buckets=this.algorithm.call(this,u,s,this.numClasses);
}else{e.util.Logger.warning("MAPVIEWER_9026","OM.style.BucketStyle","");this.buckets=[];}}}}this.checkRangedBuckets();
},checkRangedBuckets:function(){var u=this.buckets;if(e.isNull(u)||u.length===0||u[0] instanceof e.style.CollectionBucket){return;
}var t=-1,w,s=Number.NEGATIVE_INFINITY;for(var v=0;v<u.length;v++){w=u[v].high;if(e.notNull(w)&&w>s){s=w;
t=v;}}u[t].setIncludeHighValue(true);},getDefaultStyle:function(){return this.defaultStyle;},setDefaultStyle:function(s){this.defaultStyle=s;
},getRealStyle:function(v){if(typeof v===f||v===null){return this.defaultStyle;}var u=this.buckets,s=this.buckets.length;
if(u&&s>0){for(var t=0;t<s;t++){if(u[t].evaluate(v)){return this.styles[t];}}}return this.defaultStyle;
},logarithmicMethod:function(u,t){var s=this.getMinMaxValues(u,t);return this.createLogarithmicBuckets(s.max,s.min);
},getMinMaxValues:function(s,t){if(t==="_NUMBERINCLUSTER"){return this.getMinMaxNumbers(s);}var u=null,y=null,x=s.length,z,w,A=e.util.ValidationUtil.isNumber2;
for(var v=0;v<x;v++){w=s[v];if(w&&w.attributes&&typeof w.attributes[t]!=="undefined"){z=w.attributes[t];
if(e.notNull(z)){if(this.isNumeric&&!A(z)){z=Number(z);}if(e.isNull(u)||u>z){u=z;}if(e.isNull(y)||z>y){y=z;
}}}}return{min:u,max:y};},getMinMaxNumbers:function(s){return{min:s[0],max:s[1]};},equalRangeMethod:function(u,t){var s=this.getMinMaxValues(u,t);
return this.createEqualBuckets(s.max,s.min);},createEqualBuckets:function(t,v){var w=[],s=(t-v)/this.numClasses,x=v;
for(var u=1;u<=this.numClasses;u++){w[u-1]=new e.style.RangedBucket({low:x,high:x+s});x+=s;}w[this.numClasses-1].high++;
return w;},createLogarithmicBuckets:function(z,w){var t=[],A=w;var s=Math.log(w),v=Math.log(z);var u=(v-s)/this.numClasses;
for(var x=1;x<=this.numClasses;x++){var y=Math.exp(s+u*x);t[x-1]=new e.style.RangedBucket({low:A,high:y});
A=y;}t[this.numClasses-1].high++;return t;},quantilesMethod:function(){return[];},createGradients:function(){var v=this.styles,u;
var s=[];for(var t=0;t<v.length;t++){u=v[t];s.push(new e.style.LinearGradient({stops:[{offset:0,color:"#eeffffff"},{offset:1,color:u.fill}],x1:0,y1:0,x2:1,y2:1,stroke:u.stroke,fillOpacity:u.fillOpacity,strokeOpacity:u.strokeOpacity}));
}this.styles=s;},clearBuckets:function(){if(this.classification==="equal"||this.classification==="quantile"||this.classification==="quantiles"||this.classification==="logarithmic"||this.algorithm){this.buckets=[];
}},toXMLString_substyles:function(){var w="";var t=null;for(var u=0,s=this.styles.length;u<s;u+=1){t=this.styles[u];
var v=e.isNull(t)?"":t.toXMLString();if(e.isNull(v)){continue;}w+=v;}return w;},toXMLString_adv:function(){var x="";
var y="";if(this.buckets.length!==this.styles.length){e.util.Logger.warning("","OM.style.BucketStyle","Number of buckets and styles do not match");
}var w=Math.min(this.buckets.length,this.styles.length);y="<Buckets";y+=(e.notNull(this.defaultStyle)?' default_style="'+this.defaultStyle.getStyleName()+'"':"");
y+=">";var z=null,B=null;for(var v=0;v<w;v+=1){z=this.buckets[v];B=this.styles[v];var u=e.isNull(z)?"":z.toXMLString();
var A=e.isNull(z)?"":B.getStyleName();if(e.isNull(u)){continue;}var t=u.substring(0,u.length-2)+' style="'+A+'"/>';
y+=t;}y+="</Buckets>";x='<style name="'+this.styleName+'"><AdvancedStyle><BucketStyle>'+y+"</BucketStyle></AdvancedStyle></style>";
return x;},toXMLString:function(){var t=this.toXMLString_adv();var s=this.toXMLString_substyles();return s+t;
}});e.style.ColorScheme=e.style.BucketStyle.extend({initialize:function b(s){s.styleType="ColorScheme";
b.base.call(this,s);this.baseColor=e.notNull(s.baseColor)?s.baseColor:null;this.fromColor=e.notNull(s.fromColor)?s.fromColor:null;
this.toColor=e.notNull(s.toColor)?s.toColor:null;this.fillOpacity=e.notNull(s.fillOpacity)?s.fillOpacity:1;
this.stroke=e.notNull(s.stroke)?s.stroke:null;this.strokeOpacity=e.notNull(s.strokeOpacity)?s.strokeOpacity:1;
this.strokeThickness=e.notNull(s.strokeThickness)?parseFloat(s.strokeThickness):1;this.calculateColorStops();
},calculateColorStops:function(){if(this.styles&&this.styles.length>0){return;}if(this.fromColor&&this.toColor){this.calculateMultiHueStops();
}else{if(this.baseColor){this.calculateSingleHueStops();}else{e.util.Logger.warning("MAPVIEWER_9025","OM.style.ColorScheme.calculateColorStops","");
}}},calculateSingleHueStops:function(){var w=e.style.ColorScheme.rgbStringParse(this.baseColor);var s=e.style.Style.rgbToHsv(w);
var y=s.v/this.numClasses;for(var x=0;x<this.numClasses;x++){var t=e.style.Style.hsvToRgb({h:s.h,s:s.s,v:(s.v-x*y)});
var A=t.r.toString(16);if(A.length!==2){A="0"+A;}var z=t.g.toString(16);if(z.length!==2){z="0"+z;}var B=t.b.toString(16);
if(B.length!==2){B="0"+B;}var v="#"+A+z+B;var u=new e.style.Color({fill:v,fillOpacity:this.fillOpacity,stroke:this.stroke,strokeThickness:this.strokeThickness,strokeOpacity:this.strokeOpacity});
this.styles.push(u);}},calculateMultiHueStops:function(){var z=e.style.ColorScheme;var v=z.rgbStringParse(this.fromColor);
var C=e.style.Style.rgbToHsv(v);v=z.rgbStringParse(this.toColor);var y=e.style.Style.rgbToHsv(v);var A=(y.h-C.h)/this.numClasses;
var F=(y.s-C.s)/this.numClasses;var E=(y.v-C.v)/this.numClasses;for(var w=0;w<this.numClasses;w++){var s=e.style.Style.hsvToRgb({h:C.h+A*w,s:C.s+F*w,v:C.v+E*w});
var B=s.r.toString(16);if(B.length!==2){B="0"+B;}var x=s.g.toString(16);if(x.length!==2){x="0"+x;}var D=s.b.toString(16);
if(D.length!==2){D="0"+D;}var u="#"+B+x+D;var t=new e.style.Color({fill:u,fillOpacity:this.fillOpacity,stroke:this.stroke,strokeThickness:this.strokeThickness,strokeOpacity:this.strokeOpacity});
this.styles.push(t);}},getColorStops:function(){var t=[];if(!this.styles){return t;}var s=this.styles.length;
for(var u=0;u<s;u++){t.push(this.styles[u].fill);}return t;}});e.style.ColorScheme.rgbStringParse=function(u){var s={};
var t=e.$.trim(u);s.r=parseInt(t[1]+t[2],16);s.g=parseInt(t[3]+t[4],16);s.b=parseInt(t[5]+t[6],16);return s;
};e.style.HeatMap=e.style.Style.extend({initialize:function b(s){s=s||{};s.styleType="HeatMap";b.base.call(this,s);
this.colorStops=e.notNull(s.colorStops)?s.colorStops:null;this.opacity=e.notNull(s.opacity)?s.opacity:1;
this.containerVectorLayer=e.notNull(s.containerVectorLayer)?s.containerVectorLayer:null;this.lengthUnit=e.notNull(s.lengthUnit)?s.lengthUnit:"pixel";
if(this.lengthUnit==="pixel"){this.spotlightRadius=e.notNull(s.spotlightRadius)?s.spotlightRadius:5;}else{this.unitSpotlightRadius=e.notNull(s.spotlightRadius)?s.spotlightRadius:5;
}this.maxValue=e.notNull(s.maxValue)?s.maxValue:null;this.minValue=e.notNull(s.minValue)?s.minValue:null;
this.sampleFactor=e.notNull(s.sampleFactor)?s.sampleFactor:2;this.isTop=e.notNull(s.isTop)?s.isTop:false;
},getBindables:function(){if(this.bindableAttrs){return this.bindableAttrs;}this.bindableAttrs=["Heat"];
return this.bindableAttrs;},getDataValueFromBinding:function(t){if(!this.bindings||this.bindings.length===0){return null;
}var s=this.bindings[0];return this.resolveDataValue(s,t);}});e.style.RadialGradient=e.style.Gradient.extend({initialize:function b(s){s=s||{};
s.styleType="RadialGradient";b.base.call(this,s);this.cx=s.cx||0;this.cy=s.cy||0;this.radius=s.radius||0;
},createStyle:function(s){this.createGradientStop(s);this.fill=new s.oui.style.RadialGradient({cx:this.cx,cy:this.cy,radius:this.radius,stops:this.stops});
}});e.style.PieSlice=function(t,s){this.name=t;this.color=s;};e.style.PieChart=e.style.Style.extend({initialize:function b(t){t.styleType="PieChart";
if(!t||!t.pieSlices||t.pieSlices.length<1){return;}b.base.call(this,t);var s=t.pieSlices.length;this.colors=[];
this.names=[];for(var u=0;u<s;u++){var v=t.pieSlices[u];this.colors.push(v.color);this.names.push(v.name);
}this.stroke=e.notNull(t.stroke)?t.stroke:"#000000";this.strokeThickness=e.notNull(t.strokeThickness)?parseFloat(t.strokeThickness):1;
this.startingAngle=e.notNull(t.startingAngle)?parseFloat(t.startingAngle):0;this.direction=e.notNull(t.direction)?t.direction:"CCW";
this.radius=e.notNull(t.radius)?t.radius:50;this.width=this.radius*2;this.height=this.radius*2;this.lengthUnit=e.notNull(t.lengthUnit)?t.lengthUnit:"pixel";
this.enableHighlight=t.enableHighlight?t.enableHighlight:false;this.maxlength=t.radiusPixelRange&&t.radiusPixelRange.max?t.radiusPixelRange.max*2:5000;
this.minlength=t.radiusPixelRange&&t.radiusPixelRange.min?t.radiusPixelRange.min*2:0;this.showOnPoint=1;
},resolve:function(w){if(!this.bindings||this.bindings.length===0){return this;}for(var v=0,t=this.bindings.length;
v<t;v++){var s=this.bindings[v];var u=this.resolveBinding(s,w);if(s.attribute==="RADIUS"){this.radius=u;
this.width=this.radius*2;this.height=this.radius*2;}else{if(s.attribute==="SIZE"){this.radius=u/2;this.width=u;
this.height=u;}}}return this;},draw:function(F,w,G){if(!F.attributes){return;}this.resolve(F);var B=w.getGraphics();
var v=G.sPoint;var s=this.colors;var A=this.names;if(!A||A.length<1){return;}var y=A.length;var D=new Array(y);
for(var x=0;x<y;x++){var t=A[x];var C=F.getAttributeValue(t);if(e.notNull(C)){D[x]=parseFloat(C);}else{return;
}}e.style.Style.calculateStyleSize(this,w);var u=this.realWidth;var E=this.realHeight;var z={cx:v.x,cy:v.y,width:u,height:E};
G.stroke=this.stroke;G.strokeThickness=this.strokeThickness;if(this.enableHighlight){G.plugable=true;
G.description=A;}G.offsetAngle=this.startingAngle;G.orientation=this.direction==="CW"?2:1;F.shape=B.drawPieChart(z,D,s,G);
},getBindables:function(){if(this.bindableAttrs){return this.bindableAttrs;}this.bindableAttrs=["Radius","Size"];
return this.bindableAttrs;}});e.style.VariableMarker=e.style.BucketStyle.extend({initialize:function b(s){s.styleType="VariableMarker";
b.base.call(this,s);this.marker=e.notNull(s.marker)?s.marker:null;this.startSize=e.notNull(s.startSize)?s.startSize:7;
this.increament=e.notNull(s.increment)?s.increment:3;this.createAllMarkerStyles();},createAllMarkerStyles:function(){if(this.styles&&this.styles.length>0){return;
}else{if(this.marker instanceof e.style.Marker){this.styles=[];for(var t=0;t<this.numClasses;t++){var s=this.marker.clone();
s.width=this.startSize+this.increament*t;s.height=s.width;s.calculateVectorMarkerScale();this.styles.push(s);
}}else{e.util.Logger.warning("MAPVIEWER_9024",e.style.VariableMarker.createAllMarkerStyles,"");}}}});
e.style.Bar=function(t,s){this.name=t;this.color=s;};e.style.BarChart=e.style.Style.extend({initialize:function b(t){t.styleType="BarChart";
if(!t||!t.bars||t.bars.length<1){return;}b.base.call(this,t);var s=t.bars.length;this.colors=[];this.names=[];
for(var u=0;u<s;u++){var v=t.bars[u];this.colors.push(v.color);this.names.push(v.name);}this.stroke=e.notNull(t.stroke)?t.stroke:"#000000";
this.strokeThickness=e.notNull(t.strokeThickness)?parseFloat(t.strokeThickness):1;this.showXAxis=e.notNull(t.showXAxis)?t.showXAxis:false;
this.showYAxis=e.notNull(t.showYAxis)?t.showYAxis:false;this.backGround=e.notNull(t.background)?t.background:null;
this.width=e.notNull(t.width)?t.width:100;this.height=e.notNull(t.width)?t.height:100;this.lengthUnit=e.notNull(t.lengthUnit)?t.lengthUnit:"pixel";
this.enableHighlight=e.notNull(t.enableHighlight)?t.enableHighlight:false;this.maxlength=t.lengthPixelRange&&t.lengthPixelRange.max?t.lengthPixelRange.max:5000;
this.minlength=t.lengthPixelRange&&t.lengthPixelRange.min?t.lengthPixelRange.min:0;this.showOnPoint=1;
},resolve:function(w){if(!this.bindings||this.bindings.length===0){return this;}for(var v=0,t=this.bindings.length;
v<t;v++){var s=this.bindings[v];var u=this.resolveBinding(s,w);if(s.attribute==="SIZE"){if(this.origConfig.width&&this.origConfig.height&&this.origConfig.width!==this.origConfig.height){this.height=this.origConfig.height*u/this.origConfig.width;
this.width=u;}else{this.width=u;this.height=u;}}else{if(s.attribute==="WIDTH"){this.width=u;}else{if(s.attribute==="HEIGHT"){this.height=u;
}}}}return this;},draw:function(F,w,G){this.resolve(F);if(!F.attributes){return;}var B=w.getGraphics();
var v=G.sPoint;var s=this.colors;var A=this.names;if(!A||A.length<1){return;}var y=A.length;var D=new Array(y);
for(var x=0;x<y;x++){var t=A[x];var C=F.getAttributeValue(t);if(e.notNull(C)){D[x]=parseFloat(C);}else{return;
}}e.style.Style.calculateStyleSize(this,w);var u=this.realWidth;var E=this.realHeight;var z={cx:v.x,cy:v.y,width:u,height:E};
G.stroke=this.stroke;G.strokeThickness=this.strokeThickness;if(this.enableHighlight){G.plugable=true;
G.description=A;}F.shape=B.drawBarChart(z,D,s,G);},getBindables:function(){if(this.bindableAttrs){return this.bindableAttrs;
}this.bindableAttrs=["Size","Width","Height"];return this.bindableAttrs;}});e.style.Line=e.style.Style.extend({initialize:function b(t){t=t||{};
t.styleType="Line";b.base.call(this,t);var u=e.util.ValidationUtil.getColor;var s=e.PaintTypes.NO_PAINT;
this.stroke=t.stroke&&u(t.stroke)?u(t.stroke):e.PaintTypes.NO_PAINT;this.strokeOpacity=e.notNull(t.strokeOpacity)?parseFloat(t.strokeOpacity):1;
this.strokeDash=t.strokeDash||[];this.strokeLineCap=t.strokeLineCap||e.LineCaps.ROUND;this.strokeLineJoin=t.strokeLineJoin||e.LineJoins.ROUND;
this.fill=(e.notNull(t.fill)&&u(t.fill))?u(t.fill):s;this.fillOpacity=e.notNull(t.fillOpacity)?parseFloat(t.fillOpacity):1;
this.centerLine=e.notNull(t.centerLine)&&(u(t.centerLine))?u(t.centerLine):s;this.markerPattern=t.markerPattern||null;
if(e.notNull(t.startMarker)){if(t.startMarker.vectorDef&&t.startMarker.getFNFormat()){this.markerStart=t.startMarker.getFNFormat();
}else{if(t.startMarker.d){this.markerStart=t.startMarker;}else{this.startMarker=t?t.startMarker:null;
}}}if(e.notNull(t.endMarker)){if(t.endMarker.vectorDef&&t.endMarker.getFNFormat()){this.markerEnd=t.endMarker.getFNFormat();
}else{if(t.endMarker.d){this.markerEnd=t.endMarker;}else{this.endMarker=t?t.endMarker:null;}}}this.oriented=t?t.orientedMarker:false;
this.centerLineDash=t.centerLineDash||[];this.cased=false;this.lengthUnit=t.lengthUnit?t.lengthUnit:"pixel";
if(this.lengthUnit==="pixel"){this.fillWidth=t&&e.notNull(t.fillWidth)&&this.fill!==s?parseFloat(t.fillWidth):0;
this.centerLineWidth=t&&e.notNull(t.centerLineWidth)&&this.centerLine!==s?parseFloat(t.centerLineWidth):0;
this.strokeThickness=t&&e.notNull(t.strokeThickness)&&this.stroke!==s?parseFloat(t.strokeThickness):1;
}else{this.unitFillWidth=t&&e.notNull(t.fillWidth)&&this.fill!==s?parseFloat(t.fillWidth):0;this.unitCenterLineWidth=t&&e.notNull(t.centerLineWidth)&&this.centerLine!==s?parseFloat(t.centerLineWidth):0;
this.unitStrokeThickness=t&&e.notNull(t.strokeThickness)&&this.stroke!==s?parseFloat(t.strokeThickness):1;
}this.calculateRealSize();},calculateRealSize:function(){var t=null;this.stylelist=[];var s=e.PaintTypes.NO_PAINT;
if(this.stroke!==s&&this.strokeThickness>0){t={stroke:this.stroke,strokeThickness:this.fillWidth>0?this.strokeThickness*2+this.fillWidth:this.strokeThickness,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDash,strokeOpacity:this.strokeOpacity};
if(this.markerStart){t.markerStart=this.markerStart;}if(this.markerEnd){t.markerEnd=this.markerEnd;}this.stylelist.push(t);
}if(this.fill!==s&&this.fillWidth>0){t={stroke:this.fill,strokeThickness:this.fillWidth,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDash,strokeOpacity:this.fillOpacity};
if(this.markerStart){t.markerStart=this.markerStart;}if(this.markerEnd){t.markerEnd=this.markerEnd;}this.stylelist.push(t);
}if(this.centerLine!==s&&this.centerLineWidth>0&&this.fill!==this.centerLine){t={stroke:this.centerLine,strokeThickness:this.centerLineWidth,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.centerLineDash};
this.stylelist.push(t);}if(this.startMarker||this.endMarker){this.stylelist.push({});}},resolve:function(w){if(!this.bindings||this.bindings.length===0){return this;
}for(var v=0,t=this.bindings.length;v<t;v++){var s=this.bindings[v];var u=this.resolveBinding(s,w);if(s.attribute==="FILL"){this.fill=u;
}else{if(s.attribute==="FILLWIDTH"){this.fillWidth=u;}}}this.calculateRealSize();return this;},draw:function(C,v,D){this.resolve(C);
var s=this.origConfig;if(e.notNull(s.startMarker)&&s.startMarker.vectorDef&&s.startMarker.getFNFormat){this.markerStart=s.startMarker.getFNFormat(C);
}if(e.notNull(s.endMarker)&&s.endMarker.vectorDef&&s.endMarker.getFNFormat){this.markerEnd=s.endMarker.getFNFormat(C);
}var x=C.geo;var z=D.type?D.type:x.type;if(z==="Point"||z==="OrientedPoint"||z==="MultiPoint"||z==="OrientedMultiPoint"){return;
}var A=v.getGraphics();var t;if(D.screenPoints){t=D.screenPoints;}else{if(!C.screenPoints){C.transformGeometry(x);
}t=C.screenPoints;}if(!t||t.length===0){return;}var B;var y;e.style.Style.calculateStyleSize(this,v);
if(z==="LineString"||z==="Polygon"){this.drawLine(v,t,D.group,z==="Polygon",C);}else{if(z==="Rectangle"){this.drawLine(v,[[t.x,t.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height,t.x,t.y]],D.group,true,C);
}else{if(z==="MultiLineString"||z==="MultiPolygon"){if(this.cased){B=[];y=D.group.length;for(var u=0;
u<y;u++){B[u]=A.createGroup();D.group[u].appendChild(B[u]);}}else{B=A.createGroup();D.group.appendChild(B);
}y=t.length;for(var w=0;w<y;w++){this.drawLine(v,t[w],B,z==="MultiPolygon",C);}C.shapeGroup=B;}}}if(C.shapeGroup&&C.shapeGroup.length>0){C.shape=C.shapeGroup[0];
if(C.shapeGroup.length===1){C.shapeGroup=null;}}else{C.shape=C.shapeGroup;C.shapeGroup=null;}},drawLine:function(Y,T,E,K,C){var W=this.stylelist;
var S=W.length;var A={group:E};var V=Y.getGraphics();C.shapeGroup=[];for(var R=0;R<S;R++){var v=W[R];
if(!v.stroke){continue;}if(this.cased){A.group=E[R];}v={stroke:v.stroke,strokeThickness:v.strokeThickness,strokeLineCap:v.strokeLineCap,strokeDashArray:v.strokeDashArray,strokeOpacity:v.strokeOpacity,markerStart:v.markerStart,markerEnd:v.markerEnd};
if(K){v.fill=e.PaintTypes.NO_PAINT;v.fillOpacity=0;}C.shapeGroup.push(V.drawPath(T,v,A));}var J=E.length?E[R-1]:E;
var O;var ac;var aa;var B;if(this.startMarker&&!this.markerStart){O={x:T[0][0],y:T[0][1]};B={group:J,markerPoint:O};
if(this.oriented){ac=T[0][0]-T[0][2];aa=T[0][3]-T[0][1];O.angle=-Math.atan2(aa,ac);}this.startMarker.draw(C,Y,B);
}if(this.endMarker&&!this.markerEnd){var M=T[0].length;O={x:T[0][M-2],y:T[0][M-1]};B={group:J,markerPoint:O};
if(T.oriented){ac=T[0][M-4]-T[0][M-2];aa=T[0][M-1]-T[0][M-3];O.angle=-Math.atan2(aa,ac);}this.endMarker.draw(C,Y,B);
}if(e.notNull(this.markerPattern)&&e.notNull(this.markerPattern.markers)&&this.markerPattern.markers.length>0){var Z=[];
var t=e.util.GeomUtil;if(e.isNull(this.markerPattern.intervalUnit)||this.markerPattern.intervalUnit===""){this.markerPattern.intervalUnit="pixel";
}var z=this.markerPattern.interval/t.getCurrentDistancePerPixel(Y,this.markerPattern.intervalUnit);var w=T[0];
var N,s=0,u,ab;for(var Q=0,D=w.length;Q<D-3;){N=null;u=t.getSegmentLength(w[Q],w[Q+1],w[Q+2],w[Q+3]);
ab=z*(Z.length);if(s+u>=ab){var L=(ab-s)/u;var I=(w[Q]+(w[Q+2]-w[Q])*L);var G=(w[Q+1]+(w[Q+3]-w[Q+1])*L);
N=({x:I,y:G});}else{s+=u;Q+=2;}if(N){Z.push(N);}}for(var P=0;P<Z.length;P++){O=Z[P];B={group:J,markerPoint:O};
if(this.markerPattern.oriented){if(P!=Z.length-1){var U=Z[P+1];O.angle=Math.atan2(U.y-O.y,U.x-O.x);}}var F=P%(this.markerPattern.markers.length);
var X=this.markerPattern.markers[F];if(e.notNull(X)&&e.notNull(X.draw)){X.draw(C,Y,B);}}}},getBindables:function(){if(this.bindableAttrs){return this.bindableAttrs;
}this.bindableAttrs=["Fill","FillWidth"];return this.bindableAttrs;}});e.style.Marker=e.style.Style.extend({initialize:function b(s){s=s||{};
s.styleType="Marker";b.base.call(this,s);this.width=e.notNull(s.width)?s.width:null;this.height=e.notNull(s.height)?s.height:null;
this.max_size_in_px=e.notNull(s.max_size_in_px)?s.max_size_in_px:null;this.xOffset=e.notNull(s.xOffset)?s.xOffset:0;
this.yOffset=e.notNull(s.yOffset)?s.yOffset:0;this.lengthUnit=e.notNull(s.lengthUnit)?s.lengthUnit:"pixel";
this.src=e.notNull(s.src)?s.src:null;this.textStyle=e.notNull(s.textStyle)?s.textStyle:s.textStyle===null?null:f;
this.gradient=e.notNull(s.gradient)?s.gradient:null;if(this.src&&(e.isNull(this.width)||e.isNull(this.height))){this.loadImgFromSource();
}this.vectorDef=e.notNull(s.vectorDef)?s.vectorDef:null;if(this.vectorDef){this.calculateVectorMarkerScale();
}this.textOffset=s.textOffset?s.textOffset:null;this.showOnPoint=2;this.realWidthInPx=null;this.realHeightInPx=null;
},loadImgFromSource:function(){var s=this;var t=new Image();t.src=this.src;t.onload=function(){if(e.isNull(s.width)){s.width=t.width;
}if(e.isNull(s.height)){s.height=t.height;}if(s.origConfig){s.origConfig.width=t.width;s.origConfig.height=t.height;
}};},resolve:function(w){if(!this.bindings||this.bindings.length===0){return this;}for(var v=0,t=this.bindings.length;
v<t;v++){var s=this.bindings[v];var u=this.resolveBinding(s,w);if(s.attribute==="FILL"){if(this.vectorDef&&this.vectorDef.length>0){this.vectorDef[0].style.fill=u;
}if(this.isBound("FILL")&&this.bindings.length===1){if(u===e.PaintTypes.NO_PAINT){this.width=0;}else{this.width=e.notNull(this.origConfig.width)?this.origConfig.width:null;
}}}else{if(s.attribute==="SIZE"){if(this.origConfig.width&&this.origConfig.height&&this.origConfig.width!==this.origConfig.height){this.height=this.origConfig.height*u/this.origConfig.width;
this.width=u;}else{this.width=u;this.height=u;}}else{if(s.attribute==="WIDTH"){this.width=u;}else{if(s.attribute==="HEIGHT"){this.height=u;
}else{if(s.attribute==="SOURCE"){this.src=u;this.loadImgFromSource();}}}}}}if((e.isNull(this.width)||isNaN(this.width))&&e.notNull(this.origConfig.width)){this.width=this.origConfig.width;
}if((e.isNull(this.height)||isNaN(this.height))&&e.notNull(this.origConfig.height)){this.height=this.origConfig.height;
}this.calculateVectorMarkerScale();return this;},draw:function(z,s,A){this.resolve(z);var t=z.geo;var x=z.geo.type;
if(A.markerPoint&&z.shapeGroup){z.shapeGroup.push(this.drawMarker(s,A.group,A.markerPoint,z.markerText));
return;}else{if(A.sPoint){z.shape=this.drawMarker(s,A.group,A.sPoint,z.markerText);return;}}if(x==="LineString"||x==="MultiLineString"){return;
}if(x==="Polygon"||x==="MultiPolygon"){if(!z.screenPoints){var y=null;if(z.labelBox){y=new e.geometry.Point((z.labelBox[0]+z.labelBox[2])/2,(z.labelBox[1]+z.labelBox[3])/2,t.srid);
}else{if(t.mbr){y=new e.geometry.Point((t.mbr.getMinX()+t.mbr.getMaxX())/2,(t.mbr.getMinY()+t.mbr.getMaxY())/2,t.srid);
}}y=z.transformGeometry(y);if(!z.screenPoints){z.screenPoints=y;}}z.shape=this.drawMarker(s,A.group,z.screenPoints,z.markerText);
}else{if(!z.screenPoints){z.transformGeometry(t);}if(x==="Point"||x==="OrientedPoint"){z.shape=this.drawMarker(s,A.group,z.screenPoints,z.markerText);
if(!e.isNull(z.renderingStyle)){z.markerWidth=this.realWidthInPx;z.markerHeight=this.realWidthInPx;}if(this.markerText){this.drawMarker(s,w,z.screenPoints,z.markerText);
}}else{if(x==="MultiPoint"||x==="OrientedMultiPoint"){var w=s.getGraphics().createGroup();A.group.appendChild(w);
for(var u=0,v=z.screenPoints.length;u<v;u++){this.drawMarker(s,w,z.screenPoints[u],z.markerText);}z.shape=w;
}}}},drawMarker:function(N,z,G,B){if(this.width===0||this.height===0){return;}var v={group:z,xOffset:this.xOffset,yOffset:this.yOffset};
if(G.angle){v.angle=G.angle;}var t;var L=N.getGraphics();var J={lengthUnit:this.lengthUnit,width:this.width,height:this.height,max_size_in_px:this.max_size_in_px};
var Q;var O;if(this.src){J.width=this.width;J.height=this.height;J.src=this.src;v.enableCache=true;e.style.Style.calculateStyleSize(J,N);
this.realWidthInPx=J.realWidth;this.realHeightInPx=J.realHeight;J.width=J.realWidth;J.height=J.realHeight;
t=L.drawImageMarker({x:G.x,y:G.y},J,v);}else{J.vectorDef=this.vectorDef;if(!this.vectorDef||!this.vectorDef[0]||!this.vectorDef[0].shape){var y=e.gv;
var E=y.defaultMarkerStyleWidth;var P=y.defaultMarkerStyleHeight;if(e.isNull(J.width)){J.width=E;}if(e.isNull(J.height)){J.height=P;
}J.vectorDef=[{shape:{type:"circle",cx:J.width/2,cy:J.height/2,width:J.width,height:J.height,scaleX:1,scaleY:1},style:e.$.extend(true,{},y.defaultMarkerStyle,J)}];
}e.style.Style.calculateStyleSize(J,N);var C={};e.$.extend(true,C,J.vectorDef);C.length=J.vectorDef.length;
v.width=J.realWidth;v.height=J.realHeight;this.realWidthInPx=J.realWidth;this.realHeightInPx=J.realHeight;
Q=J.realWidth/J.width*C[0].shape.scaleX;O=J.realHeight/J.height*C[0].shape.scaleY;if(C[0].style.strokeThickness){C[0].style.strokeThickness=C[0].style.strokeThickness/Q;
}if(C[0].style.insetThickness){C[0].style.insetThickness=C[0].style.insetThickness/Q;}if(Q&&O){v.xScale=Q;
v.yScale=O;}if(e.notNull(this.gradient)){if(typeof this.gradient==="object"){v.gradient=this.gradient;
}else{if("radial"===this.gradient){var s=this.getRadialGradient(L,this.vectorDef[0].style.fill);v.gradient=s;
}}}t=L.drawVectorMarker({x:G.x,y:G.y},C,v);}if(B){var R=L.createTextNode(B,this.textStyle,0,0);var F=L.getWidthHeight(R);
if(J.src){var u=L.createGroup();u.appendChild(t);u.appendChild(R);z.appendChild(u);var M=G.x-F.w/2;var K=G.y+(F.h-4)/2;
if(this.textOffset){M+=this.textOffset.x?this.textOffset.x:0;K+=this.textOffset.y?this.textOffset.y:0;
}R.translate(M,K);return u;}else{t.appendChild(R);var A=J.realWidth?J.realWidth:J.width;var I=J.realHeight?J.realHeight:J.height;
var x=(A-F.w)/2;var D=(I+F.h-4)/2;if(this.textOffset){x+=this.textOffset.x?this.textOffset.x:0;D+=this.textOffset.y?this.textOffset.y:0;
}R.scale(1/Q,1/O);R.translate(x,D);}}return t;},getRadialGradient:function(v,u){if(e.isNull(v)||e.isNull(u)){return null;
}var t=v.oui;var s=new t.style.RadialGradient({cx:0.3,cy:0.3,radius:0.5,stops:[new t.style.GradientStop({offset:0,color:"#ffffff"}),new t.style.GradientStop({offset:0.8,color:u})]});
return s;},calculateVectorMarkerScale:function(){if((e.isNull(this.height)||e.isNull(this.width))&&this.vectorDef&&this.vectorDef.length>0&&e.isNotNull(this.vectorDef[0].shape)&&e.isNotNull(this.vectorDef[0].shape.width)&&e.isNotNull(this.vectorDef[0].shape.height)){this.height=this.vectorDef[0].shape.height;
this.width=this.vectorDef[0].shape.width;}if(this.vectorDef&&this.width>=0&&this.height>=0&&e.isNotNull(this.width)&&e.isNotNull(this.height)){var z;
var C;var u=Number.MIN_VALUE,s=Number.MIN_VALUE,x=Number.MAX_VALUE,v=Number.MAX_VALUE;for(z=0;z<this.vectorDef.length;
z++){C=this.vectorDef[z].shape;C.width=C.width?C.width:this.width;C.height=C.height?C.height:this.height;
if(C.type==="circle"){if(C.cx===0&&C.cy===0){C.cx=C.width/2;C.cy=C.height/2;}x=Math.min(x,C.cx-C.width/2);
v=Math.min(v,C.cy-C.height/2);u=Math.max(u,C.cx+C.width/2);s=Math.max(s,C.cy+C.height/2);}else{if(C.type==="rectangle"){if(e.isNull(C.x)){C.x=0;
}if(e.isNull(C.y)){C.y=0;}C.scaleX=1;C.scaleY=1;x=Math.min(x,C.x);v=Math.min(v,C.y);u=Math.max(u,C.x+C.width);
s=Math.max(s,C.y+C.height);}else{var t=this.vectorDef[z].shape.coords[0];for(var y=0,B=t.length;y<B;y+=2){t[y]=1*t[y];
t[y+1]=1*t[y+1];if(t[y]<x){x=t[y];}if(t[y]>u){u=t[y];}if(t[y+1]<v){v=t[y+1];}if(t[y+1]>s){s=t[y+1];}}}}}var E=u-x;
var A=s-v;if(E==Number.MIN_VALUE){E=1;}if(A==Number.MIN_VALUE){A=1;}var F=this.width/E;var D=this.height/A;
for(z=0;z<this.vectorDef.length;z++){C=this.vectorDef[z].shape;C.scaleX=F;C.scaleY=D;if(e.notNull(this.vectorDef[z].style)&&e.notNull(this.vectorDef[z].style.strokeThickness)){this.vectorDef[z].style.strokeThickness=parseFloat(this.vectorDef[z].style.strokeThickness);
}}}},getFNFormat:function(v){if(this.src){return null;}if(!this.vectorDef||this.vectorDef.length===0||!this.vectorDef[0].shape||this.vectorDef[0].shape.type!=="path"||!this.vectorDef[0].shape.coords||this.vectorDef[0].shape.coords.length<1||this.vectorDef[0].shape.coords[0].length<4){return null;
}var t=this.vectorDef[0].shape;var w=t.coords[0];var x="M "+w[0]+" "+w[1];for(var u=2,s=w.length;u<s;
u+=2){x+=" L "+w[u]+" "+w[u+1];}if(v){this.resolve(v);}else{this.calculateVectorMarkerScale();}if(this.vectorDef[0].style&&!this.vectorDef[0].style.fill){this.vectorDef[0].style.fillOpacity=0;
}return{height:t.scaleY,width:t.scaleX,d:x,refX:this.xOffset,refY:this.yOffset,paint:this.vectorDef[0].style,strokeUnits:false};
},getBindables:function(){if(this.bindableAttrs){return this.bindableAttrs;}if(this.src){this.bindableAttrs=["Size","Width","Height","Source"];
}else{this.bindableAttrs=["Fill","Size","Width","Height"];}return this.bindableAttrs;},toXMLString:function(){var B="";
var G="";var E="";var I="";var z="";if(this.vectorDef[0]&&this.vectorDef[0].style){G=this.vectorDef[0].style.fill;
if(e.notNull(this.vectorDef[0].style.fillOpacity)){E=Math.min(Math.round(this.vectorDef[0].style.fillOpacity*255),255);
}I=this.vectorDef[0].style.stroke;if(e.notNull(this.vectorDef[0].style.strokeOpacity)){z=Math.min(Math.round(this.vectorDef[0].style.strokeOpacity*255),255);
}}var A=this.vectorDef[0].shape;var u="";var K="";if(A&&A.type==="circle"){u='<circle cx="'+A.cx+'" cy="'+A.cy+'" r="0"/>';
}else{if(A&&A.type==="rectangle"){B=""+A.x+","+A.y+",";B+=(A.x+A.width)+","+A.y+",";B+=(A.x+A.width)+","+(A.y+A.height)+",";
B+=(A.x)+","+(A.y+A.height)+",";B+=A.x+","+A.y;u='<polygon points="'+B+'"/>';}else{if(A&&A.type==="path"){B="";
var t=A.coords[0];for(var v=0,y=t.length;v<y;v+=1){B+=t[v];if(v<t.length-1){B+=",";}}u='<polygon points="'+B+'"/>';
}}}if(A){var x;var w;var D="";var C="";if(e.isNull(this.xOffset)||this.xOffset===0){D="0.5";}else{x=(this.width+this.xOffset)/this.width;
x=Math.max(0,x);x=Math.min(1,x);D=""+x;}if(e.isNull(this.yOffset)||this.yOffset===0){C+="0.5";}else{w=(this.height+this.yOffset)/this.height;
w=Math.max(0,w);w=Math.min(1,w);C=""+w;}if(D!=="0.5"||C!=="0.5"){K='<anchor x="'+D+'" y="'+C+"Y";}}var F="";
if(e.notNull(this.lengthUnit)){if(this.lengthUnit!=="pixel"){F=this.lengthUnit;}}var J="";J+='<style name="'+this.getStyleName()+'">';
J+='<g class="marker"'+(e.notNull(this.max_size_in_px)?' max_size_in_px="'+this.max_size_in_px+'"':"")+' style="';
J+=(e.notNull(I)?"stroke:"+I+";":"");J+=(e.notNull(z)?"stroke-opacity:"+z+";":"");J+=(e.notNull(G)?"fill:"+G+";":"");
J+=(e.notNull(E)?"fill-opacity:"+E+";":"");J+=(e.notNull(this.width)?"width:"+this.width+F+";":"");J+=(e.notNull(this.height)?"height:"+this.height+F+";":"");
J+='">';J+=u;J+=K;J+="</g></style>";return J;}});e.style.Marker.isSameShape=function(v,u){if(v.type===u.type){if(v.type==="circle"){if(v.cx===u.cx&&v.cy===u.cy&&v.width===u.width&&v.height===u.height){return true;
}else{return false;}}else{if(v.type==="rectangle"){if(v.x===u.x&&v.y===u.y&&v.width===u.width&&v.height===u.height){return true;
}else{return false;}}else{var t=v.coords[0],x=u.coords[0];if(t.length!==x.length){return false;}for(var w=0,s=t.length;
w<s;w+=2){if(t[w]!==x[w]){return false;}}return true;}}}return false;};e.style.StyleStore=e.style.StyleStore||{};
e.style.StyleStore.styleCache=e.style.StyleStore.styleCache||{};e.style.StyleStore.styleCachePromises=e.style.StyleStore.styleCachePromises||{};
e.style.StyleStore.getServerSideStyle=function(s,w,z){var y=e.style.StyleStore.styleCachePromises;if(!s||!w){e.util.Logger.alert("MAPVIEWER_9018","OM.style.StyleStore.getServerSideStyle","dataSource:"+s+" styleName:"+w);
return null;}var C=e.style;var u=C.StyleStore.getCachedStyle(s,w);if(e.isNull(u)){if(!z||!z.callback){e.util.Logger.alert("MAPVIEWER_9018","OM.style.StyleStore.getServerSideStyle","options.callback:"+z.callback);
return null;}var x;var A=function(E){var D=null;try{D=e.style.StyleStore.parseXMLStyle(E,w,s,x);}catch(F){D=e.style.StyleStore.parseJSONStyle(E,w);
}if(e.notNull(D)){e.style.StyleStore.putStyle(s,w,D);}if(z&&z.callback){if(D.styleName==="__Invalid__"){z.callback(null);
D=null;}else{z.callback(D);}}return D;};var B="/omserver";var v={xml_request:'<non_map_request><get_style_definition data_source="'+s+'" style="'+w+'"/></non_map_request>'};
if(z&&z.url){x=z.url+B;}else{x=e.gv.localbaseURL()+B;}var t=e.style.StyleStore.getKey(s,w);if(!y[t]){y[t]=e.$.Deferred(function(D){e.util.HttpRequest.send(x,v,function(E){D.resolve(E);
},"text",function(){e.util.Logger.warning("MAPVIEWER_9023","OM.style.StyleStore.getServerSideStyle");
D.reject();});}).promise();}return y[t].done(A);}else{if(u.styleName==="__Invalid__"){if(z&&z.callback){z.callback(null);
}return null;}else{if(z&&z.callback){z.callback(u);}}}return u;};e.style.StyleStore.parseXMLStyle=function(x,u,y,t){var s;
if(typeof x==="string"){x=e.$.trim(x);var w=e.$.parseXML(x);s=e.$(w);}else{s=e.$(x);}var v;if(e.notNull(s.find("oms_error")[0])){v=new e.style.Style({styleName:"__Invalid__"});
e.util.Logger.alert("MAPVIEWER_9023","OM.style.StyleStore.parseXMLStyle",s.find("oms_error").text());
}else{v=e.style.StyleStore.createStyle(s,u,y,t);}if(e.isNull(v)){v=new e.style.Style({styleName:"__Invalid__"});
}return v;};e.style.StyleStore.parseJSONStyle=function(E,u){if(typeof E==="string"){E=e.$.parseJSON(E);
}if(!E.type){return null;}var F=E.type;var w=E.def;w.styleName=u;var s;var y;switch(F){case"color":s=new e.style.Color(w);
break;case"marker":s=new e.style.Marker(w);break;case"pulse_animation":s=new e.style.PulseAnimation(w);
break;case"color_animation":var v={};v.styleName=u;if(E.beginColorDef){v.beginColor=new e.style.Color(E.beginColorDef.def);
}if(E.endColorDef){v.endColor=new e.style.Color(E.endColorDef.def);}if(w.duration){v.duration=w.duration;
}if(w.movingDashLine){v.enableMovingDashLine=w.movingDashLine;}s=new e.style.AnimationColor(v);break;
case"bar_chart":var z=E.barArr;var A=z.length;var D=[];for(y=0;y<A;y++){D.push(new e.style.Bar(z[y].name,z[y].color));
}w.bars=D;s=new e.style.BarChart(w);break;case"pie_chart":var x=E.pieArr;var B=x.length;var C=[];for(y=0;
y<B;y++){C.push(new e.style.PieSlice(x[y].name,x[y].color));}w.pieSlices=C;s=new e.style.PieChart(w);
break;}return s;};e.style.StyleStore.createStyle=function(y,v,t,w){var F=e.style.StyleStore;var u;var D=y.find("non_map_response > style");
for(var B=0;B<D.length;B++){var A=D.eq(B);var x=A.attr("name");var E=F.createSingleStyle(A,t,w);if(e.notNull(E)){e.style.StyleStore.putStyle(t,x,E);
if(x==v){u=E;}}}if(e.notNull(u)&&e.notNull(u.markerPattern)&&e.notNull(u.markerPattern.markers)){var C=u.markerPattern.markers;
u.markerPattern.markers=[];for(var z=0;z<C.length;z++){u.markerPattern.markers.push(e.style.StyleStore.getCachedStyle(t,C[z]));
}}return u;};e.style.StyleStore.createSingleStyle=function(u,y,t){var x=e.style.StyleStore;var w;var s=u.find("AdvancedStyle")[0];
if(e.isNull(s)){var v={dataSource:y,data:u,url:t};w=x.createSimpleStyle(v);}else{w=x.createAdvancedStyle(u.parent(),y,t);
}return w;};e.style.StyleStore.createAdvancedStyle=function(u,y,t){var x=u.find("AdvancedStyle")[0];var w=e.style.StyleStore;
var s=e.$(x).children()[0];var v=s.tagName;switch(v){case"PieChartStyle":return w.createPieChartStyle(u);
case"BarChartStyle":return w.createBarChartStyle(u);case"ColorSchemeStyle":return w.createColorSchemeStyle(u);
case"HeatMapStyle":return w.createHeatMapStyle(u,y);case"BucketStyle":return w.createBucketStyle(u,y,t);
case"VariableMarkerStyle":return w.createVariableMarkerStyle(u,y,t);default:return;}};e.style.StyleStore.getCachedStyle=function(u,w){var v=e.style.StyleStore.styleCache;
var t=e.style.StyleStore.getKey(u,w);var s=v[t];return s;};e.style.StyleStore.putStyle=function(t,w,v){var u=e.style.StyleStore.styleCache;
if(e.isNull(t)||e.isNull(w)){return;}var s=e.style.StyleStore.getKey(t,w);u[s]=v;};e.style.StyleStore.getKey=function(s,t){if(e.isNull(s)){s="";
}if(e.isNull(t)){t="";}return s.toLowerCase()+"__"+t.toLowerCase();};e.style.StyleStore._styleStringToArray=function(y){var t=y.attr("style");
var x=t.split(";");var w=[];for(var u=0,s=x.length;u<s;u++){var v=x[u].split(":");if(v&&v[0]){w[v[0]]=v[1];
}}return w;};e.style.StyleStore._maxSizeInPx=function(t){var s=t.attr("max_size_in_px");if(!e.isNull(s)){s.trim();
}else{s="";}return s;};e.style.StyleStore.createSimpleStyle=function(u){var t=u.data;var y=u.dataSource;
var s=u.url;var x=t.find("g");var w=e.style.StyleStore;if(e.notNull(x[0])){var v=x.attr("class");switch(v){case"color":return w.createColorStyle(t);
case"line":return w.createLineStyle(t);case"area":return w.createAreaStyle(y,s,t);case"marker":return w.createMarkerStyle(y,s,t);
case"text":return w.createTextStyle(t);default:return null;}}else{return null;}};e.style.StyleStore.createColorStyle=function(s){var u={};
var t=e.style.StyleStore;u.styleName=s.attr("name");s.find("g").each(function(w,x){var z=e.$(x);var y=t._styleStringToArray(z);
u.fill=typeof(y.fill)!=="function"?y.fill:null;u.fillOpacity=y["fill-opacity"]?parseInt(y["fill-opacity"])/255:1;
u.stroke=y.stroke;u.strokeThickness=y["stroke-width"];u.strokeOpacity=y["stroke-opacity"]?parseInt(y["stroke-opacity"])/255:1;
});var v=new e.style.Color(u);return v;};e.style.StyleStore.createLineStyle=function(s){var u={};var t=e.style.StyleStore;
u.styleName=s.attr("name");s.find("g").each(function(w,x){var z=e.$(x);var y=t._styleStringToArray(z);
u.fill=typeof(y.fill)!=="function"?y.fill:null;u.fillWidth=y["stroke-width"];u.strokeLineCap=y["stroke-linecap"];
u.strokeLineJoin=y["stroke-linejoin"];u.cased=z.attr("cased")==="true"?true:false;z.find("line").each(function(D,C){var B;
var A=e.$(C);if(A.attr("class")==="parallel"){B=t._styleStringToArray(A);u.stroke=typeof(B.fill)!=="function"?B.fill:null;
u.strokeThickness=B["stroke-width"];u.strokeDash=t.splitDashArray(A.attr("dash"));}else{if(A.attr("class")==="base"){B=t._styleStringToArray(A);
u.centerLine=typeof(B.fill)!=="function"?B.fill:null;u.centerLineWidth=B["stroke-width"];u.centerLineDash=t.splitDashArray(A.attr("dash"));
}}});z.find("marker-pattern").each(function(E,C){var B=e.$(C);var D=B.attr("offset")||"";var A=B.attr("interval")||"";
u.markerPattern={};u.markerPattern.offset=parseInt(D);u.markerPattern.offsetUnit=D.replace(/[0-9]/g,"");
u.markerPattern.interval=parseInt(A);u.markerPattern.intervalUnit=A.replace(/[0-9]/g,"");u.markerPattern.markers=[];
B.find("marker").each(function(I,F){var G=e.$(F);u.markerPattern.markers.push(G.html());});});});var v=new e.style.Line(u);
return v;};e.style.StyleStore.createAreaStyle=function(t,w,s){var v={};var u=e.style.StyleStore;v.styleName=s.attr("name");
s.find("g").each(function(y,z){var B=e.$(z);var A=u._styleStringToArray(B);v.stroke=A.stroke;v.strokeThickness=A["stroke-width"];
v.strokeOpacity=A["stroke-opacity"]?parseInt(A["stroke-opacity"])/255:1;v.fillOpacity=A["fill-opacity"]?parseInt(A["fill-opacity"])/255:1;
v.src=w+"?sty="+v.styleName+"&ds="+t+"&w=10&h=10";});var x=new e.style.Area(v);return x;};e.style.StyleStore.createMarkerStyle=function(x,u,A){var y={};
var D=e.style.StyleStore;var v={};var w={};var E={};y.styleName=A.attr("name");A.find("g").each(function(){var K=e.$(this);
var F=D._maxSizeInPx(K);if(!e.isNull(F)&&F.length>0){y.max_size_in_px=parseInt(F);}var I=D._styleStringToArray(K);
var G=e.util.MiscUtil.parseNumberAndUnit(I.width);if(e.notNull(G.value)){y.width=1*G.value;}else{y.width=1*I.width;
}if(e.notNull(G.unit)){y.lengthUnit=G.unit;}var J=e.util.MiscUtil.parseNumberAndUnit(I.height);if(e.notNull(J.value)){y.height=1*J.value;
}else{y.height=1*I.height;}if(e.notNull(J.unit)){y.lengthUnit=J.unit;}if(I.fill&&typeof(I.fill)!=="function"){w.fill=I.fill;
}if(I["fill-opacity"]){w.fillOpacity=I["fill-opacity"]?parseInt(I["fill-opacity"])/255:1;}if(I.stroke){w.stroke=I.stroke;
}if(I["stroke-width"]){w.strokeThickness=I["stroke-width"];}if(I["stroke-opacity"]){w.strokeOpacity=I["stroke-opacity"]?parseInt(I["stroke-opacity"])/255:1;
}});var t;var z;var C;if(A.find("image").length!==0){if(A.find("image").attr("href")==="dummy.gif"){y.src=u+"?w="+y.width+"&h="+y.height+"&sty="+y.styleName+"&ds="+x;
}else{y.src=A.find("image").attr("href");}}else{if(A.find("svgSymbol").length!==0){y.src=u+"?w="+y.width+"&h="+y.height+"&sty="+y.styleName+"&ds="+x;
}else{if(A.find("circle").length!==0){E.type="circle";E.cx=1*A.find("circle").attr("cx");E.cy=1*A.find("circle").attr("cy");
E.width=y.width;E.height=y.height;v.shape=E;}else{if(A.find("rect").length!==0){E.type="rectangle";t=A.find("rect").attr("points").split(",");
for(z=0,C=t.length;z<C;z++){t[z]=1*t[z];}E.width=y.width;E.height=y.height;E.x=t[0];E.y=t[1];v.shape=E;
}else{var B=A.find("polygon").attr("points")||A.find("polyline").attr("points");E.type="path";t=B.split(",");
if(A.find("polygon").attr("points")){if(t.length>=2){t.push(t[0]);t.push(t[1]);}}E.coords=[t];v.shape=E;
}}}}for(z in w){v.style=w;break;}if(v.shape||v.style){y.vectorDef=[v];}var s=new e.style.Marker(y);s.calculateVectorMarkerScale();
return s;};e.style.StyleStore.createTextStyle=function(s){var t={};t.styleName=s.attr("name");s.find("g").each(function(v,x){var A=e.$(x);
var z=e.Text;var y=e.style.StyleStore._styleStringToArray(A);t.fill=typeof(y.fill)!=="function"?y.fill:null;
t.fontStyle=y["font-style"]==="italic"?z.FONTSTYLE_ITALIC:z.FONTSTYLE_NORMAL;t.fontFamily=y["font-family"];
var w=y["font-size"];if(w){t.fontSize=parseInt(w);var u=w.length;if(u>2&&w.substring(u-2)==="pt"){t.fontSize=parseInt(t.fontSize*96/72);
}}t.fontWeight=y["font-weight"]==="bold"?z.FONTWEIGHT_BOLD:z.FONTWEIGHT_NORMAL;});return new e.style.Text(t);
};e.style.StyleStore.createPieChartStyle=function(s){var t={};t.pieSlices=[];t.styleName=s.find("style").attr("name");
t.radius=s.find("PieChartStyle").attr("pieradius");s.find("PieSlice").each(function(x,y){var z=e.$(y);
var v=z.attr("color");var w=z.attr("name");t.pieSlices.push(new e.style.PieSlice(w,v));});var u=new e.style.PieChart(t);
return u;};e.style.StyleStore.createBarChartStyle=function(s){var t={};t.bars=[];t.styleName=s.find("style").attr("name");
var u=s.find("BarChartStyle");t.width=u.attr("width");t.height=u.attr("height");t.showXAxis=u.attr("show_x_axis");
t.maxSize=u.attr("max_value");s.find("Bar").each(function(y,z){var A=e.$(z);var w=A.attr("color");var x=A.attr("name");
t.bars.push(new e.style.Bar(x,w));});var v=new e.style.BarChart(t);return v;};e.style.StyleStore.createColorSchemeStyle=function(s){var v=e.style.StyleStore.createBucketConfig(s);
var t=s.find("ColorSchemeStyle");v.baseColor=t.attr("basecolor");var u=t.attr("basecolor_opacity");v.baseColorOpacity=u?parseInt(u)/255:1;
v.stroke=t.attr("strokecolor");if(t.attr("strokewidth")){v.strokeThickness=1*t.attr("strokewidth");}u=t.attr("strokecolor_opacity");
v.strokeOpacity=u?parseInt(u)/255:1;var w=new e.style.ColorScheme(v);return w;};e.style.StyleStore.createHeatMapStyle=function(A,t){var w={};
var u=A.find("spot_light_radius").text();w.styleName=A.find("style").attr("name");var v=A.find("container_theme").text();
if(v){w.containerVectorLayer=new e.layer.VectorLayer("container",{def:{type:e.layer.VectorLayer.TYPE_PREDEFINED,dataSource:t,theme:v,loadOnDemand:false}});
}w.spotlightRadius=1*u.match(/\d+\.?\d+/g);var C=u.match(/[a-z]+/g);if(C&&C.length>0){w.lengthUnit=C[0];
}var D;D=A.find("color_stops");var x=D.attr("alpha");w.opacity=1;if(x){w.opacity=parseFloat(x/256);}var z=e.$.trim(D.text());
D=z.split(",");for(var y=0,B=D.length;y<B;y++){D[y]=e.util.ValidationUtil.getColor(D[y]);}w.colorStops=D;
var s=new e.style.HeatMap(w);return s;};e.style.StyleStore.createBucketStyle=function(s,w,u){var t=e.style.StyleStore.createBucketConfig(s,w,u);
var v=new e.style.BucketStyle(t);return v;};e.style.StyleStore.createBucketConfig=function(B,t,v){var x={};
x.styleName=B.find("style:has('AdvancedStyle')").attr("name");var A=B.find("Buckets");var I=e.style.StyleStore;
var J=A.attr("default_style");if(J){x.defaultStyle=I.getSubStyleByName(B,J,t,v);}x.buckets=[];x.styles=[];
var w;var G=A.find("RangedBucket");if(G.length>0){w=e.style.RangedBucket;G.each(function(){x.classification="custom";
var Q=e.$(this);var L={};L.seq=1*Q.attr("seq");L.label=Q.attr("label");var K=1*Q.attr("low");var O=1*Q.attr("high");
L.low=isNaN(K)?Number.NEGATIVE_INFINITY:K;L.high=isNaN(O)?Number.POSITIVE_INFINITY:O;var N=Q.attr("style");
var M=I.getSubStyleByName(B,N,t,v);var P=new w(L);x.buckets.push(P);if(M){x.styles.push(M);}});x.numClasses=x.buckets.length;
return x;}var s=A.find("CollectionBucket");if(s.length>0){w=e.style.CollectionBucket;s.each(function(){x.classification="custom";
var P=e.$(this);var N={};N.seq=1*P.attr("seq");N.label=P.attr("label");var R=P.attr("style");var K=I.getSubStyleByName(B,R,t,v);
var V=P.attr("label_style");N.labelStyle=I.getSubStyleByName(B,V,t,v);N.keepWhiteSpace=P.attr("keep_white_space");
var S=P.attr("type");N.dataType=S;var L=P.attr("delimiter");if(!L){L=",";}var T=P.text();var U=T.split(L);
var Q=U.length;for(var O=0;O<Q;O++){if(S==="integer"||S==="short"){U[O]=parseInt(U[O]);}else{if(S=="double"||S==="long"){U[O]=parseFloat(U[O]);
}}}N.values=U;var M=new w(N);x.buckets.push(M);if(K){x.styles.push(K);}});x.numClasses=x.buckets.length;
return x;}var F=A.attr("styles");if(F){F=F.split(",");for(var z=0,C=F.length;z<C;z++){var u=I.getSubStyleByName(B,F[z],t,v);
x.styles.push(u);}}var E=A.attr("low");var y=A.attr("high");if(E){x.low=1*E;}if(y){x.high=1*y;}var D=A.attr("nbuckets");
x.numClasses=D?1*D:null;return x;};e.style.StyleStore.createVariableMarkerStyle=function(x,t,u){var v=e.style.StyleStore.createBucketConfig(x,t,u);
var y=x.find("VariableMarkerStyle");var A=e.style.StyleStore;var z=y.attr("basemarker");v.marker=A.getSubStyleByName(x,z,t,u);
var B=y.attr("startsize");var w=y.attr("increment");if(B){v.startSize=1*B;}if(w){v.increament=1*w;}var s=new e.style.VariableMarker(v);
return s;};e.style.StyleStore.getSubStyleByName=function(t,w,y,v){var s=t.find('style[name="'+w+'"]')[0];
var u=e.$(s);var x={dataSource:y,url:v,data:u};return e.style.StyleStore.createSimpleStyle(x);};e.style.StyleStore.splitDashArray=function(v){if(v){var t=v.split(",");
var s=t.length;for(var u=0;u<s;u++){t[u]=parseInt(t[u]);}return t;}return null;};e.style.StyleStore.defaultMarkerStyle=new e.style.Marker({width:50,height:50,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAG3klEQVRoQ+2XaWwUZRzG37n26LWUAi0toi1IImhiggqioiEhqYkJH5SEIyECMSAYTCiKHAot5xflC2CQ+EFEjgBRULlrLeEoJKACBakNaaDHUloshXZLa3d8nndmyrZAod3tasgOeTvnzjy///P83xkU8ZgsymPCIWIg/zcnY47EHOmhCsSi1UOF7fZtY450u3Q99MOYI/6bzSMVoWWHW2BTtO5P87mKwr1PtxwpqWjcXXOrafSvl81eQphtGhTczZS7vK0prH0Fa1Med86HHn89U63rk+g5MiQjblw4MF0GKa9t/vzQ6bIZeQUivqG00NLcyRIMEqTjRdi3D7XUVYg18yY0jB3+5IYBKa6c7sJ0GaSkMlD88ffXhx4vPNBWZefhJsoO2VKkaartNYXAKArOWdZJyGfTVPHl/PEXhqR7h0UN5PK1pqqpm6rSLp46bD3TSlFbhSWAs++Ix76qqnYIuQNcRM5E5FRFFxneRrFj5RR/Vqqnf1RBpn3rT7tw6pD1TOiSuulCEBC2x9Yxxsp2BiCOA5Zr1oUm1unegNi1fHL0QaZvrkorPglH7D5HXe9xQfaFqt0VDyAnbmh96ZBc4E4GQHbkTYg+CKNFR6RYRsSxoYMDKsUzUkEahX8QLbd0AuJ3ckaDIx5EK/cdgLijGy2nR6QTVl5k88oYaYrMPY9JoXRFJo5rjdw4bzllOWaKAeiR7YvH+TOjDSKjVZR/1wlqoig6IsVqQtGgnk7ogCIEz2nctvuI7xU7XhlxAbF9wZv/Dcj5ol+cXhcaBEoAiKQ4RcU+QUzbAd2Q0FbjwzHu0xruIW7p7gax7ZOx/sx+RvSjdeEkQDiN2pU2IZKRsqJkOaKohnSDYPKY3SPsG4XXYvpV4F66+5bYkjM6+iCM1vmTBTIqrLEJwW1iIUw1AMA+oXgZM+zLbSt6ElZOEtbsxWbfPOdFgOjRdUT2yCl8njAamtvKOsSzoRXdJYXLinNtO8N9XAiD6AbiJd2y3iMZntti08znogtSWhW48v626if+IAgqyxlINVzSAUUHFPJP0TxmCkO6QwdUuBcEKB1QNDiCbzD2FN/uWQmNYsPUQVcH9dUHWtNZ15cuf2uV+gNb1hXenLh1D16IsicIABBUXzM8gHPJZlawVhgxVJ4QcsZizOx+ke8TvlDRN28NaRWzRidvHZyqT+o6gvWLLoNU1jUPr6hpyJ+xrc5XVXoa1adoCDbcEIxtwKgciJyAK4rtitXsgJIuBuWrR8Of3nFCZD+tiKkjvLmpPm1p1ED4IMJU1gTyZ+6s91WW/AZHLPEOhIZ9xkwwaoBT4ZhB4UiUm5Oa/EA2RYpXFa8NNsS7L+i5ZqBxfVpaYnVUQdpgapsAc9tXVXYJIF6hQbjq9iJdcRCPmAFCh3oPetztUoROGGzrIEnG6VcGGWLi8+FDdCtaoRWTztTeyZ/9wx2fv7xMaG7kBECMFd1xGbqIhxX8EIlDGxFExydML1w26ilDZGcFVu/e/t3Xc+fOvt6JE+ykVox/7DW37/631P5hl3uk4wMlzI2W/A/2mL5qf4VQ3PFwxit0lyHi3Ypwo6O9hircaCOCJCNxI7J0MVQr2bgqd+HOfft++rsTCHzkiBaMAMYtjNsYTTZQO5iwQSji0tWal+pb4g/N39eadLW2QTridasiAeI9cIQghmoiTooYmamLlBtHdy7/bNHBM2eKbj4AgiIJ0YzRiMHrajEI3WC7E1EQFoJfgolr1m18Y1T25G9WFAQTSmuDMlLxBtzQAaGbom+cKiHiyg/uXbls4ZHic+dY4dDFEUYAB4KiCVGDwfjdsB3h+XZLOI44EAm4Y1+M1PdmzRkxPWd13hdHgt6yOlMkoi84S/VLUMXLgPBc+fngquVLjv1Z3A6CAM5g/jnu2E7U2wDXbAhG7B4IEoUDws8sJF4kY/SzYXpPmjJt2Jwla+etPx70XqkLiv5Jmng1SxMJ5XtDIZzoOI3sNDP7gRAUTAg6QDfqHuSEY0skQJJwsxSM3jZUAmCe+XDp2nlfnTC9w9I10af6wP5Vyz49evH8WcbEqTpFcybimr1AADYyIdjUBOFgvHj+npnKgQjXERaBriBAgvHy2YNgibt+PDzlL++otzPrC/esWLqg4OzZ31lVinaqTnEUTfEOABvbOUYwgnYK4MCE40joPRwgvCEEQZLGjHlz4EeLl4zPW5Sz/8SJY5xtKCpUNAWHgjgOPZLwUDfCdaTjvbjvAHmxTSiu+T50ZiEHxKn2fV9u97vxw45FwpEHARGKUzMXpy/uO+M8TOSjnO8pkEd5dkSviYFEtJwRuFnMkQgUMaK3iDkS0XJG4GaPjSP/Al31T1GL6r+HAAAAAElFTkSuQmCC",yOffset:-12,xOffset:2});
e.style.StyleStore.defaultLineStyle=new e.style.Line({stroke:"#000000",strokeThickness:1});e.style.StyleStore.defaultPolygonStyle=new e.style.Color({stroke:"#000000",strokeThickness:1,fill:"#bebebe"});
e.style.StyleStore.defaulTextStyle=new e.style.Text({fontSize:12,fill:"#000000"});e.style.BasicAnimation=e.style.Style.extend({initialize:function b(s){b.base.call(this,s);
this.duration=e.notNull(s.duration)?s.duration:5;this.repeatCount=s.repeatCount?s.repeatCount:Number.MAX_VALUE;
},isRepeat:function(){return this.repeatCount>0;},getDuration:function(){return this.duration;}});e.style.AnimationColor=e.style.BasicAnimation.extend({initialize:function b(s){s=s||{};
s.styleType="AnimationColor";b.base.call(this,s);this.beginColor=e.notNull(s.beginColor)?s.beginColor:new e.style.Color({strokeThickness:1,stroke:"#000000",fill:"#ffffff"});
this.endColor=e.notNull(s.endColor)?s.endColor:new e.style.Color({strokeThickness:1,stroke:"#ffffff",fill:"#000000"});
this.movingDashLine=e.notNull(s.enableMovingDashLine)?s.enableMovingDashLine:false;if(this.movingDashLine){this.beginColor.strokeDashArray=[10,10];
}if(e.isNull(s.repeat)||s.repeat){this.repeatCount=Number.POSITIVE_INFINITY;}else{this.repeatCount=1;
}},draw:function(u,t,s){this.beginColor.draw(u,t,s);},createAnimation:function(w,u,t){this.target=w;if(this.beginColor&&this.endColor){var x=[];
var v={};if(this.beginColor.stroke!==this.endColor.stroke){v.stroke={beginValue:this.covertColor(this.beginColor.stroke,u),endValue:this.covertColor(this.endColor.stroke,u),interpolator:u.oui.anim.interpolateColor};
}if(this.beginColor.strokeThickness!==this.endColor.strokeThickness){v.strokeThickness={beginValue:this.beginColor.strokeThickness,endValue:this.endColor.strokeThickness};
}if(!t){if(this.beginColor.fill!==this.endColor.fill){v.fill={beginValue:this.covertColor(this.beginColor.fill,u),endValue:this.covertColor(this.endColor.fill,u),interpolator:u.oui.anim.interpolateColor};
}if(this.beginColor.fillOpacity!==this.endColor.fillOpacity){v.fillOpacity={beginValue:this.beginColor.fillOpacity,endValue:this.endColor.fillOpacity};
}if(this.beginColor.strokeOpacity!==this.endColor.strokeOpacity){v.strokeOpacity={beginValue:this.beginColor.strokeOpacity,endValue:this.endColor.strokeOpacity};
}}if(this.movingDashLine){v.strokeDashArray={beginValue:[10,10],endValue:[10,10],interpolator:function(C,B,F){var E=5;
var D=parseInt(F*20*E);var A=D%20;var y=[10,10];if(A>10){y=[A-10,10,20-A,0.1];}else{if(A>0){var z=10-A;
y=[0.1,A,10,z===0?0.1:z];}}return y;}};}var s=new u.oui.anim.AnimateStyle({targetNode:w,dur:this.duration,animValues:v,repeatCount:this.repeatCount});
x.push(s);return x;}},covertColor:function(t,u){var w=parseInt(t.substring(1,3),16);var v=parseInt(t.substring(3,5),16);
var s=parseInt(t.substring(5),16);return new u.oui.style.Color(w,v,s);}});e.style.PulseAnimation=e.style.BasicAnimation.extend({initialize:function b(s){s=s||{};
s.styleType="PulseAnimation";b.base.call(this,s);this.beginSize=e.notNull(s.beginSize)?s.beginSize:10;
this.endSize=e.notNull(s.endSize)?s.endSize:20;this.stroke=e.notNull(s.stroke)?s.stroke:"#000000";},draw:function(B,u,C){var w=B.geo;
var z=w.type;if(z==="LineString"||z==="MultiLineString"||z==="Polygon"||z==="MultiPolygon"){return;}var A=u.getGraphics();
if(!B.screenPoints){B.transformGeometry(w);}var t=B.screenPoints;var s=[{shape:{type:"circle",cx:0,cy:0,width:this.beginSize,height:this.beginSize,scaleX:1,scaleY:1},style:{stroke:this.stroke}}];
if(z==="MultiPoint"||z==="OrientedMultiPoint"){var y=A.createGroup();C.group.appendChild(y);C.group=y;
for(var v=0,x=t.length;v<x;v++){A.drawVectorMarker({x:t[v].x,y:t[v].y},s,C);}B.shape=y;}else{B.shape=A.drawVectorMarker({x:t.x,y:t.y},s,C);
}},createAnimation:function(u,t){this.target=u;var v=[];var s=new t.oui.anim.AnimateStyle({targetNode:u,dur:this.duration,repeatCount:this.repeatCount,animValues:{width:{beginValue:this.beginSize,endValue:this.endSize},height:{beginValue:this.beginSize,endValue:this.endSize},strokeOpacity:{beginValue:1,endValue:0}}});
s.addEventListener(t.oui.SyncEvents.END,this.endListener);v.push(s);return v;},endListener:function(t){var s=t.target;
var v=s.getTargetNode();var u=s.getAnimValues();v.applyStyle({width:u.width.beginValue,height:u.height.beginValue,strokeOpacity:1});
}});e.style.Area=e.style.Style.extend({initialize:function b(s){s=s||{};s.styleType="Area";b.base.call(this,s);
var t=e.util.ValidationUtil.getColor;this.stroke=e.notNull(s.stroke)&&(t(s.stroke))?t(s.stroke):e.PaintTypes.NO_PAINT;
this.src=e.notNull(s.src)?s.src:e.PaintTypes.NO_PAINT;this.strokeThickness=e.notNull(s.strokeThickness)?parseFloat(s.strokeThickness):1;
this.fillOpacity=e.notNull(s.fillOpacity)?s.fillOpacity:1;this.strokeOpacity=e.notNull(s.strokeOpacity)?s.strokeOpacity:1;
this.strokeDashArray=e.notNull(s.strokeDash)?s.strokeDash:[];this.repeatPattern=e.notNull(s.repeatPattern)?s.repeatPattern:true;
if(e.notNull(this.src)){this.loadImgFromSource();}},loadImgFromSource:function(){var s=this;var t=new Image();
t.src=this.src;t.onload=function(){if(e.isNull(s.width)){s.width=t.width;}if(e.isNull(s.height)){s.height=t.height;
}if(s.origConfig){s.origConfig.width=t.width;s.origConfig.height=t.height;}};},createStyle:function(s){this.fill=new s.oui.style.PatternPaint({src:this.src});
},createFixedImageStyle:function(t,u,s){var v={src:this.src,x:s.x,y:s.y,width:s.width,height:s.height,preserveAspectRatio:true,opacity:this.fillOpacity};
try{var x=t.createImage(v);this.imgGroup=t.createGroup();this.imgGroup.appendChild(x);}catch(w){e.util.Logger.warning("MAPVIEWER","OM.style.Area","Cannot create fixed image. Using pattern fill");
this.fill=new t.oui.style.PatternPaint({src:this.src});}},draw:function(x,L,u){var P=x.geo;var v=e.notNull(u.type)?u.type:P.type;
var I=L.getGraphics();var F;if(u.screenPoints){F=u.screenPoints;}else{if(!x.screenPoints){x.transformGeometry(P);
}F=x.screenPoints;}var O;var C;var D;var G;if((v==="LineString"||v==="MultiLineString")&&F&&F.length>0){G={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDashArray};
if(v==="LineString"){x.shape=I.drawPath(F,G,u);}else{O=I.createGroup();u.group.appendChild(O);u.group=O;
for(C=0,D=F.length;C<D;C++){I.drawPath(F[C],G,u);}x.shape=O;}return;}if(this.repeatPattern){this.createStyle(I);
}else{}if(v==="Point"||v==="OrientedPoint"||v==="MultiPoint"||v==="OrientedMultiPoint"){var z=e.gv.defaultMarkerStyleWidth;
var E=e.gv.defaultMarkerStyleHeight;var J=[{shape:{type:"circle",cx:z/2,cy:E/2,width:z,height:E,scaleX:1,scaleY:1},style:this}];
if(v==="MultiPoint"||v==="OrientedMultiPoint"){O=I.createGroup();u.group.appendChild(O);u.group=O;for(C=0,D=F.length;
C<D;C++){I.drawVectorMarker({x:F[C].x,y:F[C].y},J,u);}x.shape=O;}else{x.shape=I.drawVectorMarker({x:F.x,y:F.y},J,u);
}return;}else{if(!F||F.length===0){return;}}G={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDashArray,fill:this.fill,fillOpacity:this.fillOpacity};
if(v==="Rectangle"){if(this.repeatPattern===false){G.fill=null;var A={src:this.src,x:F.x,y:F.y,width:F.width,height:F.height,preserveAspectRatio:true,opacity:this.fillOpacity};
var s=I.createGroup("imageGroup");u.group.appendChild(s);u.group=s;u.enableCache=true;try{I.drawImage(F,A,u);
}catch(K){e.util.Logger.warning("MAPVIEWER","OM.style.Area","Cannot create nonpattern area style:");e.util.Logger.warning("MAPVIEWER",K);
}var N=u.group;var M=I.createGroup();u.group.appendChild(M);u.group=M;I.drawRectangle(F,G,u);M.appendChild(N);
x.shape=N;}else{x.shape=I.drawRectangle(F,G,u);}}else{if(v==="Polygon"){x.shape=I.drawPath(F,G,u);}else{if(v==="MultiPolygon"){var t=I.createGroup();
u.group.appendChild(t);u.group=t;for(var B=0,y=F.length;B<y;B++){I.drawPath(F[B],G,u);}x.shape=t;}}}}});
e.style.Formatter=e.Class.extend({initialize:function(s){this.scale=(s&&s.scale)||"logarithm";this.style=s?s.style:null;
this.numClasses=(s&&s.numClasses)||7;if(e.isNull(this.numClasses)){this.numClasses=0;}},resolve:function(u,t,s){return null;
},getScale:function(){return this.scale;},getStyle:function(){return this.style;},getNumClasses:function(){return this.numClasses;
}});e.style.ColorFormatter=e.style.Formatter.extend({initialize:function b(s){b.base.call(this,s);this.baseColors=s.colors;
if(e.isNull(this.baseColors)){this.baseColors=e.style.colorbrewer.PuBuGn["7"];}this.defaultColor=s.defaultColor;
if(e.isNull(this.defaultColor)){if(e.notNull(this.style)&&e.notNull(this.style.fill)){this.defaultColor=this.style.fill;
}else{this.defaultColor=e.PaintTypes.NO_PAINT;}}},resolve:function(v,w,D){var t=this.baseColors;var C=this.numClasses||t.length;
if(e.isNull(v)||v===""){return this.defaultColor;}var B;if(this.scale&&this.scale.indexOf("log")===0){var y=w.getMin(),z=w.getMax();
var s=Math.log(y),x=Math.log(z);var u=(x-s)/C;B=parseInt((Math.log(v)-s)/u);if(isNaN(B)){return this.defaultColor;
}else{if(B>=t.length){return t[t.length-1];}else{return t[B];}}}else{var A=(w.getMax()-w.getMin())/C;
B=parseInt((v-w.getMin())/A);if(isNaN(B)){return this.defaultColor;}else{if(B>=t.length){return t[t.length-1];
}else{return t[B];}}}},getBaseColors:function(s){return this.baseColors;},setColors:function(s){this.baseColors=s;
},getDefaultColor:function(){return this.defaultColor;},setDefaultColor:function(s){this.defaultColor=s;
}});e.style.SizeFormatter=e.style.Formatter.extend({initialize:function b(s){b.base.call(this,s);this.startingSize=s.startingSize;
if(e.isNull(this.startingSize)){if(e.notNull(this.style)){this.startingSize=this.style.origConfig.width;
}else{this.startingSize=15;}}this.defaultSize=s.defaultSize;if(e.isNull(this.defaultSize)){this.defaultSize=0;
}this.delta=s.delta||5;this.lengthUnit=e.notNull(s.lengthUnit)?s.lengthUnit:"pixel";},resolve:function(y,v,u){var w=this.doResolve(y,v);
var s=this.lengthUnit.toLowerCase();if(s!=="pixel"&&e.notNull(u)&&e.notNull(u.parentLayer)&&e.notNull(u.parentLayer.parentMap)){var x=e.util.GeomUtil.getCurrentDistancePerPixel(u.parentLayer.parentMap.getMapContext());
var t=e.gv.getUnitFactor(s);if(t!==0){x/=t;}w/=x;}return w;},doResolve:function(u,v){if(e.isNull(u)||u===""){return this.defaultSize;
}var C=this.delta;var t=this.numClasses;var E=this.startingSize;var D,A,B;if(this.scale&&this.scale.indexOf("log")===0){D=C;
var x=v.getMin(),z=v.getMax();if(x<=0){var y=1-x;x=x+y;z=z+y;u=u+y;}var s=Math.log(x),w=Math.log(z);A=(w-s)/t;
B=parseInt((Math.log(u)-s)/A);if(isNaN(B)){B=0;}return E+D*B;}else{D=C;A=(v.getMax()-v.getMin())/t;B=parseInt((u-v.getMin())/A);
if(isNaN(B)){B=0;}return E+D*B;}},getStartingSize:function(){return this.minSize;},getDefaultSize:function(){return this.defaultSize;
}});e.style.Div=e.style.Style.extend({initialize:function b(s){b.base.call(this,s);s=s||{};this.showOnPoint=1;
this.lengthUnit=e.notNull(s.lengthUnit)?s.lengthUnit:"pixel";this.width=s.width;this.height=s.height;
this.callback=s.customRenderer;this.html=s.html;},draw:function(v,u,t){if(this.appliable(v)===false){return;
}var s=this.getCustomLayerDiv(v);this.setPosition(s,v,u);if(e.notNull(this.html)){s.html(this.html);}else{this.callback(s[0],v);
}},appliable:function(s){var u=s.getGeometry();var t=u.getType();switch(t){case"Point":case"MultiPoint":case"OrientedMultiPoint":case"Polygon":case"MultiPolygon":return true;
}return false;},resolve:function(x,w){if(!this.bindings||this.bindings.length===0){e.style.Style.calculateStyleSize(this,w);
return;}for(var v=0,t=this.bindings.length;v<t;v++){var s=this.bindings[v];var u=this.resolveBinding(s,x);
if(s.attribute==="SIZE"){if(this.origConfig.width&&this.origConfig.height&&this.origConfig.width!==this.origConfig.height){this.height=this.origConfig.height*u/this.origConfig.width;
this.width=u;}else{this.width=u;this.height=u;}}else{if(s.attribute==="WIDTH"){this.width=u;}else{if(s.attribute==="HEIGHT"){this.height=u;
}}}}if((e.isNull(this.width)||isNaN(this.width))&&e.notNull(this.origConfig.width)){this.width=this.origConfig.width;
}if((e.isNull(this.height)||isNaN(this.height))&&e.notNull(this.origConfig.height)){this.height=this.origConfig.height;
}this.realWidth=this.width;this.realHeight=this.height;},setPosition:function(C,G,x){this.resolve(G,x);
var E=this.realWidth;var A=this.realHeight;var s=x.getTransform();var B=G.parentLayer;var D=x.getCenterPoint();
var y=this.getCenterPoint(G);var v=s.toScreenXLength(y.getX()-D.getX())+B.orgWidth/2;var F=s.toScreenYLength(-(y.getY()-D.getY()))+B.orgHeight/2;
var u=s.toScreenXLength(B.dataBufferWindow.x+B.dataBufferWindow.w/2-D.getX());var z=s.toScreenYLength(-(B.dataBufferWindow.y+B.dataBufferWindow.h/2-D.getY()));
C.parent().css({left:u,top:z});C.css({left:v-u+"px",top:F-z+"px",width:E+"px",height:A+"px"});},getCenterPoint:function(t){var s=t.getGeometry().getMIR();
return new e.geometry.Point((s.getMinX()+s.getMaxX())/2,(s.getMinY()+s.getMaxY())/2,s.srid);},getCustomLayerDiv:function(v){var u=v.parentLayer;
var w=u.getDivId("f_"+v.id);var s=e.$("#"+w);if(s.length<=0){if(e.notNull(u.parentMap)){var t=e.$("<div id='"+w+"' style='position:absolute;overflow:hidden'>");
t.css({display:"block"});u.getCustomLayerDiv().append(t);v.$customDiv=t;s=t;}}s.data("f",v);return s;
},getBindables:function(){if(this.bindableAttrs){return this.bindableAttrs;}this.bindableAttrs=["Size","Width","Height"];
return this.bindableAttrs;}});e.style.SourceImageFormatter=e.style.Formatter.extend({initialize:function b(s){b.base.call(this,s);
this.defaultSource=s?s.defaultSource:null;if(e.isNull(this.defaultSource)){if(e.notNull(this.style)&&e.notNull(this.style.src)){this.defaultSource=this.style.src;
}else{this.defaultSource=e.PaintTypes.NO_PAINT;}}this.baseSources=s?s.sources:null;if(e.isNull(this.baseSources)){this.baseSources=[this.defaultSource];
}},resolve:function(u,t,s){},getBaseSources:function(s){return this.baseSources;},setSources:function(s){this.baseSources=s;
},getDefaultSource:function(){return this.defaultSource;},setDefaultSource:function(s){this.defaultSource=s;
}});e.style.StackedMarker=e.style.Marker.extend({initialize:function b(s){s=s||{};s.styleType="StackedMarker";
b.base.call(this,s);s.styleType="StackedMarker";this.width=e.notNull(s.width)?s.width:null;this.height=e.notNull(s.height)?s.height:null;
this.xOffset=e.notNull(s.xOffset)?s.xOffset:0;this.yOffset=e.notNull(s.yOffset)?s.yOffset:0;this.lengthUnit=e.notNull(s.lengthUnit)?s.lengthUnit:"pixel";
this.src=e.notNull(s.src)?s.src:null;this.textStyle=e.notNull(s.textStyle)?s.textStyle:s.textStyle===null?null:f;
if(this.src&&(e.isNull(this.width)||e.isNull(this.height))){var t=this;var u=new Image();u.src=this.src;
u.onload=function(){if(e.isNull(t.width)){t.width=u.width;}if(e.isNull(t.height)){t.height=u.height;}if(t.origConfig){t.origConfig.width=u.width;
t.origConfig.height=u.height;}};}this.markerArray=e.notNull(s.markerArray)?s.markerArray:null;if(this.markerArray){this.validateMarkers();
}else{e.util.Logger.warning(null,"OM.style.StackedMarker","ERROR: Invalid marker array");}this.textOffset=s.textOffset?s.textOffset:null;
this.showOnPoint=2;},validateMarkers:function(){for(var s=0;s<this.markerArray.length;s++){if(!this.markerArray[s] instanceof e.style.Marker){e.util.Logger.warning(null,"OM.style.StackedMarker","ERROR: Invalid marker array");
break;}this.markerArray[s].calculateVectorMarkerScale();}},resolve:function(){return this;},draw:function(A,t,B){var s=t.getGraphics().createGroup();
for(var v=0;v<this.markerArray.length;v++){var y=this.markerArray[v];y.resolve(A);var u=A.geo;var x=A.geo.type;
if(B.markerPoint&&A.shapeGroup){B.group.appendChild(s);if(y.width!==0&&y.height!==0){y.drawMarker(t,s,B.markerPoint,A.markerText);
}continue;}else{if(B.sPoint){B.group.appendChild(s);y.drawMarker(t,s,B.sPoint,A.markerText);continue;
}}if(x==="LineString"||x==="MultiLineString"){break;}if(x==="Polygon"||x==="MultiPolygon"){if(!A.screenPoints){var z=null;
if(A.labelBox){z=new e.geometry.Point((A.labelBox[0]+A.labelBox[2])/2,(A.labelBox[1]+A.labelBox[3])/2,u.srid);
}else{if(u.mbr){z=new e.geometry.Point((u.mbr.getMinX()+u.mbr.getMaxX())/2,(u.mbr.getMinY()+u.mbr.getMaxY())/2,u.srid);
}}z=A.transformGeometry(z);if(!A.screenPoints){A.screenPoints=z;}}B.group.appendChild(s);y.drawMarker(t,s,A.screenPoints,A.markerText);
}else{if(!A.screenPoints){A.transformGeometry(u);}if(x==="Point"||x==="OrientedPoint"){B.group.appendChild(s);
y.drawMarker(t,s,A.screenPoints,A.markerText);if(y.markerText){y.drawMarker(t,s,A.screenPoints,A.markerText);
}else{if(x==="MultiPoint"||x==="OrientedMultiPoint"){B.group.appendChild(s);for(var v=0,w=A.screenPoints.length;
v<w;v++){y.drawMarker(t,s,A.screenPoints[v],A.markerText);}}}}}}A.shape=s;}});e.style.GlyphMarker=e.style.Marker.extend({initialize:function b(s){s=s||{};
s.styleType="GlyphMarker";b.base.call(this,s);s.styleType="GlyphMarker";this.width=e.notNull(s.width)?s.width:null;
this.height=e.notNull(s.height)?s.height:null;this.xOffset=e.notNull(s.xOffset)?s.xOffset:0;this.yOffset=e.notNull(s.yOffset)?s.yOffset:0;
this.lengthUnit=e.notNull(s.lengthUnit)?s.lengthUnit:"pixel";this.src=e.notNull(s.src)?s.src:null;this.textStyle=e.notNull(s.textStyle)?s.textStyle:s.textStyle===null?null:f;
this.glyph=e.notNull(s.glyph)?s.glyph:"?";if(this.src&&(e.isNull(this.width)||e.isNull(this.height))){var t=this;
var u=new Image();u.src=this.src;u.onload=function(){if(e.isNull(t.width)){t.width=u.width;}if(e.isNull(t.height)){t.height=u.height;
}if(t.origConfig){t.origConfig.width=u.width;t.origConfig.height=u.height;}};}this.textOffset=s.textOffset?s.textOffset:null;
this.showOnPoint=2;this.calculateSurrogates(s.glyph);},calculateSurrogates:function(t){if(t.charAt(0)==="U"&&t.charAt(1)==="+"){t="0x"+t.substr(2,t.length-1);
t=parseInt(t);var x=parseInt("0x10000",16);var y=parseInt("0xD800",16);var u=parseInt("0x400",16);var w=parseInt("0xDC00",16);
var v=Math.floor((t-x)/u)+y;v="0x"+v.toString(16);var s=(t-x)%u+w;s="0x"+s.toString(16);var z=String.fromCharCode(v);
z+=String.fromCharCode(s);this.glyph=z;}},drawMarker:function(u,w,s,y){if(this.width===0||this.height===0){return;
}var t=u.getGraphics();var x=this.glyph;var v=t.createTextNode(x,this.textStyle,s.x,s.y);w.appendChild(v);
return v;}});e.Column=e.Class.extend({mixin:e.event.EventSource,initialize:function(t){this.keyGetter=t.keyGetter;
this.valueGetter=t.valueGetter;this.valueType=t.type||"number";this.measureName=t.measureName||"Measure";
this.measureIndex=e.isNull(t.measureIndex)?1:t.measureIndex;var y=t.data,w;this.numRows=y.length;this.hash=[];
this.min=Number.POSITIVE_INFINITY;this.max=Number.NEGATIVE_INFINITY;var v,x;for(var u=0,s=y.length;u<s;
u++){w=y[u];v=this.keyGetter.call(w);x=this.valueGetter.call(w,this.measureIndex);if(e.isNull(x)){continue;
}this.hash[v]=x;if(x<this.min){this.min=x;}if(x>this.max){this.max=x;}}},getSize:function(){return this.numRows;
},getValueOfRow:function(s){if(e.isNull(s)||e.isNull(this.hash)){return null;}else{return this.hash[s];
}},getValueType:function(){return this.valueType;},getMin:function(){return this.min;},getMax:function(){return this.max;
},getAverage:function(){return 0;},getKeys:function(){return[];},getKeyNames:function(){},isMeasure:function(){return true;
},getSampleData:function(s){if(!s){s=10;}},getMeasureName:function(){return this.measureName;},getMeasureIndex:function(){return this.measureIndex;
}});e.Feature=e.Class.extend({mixin:e.event.EventSource,initialize:function(w,u,s){this.id=w;this.activeIdx=null;
this.geo=u?u:null;this.graphics=null;this.group=null;this.shape=null;this.attributes=s&&e.notNull(s.attributes)?s.attributes:null;
this.renderingStyle=s&&e.notNull(s.renderingStyle)?s.renderingStyle:null;this.label=s&&e.notNull(s.label)?s.label:null;
this.labelStyle=s&&e.notNull(s.labelStyle)?s.labelStyle:null;this.draggable=s&&e.notNull(s.draggable)?s.draggable:null;
this.customContent=s&&e.notNull(s.customContent)?s.customContent:null;this.displayed=false;this.visible=true;
this.editable=false;this.screenTransformObj=null;this.labelOffsetX=2;this.labelOffsetY=2;this.selected=false;
this.hover=false;this.tooltipCache=null;this.tooltipNode=null;this.scaleX=1;this.scaleY=1;if(this.attributes){for(var t in this.attributes){var v=t.toUpperCase();
if(v!==t){this.attributes[v]=this.attributes[t];this.attributes[t]=null;delete this.attributes[t];}}}this.columnMap=null;
},setGeometry:function(x){if(e.isNull(x)){return false;}if(e.notNull(this.parentLayer)&&this.parentLayer.useRTree){this.parentLayer.removeFromRtree(this);
}if(!this.displayed){this.geo=x;this.screenPoints=null;return true;}var v=x.srid;var z=this.geo.srid;
if(v!==z){var B=this;x.transform(z,function(s){B.setGeometry(s);});return true;}this.clearInfoWindow();
this.geo=x;var y=-1;this.getShapeIndex();this.remove();this.screenPoints=null;var w=this.parentLayer;
var t=[];var A=w.getFeatureStyles(this);if(A){t.push(A);}if(w.otherStyles){t=t.concat(w.otherStyles);
}if(t.length===0){A=w.getDefaultRenderingStyle(this.geo.type);if(A){t.push(A);}else{return false;}}t=this.getAllStyles(t);
if(this.parentLayer.featureGroupArr&&this.parentLayer.featureGroupArr.length>0){this.shapeArray=[];for(var u=0;
u<this.parentLayer.featureGroupArr.length;u++){if(e.isNull(this.activeIdx)||this.activeIdx===u){this.group=this.parentLayer.featureGroupArr[u];
this.displayFeature(t,y);this.shapeArray[u]=this.labelShape;}}}else{this.displayFeature(t,y);}if(this.parentLayer.parentMap.wraparound){this.parentLayer.refresh();
}this.startAnimation();return true;},getGeometry:function(){var s=e.geometry.Geometry;if(!(this.geo instanceof s)){this.geo=s.createGeometry(this.geo,this.geo.srid);
}return this.geo;},getAttributes:function(){return this.attributes;},getAttributeValue:function(t){if(typeof t!=="string"||!this.attributes){return null;
}var s=this.attributes;var v=t.toUpperCase();if(e.notNull(s[v])){return s[v];}else{var u=this.getAliasColumnName(t);
if(u){u=u.toUpperCase();return s[u];}else{return null;}}},hasAttributes:function(){if(this.attributes){return true;
}else{return false;}},getAliasColumnName:function(t){if(typeof t!=="string"||!this.columnMap){return null;
}var s=this.columnMap;var u=t.toUpperCase();if(s&&e.notNull(s[u])){return s[u];}else{return null;}},getRealColumnName:function(s){if(typeof s!=="string"){return null;
}var t=this.columnMap;var w=s.toUpperCase();if(t){for(var u in t){if(t.hasOwnProperty(u)){var v=t[u].toUpperCase();
if(v===w){return u;}}}}return null;},getAllStyles:function(u){var t=[];var v=[];for(var s=0;s<u.length;
s++){if(e.notNull(u[s].animation)){v.push(u[s].animation);}}t=u.concat(v);return t;},setRenderingStyle:function(v){if(e.isNull(v)&&(e.isNull(this.parentLayer)||e.isNull(this.parentLayer.otherStyles)||this.parentLayer.otherStyles.length===0)){return;
}if(this.renderingStyle==v){return;}this.renderingStyle=v;if(!this.displayed){return;}var s=-1;this.getShapeIndex();
var t=this;if(e.notNull(this.shape)){this.shape.addEventListener(e.event.MouseEvent.MOUSE_OUT,function(x){try{x.target=t.shape;
t.shape.dispatchEvent(x);}catch(w){}});}this.remove();v=[v];if(this.parentLayer.otherStyles){v=v.concat(this.parentLayer.otherStyles);
}v=this.getAllStyles(v);if(this.parentLayer.featureGroupArr&&this.parentLayer.featureGroupArr.length>0){this.shapeArray=[];
for(var u=0;u<this.parentLayer.featureGroupArr.length;u++){if(e.isNull(this.activeIdx)||this.activeIdx===u){this.group=this.parentLayer.featureGroupArr[u];
this.displayFeature(v,s);this.shapeArray[u]=this.shape;}}}else{this.displayFeature(v,s);}this.setShapeIndex();
},getRenderingStyle:function(){return this.renderingStyle;},setLabel:function(s){if(e.isNull(s)){return;
}this.label=s;this.applyToolTip();},setLabelingStyle:function(s){if(e.isNull(s)){return;}this.labelStyle=s;
},getLabelingStyle:function(){return this.labelStyle;},isVisible:function(){return this.visible;},setVisible:function(t){if(e.isNull(t)){return;
}this.visible=t;if(this.displayed){var s=this.graphics;s.setVisible(this.shape,t);if(this.ghostShape){s.setVisible(this.ghostShape,t);
}if(this.labelShape){s.setVisible(this.labelShape,t);}}else{if(t){this.displayFeature(this.renderingStyle);
}}},bringForward:function(){if(this.parentLayer){this.parentLayer.bringFeatureForward(this);}},sendBackward:function(){if(this.parentLayer){this.parentLayer.sendFeatureBackward(this);
}},bringToTop:function(){if(this.parentLayer){this.parentLayer.bringFeatureToTop(this);}},sendToBottom:function(){if(this.parentLayer){this.parentLayer.sendFeatureToBottom(this);
}},displayFeature:function(L,C){var N=this.geo;var u=this.typeIs(N);if(this.editing&&u==="OrientedPoint"){return;
}if(!L||L.length===0){return;}var J=L[0];if(J&&!(J instanceof e.style.Style)&&J.dataSource&&J.name){var y=this;
var x=J.url;if(e.isNull(x)){if(this.parentLayer.type===e.layer.VectorLayer.TYPE_JDBC||this.parentLayer.type===e.layer.VectorLayer.TYPE_PREDEFINED){x=this.parentLayer.serverURL;
}else{x=this.parentLayer.parentMap.mapviewerURL;}}e.style.StyleStore.getServerSideStyle(J.dataSource,J.name,{url:x,callback:function(O){y.displayFeature([O],C);
}});return;}var K=this.graphics;var A=this.renderingStyle&&this.renderingStyle.cased?this.parentLayer.getLineGroup():this.group;
var D=this.screenTransformObj;if(e.isNull(K)||e.isNull(A)||e.isNull(N)||e.isNull(D)){return;}if(L.length>1){var v=K.createGroup();
A.appendChild(v);A=v;}var w=L.length;var t=[];for(var G=0;G<w;G++){var M=L[G];var B=M.styleType;if(M.showOnPoint){M.realWidth=null;
M.realHeight=null;t.push(M);continue;}if(u==="GeometryCollection"){var F=K.createGroup();A.appendChild(F);
for(var E=0,z=N.geometries.length;E<z;E++){var s=this.transformGeometry(N.geometries[E]);M.draw(this,this.parentLayer.parentMap.getMapContext(),{group:F,type:N.geometries[E].type,screenPoints:s});
}this.shape=F;}else{M.draw(this,this.parentLayer.parentMap.getMapContext(),{group:A,idx:C});}if((B=="AnimationColor"||B=="PulseAnimation")&&e.notNull(this.shape)){this.animations=[];
this.createAnimation(this.shape,M,u=="MultiLineString"||u=="LineString");}}if(t.length>0){var I=this.parentLayer.parentMap.getMapContext().getUniverse().getSRID();
if(e.isNull(this.labelBox)){this.createLabelBox();}this.getPointPosition(t,this.labelBox,A,I);}if(w>1){this.shape=A;
}this.displayed=true;this.applyToolTip();if(this.ghostGeom){this.drawGhostGeom(this.ghostGeom,L);this.drawGhostLabel(this.ghostGeom);
}if(this.shapeGroup&&!this.visible){for(G=1;G<this.shapeGroup.length;G++){this.graphics.setVisible(this.shapeGroup[G],false);
}}else{if(this.shape&&!this.visible){this.graphics.setVisible(this.shape,false);}}if(this.ghostShape&&!this.visible){this.graphics.setVisible(this.ghostShape,false);
}this.resumeMoveAnimation();if(e.notNull(this.parentLayer)&&this.parentLayer.useRTree){this.parentLayer.addToRtree(this);
this.parentLayer.updatedSearchWindow(this,u);}},getFeatureScreenPosition:function(){return this.featurePosition;
},transformGeometry:function(y){var B=this.parentLayer.parentMap.getMapContext().getTransform();var C=y.dim?y.dim:2;
var u=y.type,E=y.coordinates;var D,K,J,I,F,z,G,w,v,A;if(u==="Point"){D=B.toScreenPoint(E[0],E[1]);}else{if(u==="OrientedPoint"){D=B.toScreenPoint(E[0],E[1]);
K=E[C];J=E[C+1];I=-Math.atan2(J,K);D.angle=I;}else{if(u==="MultiPoint"||u==="OrientedMultiPoint"){D=[];
for(F=0,G=E.length;F<G;F++){A=B.toScreenPoint(E[F][0],E[F][1]);if(u==="OrientedMultiPoint"){K=E[F][C];
J=E[F][C+1];I=-Math.atan2(J,K);A.angle=I;}D.push(A);}}else{if(u==="LineString"){v=B.transformSegment(E,2,C);
if(v){D=[v];}else{D=null;}}else{if(u==="MultiLineString"){D=[];for(z=0,w=E.length;z<w;z++){v=B.transformSegment(E[z],2,C);
if(v){D.push([v]);}}}else{if(u=="Polygon"){D=[];for(F=0,G=E.length;F<G;F++){v=B.transformSegment(E[F],1,C);
if(v){D.push(v);}}}else{if(u==="MultiPolygon"){D=[];for(z=0,w=E.length;z<w;z++){var s=[];for(F=0,G=E[z].length;
F<G;F++){v=B.transformSegment(E[z][F],2,C);if(v){s.push(v);}}if(s.length>0){D.push(s);}}}else{if(u==="Rectangle"){A=B.toScreenPoint(E[0],E[3]);
var t=B.toScreenXLength(E[2]-E[0]);var x=B.toScreenYLength(E[3]-E[1]);D={x:A.x,y:A.y,width:t,height:x};
}}}}}}}}if(this.geo===y){this.screenPoints=D;}this.featurePosition=D;return D;},drawSinglePoint:function(u,x,s,w){var v={group:x,id:"pot"};
if(s.angle){v.angle=s.angle;}v.xOffset=w.xOffset;v.yOffset=w.yOffset;var t;if(w&&w.src){v.enableCache=true;
t=u.drawImageMarker({x:s.x,y:s.y},w,v);}else{if(w&&w.resolve){w.resolve(this);t=w.drawMarker(this.parentLayer.parentMap.getMapContext(),x,s,null);
}}return t;},drawRectangle:function(y,B,w,s,D){var E,C,t,v;if(!this.screenPoints||D){var A=w.coordinates;
var z=this.screenTransformObj.toScreenPoint(A[0],A[3]);E=z.x;C=z.y;t=this.screenTransformObj.toScreenXLength(A[2]-A[0]);
v=this.screenTransformObj.toScreenYLength(A[3]-A[1]);if(!D){this.screenPoints={x:E,y:C,width:t,height:v};
}}var x=y.drawRectangle({x:E,y:C,width:t,height:v},s,{group:B,id:"rec"});var I=(this.geo.getMBR().getMinX()+this.geo.getMBR().getMaxX())/2;
var F=(this.geo.getMBR().getMinY()+this.geo.getMBR().getMaxY())/2;var u=this.screenTransformObj.toScreenPoint(I,F);
if(this.parentLayer.leadLine){var G=y.drawPath([[E,C,u.x,u.y]],s,{group:B});this.line=G;this.line.feature=this;
}if(!D){this.shape=x;}return x;},remove:function(){var v=this.shape;if(!v){return;}this.graphics.remove(v);
this.shape=null;if(this.shapeGroup){var s=this.shapeGroup.length;for(var w=0;w<s;w++){if(this.shapeGroup[w]){this.graphics.remove(this.shapeGroup[w]);
}}}this.shapeGroup=null;if(this.shapeArray){var u=this.shapeArray.length;for(var t=0;t<u;t++){if(this.shapeArray[t]){this.shapeArray[t].feature=null;
this.graphics.remove(this.shapeArray[t]);}}this.shapeArray=null;}if(this.labelShapeArr){}},typeIs:function(s){var t=e.geometry;
if(s instanceof t.Circle){return"Circle";}if(s instanceof t.Rectangle){return"Rectangle";}return s.type;
},move:function(v,u,s){v=-v;var A,z,E,B,w;if(this.displayed){E=this.geo.type;var D=this;var C=function(y,I){if(I=="Point"||I=="OrientedPoint"||I=="Rectangle"){y.x+=v;
y.y-=u;}else{if(I=="MultiPoint"||I=="OrientedMultiPoint"){var x=y.length;for(A=0;A<x;A++){y[A].x+=v;y[A].y-=u;
}}else{e.util.GeomUtil.moveCoordinates(y,v,-u,null,null,D.parentLayer.parentMap.getMapContext());}}};
if(E=="GeometryCollection"){}else{C(this.screenPoints,E);}var G=v*s.resolution;var F=u*s.resolution*s.stretchRatio;
if(!(this.geo instanceof e.geometry.Geometry)){if(E!="GeometryCollection"){w=(E=="OrientedPoint"||E=="OrientedMultiPoint")?true:false;
e.util.GeomUtil.moveCoordinates(this.geo.coordinates,G,F,w,this.geo.dim,this.parentLayer.parentMap.getMapContext());
}else{var t=this.geo.geometries;B=t.length;for(z=0;z<B;z++){E=t[z].type;w=(E=="OrientedPoint"||E=="OrientedMultiPoint")?true:false;
e.util.GeomUtil.moveCoordinates(t[z].coordinates,G,F,w,t[z].dim,this.parentLayer.parentMap.getMapContext());
}}}else{this.geo.move(G,F,this.parentLayer.parentMap.getMapContext());}if(this.labelBox){this.labelBox=[this.labelBox[0]+G,this.labelBox[1]+F,this.labelBox[2]+G,this.labelBox[3]+F];
}return this.geo;}},addLabel:function(u){if(!this.displayed){return;}if(!this.parentLayer){return;}if(!this.label){if(!this.attributes){return;
}if(this.parentLayer.labelColumn){this.label=this.attributes[this.parentLayer.labelColumn.toUpperCase()];
}else{this.label=this.attributes._LABEL_;}}if(!this.label){return;}var s=this.getLabelingStyle();var v=this.geo.type;
if(e.notNull(s)){s.resolve(this);e.style.Style.calculateStyleSize(this.labelStyle,this.parentLayer.parentMap.getMapContext());
if(v=="Point"||v=="OrientedPoint"){this.addPointLabel(u);}else{if(v=="Polygon"||v=="MultiPolygon"){this.addPolygonLabel(u);
if(!this.labelShape){var t=this.parentLayer.createShadowGeometry(this);if(t){this.drawGhostGeom(t,[this.renderingStyle]);
this.drawGhostLabel(t);}}}else{if(v=="LineString"||v=="MultiLineString"){this.addLineLabel(u);}}}}else{e.util.Logger.warning(null,"Feature","No labeling style present for feature");
}},addPointLabel:function(s){var L=this.graphics;var F=L.getTextSize(this.label,this.labelStyle);F.w=parseInt(F.w)-2;
F.h=parseInt(F.h)-4;var C=this.screenPoints.x;var B=this.screenPoints.y;var D=this.markerSize?this.markerSize.w:this.renderingStyle.width;
var J=this.markerSize?this.markerSize.h:this.renderingStyle.height;if(e.isNull(D)&&!e.isNull(this.markerWidth)){D=this.markerWidth;
}if(e.isNull(J)&&!e.isNull(this.markerHeight)){J=this.markerHeight;}var M;var z;var G;if(this.geo.type==="OrientedPoint"){M=-Math.atan2(this.geo.getOrientationY(),this.geo.getOrientationX());
}var v={};var P=C-D/2-this.labelOffsetX;var Q=P-F.w;var O=B-F.h/2;var N=B+F.h/2;v.L=[Q,O,P,N];if(M){if(M<=0&&M>=-Math.PI/2){Q=C-(D/2+this.labelOffsetX+F.w)*Math.cos(-M);
O=B+(D/2+this.labelOffsetX)*Math.sin(-M);P=C-(D/2+this.labelOffsetX)*Math.cos(-M);N=B+(D/2+this.labelOffsetX+F.w)*Math.sin(-M);
v.L=[Q,O,P,N];z=Q;G=N;v.LL=[z,G];}if(M>=-Math.PI&&M<-Math.PI/2){Q=C+(D/2+this.labelOffsetX)*Math.cos(Math.PI+M);
O=B+(D/2+this.labelOffsetX)*Math.sin(Math.PI+M);P=C+(D/2+this.labelOffsetX+F.w)*Math.cos(Math.PI+M);N=B+(D/2+this.labelOffsetX+F.w)*Math.sin(Math.PI+M);
v.L=[Q,O,P,N];z=Q;G=O;v.LL=[z,G];}if(M<=Math.PI&&M>=Math.PI/2){Q=C+(D/2+this.labelOffsetX)*Math.cos(Math.PI-M);
O=B-(D/2+this.labelOffsetX+F.w)*Math.sin(Math.PI-M);P=C+(D/2+this.labelOffsetX+F.w)*Math.cos(Math.PI-M);
N=B-(D/2+this.labelOffsetX)*Math.sin(Math.PI-M);v.L=[Q,O,P,N];z=Q;G=N;v.LL=[z,G];}if(M<Math.PI/2&&M>0){Q=C-(D/2+this.labelOffsetX+F.w)*Math.cos(M);
O=B-(D/2+this.labelOffsetX+F.w)*Math.sin(M);P=C-(D/2+this.labelOffsetX)*Math.cos(M);N=B-(D/2+this.labelOffsetX)*Math.sin(M);
v.L=[Q,O,P,N];z=Q;G=O;v.LL=[z,G];}}Q=C+D/2+this.labelOffsetX;P=Q+F.w;v.R=[Q,O,P,N];if(M){if(M<=0&&M>=-Math.PI/2){Q=C+(D/2+this.labelOffsetX)*Math.cos(-M);
O=B-(D/2+this.labelOffsetX+F.w)*Math.sin(-M);P=C+(D/2+this.labelOffsetX+F.w)*Math.cos(-M);N=B-(D/2+this.labelOffsetX)*Math.sin(-M);
v.R=[Q,O,P,N];z=Q;G=N;v.RR=[z,G];}if(M>=-Math.PI&&M<-Math.PI/2){Q=C-(D/2+this.labelOffsetX+F.w)*Math.cos(M+Math.PI);
O=B-(D/2+this.labelOffsetX+F.w)*Math.sin(M+Math.PI);P=C-(D/2+this.labelOffsetX)*Math.cos(M+Math.PI);N=B-(D/2+this.labelOffsetX)*Math.sin(M+Math.PI);
v.R=[Q,O,P,N];z=Q;G=O;v.RR=[z,G];}if(M<=Math.PI&&M>=Math.PI/2){Q=C-(D/2+this.labelOffsetX+F.w)*Math.cos(Math.PI-M);
O=B+(D/2+this.labelOffsetX)*Math.sin(Math.PI-M);P=C-(D/2+this.labelOffsetX)*Math.cos(Math.PI-M);N=B+(D/2+this.labelOffsetX+F.w)*Math.sin(Math.PI-M);
v.R=[Q,O,P,N];z=Q;G=N;v.RR=[z,G];}if(M<Math.PI/2&&M>0){Q=C+(D/2+this.labelOffsetX)*Math.cos(M);O=B+(D/2+this.labelOffsetX)*Math.sin(M);
P=C+(D/2+this.labelOffsetX+F.w)*Math.cos(M);N=B+(D/2+this.labelOffsetX+F.w)*Math.sin(M);v.R=[Q,O,P,N];
z=Q;G=O;v.RR=[z,G];}}Q=C-F.w/2;P=Q+F.w;N=B-J/2-this.labelOffsetY;O=N-F.h;v.T=[Q,O,P,N];Q=C-F.w/2;P=Q+F.w;
O=B+J/2+this.labelOffsetY;N=O+F.h;v.B=[Q,O,P,N];var A=e.gv.labelDisplayOrder;var K=e.gv.orientedLabelDisplayOrder;
var t;if(M){for(var I=0;I<K.length;I++){t=v[K[I]];var u=v[K[I]+K[I]];if(this.addLabelNode(s,t,u[0],u[1],{angle:M,w:D,h:J})){return;
}}}else{for(var E=0;E<A.length;E++){t=v[A[E]];if(this.addLabelNode(s,t,t[0],t[3]-1)){return;}}}},createLabelBox:function(){var s=this.getGeometry().getMIR();
if(s){this.labelBox=[s.getMinX(),s.getMinY(),s.getMaxX(),s.getMaxY()];}},addPolygonLabel:function(s){if(!this.labelBox){this.createLabelBox();
}if(this.labelBox){var G=5;var L=this.graphics;var D=L.getTextSize(this.label,this.labelStyle);var E=this.label.indexOf("\n")>0?true:false;
D.w=parseInt(D.w)-2;D.h=parseInt(D.h)-4;var M=(this.labelBox[0]+this.labelBox[2])/2;var K=(this.labelBox[1]+this.labelBox[3])/2;
var F=this.screenTransformObj.toScreenPoint(M,K);var A=F.x;var z=F.y;var R=A-D.w/2;var P=A+D.w/2;var O=z-D.h/2;
var N=z+D.h/2;var v=this.screenTransformObj.toScreenPoint(this.labelBox[0],this.labelBox[1]);var t=this.screenTransformObj.toScreenPoint(this.labelBox[2],this.labelBox[3]);
var w=t.x-v.x,B=v.y-t.y;if(this.labelStyle.sticky){w=w*3;B=B*1.5;}var u;if(D.h>B){return;}else{if((D.w<=w&&D.h<=B)&&!E){u=[R-G,O-G,P+G,N+G];
this.addLabelNode(s,u,R,N-1);if(this.labelShape){this.labelShape.feature=this;}}}if(!this.labelShape){var S=this.label.split(" ");
var Q=0;for(var I=0,J=S.length;I<J;I++){D=this.graphics.getTextSize(S[I],this.labelStyle);if(D.w>Q){Q=D.w;
}}if(Q>w){if(this.labelStyle.sticky&&E){w=w*3;B=B*1.5;}else{return;}}var C=this.graphics.createTextBlock(this.label,this.labelStyle,A,z,w);
if(C.h>B){return;}u=[A-C.w/2-G,O-G,A+C.w/2+G,O+C.h+G];if(!s.conflicts(u)){s.insert(u);C.node.translate(0,(D.h-C.h)/2);
this.parentLayer.labelGroup.appendChild(C.node);this.labelShape=C.node;this.labelShape.feature=this;}}}},addLineLabel:function(s){var A,u,v,z;
if(!this.labelStyle||this.labelStyle.styleType!="Marker"){var B=this.graphics.getTextSize(this.label,this.labelStyle);
A=B.w/2;u=B.h/2-2;v=Math.max(A,u)*4;z=this.getLineTextPos(v,A,u,s);}else{A=this.labelStyle.width/2;u=this.labelStyle.height/2;
v=Math.max(A,u)*4;z=this.getLabelMarkerPos(v);for(var t=0,x=z?z.length>3?3:z.length:0;t<x;t++){var y=[z[t].x-A,z[t].y-u,z[t].x+A,z[t].y+u];
this.addMarkerLabelNode(s,y,z[t]);}}},addLabelNode:function(t,B,C,A,G){if(G&&G.angle){B=[B[0]+3,B[1]+3,B[2],B[3]];
}if(t.conflicts(B)){return false;}var v;var u;var E=this.label,F=0;if(G&&G.angle){u=new this.graphics.oui.geom.Matrix();
F=G.angle;if(G.angle>=-Math.PI&&G.angle<-Math.PI/2){F=G.angle+Math.PI;E=this.label.split(" ").reverse().join(" ");
}if(G.angle<Math.PI&&G.angle>=Math.PI/2){F=G.angle-Math.PI;E=this.label.split(" ").reverse().join(" ");
}u.rotate(F,C,A);}else{if(G&&G.transform){u=G.transform;}}if(E.indexOf("\n")>=0){var D=B[2]-B[0],z=B[3]-B[1];
C=C+D/2;A=A-z/2;var s=this.graphics.createTextBlock(this.label,this.labelStyle,C,A);v=s.node;}else{v=this.graphics.createTextNode(E,this.labelStyle,C,A);
}if(e.notNull(u)){v.applyStyle({transform:u});}t.insert(B);if(G&&G.group){G.group.appendChild(v);}else{this.parentLayer.labelGroup.appendChild(v);
this.labelShape=v;}return true;},addMarkerLabelNode:function(t,v,u){if(t.conflicts(v)){return false;}this.labelShape=this.graphics.createGroup();
this.parentLayer.labelGroup.appendChild(this.labelShape);this.labelShape.feature=this;this.labelShape.applyStyle({cursor:this.parentLayer.mouseCursor});
this.drawSinglePoint(this.graphics,this.labelShape,u,this.labelStyle);if(this.labelStyle.textStyle!==null){var s=this.graphics.getTextSize(this.label,{});
var w=this.graphics.createTextNode(this.label,this.labelStyle.textStyle,u.x-s.w/2,u.y+s.h/2-2);this.labelShape.appendChild(w);
t.insert(v);}return true;},getTip:function(){if(typeof this.id==="string"&&this.id.indexOf("_mul")===0){return null;
}var s=this.parentLayer;if(e.isNull(s)){return null;}if(s.showToolTip){if(s.toolTipCustomizer){var t=s.toolTipCustomizer(this);
if(typeof t==="string"){return t+"";}else{return t;}}else{if(this.label){return this.label+"";}else{if(s.labelColumn&&e.notNull(this.attributes)&&e.notNull(this.attributes[s.labelColumn.toUpperCase()])){return this.attributes[s.labelColumn.toUpperCase()]+"";
}else{if(this.attributes&&e.notNull(this.attributes._LABEL_)){return this.attributes._LABEL_+"";}else{return null;
}}}}}else{return null;}},applyToolTip:function(){if(!this.displayed){return;}var t;var u=this.getTip();
if(typeof u!=="string"){if(e.isNull(this.tooltipCache)||this.tooltipCache.toString()!=u.toString()){this.tooltipCache=u;
t=this.buildVaTooltip(u);this.tooltipNode=t;}else{t=this.tooltipNode;}}else{if(e.isNull(this.tooltipNode)||this.tooltipNode!=u){this.tooltipNode=u;
t=u;}else{t=this.tooltipNode;}}if(this.shapeGroup){for(var s=1;s<this.shapeGroup.length;s++){if(t&&(!this.renderingStyle||!this.renderingStyle.enableHighlight)){this.shapeGroup[s].applyStyle({tooltip:t});
}this.shapeGroup[s].feature=this;}}else{if(this.shape){if(t&&(!this.renderingStyle||!this.renderingStyle.enableHighlight)){this.shape.applyStyle({tooltip:t});
}this.shape.feature=this;}}},buildVaTooltip:function(y){var D=this.graphics;if(e.isNull(D)){D=this.parentLayer.parentMap.getMapContext().getGraphics();
}var v=D.createGroup({opacity:1,visibility:"visible"});var A;var w;var u;if(e.isNull(y)){return null;
}if(e.isNull(y.titlesArray)||e.isNull(y.headersArray)||e.isNull(y.contentsArray)){return null;}else{A=y.titlesArray;
w=y.headersArray;u=y.contentsArray;}if(!Array.isArray(A)){A=[];A.push(y.title);}if(!Array.isArray(w)){w=[];
w.push(y.title);}if(!Array.isArray(u)){u=[];u.push(y.title);}if(u.length!==w.length){return null;}var z=D.getInnerTooltipStyle();
var J=z.titleStyle;var x=z.headerStyle;var F=z.contentStyle;var C={hAlign:J.hAlign};var t={hAlign:x.hAlign};
var s={hAlign:F.hAlign};var K=D.oui.load({name:"mainVBox",type:"vbox",children:[{name:"titleBox",type:"hbox",layout:C},{name:"headerAndContentBox",type:"hbox",children:[{name:"headerBox",type:"vbox"},{name:"contentBox",type:"vbox"}]}]});
for(var G=0,E=A.length;G<E;G++){K.titleBox.load([{type:"text",textValue:A[G]+" ",fontWeight:J.fontWeight,fontFamily:J.fontFamily,fontStyle:J.fontStyle,fontSize:J.fontSize,fill:J.fill}]);
}for(var I=0,B=w.length;I<B;I++){K.headerAndContentBox.headerBox.load([{type:"text",textValue:w[I]+" ",fontWeight:x.fontWeight,fontFamily:x.fontFamily,fontStyle:x.fontStyle,fontSize:x.fontSize,fill:x.fill,layout:t}]);
K.headerAndContentBox.contentBox.load([{type:"text",textValue:u[I]+" ",fontWeight:F.fontWeight,fontFamily:F.fontFamily,fontStyle:F.fontStile,fontSize:F.fontSize,fill:F.fill,layout:s}]);
}v.appendChild(K);return v;},createAnimation:function(u,t,s){if(!u.hasChildNodes()){Array.prototype.push.apply(this.animations,t.createAnimation(u,this.graphics,s));
}else{var v=u.firstChild;while(v){this.createAnimation(v,t,s);v=v.nextSibling;}}},startAnimation:function(){if(this.animations){var s=this.animations.length;
for(var t=0;t<s;t++){this.animations[t].beginAt(0);}}},stopAnimation:function(){if(this.animations){var s=this.animations.length;
for(var t=0;t<s;t++){this.animations[t].endAt(0);}}},clearAnimation:function(){if(this.animations){var s=this.animations.length;
for(var t=0;t<s;t++){this.animations[t].unplug();this.animations[t].endAt(0);}}},animateToNewLocation:function(E,F){if(this.moveAnimation){this.stopMoveAnimation();
return;}this.originalGeo=this.geo;var D=E.coordinates;var A,y,w;if(E.type=="Point"||E.type=="OrientedPoint"){this.movePoints=[D[0],D[1]];
}else{if(E.type=="MultiPoint"||E.type=="OrientedMultiPoint"){A=D.length;y=[];for(w=0;w<A;w++){y=y.concat(D[w][0],D[w][1]);
}this.movePoints=y;}else{if(E.type=="LineString"||E.type=="MultiLineString"){A=D.length;y=[];for(w=0;
w<A;w++){y.push(D[w]);}this.movePoints=y;}}}var C=1;try{var t=this.parentLayer.parentMap;var u=t.getMapContext();
var z=u.getUniverse();var x=u.getZoomLevel();if(z&&z.zoomLevels){x=t.checkZoomLevel(x);var v=z.zoomLevels[x].resolution;
var s=z.zoomLevels[x].stretchRatio;C=Math.sqrt(Math.pow(v,2)+Math.pow(v*s,2))/2;}}catch(B){}this.movePoints=e.util.GeomUtil.simplifyCoordinates(this.movePoints,C);
if(this.movePoints&&this.movePoints.length>=2){this.moveTime=F&&e.notNull(F.time)?F.time:300;this.moveLoop=F&&F.loop;
this.moveBound=F&&F.bounce;this.moveOriented=this.geo.type==="OrientedPoint"?true:false;this.moveStep=F&&F.step?F.step:5;
this.animateToNewPoint(0);}},animateToNewPoint:function(U){var F={x:this.movePoints[U],y:this.movePoints[U+1]};
this.currentTarget=U;if(this.displayed&&this.shape){var S=this.screenPoints;var I=this.screenTransformObj.toScreenPoint(F.x,F.y);
var D=I.x-S.x;var C=I.y-S.y;if(Math.abs(D)<=this.moveStep&&Math.abs(C)<=this.moveStep){if(this.movePoints&&!this.reverse&&this.movePoints.length>=this.currentTarget+4){this.animateToNewPoint(this.currentTarget+2);
}else{if(this.movePoints&&this.reverse&&this.currentTarget>0){this.animateToNewPoint(this.currentTarget-2);
}else{var R;if(this.moveOriented){R=new e.geometry.Point(F.x,F.y,this.geo.srid,this.geo.coordinates[2],this.geo.coordinates[3]);
}else{R=new e.geometry.Point(F.x,F.y,this.geo.srid);}this.geo=R;this.finishAnimation();}}return;}var L;
if(this.moveOriented){var T=new e.geometry.Point(this.geo.getX(),this.geo.getY(),this.geo.srid,D,-C);
this.geo=T;var B=this.parentLayer;L=B.getFeatureStyles(this);if(e.notNull(this.animations)&&this.animations.length>0){this.screenPoints=null;
var O={};for(var J=0;J<this.animations.length;J++){var E=this.animations[J].getTargetNode();if(e.notNull(E)){O[E.parentNode._id]=E.parentNode._id;
}}var K=new this.graphics.oui.geom.Matrix();e.style.Style.calculateStyleSize(L,B.parentMap.getMapContext());
var v;for(var G=0;G<this.shape.childrenCount;G++){var Q=this.shape.getChildAt(G);if(e.isNull(O[Q._id])){v=Q;
break;}}var A=v.getLocalBounds();K.rotate(Math.atan2(C,D),A.x+L.realWidth/2,A.y+L.realHeight/2);v.setTransformMatrix(K);
this.displayed=true;}else{this.remove();this.screenPoints=null;L.draw(this,this.parentLayer.parentMap.getMapContext(),{group:this.group});
this.displayed=true;this.applyToolTip();}}L=this.shape._style;var N=S.x;if(L.width||L.x){N-=L.width/2+L.x;
}var M=S.y;if(L.height||L.y){M-=L.height/2+L.y;}var u=N+D;var t=M+C;this.moveAnimationDef={startX:N,startY:M,endX:u,endY:t,moveX:D,moveY:C};
var s=Math.sqrt(D*D+C*C)/10*this.moveTime/1000;var P;var y;P=this.shape.getTransformMatrix();y=P.clone();
if(this.moveOriented){this.moveAnimationDef.angleInRadius=Math.atan2(C,D);if(this.scaleX!=1&&this.scaleY!=1){var x=this.renderingStyle.realWidth/2;
var w=this.renderingStyle.realHeight/2;y.rotate(-this.moveAnimationDef.angleInRadius,x,w);y.translate(D/this.scaleX,C/this.scaleY);
y.rotate(this.moveAnimationDef.angleInRadius,x,w);}else{if(P.a===1&&P.b===0&&P.c===0&&P.d===1){y.translate(D,C);
}else{this.dis=Math.sqrt(D*D+C*C);y.translate(this.dis,0);}}}else{y.translate(D/this.scaleX,C/this.scaleY);
}this.moveAnimation=new this.graphics.oui.anim.AnimateStyle({targetNode:this.shape,dur:s,animValues:{transform:{beginValue:P,endValue:y,interpolator:function(ab,aa,V){var X=ab.tx;
var W=aa.tx;var Z=(W-X)*V+X;var ae=ab.ty;var ac=aa.ty;var Y=(ac-ae)*V+ae;var ad=ab.clone();ad.tx=Z;ad.ty=Y;
ad.b=aa.b;ad.c=aa.c;ad.a=aa.a;ad.b=aa.b;return ad;}}}});this.moveAnimation.beginAt(0);var z=this;this.moveAnimation.addEventListener(this.graphics.oui.SyncEvents.END,function(){if(e.isNull(z.moveAnimation)){return;
}var X=z.moveAnimationDef;var aa=0;var Y=0;var Z,aj;if(e.notNull(z.progress)){aa=parseInt(X.moveX*z.progress);
Y=parseInt(X.moveY*z.progress);if(aa===0&&Y===0){z.progress=null;return;}var ah=X.startX+aa;var af=X.startY+Y;
if(z.shape){if(z.moveOriented){var ag=new z.graphics.oui.geom.Matrix();ag.translate(ah,af);}else{}}if(z.parentLayer){var ab=z.parentLayer.parentMap.getMapContext();
var ad=ab.getUniverse();var ac=ad.getZoomLevels(0);var W=ac[ab.getZoomLevel()];var ae=z.getGeometry();
var V=ae.getX()+aa*W.resolution;var ai=ae.getY()-Y*W.resolution*W.stretchRatio;if(z.moveOriented){Z=z.moveAnimationDef.angleInRadius;
aj=z.getOrientation(Z);z.geo=new e.geometry.Point(V,ai,z.geo.srid,aj.x,aj.y);}else{z.geo=new e.geometry.Point(V,ai,z.geo.srid);
}z.screenPoints=z.screenTransformObj.toScreenPoint(z.geo.getX(),z.geo.getY());}z.progress=null;}else{if(z.screenTransformObj){z.screenPoints=z.screenTransformObj.toScreenPoint(F.x,F.y);
}if(z.moveOriented){Z=z.moveAnimationDef.angleInRadius;z.screenPoints.angle=Z;aj=z.getOrientation(Z);
z.geo=new e.geometry.Point(F.x,F.y,z.geo.srid,aj.x,aj.y);}else{z.geo=new e.geometry.Point(F.x,F.y,z.geo.srid);
}z.moveAnimation=null;if(z.movePoints&&!z.reverse&&z.movePoints.length>=z.currentTarget+4){z.animateToNewPoint(z.currentTarget+2);
}else{if(z.movePoints&&z.reverse&&z.currentTarget>0){z.animateToNewPoint(z.currentTarget-2);}else{z.finishAnimation();
}}}});}},finishAnimation:function(){if((this.moveLoop||this.moveBound)&&this.movePoints.length>=4){if(this.moveBound){this.reverse=!this.reverse;
if(this.reverse){this.animateToNewPoint(this.movePoints.length-2);}else{if(this.moveLoop){this.animateToNewPoint(2);
}else{this.movePoints=null;this.moveTime=null;this.currentTarget=null;}}}else{var t={x:this.movePoints[0],y:this.movePoints[1]};
var u=this.screenTransformObj.toScreenPoint(t.x,t.y);var s=u.x-this.screenPoints.x;var v=u.y-this.screenPoints.y;
if(this.screenPoints.angle){this.shape.rotate(-this.screenPoints.angle*180/Math.PI,12.5,5);}this.shape.translate(s/this.scaleX,v/this.scaleY);
this.screenPoints=u;this.screenPoints.angle=0;this.geo=new e.geometry.Point(this.movePoints[0],this.movePoints[1],this.geo.srid);
this.animateToNewPoint(2);}}else{this.movePoints=null;this.moveTime=null;this.currentTarget=null;}},pauseMoveAnimation:function(){if(this.displayed&&this.shape&&this.moveAnimation){var s=this.moveAnimation._progress();
var t=this.graphics.getLeftTop(this.shape);this.shape.stopPos=t;this.moveAnimation.endAt(0,false);this.progress=s;
}},resumeMoveAnimation:function(){if(this.movePoints&&e.notNull(this.currentTarget)){this.animateToNewPoint(this.currentTarget);
}},stopMoveAnimation:function(){this.pauseMoveAnimation();this.moveTime=null;this.currentTarget=null;
this.moveAnimation=null;if(e.notNull(this.originalGeo)){this.setGeometry(this.originalGeo);}this.originalGeo=null;
this.movePoints=null;this.progress=null;},getOrientation:function(t){var s=0;var v=0;var u=Math.PI/2;
if(t>-u&&t<u){s=1;v=s*Math.tan(t);}else{if(t>u||t<-u){s=1;v=s*Math.tan(t);}else{v=t==u?1:-1;}}return{x:s,y:v};
},getPointPosition:function(U,K,u,P){var t=this.geo.type;if(t==="LineString"||t==="MultiLineString"){return;
}var s,L,B,A,I;var O=U.length;var T=this.parentLayer.parentMap.getMapContext();if(t==="Point"||t==="MultiPoint"||t==="OrientedPoint"||t==="OrientedMultiPoint"){for(L=0;
L<O;L++){if(U[L].showOnPoint===1){s=this.transformGeometry(this.geo);if(t==="MultiPoint"||t==="OrientedMultiPoint"){s=s[0];
}U[L].draw(this,this.parentLayer.parentMap.getMapContext(),{group:u,sPoint:s});}else{U[L].draw(this,this.parentLayer.parentMap.getMapContext(),{group:u});
}}return;}if(e.isNull(K)){return;}if(O<2){B=(K[0]+K[2])/2;A=(K[1]+K[3])/2;I=new e.geometry.Point(B,A,P);
s=this.transformGeometry(I);U[0].draw(this,T,{group:u,sPoint:s});return;}var F=0;var J=0;var v=0;var G=0;
for(L=0;L<O;L++){e.style.Style.calculateStyleSize(U[L],this.parentLayer.parentMap.getMapContext());F+=U[L].realWidth;
J+=U[L].realHeight;var Q=U[L].realWidth*U[L].realHeight;if(Q>v){v=Q;G=L;}}var E=T.getUniverse();var N=E.getZoomLevels()[T.getZoomLevel()];
var D=(K[2]-K[0])/N.resolution;var z=(K[3]-K[1])/N.resolution/N.stretchRatio;var R=0;var S;if(F<=D){S="H";
R=(D-F)/(O+1);}else{if(J<=z){S="V";R=(z-J)/(O+1);}else{if(F-D>J-z){S="V";}else{S="H";}}}var V=[];e.$.extend(true,V,K);
if(S=="H"){var C=U[G].realWidth/2*N.resolution;if(D>U[G].realWidth){B=K[0]+C+R*N.resolution;}else{B=(K[0]+K[2])/2-C;
}A=(K[1]+K[3])/2;V[0]=B+C;}else{if(S=="V"){var M=U[G].realHeight/2*N.resolution*N.stretchRatio;if(z>U[G].realHeight){A=K[1]+M+R*N.resolution;
}else{A=(K[1]+K[3])/2-M;}B=(K[0]+K[2])/2;V[1]=A+M;}}I=new e.geometry.Point(B,A,P);s=this.transformGeometry(I);
U[G].draw(this,T,{group:u,sPoint:s});this.displayed=true;this.applyToolTip();U.splice(G,1);this.getPointPosition(U,V,u,P);
},enableFeatureEditing:function(v){if(this.editable==v){return;}if(this.geo instanceof e.geometry.Circle){return;
}if(this.geo.type==="Rectangle"){var x=this.geo.coordinates[0];var w=this.geo.coordinates[1];var u=this.geo.coordinates[2];
var t=this.geo.coordinates[3];var y=new e.geometry.Polygon([[x,w,u,w,u,t,x,t,x,w]]);this.geo=y;}this.editable=v;
if(this.editable){if(!this.startDrag){var s=new e.layer.EditableFeature();this.init=s.init;this.startDrag=s.startDrag;
this.featureDragging=s.featureDragging;this.endDrag=s.endDrag;this.addEditProperties=s.addEditProperties;
this.startEditing=s.startEditing;this.endEditing=s.endEditing;this.deleteEditingProperties=s.deleteEditingProperties;
this.shapePointMoved=s.shapePointMoved;this.possiblePointMoved=s.possiblePointMoved;this.deleteShapePoint=s.deleteShapePoint;
this.featurePointMoved=s.featurePointMoved;this.showContextMenu=s.showContextMenu;this.shapePointMoving=s.shapePointMoving;
this.possiblePointMoving=s.possiblePointMoving;this.featurePointMoving=s.featurePointMoving;this.calRelatedFeature=s.calRelatedFeature;
this.setParentThat=s.setParentThat;this.addResizeHandles=s.addResizeHandles;this.calDistance=s.calDistance;
this.isEditProperties=s.isEditProperties;this.focusProperties=s.focusProperties;this.registerUpdate=s.registerUpdate;
this.init();this.setParentThat(this);}this.startEditing();}else{this.setParentThat(this);this.endEditing();
this.edit=null;this.relatedFeature=null;this.parentLayer.parentMap.enableMapAction.drag=true;}},enableFeatureDragging:function(t){if(this.draggable===t){}if(this.draggable){var s=new e.layer.EditableFeature();
this.init=s.init;this.startDrag=s.startDrag;this.featureDragging=s.featureDragging;this.endDrag=s.endDrag;
this.addEditProperties=s.addEditProperties;this.startEditing=s.startEditing;this.endEditing=s.endEditing;
this.deleteEditingProperties=s.deleteEditingProperties;this.shapePointMoved=s.shapePointMoved;this.possiblePointMoved=s.possiblePointMoved;
this.deleteShapePoint=s.deleteShapePoint;this.featurePointMoved=s.featurePointMoved;this.showContextMenu=s.showContextMenu;
this.shapePointMoving=s.shapePointMoving;this.possiblePointMoving=s.possiblePointMoving;this.featurePointMoving=s.featurePointMoving;
this.calRelatedFeature=s.calRelatedFeature;this.setParentThat=s.setParentThat;this.addResizeHandles=s.addResizeHandles;
this.calDistance=s.calDistance;this.isEditProperties=s.isEditProperties;this.focusProperties=s.focusProperties;
this.registerUpdate=s.registerUpdate;this.init();this.setParentThat(this);}},isEditable:function(){return this.editable;
},clone:function(){var t={};e.$.extend(true,t,this.geo);var s={};e.$.extend(true,s,this.attributes);var u;
if(this.text){u=new e.TextFeature(this.id,t,this.text,this.renderingStyle);}else{u=new e.Feature(this.id,t,{attributes:s,renderingStyle:this.renderingStyle,label:this.label,labelStyle:this.labelStyle});
}if(this.columns){u.columns={};e.$.extend(true,u.columns,this.columns);}if(!this.renderingStyle&&this.styleName){u.styleName=this.styleName;
}if(this.mapping){u.mapping=true;}return u;},clearInfoWindow:function(){var s=this.parentLayer.parentMap;
if(s.infoLayer){s.infoLayer.deleteInfoWindows();}},getLabelMarkerPos:function(t){if(!this.parentLayer.mask){var u=this.parentLayer.parentMap.getMapContext();
var s=u.getCenterPoint();var x=u.getDeviceWindow();var w=this.screenTransformObj.toScreenPoint(s.getX(),s.getY());
this.parentLayer.mask={minX:w.x-x.w,minY:w.y-x.h,maxX:w.x+x.w,maxY:w.y+x.h};}var v;if(this.screenPoints){if(this.geo.type=="LineString"){v=e.util.GeomUtil.clipLine(this.parentLayer.mask,[this.screenPoints]);
}else{v=e.util.GeomUtil.clipLine(this.parentLayer.mask,this.screenPoints);}if(v.length>0){return e.util.GeomUtil.getPointByPercent(v,0.5,t);
}}},getLineTextPos:function(v,B,M,s){if(!this.parentLayer.mask){var t=this.parentLayer.parentMap.getMapContext();
var N=t.getCenterPoint();var x=t.getDeviceWindow();var E=this.screenTransformObj.toScreenPoint(N.getX(),N.getY());
this.parentLayer.mask={minX:E.x-x.w,minY:E.y-x.h,maxX:E.x+x.w,maxY:E.y+x.h};}if(this.screenPoints){var J;
if(this.geo.type=="LineString"){J=e.util.GeomUtil.clipLine(this.parentLayer.mask,[this.screenPoints]);
}else{J=e.util.GeomUtil.clipLine(this.parentLayer.mask,this.screenPoints);}this.labelShape=this.graphics.createGroup();
this.parentLayer.labelGroup.appendChild(this.labelShape);var y=[];var L=J.length;var G;for(var K=0;K<L;
K++){G=e.util.GeomUtil.getScreenLength(J[K]);var z=false;for(var I=0,D=y.length;I<D;I++){if(G>y[I].len){z=true;
y.splice(I,0,{idx:K,len:G});break;}}if(!z){y.push({idx:K,len:G});}}var C=0;for(var F=0,A=y.length;F<A;
F++){var u=J[y[F].idx];G=y[F].len;if(G<v/2){continue;}if(this.testLabelByPercent(u,G,0.5,B,M,s)){C++;
}else{if(this.testLabelByPercent(u,G,0.4,B,M,s)){C++;}else{if(this.testLabelByPercent(u,G,0.6,B,M,s)){C++;
}}}if(C>3){break;}}return !!C;}return false;},testLabelByPercent:function(B,K,v,G,L,s){var J=e.util.GeomUtil.getPointByLength(K*v,B);
var D=J.pos;var R,O,P,N,A;if(J.len>G*2){var F=(B[D]+B[D+2])/2,E=(B[D+1]+B[D+3])/2;var M=-Math.atan2(B[D+1]-B[D+3],B[D+2]-B[D]);
if(M<-Math.PI/2||M>=Math.PI/2){M+=Math.PI;}var I=new this.graphics.oui.geom.Matrix();I.rotate(M,F,E);
A=[F-G,E-L,F+G,E+L];A=I.transformAll([A[0],A[1],A[0],A[3],A[2],A[3],A[2],A[1]]);R=Math.ceil(Math.min(A[0],A[2],A[4],A[6]));
P=Math.floor(Math.max(A[0],A[2],A[4],A[6]));O=Math.ceil(Math.min(A[1],A[3],A[5],A[7]));N=Math.floor(Math.max(A[1],A[3],A[5],A[7]));
A=[R,O,P,N];return this.addLabelNode(s,A,F-G,E+L,{transform:I,group:this.labelShape});}else{var t=e.util.GeomUtil;
var z=t.getPoinsByLength(B,D,J.x,J.y,G*4,-2);var u=t.getPoinsByLength(B,D,J.x,J.y,G*4,2);var Q;if(z.x>u.x){Q=z;
z=u;u=Q;}if(J.x<z.x||J.x>u.x||z.y>u.y&&(J.y>z.y||J.y<u.y)||z.y<u.y&&(J.y<z.y||J.y>u.y)){return false;
}R=Math.min(z.x,u.x,J.x);P=Math.max(z.x,u.x,J.x);O=Math.min(z.y,u.y,J.y);N=Math.max(z.y,u.y,J.y);var S=Math.max(G/4,L);
A=[R-S,O-S,P+S,N+S];if(!s.conflicts(A)){s.insert(A);var C=t.getCircle(z.x,z.y,J.x,J.y,u.x,u.y);this.addLabelAlongCurve(C,G,L,-Math.atan2((z.y-u.y)/(u.x-z.x)));
return true;}}return false;},addLabelAlongCurve:function(s,F,A,D){var B=this.label.length;if(B<2){return;
}if(!s.eAngle||!s.sAngle){return;}D=(s.eAngle-s.sAngle)/(B-1);F=F/B;for(var z=0;z<B;z++){var u=s.sAngle+D*z;
var E=Math.cos(u)*s.r+s.x-F;var C=Math.sin(u)*s.r+s.y+A-1;var v=this.graphics.createTextNode(this.label[z],this.labelStyle,E,C);
var t=new this.graphics.oui.geom.Matrix();v.applyStyle({transform:t});this.labelShape.appendChild(v);
}},getLabelPosBySlope:function(G){var B=[];for(var A=0,C=G.length;A<C;A++){var t=G[A];var z=t.length;
var I=(t[z-2]-t[0])/(t[z-1]-t[1]);var w=Number.POSITIVE_INFINITY;var E=0;for(var v=0;v<z-1;v+=2){var J=(t[v+2]-t[v])/(t[v+3]-t[v+1]);
if(Math.abs(I-J)<w){w=Math.abs(I-J);E=v;}}var F=(t[E]+t[E+2])/2,D=(t[E+1]+t[E+3])/2;var u=-Math.atan2(t[E+1]-t[E+3],t[E+2]-t[E]);
if(u<=-Math.PI/2||u>Math.PI/2){u+=Math.PI;}B.push({x:F,y:D,angle:u});}return B;},isCluster:function(){if(this.id&&this.id.indexOf("-CL")===0&&this.cluster){return true;
}else{return false;}},getFeaturesInCluster:function(){if(this.isCluster()){return this.cluster.featureArray;
}else{return null;}},drawGhostGeom:function(v,t){if(!v||!t||t.length===0){return;}this.removeGhostShape();
var s={};this.ghostGeom=v;e.$.extend(true,s,t[0]);this.ghostShape=this.drawRectangle(this.graphics,this.group,v,s,true);
this.ghostShape.feature=this;var u=this.getTip();this.ghostShape.applyStyle({tooltip:u});},drawGhostLabel:function(u){if(!u||!this.label){return;
}var w=(u.getMinX()+u.getMaxX())/2;var v=(u.getMinY()+u.getMaxY())/2;var s=this.screenTransformObj.toScreenPoint(w,v);
this.labelShape=this.graphics.createTextNode(this.label,this.labelStyle,s.x,s.y);var t=this.graphics.getWidthHeight(this.labelShape);
this.labelShape.translate(-t.w/2,t.h/2-2);this.parentLayer.labelGroup.appendChild(this.labelShape);this.labelShape.feature=this;
},removeGhostShape:function(){if(this.ghostShape){this.ghostShape.feature=null;this.graphics.remove(this.ghostShape);
this.graphics.remove(this.line);if(this.parentLayer.leadLine){this.line.feature=null;this.line=null;}this.ghostShape.feature=null;
this.ghostShape=null;if(this.labelShape){this.graphics.remove(this.labelShape);this.labelShape.feature=null;
this.labelShape=null;}}},enableMarkerDraggable:function(s){this.draggable=s;},setMarkerText:function(s){this.markerText=s;
},getMarkerText:function(){return this.markerText;},setInfoWindowContent:function(s){this.InfoHtml=s;
},getShapeIndex:function(){if(this.shape&&this.shape.parentNode){this.idx=this.shape.parentNode.getChildIndex(this.shape);
}else{this.idx=-1;}},setShapeIndex:function(){if(this.shape&&this.shape.parentNode&&this.idx>=0){var s=this.shape.parentNode.getChildIndex(this.shape);
if(s!=this.idx){if(this.shapeGroup&&this.shapeGroup.length>1){for(var t=this.shapeGroup.length-1;t>-1;
t--){this.shapeGroup[t].parentNode.setChildIndex(this.shapeGroup[t],this.idx);}}else{this.shape.parentNode.setChildIndex(this.shape,this.idx);
}}}}});e.MapMarker=e.Feature.extend({initialize:function b(u){var t,v;if(e.notNull(u)){t=e.isNull(u.label)?"x":u.label;
if(u.position){var s=e.isNull(u.position.srid)?8307:u.position.srid;v=new e.geometry.Point(u.position.x,u.position.y,s);
}b.base.call(this,u.id,v,{renderingStyle:u.renderingStyle,label:t,draggable:u.draggable});if(u.dragStart){this.dragStartListener=u.dragStart;
}if(u.dragEnd){this.dragEndListener=u.dragEnd;}if(u.dragging){this.draggingListener=u.dragging;}}else{b.base.call(this);
}},getLabel:function(){return this.label;},setLabel:function(s){this.label=s;this.setMarkerText(s);},setID:function(s){if(e.notNull(s)&&s!==""){this.id=s;
}},getID:function(){return this.id;},isDraggable:function(){return(this.draggable===true);},setDraggable:function(s){this.draggable=(s===true);
},setStyle:function(s){if(e.notNull(s)&&s!==""){this.renderingStyle=s;}},getStyle:function(){return this.renderingStyle;
},setPosition:function(v,u,A){var s,z;if(v&&u){s=v;z=u;var t;if(e.isNull(A)){t=8307;}else{t=A;}var w=new e.geometry.Point(s,z,t);
this.setGeometry(w);}else{e.util.Logger.warning("MAPVIEWER_9073","OM.MapMarker.setPosition","The ["+s+","+z+"],values are not properly specified.");
}},getPosition:function(){return{x:this.getGeometry().getX(),y:this.getGeometry().getY(),srid:this.getGeometry().getSRID()};
},getMarkerX:function(){return this.getGeometry().getX();},getMarkerY:function(){return this.getGeometry().getY();
},getMarkerSRID:function(){return this.getGeometry().getSRID();},setDragStartListener:function(s){this.dragStartListener=s;
},setDraggingListener:function(s){this.draggingListener=s;},setDragEndListener:function(s){this.dragEndListener=s;
},toJSON:function(){var s={position:{x:this.getGeometry().getX(),y:this.getGeometry().getY(),srid:this.getGeometry().getSRID()},renderingStyle:e.isNull(this.renderingStyle)?"undefined":this.renderingStyle,draggable:e.isNull(this.draggable)?"undefined":this.draggable,label:this.label};
return s;}});e.TextFeature=e.Feature.extend({initialize:function(v,s,u,t){this.id=v;this.geo=s;this.text=u;
this.renderingStyle=t?t:new e.style.Text(e.gv.defaultTextStyleConfig);this.editRenderingStyle=e.layer.EditableFeature.textStyle;
if(!(t instanceof e.style.Style)){this.attributes=t&&e.notNull(t.attributes)?t.attributes:null;this.renderingStyle=t.style?t.style:new e.style.Text(e.gv.defaultTextStyleConfig);
this.editRenderingStyle=t.editStyle?t.editStyle:e.layer.EditableFeature.textStyle;}this.displayed=false;
this.visible=true;this.editable=false;},setText:function(s){if(e.notNull(s)&&s!==""){this.text=s;if(this.displayed){this.remove();
this.displayFeature();}}},getText:function(){return this.text;},setGeometry:function(s){if(s&&(s.type==="Point"||s.type==="OrientedPoint")){this.geo=s;
if(this.displayed){this.remove();this.screenPoints=null;this.displayFeature();}}},setRenderingStyle:function(v){if(e.isNull(v)&&(e.isNull(this.parentLayer)||e.isNull(this.parentLayer.otherStyles)||this.parentLayer.otherStyles.length===0)){return;
}if(this.renderingStyle===v){return;}this.renderingStyle=v;if(!this.displayed){return;}var s=-1;this.getShapeIndex();
var t=this;if(e.notNull(this.shape)){this.shape.addEventListener(e.event.MouseEvent.MOUSE_OUT,function(x){try{x.target=t.shape;
t.shape.dispatchEvent(x);}catch(w){}});}this.remove();v=[v];if(this.parentLayer.otherStyles){v=v.concat(this.parentLayer.otherStyles);
}v=this.getAllStyles(v);if(this.parentLayer.featureGroupArr&&this.parentLayer.featureGroupArr.length>0){this.shapeArray=[];
for(var u=0;u<this.parentLayer.featureGroupArr.length;u++){if(e.isNull(this.activeIdx)||this.activeIdx===u){this.group=this.parentLayer.featureGroupArr[u];
this.displayFeature(v,s);this.shapeArray[u]=this.shape;}}}else{this.displayFeature(v,s);}this.setShapeIndex();
},setEditRenderingStyle:function(s){if(e.notNull(s)&&s instanceof e.style.Text){this.editRenderingStyle=s;
}},displayFeature:function(B,E){var z=this.geo;var C=this.typeIs(z);if(this.editing&&C==="OrientedPoint"){return;
}if(!B||B.length===0){return;}var A=B[0];if(A&&!(A instanceof e.style.Style)&&A.dataSource&&A.name){var J=this;
var s=A.url;if(e.isNull(s)){if(this.parentLayer.type===e.layer.VectorLayer.TYPE_JDBC||this.parentLayer.type===e.layer.VectorLayer.TYPE_PREDEFINED){s=this.parentLayer.serverURL;
}else{s=this.parentLayer.parentMap.mapviewerURL;}}e.style.StyleStore.getServerSideStyle(A.dataSource,A.name,{url:s,callback:function(K){J.displayFeature([K],E);
}});return;}var D=this.graphics;var G=this.renderingStyle&&this.renderingStyle.cased?this.parentLayer.getLineGroup():this.group;
var x=this.screenTransformObj;if(e.isNull(D)||e.isNull(G)||e.isNull(z)||e.isNull(x)){return;}if(B.length>1){var v=D.createGroup();
G.appendChild(v);G=v;}var u=B.length;var w=[];for(var y=0;y<u;y++){var t=B[y];var F=t.styleType;if(t.showOnPoint){t.realWidth=null;
t.realHeight=null;w.push(t);continue;}t.draw(this,this.parentLayer.parentMap.getMapContext(),{group:G,idx:E});
if((F==="AnimationColor"||F==="PulseAnimation")&&e.notNull(this.shape)){this.animations=[];this.createAnimation(this.shape,t,C=="MultiLineString"||C=="LineString");
}}if(w.length>0){var I=this.parentLayer.parentMap.getMapContext().getUniverse().getSRID();if(e.isNull(this.labelBox)){this.createLabelBox();
}this.getPointPosition(w,this.labelBox,G,I);}if(u>1){this.shape=G;}this.displayed=true;this.applyToolTip();
if(this.ghostGeom){this.drawGhostGeom(this.ghostGeom,B);this.drawGhostLabel(this.ghostGeom);}if(this.shapeGroup&&!this.visible){for(y=1;
y<this.shapeGroup.length;y++){this.graphics.setVisible(this.shapeGroup[y],false);}}else{if(this.shape&&!this.visible){this.graphics.setVisible(this.shape,false);
}}if(this.ghostShape&&!this.visible){this.graphics.setVisible(this.ghostShape,false);}this.resumeMoveAnimation();
if(e.notNull(this.parentLayer)&&this.parentLayer.useRTree){this.parentLayer.addToRtree(this);this.parentLayer.updatedSearchWindow(this,C);
}},remove:function(){var v=this.shape;if(!v){return;}this.graphics.remove(v);this.shape=null;if(this.shapeGroup){var s=this.shapeGroup.length;
for(var w=0;w<s;w++){if(this.shapeGroup[w]){this.graphics.remove(this.shapeGroup[w]);}}}this.shapeGroup=null;
if(this.shapeArray){var u=this.shapeArray.length;for(var t=0;t<u;t++){if(this.shapeArray[t]){this.shapeArray[t].feature=null;
this.graphics.remove(this.shapeArray[t]);}}this.shapeArray=null;}if(this.labelShapeArr){}},toJSON:function(){var s={id:this.id,styleConfig:this.getRenderingStyle().getConfig(),text:this.getText()};
if(!(this.geo instanceof e.geometry.Geometry)){s.geometry=this.geo;}else{s.geometry=this.geo.toJSON();
}return s;}});e.Map=e.Class.extend({mixin:e.event.EventSource,initialize:function(J,x){e.util.LoadFileUtil.LoadCss(e.gv.cssResourcePath()+"decoration.css");
e.util.LoadFileUtil.LoadCss(e.gv.cssResourcePath()+"info.css");e.util.LoadFileUtil.LoadCss(e.gv.cssResourcePath()+"progressbar.css");
e.util.LoadFileUtil.LoadCss(e.gv.cssResourcePath()+"fonticon.css");if(!e.gv.msgLoaded){e.gv.loadMessage();
}var N=this;this._decoration={};this.wraparound=false;if(x&&x.wraparound===true){this.wraparound=x.wraparound;
}this.mapBBox=[];e.gv.addMapInstance(this,J);this.$containerDiv=e.$(J);this.$containerDiv.empty();this.progressBarComplete=false;
this.enableProgressBar=true;this.globalMinProgress=0;this.zoomComplete=true;this.utfgridHTMLArray=[];
if(document.compatMode=="CSS1Compat"){if(this.$containerDiv.width()===0){if(e.isNull(e.util.DomUtil.css(e.$("html")).width)){e.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set html width to 100%");
e.$("html").css("width","100%");}if(e.isNull(e.util.DomUtil.css(e.$("body")).width)){e.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set body width to 100%");
e.$("body").css("width","100%");}}if(this.$containerDiv.height()===0){if(e.isNull(e.util.DomUtil.css(e.$("html")).height)){e.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set html height to 100%");
e.$("html").css("height","100%");}if(e.isNull(e.util.DomUtil.css(e.$("body")).height)){e.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set body height to 100%");
e.$("body").css("height","100%");}}}if(this.$containerDiv.width()===0||this.$containerDiv.height()===0){e.util.Logger.warning("MAPVIEWER_9050","OM.Map.initialize","Size is "+this.$containerDiv.width()+"*"+this.$containerDiv.height());
}this.$containerDiv.css("-webkit-user-select","none");this.$containerDiv.css({"-moz-user-select":"none"});
this.$containerDiv.css({"-ms-touch-action":"none"});if(e.browser.touchSupported){this.$containerDiv.css({"-webkit-tap-highlight-color":"rgba(0, 0, 0, 0)"});
}if(this.$containerDiv.css("position")!=="absolute"){this.$containerDiv.css("position","relative");}this.mapInstanceId=this.generateMapInstanceId();
var L="<div id='oracleMapDiv"+this.mapInstanceId+"' ";if(e.gv.tabIndexEnabled){L+=" tabindex='1' ";}this._rootDivPos={normal:"position:absolute; width:100%; height:100%;",va:"width:100%; height:100%;"};
L+="style='"+this._rootDivPos.normal+"left:0px; top:0px; -moz-user-select: none;-webkit-user-select:none; overflow: hidden;z-index:0'></div>";
this.$oracleMapDiv=e.$(L);this.$oracleMapDiv.addClass("omapsv2-root");this.$containerDiv.append(this.$oracleMapDiv);
this.$topLayerDIV=e.$("<div id ='topLayerDIV"+this.mapInstanceId+"'></div>");this.$fixedLayerDIV=e.$("<div id ='fixedLayerDIV"+this.mapInstanceId+"'></div>");
this.$infoWinLayerDIV=e.$("<div id ='infoWinLayerDIV"+this.mapInstanceId+"'></div>");this.$customLayersDiv=e.$("<div id ='customLayersDiv"+this.mapInstanceId+"'></div>");
this.$fkGraphicLayersDiv=e.$("<div id ='fkGraphicLayersDiv"+this.mapInstanceId+"'></div>");this.$tileLayersDiv=e.$("<div id ='tileLayersDiv"+this.mapInstanceId+"'></div>");
this.$progressBarDiv=e.$("<div class='omv2_progDiv' id ='progressBarDiv"+this.mapInstanceId+"'></div>");
this.$progressBarSpan=e.$("<span class='omv2_progSpan' style='width:0%'></span>");this.$oracleMapDiv.append(this.$topLayerDIV);
this.$oracleMapDiv.append(this.$fixedLayerDIV);this.$oracleMapDiv.append(this.$infoWinLayerDIV);this.$oracleMapDiv.append(this.$customLayersDiv);
this.$oracleMapDiv.append(this.$fkGraphicLayersDiv);this.$oracleMapDiv.append(this.$tileLayersDiv);this.$oracleMapDiv.append(this.$progressBarDiv);
this.$topLayerDIV.css({"z-index":"300",position:"absolute",left:"0px",top:"0px"});this.$fixedLayerDIV.css({"z-index":"200",position:"absolute",left:"0px",top:"0px"});
this.$infoWinLayerDIV.css({"z-index":"110",position:"absolute",left:"0px",top:"0px"});this.$customLayersDiv.css({"z-index":"100",position:"absolute",left:"0px",top:"0px"});
this.$fkGraphicLayersDiv.css({"z-index":"99",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});
this.$tileLayersDiv.css({"z-index":"0",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});
this.$progressBarDiv.append(this.$progressBarSpan);this.$heatMapDiv=e.$("<div id ='heatMapDiv"+this.mapInstanceId+"'></div>");
this.$oracleMapDiv.append(this.$heatMapDiv);this.$heatMapDiv.css({"z-index":"90",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});
this.graphics=new e.Graphics(this.$fkGraphicLayersDiv[0]);this.$fkGraphicLayersDiv.find("svg,canvas").attr("unselectable","on");
this.draggableGroup=this.graphics.createGroup();this.fixedGroup=this.graphics.createGroup();this.blockerGroup=this.graphics.createGroup();
this.graphics.addGroup(this.draggableGroup);this.graphics.addGroup(this.blockerGroup);this.graphics.addGroup(this.fixedGroup);
this.useRTree=(e.notNull(x&&x.useRTree))?x.useRTree:e.gv.useRTree;(this.updateBlocker=function(){if(!N.useRTree||e.isNull(N.blockerGroup)){return;
}if(N.blockerGroup.childrenCount===0){N.graphics.drawRectangle({x:0,y:0,width:N.$containerDiv.width(),height:N.$containerDiv.height()},{fill:"orange",fillOpacity:0},{group:N.blockerGroup});
}var P=N.blockerGroup.firstChild;if(e.notNull(P)){P.applyStyle({x:0,y:0,width:N.$containerDiv.width(),height:N.$containerDiv.height()});
}}).call();N.iterateVectorLayers=function(U){var T=N.svgLayers;var P=T.length-1;for(var S=P;S>=0;S--){var R=T[S];
var Q=U(R);if(Q===true){return;}}};N.search=function(P){var Q=null;N.iterateVectorLayers(function(R){Q=R.findFeature(P,false);
if(e.notNull(Q)){return true;}});if(e.isNull(Q)){N.iterateVectorLayers(function(R){Q=R.findFeature(P,true);
if(e.notNull(Q)){return true;}});}return Q;};var C=function(S,R){if(e.notNull(S)){var P=S;var Q=P.feature;
while(e.isNull(Q)&&P.parentNode){P=P.parentNode;Q=P.feature;}if(e.isNull(Q)){return;}if(Q.shape===S){Q.shape.dispatchEvent(R);
}else{if(e.notNull(Q.shape)){Q.shape.dispatchEvent(R);}S.dispatchEvent(R);}}};var w=function(P){var Q=N.search(P);
var R=Q?Q.fkNode:null;if(e.notNull(Q)){if(e.notNull(Q.parentLayer)){N.graphics.setCursor(N.blockerGroup,Q.parentLayer.mouseCursor);
}}else{N.graphics.setCursor(N.blockerGroup,N.cursorStyleDefault);}if(e.notNull(Q)){P.target=R;C(R,P);
}if(P.type===e.event.MouseEvent.MOUSE_MOVE){E(R,P);}else{if(P.type===e.event.MouseEvent.MOUSE_LEAVE){N.lastMoveTarget=null;
}}};N.lastMoveTarget=null;var E=function(Q,P){if(Q!==N.lastMoveTarget){if(e.notNull(N.lastMoveTarget)){P.target=N.lastMoveTarget;
P.relatedTarget=Q;C(N.lastMoveTarget,e.$.extend({},P,{type:e.event.MouseEvent.MOUSE_OUT}));C(N.lastMoveTarget,e.$.extend({},P,{type:e.event.MouseEvent.MOUSE_LEAVE}));
}if(e.notNull(Q)){P.target=Q;P.relatedTarget=N.lastMoveTarget;C(Q,e.$.extend({},P,{type:e.event.MouseEvent.MOUSE_ENTER}));
C(Q,e.$.extend({},P,{type:e.event.MouseEvent.MOUSE_OVER}));}}N.lastMoveTarget=Q;};if(N.useRTree===true){if(e.browser.touchSupported){this.graphics.attachEventListener(e.event.MouseEvent.TOUCH_TAP,w,this.blockerGroup);
this.graphics.attachEventListener(e.event.MouseEvent.TOUCH_LONG_PRESS,w,this.blockerGroup);this.graphics.attachEventListener(e.event.MouseEvent.TOUCH_END,w,this.blockerGroup);
this.graphics.attachEventListener(e.event.MouseEvent.TOUCH_START,w,this.blockerGroup);}else{this.graphics.attachEventListener(e.event.MouseEvent.MOUSE_MOVE,w,this.blockerGroup);
this.graphics.attachEventListener(e.event.MouseEvent.MOUSE_CLICK,w,this.blockerGroup);this.graphics.attachEventListener(e.event.MouseEvent.MOUSE_RIGHT_CLICK,w,this.blockerGroup);
this.graphics.attachEventListener(e.event.MouseEvent.MOUSE_UP,w,this.blockerGroup);this.graphics.attachEventListener(e.event.MouseEvent.MOUSE_DOWN,w,this.blockerGroup);
this.graphics.attachEventListener(e.event.MouseEvent.MOUSE_LEAVE,w,this.blockerGroup);}}this.divLeft=0;
this.divTop=0;this.undoManager=new e.UndoManager();this.mouseWheelZoomBehavior=e.Map.ZOOM_CENTER_ON_MOUSE;
if(x&&x.mapviewerURL){this.mapviewerURL=x.mapviewerURL;}var D=function(P){if(P){e.util.Logger.warning(0,"OM.Map.initialize",P.responseText);
}else{e.util.Logger.warning(0,"OM.Map.initialize","");}return;};try{if(e.notNull(this.mapviewerURL)&&e.isNull(e.gv.defaultDataSource)){var z=this.mapviewerURL+"/omserver";
var M={xml_request:'<?xml version="1.0" standalone="yes"?><non_map_request><list_data_sources/></non_map_request>'};
e.util.HttpRequest.send(z,M,function(Q){var P=e.$(Q).find("map_data_source");if(e.notNull(P)){e.gv.defaultDataSource=P.attr("name");
}},"xml",D);}}catch(A){var B=(A.stack)?A.message+"\nStack: "+A.stack:A.message;e.util.Logger.warning(0,"OM.Map.initialize",B);
}if(e.isNull(this.mapviewerURL)){this.mapviewerURL=e.gv.localbaseURL();}else{if(this.mapviewerURL.indexOf("http")===0){e.gv.setBaseMapViewerURL(this.mapviewerURL);
}}this.disableOverviewMap=true;if(x&&x.disableOverviewMap===false){this.disableOverviewMap=x.disableOverviewMap;
}this.getMapContextToken=(function(){var P={};return function(){return P;};}());var K=this.getMapContextToken();
K.universe={};K.graphics=this.graphics;K.xRatio=2;if(x&&x.universe){K.universe=x.universe;}K.deviceWindow={x:0,y:0,w:this.$containerDiv.width(),h:this.$containerDiv.height()};
this.typeArray=[];this.nameArray=[];this.divLayers=[];this.svgLayers=[];this.layerQueue=[];this.touchStartLocs=[];
this.mLocX=null;this.mLocY=null;this.decorationArray=[];this.defaultFeatureLayer=null;this.toolFeatureLayer=null;
this.enableMapAction={mouse:true,click:true,drag:true,dbclick:true,mousewheel:true};this.zoomEnabled=true;
this._zoomLevel=null;this._mapCenter=null;this.universeLayerIndex=-1;this.boundingLayerName=null;this.inited=false;
this.displayed=false;this.initialized=false;this.boundingThemeLoading=false;this.boundingThemeLoaded=false;
this.moveflag=false;this.resetTag=false;this.hasExternal=false;this.tileLayerZoomAnimation=true;this.infoWindowEventPropogation=false;
this.over=x&&x.over?true:false;this.template=null;this.cursorStyleDragging=e.CursorTypes.MOVE;this.cursorStyleDefault=e.CursorTypes.DEFAULT;
this.resizeFun=function G(){if(!N.over&&N.$containerDiv){if(K.deviceWindow.w!=N.$containerDiv.width()||K.deviceWindow.h!=N.$containerDiv.height()){K.deviceWindow.w=N.$containerDiv.width();
K.deviceWindow.h=N.$containerDiv.height();N.updateBlocker();N.redrawMap();var P=new e.event.MapEvent(e.event.MapEvent.MAP_RESIZED,N);
N.fire(P.type,P);}}};this.resizeTimer=setInterval(this.resizeFun,300);this.$oracleMapDiv[0].addEventListener("mouseover",function(P){var R=e.event;
var Q=new R.MapEvent(R.MouseEvent.MOUSE_OVER,N);Q.evt=P;N.fire(Q.type,Q);},true);this.$oracleMapDiv[0].addEventListener("mouseout",function(P){var R=e.event;
var Q=new R.MapEvent(R.MouseEvent.MOUSE_OUT,N);Q.evt=P;N.fire(Q.type,Q);},true);if(!x||!x.magnifier){this.$oracleMapDiv.dblclick(function(P){if(N.isStoppedEvent(P)){return;
}if(N.displayed&&N.enableMapAction.dbclick){N.setMapCenterAndZoomLevel(N.getCursorLocation(),K.zoomLevel+1,true);
}var Q=new e.event.MapEvent(e.event.MouseEvent.MOUSE_DOUBLE_CLICK,N);N.fire(Q.type,Q);return;});this.$oracleMapDiv[0].oncontextmenu=function(P){P.preventDefault();
};var u=false;this.$oracleMapDiv.on("mousewheel DOMMouseScroll",function(P){if(N.isStoppedEvent(P)){return;
}if(!N.enableMapAction.mousewheel){return;}if(u){return;}y(P,P.deltaY);});var y=function(P,Q){u=true;
setTimeout(function(){u=false;var X=N.getMapContext();var Z=X.getUniverse();var Y=Z.getZoomLevels();var ac=X.getZoomLevel();
var ae=ac;if(Q>0){ac++;}else{ac--;}if(ac<0||ac>=Y.length){return;}P.preventDefault();var S=N.getCursorLocation();
if(!N.mouseWheelZoomBehavior||N.mouseWheelZoomBehavior===e.Map.ZOOM_KEEP_MOUSE_POINT){if(N.graphics){var ab=Y[ac].resolution;
var V=Y[ae].resolution;var R=X.getCenterPoint();var T=N.getCursorLocation();var W=T.getX();var U=T.getY();
var af=new N.graphics.oui.geom.Matrix();af.translate(W,U);af.scale(ab/V);af.translate(-W,-U);var ad=af.transform(R.getX(),R.getY());
S=new e.geometry.Point(ad.x,ad.y,Z.srid);}}N.setMapCenterAndZoomLevel(S,ac,true);var aa=new e.event.MapEvent(e.event.MouseEvent.WHEEL_SCROLL,N);
aa.delta=Q;N.fire(aa.type,aa);},350);};this.$oracleMapDiv.mousedown(function(P){if(N.isStoppedEvent(P)){return;
}if(P.which===1&&N.enableMapAction.drag){N.moveflag=true;}N.mLocX=P.pageX-N.$oracleMapDiv.offset().left;
N.mLocY=P.pageY-N.$oracleMapDiv.offset().top;N.mouseDownLocX=N.mLocX;N.mouseDownLocY=N.mLocY;var Q=new e.event.MapEvent(e.event.MouseEvent.MOUSE_DOWN,N);
Q.evt=P;N.fire(Q.type,Q);});this.$oracleMapDiv.mousemove(function(R){if(N.isStoppedEvent(R)){return;}var Q=(R.pageX-N.$oracleMapDiv.offset().left)-N.mLocX;
var P=(R.pageY-N.$oracleMapDiv.offset().top)-N.mLocY;N.mLocX=R.pageX-N.$oracleMapDiv.offset().left;N.mLocY=R.pageY-N.$oracleMapDiv.offset().top;
if(N.moveflag&&N.enableMapAction.drag){N.changeCursor(N.cursorStyleDragging);N.pan(Q,P,false);}var S=new e.event.MapEvent(e.event.MouseEvent.MOUSE_MOVE,N);
S.evt=R;N.fire(S.type,S);if(N.utfgridMouseEType===e.event.MouseEvent.MOUSE_MOVE&&(Q!==0||P!==0)){N.utfgridMouseEListener(e.event.MouseEvent.MOUSE_MOVE);
}});this.$oracleMapDiv.mouseup(function(S){if(N.isStoppedEvent(S)){return;}var U=e.event;var T=new U.MapEvent(U.MouseEvent.MOUSE_UP,N);
T.evt=S;N.fire(T.type,T);N.mouseUpLocX=N.mLocX;N.mouseUpLocY=N.mLocY;if(N.mouseDownLocX&&N.mouseDownLocY&&N.moveflag&&N.enableMapAction.drag&&(Math.abs(N.mouseUpLocX-N.mouseDownLocX)>1||Math.abs(N.mouseUpLocY-N.mouseDownLocY)>1)){T=new U.MapEvent(U.MapEvent.MAP_RECENTERED,N);
N.fire(T.type,T);}else{if(N.mouseDownLocX&&N.mouseDownLocY&&Math.abs(N.mouseUpLocX-N.mouseDownLocX)<=1&&Math.abs(N.mouseUpLocY-N.mouseDownLocY)<=1){if(S.which==3){T=new U.MapEvent(U.MouseEvent.MOUSE_RIGHT_CLICK,N);
N.fire(T.type,T);return;}T=new U.MapEvent(U.MouseEvent.MOUSE_CLICK,N);N.fire(T.type,T);for(var R=0;R<N.divLayers.length;
R++){var Q=N.divLayers[R];if((Q.layerType===e.LayerTypes.TILE||Q.layerType===e.LayerTypes.DYNAMIC_TILE)&&Q instanceof e.layer.InteractiveTileLayer&&Q.isVisible()){var P=N.getCursorLocation();
Q.identifyFeatures(P);}}if(N.utfgridMouseEType===e.event.MouseEvent.MOUSE_CLICK){N.fireUTFGridEvent(e.event.MouseEvent.MOUSE_CLICK);
setTimeout(N.displayUTFGridInfoWindow(),10);}}}N.mouseDownLocX=null;N.mouseDownLocY=null;N.moveflag=false;
N.showProgressBar(N.getProgress());N.changeCursor(N.cursorStyleDefault);});N.displayUTFGridInfoWindow=function(){var Q=10;
var S=null;var P=0;var R=function(){if(N.utfgridHTMLArray.length<N.utfgrid_lyr_cnt){if(P>=Q){clearTimeout(S);
e.util.Logger.warning("MAPVIEWER_9081","OM.Map.initialize");}else{clearTimeout(S);S=setTimeout(R,50);
P+=1;}}else{var X="";for(var V=0,U=N.utfgridHTMLArray.length;V<U;V++){var Y=N.utfgridHTMLArray[V];if((!e.isNull(Y))&&Y.trim().length>0){X+=Y.trim();
}}if(X.trim().length>0){X="<table align='left' cellspacing='4' style='margin: auto;border-collapse: separate;'>"+X+"</table>";
var T=N.getCursorLocation();var W={title:"Feature Info"};N.displayInfoWindow(T,X,W);}else{N.closeInfoWindows();
}N.utfgridHTMLArray=[];}};R();};N.fireUTFGridEvent=function(S){var P=0;for(var R=0;R<N.divLayers.length;
R++){var Q=N.divLayers[R];if((Q.layerType===e.LayerTypes.TILE||Q.layerType===e.LayerTypes.DYNAMIC_TILE)&&Q.enableUTFGrid===true&&Q.mouseETypeUTFGrid===S&&Q.enableUTFGridInfoWindow===true){var T=new e.event.MapEvent(Q.mouseETypeUTFGrid,Q);
Q.fire(T.type,Q);P+=1;}}if(P!=N.utfgrid_lyr_cnt){e.util.Logger.warning("","OM.Map.fireUTFGridEvent","the utfgrid-enabled layer count does not match.");
}};this.mapDragOutDiv=function(){if(N.moveflag&&N.enableMapAction.drag){if(N.mouseDownLocX&&N.mouseDownLocY&&N.moveflag&&N.enableMapAction.drag&&(Math.abs(N.mouseUpLocX-N.mouseDownLocX)>1||Math.abs(N.mouseUpLocY-N.mouseDownLocY)>1)){var P=new e.event.MapEvent(e.event.MapEvent.MAP_RECENTERED,N);
N.fire(P.type,P);}N.moveflag=false;N.changeCursor(N.cursorStyleDefault);N.mouseDownLocX=null;N.mouseDownLocY=null;
}};e.$(document).mouseup(this.mapDragOutDiv).mouseout(this.mapDragOutDiv);this.$fkGraphicLayersDiv.mouseout(function(P){P.stopPropagation();
});this.graphics.oui.rootNode.addEventListener(e.event.MouseEvent.MOUSE_LEAVE,function(){if(N.graphics.oui&&N.graphics.oui.tree&&N.graphics.oui.tree.canvas){N.graphics.oui.tree.canvas.style.cursor=N.cursorStyleDefault;
}});if(e.browser.touchSupported){this.$oracleMapDiv.bind("touchstart",function(P){if(!N.isStoppedEvent(P)){N.touchStart(P);
}});this.$oracleMapDiv.bind("touchmove",function(P){P.preventDefault();if(!N.isStoppedEvent(P)){N.touchMove(P);
}});this.$oracleMapDiv.bind("touchend",function(P){if(!N.isStoppedEvent(P)){N.touchEnd(P);}});}if(e.gv.isWin8Touch){var F=this;
e.Hammer(this.$oracleMapDiv[0]).on("transformstart",function(Q){F.touchStartLocs=[];F.pinchZoomScale=1;
var S=F.touchStartLocs;S[0]={x:Q.gesture.touches[0].pageX,y:Q.gesture.touches[0].pageY};S[1]={x:Q.gesture.touches[1].pageX,y:Q.gesture.touches[1].pageY};
var R=S[1].x-S[0].x;var P=S[1].y-S[0].y;F.pinchZoomStartDist=Math.sqrt(R*R+P*P);});e.Hammer(this.$oracleMapDiv[0]).on("pinch",function(S){var W=e.util.DomUtil;
var T=W.getTouchesScale(S);if(e.isNull(T)){var Q=W.getTouchesPosition(S.gesture);var R=Q[0].x-Q[1].x;
var P=Q[0].y-Q[1].y;var X=Math.sqrt(R*R+P*P);T=X/F.pinchZoomStartDist;}F.pinchZoomScale=T;if(T==1||T<=0){return;
}var U=F.zoomLevel;if(T>1&&U>=F.maxZoom){return;}else{if(T<1&&U<=0){return;}}F.pinchZooming=true;F.graphics.setVisible(F.draggableGroup,false);
F.$heatMapDiv.css({visibility:"hidden"});F.$customLayersDiv.css({visibility:"hidden"});for(var V=0;V<F.divLayers.length;
V++){if(F.divLayers[V].zoomControl){F.divLayers[V].zoomControl.scaleTiles(T);}}});e.Hammer(this.$oracleMapDiv[0]).on("transformend",function(){var Q=F.pinchZoomScale;
if(F.pinchZooming){var P=F.getScaleZoomLevel(Q);F.setMapZoomLevel(P);F.pinchZoomScale=1;F.pinchZooming=false;
F.graphics.setVisible(F.draggableGroup,true);F.$heatMapDiv.css({visibility:"visible"});F.$customLayersDiv.css({visibility:"visible"});
F.doubleTap=false;}});}this._keyboardSupport={xPanOffset:5,yPanOffset:5,useSmoothPan:true,actionMap:{tab:function(){},zoomIn:function(){N.zoomIn();
},zoomOut:function(){N.zoomOut();},panLeft:function(){N.pan(N._keyboardSupport.xPanOffset,0,N._keyboardSupport.useSmoothPan);
},panUp:function(){N.pan(0,N._keyboardSupport.yPanOffset,N._keyboardSupport.useSmoothPan);},panRight:function(){N.pan(-N._keyboardSupport.xPanOffset,0,N._keyboardSupport.useSmoothPan);
},panDown:function(){N.pan(0,-N._keyboardSupport.yPanOffset,N._keyboardSupport.useSmoothPan);},toggleOverview:function(){var P=N.overview;
if(P.minimized){P.restore();}else{P.collapse();}},toggleLayerControl:function(){},toggleDecoration:function(){}},keyMap:{107:"zoomIn",109:"zoomOut",37:"panLeft",38:"panUp",39:"panRight",40:"panDown",79:"toggleOverview"}};
var s=function(Q){if(N.isStoppedEvent(Q)||Q.type!=="keydown"){return;}var P=N._keyboardSupport.actionMap;
var S=N._keyboardSupport.keyMap;var R=S[Q.keyCode];if(R&&P[R]){P[R]();}};this.$oracleMapDiv.keypress(s);
this.$oracleMapDiv.keydown(s);this.$oracleMapDiv.keyup(s);}this.newLayerConfigLoaded=function(P){if(P.target instanceof e.layer.Layer){P.target.lastEvent=P.type;
}N.showProgressBar(N.getProgress());N.initLayers(P);};this.getProgress=function(){var Z=0;var R=0;var Y=0;
var T=0;var P=0;if(e.notNull(N.divLayers)){T+=N.divLayers.length;for(var X=0;X<N.divLayers.length;X++){var S=N.divLayers[X];
var Q=1;if(S.layerType===e.LayerTypes.TILE||S.layerType===e.LayerTypes.DYNAMIC_TILE){if(e.notNull(S.lastEvent)){if(S.lastEvent===e.event.LayerEvent.ALL_TILES_LOADED||S.lastEvent===e.event.LayerEvent.INIT_ERROR||S.isVisible()!==true){Q=0;
}else{if(S.lastEvent===e.event.LayerEvent.FINISH_GOT_CONFIG){Q=0.75;}else{Q=1-(S.getTilesPercentStatus()/100);
}}}R+=Q;}else{if(e.isNull(S.lastEvent)||(S.lastEvent!=e.event.LayerEvent.FINISH_LOAD&&S.lastEvent!=e.event.LayerEvent.INIT_ERROR)){R++;
}}}}if(e.notNull(N.svgLayers)){T+=N.svgLayers.length;for(var V=0;V<N.svgLayers.length;V++){var W=1;var U=N.svgLayers[V];
if(e.notNull(U.lastEvent)){if(U.lastEvent===e.event.LayerEvent.FINISH_LOAD||U.lastEvent===e.event.LayerEvent.INIT_ERROR){W=0;
}else{if(U.lastEvent===e.event.LayerEvent.FINISH_GOT_CONFIG){W=0.75;}else{if(U.lastEvent===e.event.LayerEvent.VECTOR_LAYER_LOADING_THEME){W=0.5;
}else{if(U.lastEvent===e.event.LayerEvent.VECTOR_LAYER_PARSING_THEME){W=0.25;}}}}}Z+=W;}}Y=Z+R;if(Y===0||T===0){P=100;
}else{P=100*(T-Y)/T;}if(this.zoomComplete===false){if(P>=100){P=77;}}if(P>=N.globalMinProgress||e.isNull(N.globalMinProgress)){N.globalMinProgress=P;
}else{P=N.globalMinProgress;}if(N.moveflag===true){P=70;}return P;};this.listenerElocationCopyright=function(){var P=new e.control.CopyRight({anchorPosition:e.control.MapDecoration.POSITION_LOWER_RIGHT,textValue:'&copy; 2015 Oracle Corporation &nbsp;&nbsp; <a target="_blank" href="http://elocation.oracle.com/elocation/legal.html">Terms</a> &nbsp;&nbsp; Map data &copy; 2015 HERE',fontSize:10,fontFamily:"Arial",fontColor:"black"});
N.addMapDecoration(P);this.deleteListener(e.event.LayerEvent.FINISH_GOT_CONFIG,N.listenerElocationCopyright);
};this.layerFinish=function(S){S.target.loaded=true;S.target.lastEvent=S.type;var Q;if(e.Map.isTileLayer(S.target.layerType)){if(!N.divLayers){return;
}for(Q=0;Q<N.divLayers.length;Q++){if(!N.divLayers[Q].loaded){return;}}var P=new e.control.CopyRight({anchorPosition:6,textValue:S.target.tileLayerConfig.copyright,fontSize:12,fontFamily:"Arial"});
if(!N.over&&e.isNull(P.textValue)&&P.textValue.trim().length>0){N.addMapDecoration(P);}if(P.type==="CopyRight"){N.copyRight=P;
}if(N.graphics){N.graphics.setVisible(N.draggableGroup,true);}if(N.$heatMapDiv){N.$heatMapDiv.css({visibility:"visible"});
}if(N.$customLayersDiv){N.$customLayersDiv.css({visibility:"visible"});}}if(this.progressBarComplete===false||N.divLayers.length===0||!(S.target.layerType===e.LayerTypes.TILE||S.target.layerType!==e.LayerTypes.DYNAMIC_TILE)){N.showProgressBar(N.getProgress());
}if(N.divLayers){for(Q=0;Q<N.divLayers.length;Q++){if(!N.divLayers[Q].loaded){return;}}}if(N.svgLayers){for(Q=0;
Q<N.svgLayers.length;Q++){if(!(N.svgLayers[Q].loaded||N.svgLayers[Q].loadError)){return;}}}N.boundingLayerName=null;
N.boundingThemeLoaded=false;try{N.refreshVectorLayerLabels();N.getToolFeatureLayer();}catch(R){var T=(R.stack)?R.message+"\nStack: "+R.stack:R.message;
e.util.Logger.warning(0,"OM.Map.layerFinish",T);}finally{S=new e.event.MapEvent(e.event.MapEvent.MAP_AFTER_REFRESH,N);
N.fire(S.type,S);}};this.layerErr=function(P){if(N.overviewLayer==P.target){N.overviewLayerErr=true;}N.removeLayer(P.target);
if(e.Map.isTileLayer(P.target.layerType)){if(N.divLayers.length===0){N.showProgressBar(N.getProgress());
}else{N.divLayers[N.universeLayerIndex].getLayerConfig();}}else{if(P.target.isBoundingTheme()){N.boundingLayerName=null;
if(N.universeLayerIndex>=0){N.divLayers[N.universeLayerIndex].getLayerConfig();}}N.layerFinish(P);if(N.universeLayerIndex<0&&N.overviewLayerErr&&N.overview){if(N.svgLayers.length>0){N.overviewLayer=N.svgLayers[N.svgLayers.length-1];
N.overview.setOverviewMapOptions({overviewLayer:N.overviewLayer});N.overview.errLoadLayer();}}}};this.layerStyleChanged=function(Q){var P=new e.event.MapEvent(e.event.MapEvent.MAP_STYLE_CHANGED,N);
P.affectLayer=Q.target;P.newStyle=Q.newStyle;P.attributes=Q.attributes;N.fire(P.type,P);};this.nsdpMapped=function(Q){var P=new e.event.MapEvent(e.event.MapEvent.I_MAP_NSDP_MAPPED,N);
P.affectLayer=Q.target;N.fire(P.type,P);};if(!this.disableOverviewMap&&!x.magnifier){this.overview=new e.control.OverviewMap({});
this.overview.mainmap=this;this.addMapDecoration(this.overview);var O=this.overview;var I=e.event.MapEvent;
this.$fixedLayerDIV.append(this.overview.$DecorationDiv);this.on(I.I_MAP_CENTER_ZOOM,this.overview.setCenterAndZoomlevel,O);
this.on(I.I_MAP_DRAGGING,this.overview.setRectangleFeature,O);this.on(I.MAP_RECENTERED,this.overview.setCenterAndZoomlevel,O);
this.on(I.MAP_BEFORE_REFRESH,this.overview.setCenterAndZoomlevel,O);this.on(I.MAP_RESIZED,this.overview.resize,O);
this.on(I.MAP_STYLE_CHANGED,this.overview.styleChange,O);this.on(I.I_MAP_NSDP_MAPPED,this.overview.nsdpMapped,O);
this.on(I.LAYER_DELETED,this.overview.layerDel,O);this.overviewLayer=null;}var t=function(){var Q=N.getLabelGridBox();
N.grid=new e.util.CoverageGrid(Q);for(var P=0;P<N.svgLayers.length;P++){N.svgLayers[P].loaded=false;}};
var v=e.event.MapEvent;this.on(v.MAP_INITIALIZED,t,this);this.on(v.LAYER_REORDERED,this.changeOverView,this);
this.getToolFeatureLayer();},setUTFGridMouseEType:function(s){for(var u=0;u<this.divLayers.length;u++){var t=this.divLayers[u];
if((t.layerType===e.LayerTypes.TILE||t.layerType===e.LayerTypes.DYNAMIC_TILE)&&t.enableUTFGrid===true&&t.enableUTFGridInfoWindow===true){this.utfgridMouseEType=((s===e.event.MouseEvent.MOUSE_OVER||s===e.event.MouseEvent.MOUSE_MOVE)?e.event.MouseEvent.MOUSE_MOVE:e.event.MouseEvent.MOUSE_CLICK);
}}},updateUTFGridLayerListener:function(){this.utfgrid_lyr_cnt=this.getUTFGridLayerCount();this.utfgridMouseEType=this.getUTFGridMouseEType();
this.utfgridMouseEListener=e.util.MiscUtil.debounce(function(t){if(t!==this.utfgridMouseEType){return;
}var u=this;if(u.utfgrid_lyr_cnt>0){u.fireUTFGridEvent(t);var s=function(){u.displayUTFGridInfoWindow();
};setTimeout(s,50);}},500);},updateUTFGridLayerCount:function(){this.utfgrid_lyr_cnt=this.getUTFGridLayerCount();
},generateMapInstanceId:(function(){var s=0;return function(){return +(++s);};}()),getUndoManager:function(){return this.undoManager;
},getMapContext:function(){return e.MapContext(this);},initLayers:function(B){var t=this;var I=e.event;
var C=this.getMapContextToken();var D=function(){var K=[];for(var N=0;e.notNull(t.layerQueue)&&N<t.layerQueue.length;
N++){var O=t.layerQueue[N];if(e.Map.isTileLayer(O[0].layerType)){var J=O[0].getZIndex()-1;var M=false;
for(var L=0;L<J;L++){if(!t.divLayers[L].initCalled){M=true;break;}}if(M){K.push(t.layerQueue[N]);continue;
}else{if(O.length==1&&O[0] instanceof e.layer.InteractiveTileLayer){O[0].setLayerConfig(C.universe);}else{if(!O[1].equals(C.universe)){t.resetUniverse(O[1],O[0],O[0].tileLayerConfig);
return;}else{if(t.divLayers[t.universeLayerIndex]==O[0]&&!t.boundingLayerName&&!t.extentRect){continue;
}}}}}O[0].initLayer();}if(t.overviewLayerErr&&t.overview){if(t.universeLayerIndex!=-1){t.overviewLayer=t.divLayers[t.universeLayerIndex];
}else{if(t.svgLayers.length>0){t.overviewLayer=t.svgLayers[t.svgLayers.length-1];}}t.overview.setOverviewMapOptions({overviewLayer:t.overviewLayer});
t.overview.errLoadLayer();}t.layerQueue=K;};var s=function(K){if(e.isNull(t.layerQueue)){return;}for(var J=0;
J<t.layerQueue.length;J++){if(t.layerQueue[J][0].name==K.target.name){return;}}var L=[K.target];if((e.Map.isTileLayer(K.target.layerType))&&e.notNull(K.config)){L.push(new e.universe.Universe(K.config));
}t.layerQueue.push(L);};if(t.extentRect){t.boundingLayerName=null;}var u,E,A,G;if(e.notNull(t.extentRect)&&t.universeLayerIndex!==-1){if(!t.displayed&&t.divLayers[t.universeLayerIndex]==B.target){C.universe=new e.universe.Universe(B.config).copy(C.universe);
t.displayed=true;t.setAllInitialParams();C.zoomLevel=t.checkZoomLevel(C.zoomLevel);s(B);t.zoomToExtent(t.extentRect);
}else{if(!B&&t.displayed){t.checkCenter();u=new I.MapEvent(I.MapEvent.MAP_INITIALIZED,t);t.initialized=true;
t.inited=false;t.fire(u.type,u);D();}else{if(t.initialized){if(e.Map.isTileLayer(B.target.layerType)){E=new e.universe.Universe(B.config);
if(e.isNull(B.config)&&B.target instanceof e.layer.InteractiveTileLayer){B.target.setLayerConfig(C.universe);
}else{if(!E.equals(C.universe)){t.resetUniverse(E,B.target,B.config);return;}}}B.target.initLayer();D();
}else{s(B);}}}}else{if(e.notNull(t.extentRect)){if(!t.displayed){t.displayed=true;C.zoomLevel=t.checkZoomLevel(C.zoomLevel);
t.setAllInitialParams();s(B);t.zoomToExtent(t.extentRect);}else{if(!B&&t.displayed){u=new I.MapEvent(I.MapEvent.MAP_INITIALIZED,t);
if(!t.initialized){t.initialized=true;t.inited=false;t.fire(u.type,u);}D();}else{if(t.initialized){B.target.initLayer();
}else{s(B);}}}}else{if(t.boundingLayerName&&t.universeLayerIndex!=-1){if(t.divLayers[t.universeLayerIndex]==B.target&&!t.displayed){C.universe=new e.universe.Universe(B.config).copy(C.universe);
t.displayed=true;s(B);for(var y=0;y<t.layerQueue.length;y++){var v=t.layerQueue[y];if(v[0].layerType==e.LayerTypes.VECTOR&&(v[0].name==t.boundingLayerName)){t.boundingThemeLoading=true;
v[0].loadBoundingTheme();break;}}}else{if(t.boundingLayerName==B.target.name&&t.displayed){if(t.boundingThemeLoading){var x=B.bbox;
G=B.target.calculateCenterAndZoomLevel(x[0],x[1],x[2],x[3]);if(t.initialized){t.setMapCenterAndZoomLevel(G[1],G[0]);
B.target.initLayer();D();}else{C.centerPoint=G[1];C.homeCenter=C.centerPoint;C.zoomLevel=t.checkZoomLevel(G[0]);
if(!C.homeMapCenter){C.homeMapCenter=C.homeCenter;}if(t.wraparound){C.roundMapCenterPoint=C.homeCenter.clone();
}if(!C.homeMapZoomlevel){C.homeMapZoomlevel=C.zoomLevel;}t.checkCenter();t.boundingThemeLoaded=true;u=new I.MapEvent(I.MapEvent.MAP_INITIALIZED,t);
t.initialized=true;t.inited=false;t.fire(u.type,u);s(B);D();}t.boundingThemeLoading=false;}else{t.boundingThemeLoading=true;
B.target.loadBoundingTheme();}}else{if(t.initialized&&t.boundingThemeLoaded){if(e.Map.isTileLayer(B.target.layerType)){E=new e.universe.Universe(B.config);
if(e.isNull(B.config)&&B.target instanceof e.layer.InteractiveTileLayer){B.target.setLayerConfig(C.universe);
}else{if(!E.equals(C.universe)){t.resetUniverse(E,B.target,B.config);return;}}}B.target.initLayer();D();
}else{s(B);}}}}else{if(t.universeLayerIndex!=-1){if(t.divLayers&&t.divLayers[t.universeLayerIndex]===B.target&&!t.displayed){C.universe=new e.universe.Universe(B.config).copy(C.universe);
C.zoomLevel=t.checkZoomLevel(C.zoomLevel);t.displayed=true;A=function(){t.checkCenter();var J=new I.MapEvent(I.MapEvent.MAP_INITIALIZED,t);
if(!t.initialized){t.initialized=true;t.inited=false;if(t.resetTag){J=new I.MapEvent(I.MapEvent.MAP_RESET_UNIVERSE,t);
}t.fire(J.type,J);}B.target.initLayer();D();};t.setAllInitialParams();if(C.centerPoint.srid==C.universe.srid){C.homeCenter=C.centerPoint.clone();
if(t.wraparound){C.roundMapCenterPoint=C.homeCenter.clone();}A();}else{C.centerPoint.transform(C.universe.srid,function(J){C.centerPoint=J;
C.homeCenter=C.centerPoint.clone();if(t.wraparound){C.roundMapCenterPoint=J;}A();});}}else{if(t.initialized){if(e.Map.isTileLayer(B.target.layerType)){var F=B.target.getZIndex()-1;
for(var w=0;w<F;w++){if(!t.divLayers[w].initCalled){s(B);return;}}E=new e.universe.Universe(B.config);
if(e.isNull(B.config)&&B.target instanceof e.layer.InteractiveTileLayer){B.target.setLayerConfig(C.universe);
}else{if(!E.equals(C.universe)){t.resetUniverse(E,B.target,B.config);return;}}}B.target.initLayer();D();
}else{s(B);}}}else{if(t.boundingLayerName){if((B.target.name==t.boundingLayerName)&&B.bbox){t.displayed=true;
C.homeMapCenter=C.centerPoint;C.homeMapZoomlevel=C.zoomLevel;if(e.notNull(B.bbox[0])&&e.notNull(B.bbox[1])&&e.notNull(B.bbox[2])&&e.notNull(B.bbox[3])){G=B.target.calculateCenterAndZoomLevel(B.bbox[0],B.bbox[1],B.bbox[2],B.bbox[3]);
C.homeCenter=G[1];if(!C.homeMapCenter){C.homeMapCenter=G[1];}if(!C.homeMapZoomlevel){C.homeMapZoomlevel=G[0];
}t.setMapCenterAndZoomLevel(G[1],G[0]);}else{t.setMapZoomLevel(0);}t.checkCenter();t.boundingThemeLoaded=true;
u=new I.MapEvent(I.MapEvent.MAP_INITIALIZED,t);if(!t.initialized){t.initialized=true;t.inited=false;t.fire(u.type,u);
}if(e.notNull(B.bbox[0])&&e.notNull(B.bbox[1])&&e.notNull(B.bbox[2])&&e.notNull(B.bbox[3])){s(B);}D();
}else{if(B.target.name==t.boundingLayerName){t.boundingThemeLoading=true;B.target.loadBoundingTheme();
}else{if(t.initialized&&t.boundingThemeLoaded){B.target.initLayer();D();}else{s(B);}}}}else{var z=this.getMapContext().getUniverse();
t.displayed=true;C.zoomLevel=t.checkZoomLevel(C.zoomLevel);t.setAllInitialParams();A=function(){var J=new I.MapEvent(I.MapEvent.MAP_INITIALIZED,t);
t.checkCenter();if(!t.initialized){t.initialized=true;t.inited=false;t.fire(J.type,J);}if(B){B.target.initLayer();
}D();};if(C.centerPoint.srid==z.srid){C.homeCenter=C.centerPoint.clone();if(t.wraparound){C.roundMapCenterPoint=C.homeCenter.clone();
}A();}else{C.centerPoint.transform(z.srid,function(J){C.centerPoint=J;C.homeCenter=C.centerPoint.clone();
if(t.wraparound){C.roundMapCenterPoint=C.homeCenter.clone();}A();});}}}}}}},init:function(){this.on(e.event.MapEvent.MAP_INITIALIZED,function(B){var E=B.target;
E.getMapContext().getTransform();E.changeCursor(E.cursorStyleDefault);var A=E.getMapContext().getUniverse().getMapBounds().getWidth();
var C=E.getMapContext().getWholeMapNum();var z=E.getMapContext().getBaseWholeMapIndex();for(var D=0;D<C;
D++){this.mapBBox[D]={minX:(D-z)*A-A/2,maxX:(D-z)*A+A/2};}});var y=this;var x=e.event;var w=this.getMapContextToken();
this.layerQueue=[];if(this.initialized){this.cleanMap();}else{var s=this.getMapContextToken();if(e.notNull(s.centerPoint)){s.homeMapCenter=s.centerPoint;
}if(y.wraparound&&e.notNull(s.homeMapCenter)){w.roundMapCenterPoint=s.homeMapCenter.clone();}s.homeMapZoomlevel=s.zoomLevel;
}var u,t;if(this.divLayers.length===0&&this.svgLayers.length===0){this.displayed=true;w.zoomLevel=y.checkZoomLevel(w.zoomLevel);
if(!this.initialized){this.initialized=true;this.inited=false;var v=new x.MapEvent(x.MapEvent.MAP_INITIALIZED,this);
if(this.resetTag){v=new x.MapEvent(x.MapEvent.MAP_RESET_UNIVERSE,this);}this.fire(v.type,v);}}else{if(this.universeLayerIndex!=-1&&this.divLayers.length>0){u=this.divLayers[this.universeLayerIndex];
if(u.layerType==e.LayerTypes.EXTERNAL){u.loaded=true;u.setContainer(this.$tileLayersDiv[0]);}if(e.isNull(this.overviewLayer)){this.overviewLayer=u;
}this.graphics.setVisible(this.draggableGroup,false);this.$heatMapDiv.css({visibility:"hidden"});this.$customLayersDiv.css({visibility:"hidden"});
u.getLayerConfig();for(t=this.universeLayerIndex+1;t<this.divLayers.length;t++){u=this.divLayers[t];if(u.layerType==e.LayerTypes.EXTERNAL){u.loaded=true;
u.setContainer(this.$tileLayersDiv[0]);}u.getLayerConfig();}}for(t=0;t<=this.svgLayers.length-1;t++){if(e.isNull(this.overviewLayer)&&this.svgLayers[t]!==this.toolFeatureLayer&&this.svgLayers[t]!==this.defaultFeatureLayer){this.overviewLayer=this.svgLayers[t];
if(this.overview&&this.overview.submap){}}this.svgLayers[t].getLayerConfig();}this.inited=true;this.updateUTFGridLayerListener();
}},validateUTFGridLayerTriggers:function(){var s=null;for(var u=0;u<this.divLayers.length;u++){var t=this.divLayers[u];
if((t.layerType===e.LayerTypes.TILE||t.layerType===e.LayerTypes.DYNAMIC_TILE)&&t.enableUTFGrid===true&&t.enableUTFGridInfoWindow===true){if(e.notNull(t.mouseETypeUTFGrid)){if(e.isNull(s)){s=t.mouseETypeUTFGrid;
}else{t.mouseETypeUTFGrid=s;e.util.Logger.warning("","OM.Map.getUTFGridMouseEType","UTFGrid info window trigger is set to:["+s+"]");
}}}}},getUTFGridMouseEType:function(){for(var t=0;t<this.divLayers.length;t++){var s=this.divLayers[t];
if((s.layerType===e.LayerTypes.TILE||s.layerType===e.LayerTypes.DYNAMIC_TILE)&&s.enableUTFGrid===true&&s.enableUTFGridInfoWindow===true){if(e.notNull(s.mouseETypeUTFGrid)){return s.mouseETypeUTFGrid;
}}}return null;},getUTFGridLayerCount:function(){var s=0;for(var u=0;u<this.divLayers.length;u++){var t=this.divLayers[u];
if((t.layerType===e.LayerTypes.TILE||t.layerType===e.LayerTypes.DYNAMIC_TILE)&&t.enableUTFGrid===true&&t.enableUTFGridInfoWindow===true){if(t.isVisible()!==true){continue;
}s+=1;}}return s;},refreshMap:function(){if(this.initialized){var s=new e.event.MapEvent(e.event.MapEvent.MAP_BEFORE_REFRESH,this);
this.fire(s.type,s);}},redrawMap:function(){if(this.initialized){this.getMapContextToken().transform=null;
this.getMapContext().getTransform();if(this.wraparound){this.getMapContextToken().roundMapCenterPoint=this.getMapContextToken().centerPoint;
}this.graphics.setLeftTop(this.draggableGroup,0,0);var s=new e.event.MapEvent(e.event.MapEvent.MAP_REDRAW,this);
this.fire(s.type,s);}},destroyMap:function(){e.util.Logger.info(null,"Destorying map instance "+this.mapInstanceId);
var u=new e.event.MapEvent(e.event.MapEvent.MAP_DESTROY,this);this.fire(u.type,u);this.deleteAllListeners();
if(this.template){this.template.destroy();}if(this.graphics){this.graphics.clearGroup(this.draggableGroup);
this.graphics.clearGroup(this.blockerGroup);this.graphics.clearGroup(this.fixedGroup);this.graphics.removeAll();
}this.draggableGroup=null;this.blockerGroup=null;this.fixedGroup=null;this.graphics=null;if(this.undoManager){this.undoManager.destroy();
}this.undoManager=null;if(this.loadingIcon){e.$(this.loadingIcon).remove();}if(this.$topLayerDIV){this.$topLayerDIV.remove();
}if(this.$fixedLayerDIV){this.$fixedLayerDIV.remove();}if(this.$infoWinLayerDIV){this.$infoWinLayerDIV.remove();
}if(this.$customLayersDiv){this.$customLayersDiv.remove();}if(this.$fkGraphicLayersDiv){this.$fkGraphicLayersDiv.remove();
}if(this.$tileLayersDiv){this.$tileLayersDiv.remove();}if(this.$heatMapDiv){this.$heatMapDiv.remove();
}if(this.loadingIcon){e.$(this.loadingIcon).empty();}if(this.$oracleMapDiv){this.$oracleMapDiv.remove();
}if(this.$containerDiv){this.$containerDiv.unbind().empty();}if(this.mapDragOutDiv){e.$(document).unbind("mouseup",this.mapDragOutDiv).unbind("mouseout",this.mapDragOutDiv);
}if(this.dropOnDoc){e.$(document).unbind("drop",this.dropOnDoc);}this.mapDragOutDiv=null;this.dropOnDoc=null;
this.loadingIcon=null;this.$topLayerDIV=null;this.$fixedLayerDIV=null;this.$infoWinLayerDIV=null;this.$customLayersDiv=null;
this.$fkGraphicLayersDiv=null;this.$tileLayersDiv=null;this.$oracleMapDiv=null;this.$containerDiv=null;
this.$heatMapDiv=null;this.divLayers=[];this.svgLayers=[];this.defaultFeatureLayer=null;this.toolFeatureLayer=null;
this.overviewLayer=null;this.overview=null;this.decorationArray=[];this.layerQueue=[];var v=e.gv.mapInstances;
var s=v.length;for(var t=0;t<s;t++){if(v[t]==this){v.splice(t,1);break;}}},getUniverse:function(){return this.getMapContext().getUniverse();
},setMapCenter:function(t,s){if(s!==false){s=true;}if(this.wraparound){this.setMapCenterAndZoomLevel(t,this.getMapContext().getZoomLevel(),s);
}else{this.setMapCenterAndZoomLevel(t,null,s);}},getMapCenter:function(s){if(e.isNull(s)){return this.getMapContext().getCenterPoint();
}else{this._noZoomInOut=true;this.zoomToExtent(s);this._noZoomInOut=false;return this._mapCenter;}},setMapZoomLevel:function(s){this.setMapCenterAndZoomLevel(null,s,true);
},getMapZoomLevel:function(s){if(e.isNull(s)){return this.getMapContext().getZoomLevel();}else{this._noZoomInOut=true;
this.zoomToExtent(s);this._noZoomInOut=false;return this._zoomLevel;}},setMapScale:function(v,t){var u=this;
var s=function(){u.deleteListener(e.event.MapEvent.MAP_INITIALIZED,s);var x=u.getMapContext().getUniverse().getSRID();
var z=0.0254;var y;if(x==8307||x==8265||x==4326){var w=111195;y=v*z/w/e.gv.DPI;}else{y=v*z/e.gv.DPI;}u.setMapResolution(y,t);
};if(this.initialized){s();}else{this.on(e.event.MapEvent.MAP_INITIALIZED,s);}},getMapScale:function(){var v=0.0254;
var u=this.getMapContext();var y=u.getZoomLevel();var x=u.getUniverse().getZoomLevels();var t=x[y];var s=t.resolution;
var w=e.gv.DPI*s/v;return w;},setMapResolution:function(v,s,u){var t=this.getMapContext().getUniverse().getZoomLevels();
if(!s){s=null;}if(v>t[0].resolution){this._zoomLevel=0;if(!this._noZoomInOut){this.setMapCenterAndZoomLevel(s,0);
}return;}for(var w=0;w<t.length-1;w++){if(t[w+1].resolution<=v&&t[w].resolution>=v){if(u){this._zoomLevel=w;
if(!this._noZoomInOut){this.setMapCenterAndZoomLevel(s,w);}return;}else{if(v/t[w].resolution>=t[w+1].resolution/v){this._zoomLevel=w;
if(!this._noZoomInOut){this.setMapCenterAndZoomLevel(s,w);}}else{this._zoomLevel=w+1;if(!this._noZoomInOut){this.setMapCenterAndZoomLevel(s,w+1);
}}return;}}}this._zoomLevel=w;if(!this._noZoomInOut){this.setMapCenterAndZoomLevel(s,w);}},zoomToExtent:function(v){var u=this;
var s=this.getMapContextToken();var w=s.universe;if(v.getWidth()===0||v.getHeight()===0){return;}var t=function(z){var x=z.getWidth()/s.deviceWindow.w;
var y=z.getHeight()*w.zoomLevels[s.zoomLevel].stretchRatio/s.deviceWindow.h;u._mapCenter=z.getCenter();
if(x>y){u.setMapResolution(x,z.getCenter(),true);}else{u.setMapResolution(y,z.getCenter(),true);}if(!u.initialized){u.initLayers();
}};u.extentRect=v;if(!this.displayed){return;}if(v.srid==w.srid){t(v);}else{v.transform(w.srid,function(x){t(x);
});}},zoomIn:function(){this.setMapZoomLevel(this.getMapContext().getZoomLevel()-0+1);},zoomOut:function(){this.setMapZoomLevel(this.getMapContext().getZoomLevel()-1);
},pan:function(T,C,v){var P=this.getMapContextToken();var I=P.universe;var L=P.zoomLevel;var N=I.zoomLevels[L].resolution;
var E=I.zoomLevels[L].stretchRatio;var D=T*N;var F=C*N*E;var z=I.bound.getMinX();var y=I.bound.getMaxX();
var x=I.bound.getMinY();var u=I.bound.getMaxY();var K=P.centerPoint.clone();var J=new e.geometry.Point(P.centerPoint.getX()-D,P.centerPoint.getY()+F,I.srid);
var B;if(this.wraparound){B=new e.geometry.Point(P.roundMapCenterPoint.getX()-D,P.roundMapCenterPoint.getY()+F,I.srid);
}var M=P.deviceWindow;var t=M.w*N;var s=M.h*N*E;var w=P.universe.getMapBounds().getWidth();var S,R;if((J.getX()<(y-t/2)&&J.getY()<(u-s/2)&&J.getX()>(z+t/2)&&J.getY()>(x+s/2))||this.wraparound){if(this.wraparound){if(J.getY()>w/6||J.getY()<-w/6){if(J.getY()<(x+s/2)||J.getY()>(u-s/2)){return;
}}if(P.centerPoint.getX()>w/2){J=new e.geometry.Point(P.centerPoint.getX()-D-w,P.centerPoint.getY()+F,I.srid);
}else{if(P.centerPoint.getX()<-w/2){J=new e.geometry.Point(P.centerPoint.getX()-D+w,P.centerPoint.getY()+F,I.srid);
}else{J=new e.geometry.Point(P.centerPoint.getX()-D,P.centerPoint.getY()+F,I.srid);}}P.roundMapCenterPoint=B;
}P.centerPoint=J;P.homeCenter=J.clone();var A=this.getMapContext().getWholeMapNum();var G=this.getMapContext().getBaseWholeMapIndex();
this.mapBBox=[];for(var O=0;O<A;O++){this.mapBBox[O]={minX:(O-G)*w-w/2,maxX:(O-G)*w+w/2};}}else{S=J.getX();
R=J.getY();if(J.getX()<(y-t/2)&&J.getX()>(z+t/2)){if(J.getY()<(x+s/2)){R=x+s/2;C=(x+s/2-K.getY())/(N*E);
}else{if(J.getY()>(u-s/2)){R=u-s/2;C=(K.getY()-(u-s/2))/(N*E)*-1;}else{C=0;}}P.centerPoint.setPoint(S,R);
P.homeCenter.setPoint(S,R);}else{if(J.getY()<(u-s/2)&&J.getY()>(x+s/2)){if(J.getX()<(z+t/2)){S=z+t/2;
T=(z+t/2-K.getX())/N*-1;}else{if(J.getX()>(y-t/2)){S=y-t/2;T=(K.getX()-(y-t/2))/N;}else{T=0;}}P.centerPoint.setPoint(S,R);
P.homeCenter.setPoint(S,R);}else{return;}}}if(!this.wraparound){if((y-z)<t){T=0;S=(y+z)/2;}if((u-x)<s){C=0;
R=(u+x)/2;}if(e.notNull(S)&&e.notNull(R)){P.centerPoint.setPoint(S,R);P.homeCenter.setPoint(S,R);}if(T===0&&C===0){return;
}}if(this.initialized){var Q=new e.event.MapEvent(e.event.MapEvent.I_MAP_DRAGGING,this);Q.xOffset=T;Q.yOffset=C;
Q.preCenter=K;this.doSmoothPan(Q,v);}},doSmoothPan:function(B,v){var E=B.xOffset;var C=B.yOffset;var t=this;
var D=this.graphics;var A=null;var u=0;var z=0;var w=0;var G=null;var s=function(){if(!t.graphics){return;
}if(Math.abs(E)>F){B.xOffset=F*(Math.abs(E)/E);E=E-F*(Math.abs(E)/E);}else{B.xOffset=E;E=0;}if(Math.abs(C)>F){B.yOffset=F*(Math.abs(C)/C);
C=C-F*(Math.abs(C)/C);}else{B.yOffset=C;C=0;}A=D.getLeftTop(t.draggableGroup);D.setLeftTop(t.draggableGroup,A.x+B.xOffset,A.y+B.yOffset);
t.fire(B.type,B);w++;if(w<z){G=setTimeout(s,20);}else{if(!t.moveflag){B=new e.event.MapEvent(e.event.MapEvent.MAP_RECENTERED,t);
t.fire(B.type,B);}}};var F=Math.floor(e.MapContext(this).getDeviceWidth()/10);if(!v||(Math.abs(E)<F&&Math.abs(C)<F)){A=D.getLeftTop(t.draggableGroup);
D.setLeftTop(t.draggableGroup,A.x+E,A.y+C);t.fire(B.type,B);if(!t.moveflag){B=new e.event.MapEvent(e.event.MapEvent.MAP_RECENTERED,t);
t.fire(B.type,B);}}else{u=Math.abs(E)>Math.abs(C)?E:C;z=Math.abs(u/F);G=setTimeout(s,20);}},checkZoomLevel:function(t){var u=this.getMapContextToken().universe;
if(u&&u.getZoomLevelNumber){if(e.notNull(t)){var s=u.getZoomLevelNumber()-1;var v=0;if(t>s){t=s;}if(t<v){t=v;
}}else{t=0;}}return t;},setMapCenterAndZoomLevel:function(w,v,s){if(this.divLayers.length>0){this.showProgressBar(15);
}else{this.showProgressBar(this.getProgress());}this.zoomComplete=false;if(this.divLayers&&this.divLayers.length===1&&this.divLayers[0].tileSource==="google"&&this.divLayers[0].mapType===e.layer.GoogleTileLayer.TYPE_SHADED){if(v>=15){v=14;
}}if(!v&&this.wraparound||!v&&this.over){v=0;}var u=this;var t=this.getMapContextToken();if(!this.initialized||e.isNull(w)||t.centerPoint.srid===w.srid){this.do_setMapCenterAndZoomLevel(w,v,s);
}else{w.transform(t.universe.srid,function(x){u.do_setMapCenterAndZoomLevel(x,v,s);});}setTimeout(function(){if(u.wraparound){for(var x=0;
x<u.divLayers.length;x++){if(u.divLayers[x].mapType===e.layer.BingTileLayer.TYPE_ROAD||u.divLayers[x].mapType===e.layer.BingTileLayer.TYPE_AERIAL){u.redrawMap();
}}}},100);},do_setMapCenterAndZoomLevel:function(t,J,v){var y=null;var G=null;var E=this.getMapContextToken();
var D;this.on(e.event.MapEvent.MAP_AFTER_ZOOM,function(){if(this.wraparound){this.pan(0,0);}var L=E.universe.getMapBounds().getWidth();
var M=this.getMapContext().getWholeMapNum();var K=this.getMapContext().getBaseWholeMapIndex();this.mapBBox=[];
for(var N=0;N<M;N++){this.mapBBox[N]={minX:(N-K)*L-L/2,maxX:(N-K)*L+L/2};}this.zoomComplete=true;},this);
if(this.initialized){if(e.notNull(J)&&this.zoomEnabled===false){return;}if(e.notNull(J)&&this.checkZoomLevel(J)!==E.zoomLevel){if(this.grid){this.grid.clear();
var B=this.getLabelGridBox(J);this.grid.setBox(B);}D=new e.event.MapEvent(e.event.MapEvent.I_MAP_CENTER_ZOOM,this);
y=E.zoomLevel;E.transform=null;E.zoomLevel=this.checkZoomLevel(J);D.beforeZoomLevel=y;D.afterZoomLevel=E.zoomLevel;
var A=new e.event.MapEvent(e.event.MapEvent.MAP_BEFORE_ZOOM,this);A.beforeZoomLevel=y;A.afterZoomLevel=E.zoomLevel;
this.fire(A.type,A);D.preMapCenter=E.centerPoint.clone();if(t&&t!=E.homeCenter){E.centerPoint=t;E.homeCenter=E.centerPoint.clone();
if(this.wraparound){E.roundMapCenterPoint=t;}}this.checkCenter();var z;for(z=0;z<this.svgLayers.length;
z++){this.svgLayers[z].loaded=false;this.svgLayers[z].clearFeatureShapes();}if(this.divLayers.length>0){this.graphics.setVisible(this.draggableGroup,false);
this.$heatMapDiv.css({visibility:"hidden"});this.$customLayersDiv.css({visibility:"hidden"});}for(z=0;
z<this.divLayers.length;z++){this.divLayers[z].loaded=false;}var C=this;if(this.graphics){this.graphics.clearToolTips();
}setTimeout(function(){if(e.isNull(C.graphics)){return;}C.graphics.setLeftTop(C.draggableGroup,0,0);C.getMapContext().getTransform();
C.fire(D.type,D);var K=new e.event.MapEvent(e.event.MapEvent.MAP_AFTER_ZOOM,C);K.beforeZoomLevel=y;K.afterZoomLevel=E.zoomLevel;
C.fire(K.type,K);},0);}else{if(t){G=E.centerPoint.clone();E.centerPoint=t;E.homeCenter=E.centerPoint.clone();
if(this.wraparound){E.roundMapCenterPoint=t;}var I=this.checkCenter(E.centerPoint);var s=E.centerPoint;
var x=Math.round((G.getX()-s.getX())/E.universe.zoomLevels[E.zoomLevel].resolution);var u=Math.round((s.getY()-G.getY())/E.universe.zoomLevels[E.zoomLevel].resolution*E.universe.zoomLevels[E.zoomLevel].stretchRatio);
if(x===0&&u===0){var F=new e.event.MapEvent(e.event.MapEvent.MAP_RESTRICT_CENTER,this);this.fire(F.type,F);
return;}if(Math.abs(x)>E.deviceWindow.w||Math.abs(u)>E.deviceWindow.h){this.graphics.setLeftTop(this.draggableGroup,0,0);
E.transform=null;D=new e.event.MapEvent(e.event.MapEvent.MAP_BEFORE_REFRESH,this);D.preMapCenter=G;D.restrictCenter=I;
D.bigPan=true;this.fire(D.type,D);}else{D=new e.event.MapEvent(e.event.MapEvent.I_MAP_DRAGGING,this);
D.xOffset=Math.round(x);D.yOffset=Math.round(u);D.preCenter=G;D.restrictCenter=I;this.doSmoothPan(D,v);
}}else{for(var w=0;w<this.divLayers.length;w++){if(this.divLayers[w].zoomControl&&this.divLayers[w].zoomControl.reset&&this.divLayers[w].zoomControl.endScaling){this.divLayers[w].zoomControl.reset();
this.divLayers[w].zoomControl.endScaling();}}}}}else{this.zoomComplete=true;if(t){E.centerPoint=t;E.homeCenter=E.centerPoint.clone();
if(this.wraparound){E.roundMapCenterPoint=t;}}if(e.notNull(J)){E.zoomLevel=this.checkZoomLevel(J);}}},addLayer:function(x,z,u){var t=this;
if(t.inited&&!t.initialized){setTimeout(function(){t.addLayer(x,z);},50);return;}if(this.getLayerByName(x.name)){e.util.Logger.warning("MAPVIEWER-05509","OM.Map.addLayer");
return;}if(e.isNull(z)){z="undefined";}this.typeArray.push(z);x.customType=z;if(e.isNull(this.nameArray[z])){this.nameArray[z]=[];
}this.nameArray[z].push(x.name);x.parentMap=this;var v=e.event;this.on(v.MapEvent.I_MAP_DRAGGING,x.panEvent,x);
this.on(v.MapEvent.MAP_RECENTERED,x.recenter,x);this.on(v.MapEvent.I_MAP_CENTER_ZOOM,x.setCenterAndZoomlevel,x);
this.on(v.MapEvent.MAP_BEFORE_REFRESH,x.refreshEvent,x);this.on(v.MapEvent.MAP_REDRAW,x.redraw,x);this.on(v.MapEvent.MAP_DESTROY,x.destroy,x);
if(x instanceof e.layer.VectorLayer&&x.useRTree){this.on(v.MapEvent.MAP_BEFORE_ZOOM,x.beforeZoom,x);}x.addListener(v.LayerEvent.FINISH_GOT_CONFIG,t.newLayerConfigLoaded);
x.addListener(v.LayerEvent.FINISH_LOAD,t.layerFinish);x.addListener(v.LayerEvent.ALL_TILES_LOADED,t.layerFinish);
x.addListener(v.LayerEvent.INIT_ERROR,t.layerErr);x.addListener(v.LayerEvent.RENDERING_STYLE_CHANGED,t.layerStyleChanged);
x.addListener(v.LayerEvent.NSDP_MAPPED,t.nsdpMapped);if((x.dataSource&&(x.dataSource.toUpperCase()==="ELOCATION_MERCATOR"))&&(x.tileLayer&&(x.tileLayer.toUpperCase()==="WORLD_MAP"))&&(x.serverURL&&(x.serverURL.toLowerCase().indexOf("//elocation.oracle.com/mapviewer/mcserver")>=0))){x.addListener(v.LayerEvent.FINISH_GOT_CONFIG,t.listenerElocationCopyright);
}if(e.isNull(x.serverURL)){x.serverURL=this.mapviewerURL;}if(x.serverURL=="invalid url"){e.util.Logger.alert("MAPVIEWER_9020","OM.Map.addLayer","");
return;}if(e.Map.isTileLayer(x.layerType)){if(x.layerType==e.LayerTypes.EXTERNAL){this.hasExternal=true;
}if(this.universeLayerIndex==-1){this.universeLayerIndex=this.divLayers.length;}if(!e.isNull(u)&&u<this.divLayers.length){this.divLayers.splice(u,0,x);
}else{this.divLayers.push(x);this.updateUTFGridLayerListener();}}else{x.initGroup();if(x.isBoundingTheme()&&!this.initialized){this.boundingLayerName=x.name;
}else{if(x.isBoundingTheme()){this.boundingThemeLoaded=false;this.boundingThemeLoading=false;this.boundingLayerName=x.name;
}}this.svgLayers.push(x);}if(this.initialized){if(!e.Map.isTileLayer(x.layerType)){t.showProgressBar(t.getProgress());
}else{if(x.layerType==e.LayerTypes.EXTERNAL){x.loaded=true;}}if(x.layerType==e.LayerTypes.EXTERNAL){x.setContainer(this.$tileLayersDiv[0]);
}if(t.grid){t.grid.clear();}x.getLayerConfig();if(this.overview){this.changeOverView();if(this.overview.overFeatureLayer){this.overview.overFeatureLayer.bringToTop();
}}}var y=null;if(e.Map.isTileLayer(x.layerType)){y=this.divLayers.length;}else{y=this.svgLayers.length+this.divLayers.length-2;
}var s=new v.MapEvent(v.MapEvent.LAYER_ADDED,t);s.affectedLayer=x;this.fire(s.type,s);for(var w=0;w<this.decorationArray.length;
w++){var A=this.decorationArray[w];if(A.type=="LayerControl"){A.left=parseInt(A.$DecorationDiv.css("left"));
A.top=parseInt(A.$DecorationDiv.css("top"));A.width=A.currentWidth;this.removeMapDecoration(A);this.addMapDecoration(A);
}}this.$oracleMapDiv.keydown(function(B){if((B.keyCode==17||B.keyCode==91||B.keyCode==93)&&x.selectionEnable&&!x.multiSelect){x.multiSelect=true;
x.enableFeatureSelection(true,e.layer.VectorLayer.MULTIPLE_SELECTION);}});this.$oracleMapDiv.keyup(function(B){if((B.keyCode==17||B.keyCode==91||B.keyCode==93)&&x.selectionEnable){x.multiSelect=false;
x.enableFeatureSelection(true,e.layer.VectorLayer.SINGLE_SELECTION);}});this.resetTileLayerZIndex();return y;
},resetTileLayerZIndex:function(){var s;for(s=0;s<this.divLayers.length;s++){var t;var u;this.divLayers[s].zIndex=s;
t=this.divLayers[s].container;if(!e.isNull(t)){u=t.style;if(!e.isNull(u)){u.zIndex=s;}}else{t=this.divLayers[s].jqLayerDiv;
if(!e.isNull(t)){u=t[0].style;if(!e.isNull(u)){u.zIndex=s;}}}}},removeAllFeatureLayers:function(){var v=this.svgLayers;
var s=v.length-1;for(var u=s;u>=0;u--){var t=v[u].name;if(t!="ii_oracle_maps_internal_editing"&&t!="ii_oracle_maps_internal_others"){this.removeLayer(v[u]);
}}},removeLayer:function(x){var w,B,z,v;if(x){var s=new e.event.MapEvent(e.event.MapEvent.LAYER_DELETED,x.parentMap);
s.affectedLayer=x;if(x==this.overviewLayer){this.userSetOL=false;}for(w=0,z=this.svgLayers.length;w<z;
w++){if(this.svgLayers[w]==x){this.deleteLayerListener(x);var y=-1;for(v=0;v<this.nameArray[this.svgLayers[w].customType].length;
v++){if(this.nameArray[this.svgLayers[w].customType][v]==this.svgLayers[w].name){y=v;}}if(y>-1){this.nameArray[this.svgLayers[w].customType].splice(y,1);
}this.svgLayers.splice(w,1);this.fire(s.type,s);this.refreshVectorLayerLabels();x.parentMap=null;for(var t=0;
t<this.decorationArray.length;t++){B=this.decorationArray[t];if(B.type=="LayerControl"){B.left=parseInt(B.$DecorationDiv.css("left"));
B.top=parseInt(B.$DecorationDiv.css("top"));B.width=B.currentWidth;this.removeMapDecoration(B);this.addMapDecoration(B);
}}return x;}}for(w=0,z=this.divLayers.length;w<z;w++){if(this.divLayers[w]==x){this.deleteLayerListener(x);
this.divLayers.splice(w,1);this.fire(s.type,s);x.parentMap=null;for(v=0;v<this.decorationArray.length;
v++){B=this.decorationArray[v];if(B.type=="LayerControl"){this.removeMapDecoration(B);this.addMapDecoration(B);
}}for(v=0;v<this.typeArray.length;v++){var u=this.typeArray[v];var A=this.nameArray[u][v];if(A===x.name){this.nameArray[u].splice(v,1);
this.typeArray.splice(v,1);break;}}return x;}}for(w=0,z=this.divLayers.length;w<z;w++){if(this.divLayers[w].layerType==e.LayerTypes.EXTERNAL){this.hasExternal=true;
break;}else{this.hasExternal=false;}}for(w=0;w<this.decorationArray.length;w++){B=this.decorationArray[w];
if(B.type=="LayerControl"){this.removeMapDecoration(B);this.addMapDecoration(B);}}}this.resetTileLayerZIndex();
this.updateUTFGridLayerListener();},deleteLayerListener:function(t){if(t){var v=this;this.deleteListener(e.event.MapEvent.I_MAP_DRAGGING,t.panEvent,t);
this.deleteListener(e.event.MapEvent.MAP_RECENTERED,t.recenter,t);this.deleteListener(e.event.MapEvent.I_MAP_CENTER_ZOOM,t.setCenterAndZoomlevel,t);
this.deleteListener(e.event.MapEvent.MAP_BEFORE_REFRESH,t.refreshEvent,t);this.deleteListener(e.event.MapEvent.MAP_REDRAW,t.redraw,t);
this.deleteListener(e.event.MapEvent.MAP_DESTROY,t.destroy,t);var u=e.event.LayerEvent;t.deleteListener(u.FINISH_GOT_CONFIG,v.newLayerConfigLoaded);
t.deleteListener(u.FINISH_LOAD,v.layerFinish);t.deleteListener(u.ALL_TILES_LOADED,v.layerFinish);t.deleteListener(u.INIT_ERROR,v.layerErr);
t.deleteListener(u.RENDERING_STYLE_CHANGED,v.layerStyleChanged);t.deleteListener(u.NSDP_MAPPED,v.nsdpMapped);
if(t.clearLayer){t.clearLayer();}if(t.destroy){t.destroy();}var s=new e.event.MapEvent(e.event.MapEvent.LAYER_DELETED,v);
s.affectedLayer=t;}},addToolBar:function(s){if(e.notNull(s)){s.map=this;if(e.$("#div_"+s.innerID).attr("id")!==f){e.util.Logger.warning("MAPVIEWER-9048","OM.Map.addToolBar","Toolbar ID is already used, please pick a new ID.");
return;}else{this.addMapDecoration(s.toolBarDecoration);}s.initBuiltInTools();s.initCustomBts();this.on(e.event.MapEvent.MAP_CLEAN,s.clearTools,this);
}},addMagnifier:function(s){if(e.notNull(s)){this.addMapDecoration(s);s.map=this;}},removeToolbar:function(s){this.removeMapDecoration(s.toolBarDecoration);
s.destroy();s.map=null;},addNavigationPanelBar:function(){var s=new e.control.NavigationPanelBar();this.addMapDecoration(s);
},addScaleBar:function(){var s=new e.control.ScaleBar();this.addMapDecoration(s);},addScaleBarValue:function(s,t){if(!this.ScaleBar){this.addMapDecoration(t);
}t.$DecorationDiv.css({display:"none"});e.$(s).html(t.getTopScaleValue()+"<br>"+t.getBottomScaleValue());
this.on(e.event.MapEvent.MAP_AFTER_REFRESH,function(){e.$(s).html(t.getTopScaleValue()+"<br>"+t.getBottomScaleValue());
});},addScaleBarUnit:function(s,t){if(!this.ScaleBar){this.addMapDecoration(t);}t.$DecorationDiv.css({display:"none"});
e.$(s).html(t.getTopScaleUnit()+"<br>"+t.getBottomScaleUnit());this.on(e.event.MapEvent.MAP_AFTER_REFRESH,function(){e.$(s).html(t.getTopScaleUnit()+"<br>"+t.getBottomScaleUnit());
});},addScaleBarDiv:function(s,t){if(!this.ScaleBar){this.addMapDecoration(t);}t.$DecorationDiv.css({display:"none"});
if(t.getBottomScaleBar()){e.$(s).html(t.getTopScaleBar().prop("outerHTML")+t.getBottomScaleBar().prop("outerHTML"));
}else{e.$(s).html(t.getTopScaleBar().prop("outerHTML"));}this.on(e.event.MapEvent.MAP_AFTER_REFRESH,function(){if(t.getBottomScaleBar()){e.$(s).html(t.getTopScaleBar().prop("outerHTML")+t.getBottomScaleBar().prop("outerHTML"));
}else{e.$(s).html(t.getTopScaleBar().prop("outerHTML"));}});},addMapDecoration:function(s,t){if(!t){this._decoration[s.type]=null;
}else{this._decoration[s.type]=t;s.collapsible=false;s.draggable=false;}if(!this.graphics){return;}if(e.notNull(s)){this.decorationArray=this.decorationArray||[];
for(var u=0;u<this.decorationArray.length;u++){if(s.id==this.decorationArray[u].id){return;}if(s.mapType==this.decorationArray[u].mapType&&s.mapType=="mapTypeControl"){return;
}}this.decorationArray.push(s);s.map=this;if(this.initialized||s.type=="ToolBar"){s.display();}else{if(s.type=="CopyRight"){this.copyRight=s;
}this.on(e.event.MapEvent.MAP_INITIALIZED,s.display,s);this.on(e.event.MapEvent.MAP_RESET_UNIVERSE,s.display,s);
}this.on(e.event.MapEvent.MAP_DESTROY,s.remove,s);this.on(e.event.MapEvent.MAP_CLEAN,s.clean,s);}},removeMapDecoration:function(s){if(!this.decorationArray||this.decorationArray.length===0||!s){return;
}for(var t=0;t<this.decorationArray.length;t++){if(this.decorationArray[t].id===s.id){this.decorationArray.splice(t,1);
this.deleteListener(e.event.MapEvent.MAP_CLEAN,s._cleanMapDecoration);this.deleteListener(e.event.MapEvent.MAP_DESTROY,s._removeMapDecoration);
this.deleteListener(e.event.MapEvent.MAP_INITIALIZED,s.display);this.deleteListener(e.event.MapEvent.MAP_RESET_UNIVERSE,s.display);
s.remove();break;}}},showOverviewMap:function(){this.setOverviewMapOptions({display:true});},hideOverviewMap:function(){this.setOverviewMapOptions({display:false});
},setOverviewMapOptions:function(s){if(s&&s.overviewLayer){if(this.getLayerCurrentIndex(s.overviewLayer)==-1){s.overviewLayer=null;
}else{this.userSetOL=true;}}if(this.overview){this.overview.setOverviewMapOptions(s);}},getCursorLocation:function(){return this.getScreenPointLocation(this.mLocX,this.mLocY);
},getAbsoluteCursorLocation:function(){return this.getScreenPointLocation(this.mLocX,this.mLocY,true);
},getACL:function(v,x){var w=this.getMapContext();var u=w.getBaseWholeMapIndex();var t=w.getUniverse().getMapBounds().getWidth();
var s=v.getX()+(x-u)*t;return new e.geometry.Point(s,v.getY(),v.srid);},getScreenPointLocation:function(I,G,F){var K=this.getMapContext();
var J=K.getBaseWholeMapIndex();var C=J;var A=e.MapContext(this);var E=A.getUniverse();var D=A.getZoomLevel();
var s=A.getCenterPoint();var z=I-A.getDeviceWidth()/2;var u=G-A.getDeviceHeight()/2;var t=null;I=null;
G=null;if(E&&E.zoomLevels){D=this.checkZoomLevel(D);var w=E.zoomLevels[D].resolution;t=E.zoomLevels[D].stretchRatio;
I=s.getX()+z*w;G=s.getY()-u*w*t;if(this.wraparound){var B=A.getUniverse().getMapBounds().getWidth();if(I<-B/2){C=J+Math.floor((I+B/2)/B);
}if(I>B/2){C=J+Math.ceil((I-B/2)/B);}if(!F){if(I<-B/2){I=I-B*Math.floor((I+B/2)/B);}if(I>B/2){I=I-B*Math.ceil((I-B/2)/B);
}}var v=new e.geometry.Point(I,G,E.srid);v.setPointIndex(C);return v;}else{return new e.geometry.Point(I,G,E.srid);
}}else{return null;}},getScreenLocation:function(C){var v=e.MapContext(this);var z=v.getUniverse();if(z&&z.zoomLevels){var w=this.checkZoomLevel(v.getZoomLevel());
var u=z.zoomLevels[w].resolution;var t=z.zoomLevels[w].stretchRatio;var s=v.getCenterPoint();var B=C.getX();
var A=C.getY();var E=(B-s.getX())/u+v.getDeviceWidth()/2;var D=(s.getY()-A)/u*t+v.getDeviceHeight()/2;
return{x:Math.round(E),y:Math.round(D)};}},getMapWindowBoundingBox:function(){var s=e.MapContext(this).getDeviceWindow();
var u=this.getScreenPointLocation(0,0);var t=this.getScreenPointLocation(s.w,s.h);return e.isNull(u)?null:new e.geometry.Rectangle(u.getX(),u.getY(),t.getX(),t.getY(),t.srid);
},getMaxResolution:function(){},getMinResolution:function(){},setMaxResolution:function(){},setMinResolution:function(){},backToHomeMap:function(){var s=this.getMapContextToken();
if(e.isNull(s.homeMapZoomlevel)){s.homeMapZoomlevel=s.zoomLevel;}if(!s.homeMapCenter){s.homeMapCenter=s.centerPoint;
}this.setMapCenterAndZoomLevel(s.homeMapCenter,s.homeMapZoomlevel,true);},showProgressBar:function(t){if(t<100){this.progressBarComplete=false;
}else{if(this.progressBarComplete===true){return;}this.progressBarComplete=true;}if(typeof t==="boolean"){this.enableProgressBar=t;
if(this.enableProgressBar){t=0;}}if(this.enableProgressBar===true){this.$progressBarDiv.css("visibility","visible");
this.$progressBarSpan.css("width",this.globalMinProgress+"%");this.$progressBarSpan.css("width",t+"%");
this.globalMinProgress=t;var s=this.$progressBarDiv;if(t>=100||t===0){setTimeout(function(){s.css("visibility","hidden");
},500);}}else{this.$progressBarDiv.css("visibility","hidden");}},getLoadingPercentStatus:function(){return this.globalMinProgress;
},setLayerIndex:function(v,t){var z=this.divLayers.length;var x=this.svgLayers.length;var w=this.getLayerCurrentIndex(v);
if(w==t){return t;}var y;if(e.Map.isTileLayer(v.layerType)){if(t<=1){return this.sendToBottom(v);}else{if(t>=z){return this.bringToTop(v);
}}w--;this.divLayers.splice(w,1);this.divLayers.splice(t-1,0,v);for(var u=0;u<this.divLayers.length;u++){e.$("#tilelayer_"+this.divLayers[u].name).css({"z-index":u});
}y=new e.event.MapEvent(e.event.MapEvent.LAYER_REORDERED,this);y.affectedLayer=v;this.fire(y.type,y);
return t;}else{if(t<=z+1){return this.sendToBottom(v);}else{if(t>=z+x-2){return this.bringToTop(v);}}w=w-z-1;
var s=t-z-1;this.svgLayers.splice(w,1);this.svgLayers.splice(s,0,v);this.graphics.setDisplayIndex(v.group,s);
y=new e.event.MapEvent(e.event.MapEvent.LAYER_REORDERED,this);y.affectedLayer=v;this.fire(y.type,y);return t;
}},getLayerCurrentIndex:function(u){var t,s;if(e.Map.isTileLayer(u.layerType)){s=this.divLayers.length;
if(s===0){return -1;}for(t=0;t<s;t++){if(this.divLayers[t]==u){return t+1;}}}else{s=this.svgLayers.length;
if(s===0){return -1;}for(t=0;t<s;t++){if(this.svgLayers[t]==u){return(t+this.divLayers.length+1);}}}return -1;
},bringForward:function(v){var u=this.getLayerCurrentIndex(v);if(u<0){return;}var t=null;var w=new e.event.MapEvent(e.event.MapEvent.LAYER_REORDERED,this);
w.affectedLayer=v;if(e.Map.isTileLayer(v.layerType)){if(this.divLayers[this.divLayers.length-1]==v){this.fire(w.type,w);
return this.divLayers.length-1;}t=this.divLayers[u];this.divLayers[u]=v;this.divLayers[u-1]=t;for(var s=0;
s<this.divLayers.length;s++){e.$("#tilelayer_"+this.divLayers[s].name).css({"z-index":s});}this.fire(w.type,w);
return(u+2);}else{if(this.svgLayers.length<3){return;}if(this.svgLayers[this.svgLayers.length-3]==v){this.fire(w.type,w);
return(this.svgLayers.length-3+this.divLayers.length);}t=this.svgLayers[u-this.divLayers.length];this.svgLayers[u-this.divLayers.length]=v;
this.svgLayers[u-1-this.divLayers.length]=t;this.graphics.bringForward(v.group);this.fire(w.type,w);return(u+2);
}},sendBackward:function(v){var u=this.getLayerCurrentIndex(v);if(u<0){return;}var w=new e.event.MapEvent(e.event.MapEvent.LAYER_REORDERED,this);
w.affectedLayer=v;var t=null;if(e.Map.isTileLayer(v.layerType)){if(this.divLayers[0]==v){this.fire(w.type,w);
return 0;}t=this.divLayers[u-2];this.divLayers[u-2]=v;this.divLayers[u-1]=t;for(var s=0;s<this.divLayers.length;
s++){e.$("#tilelayer_"+this.divLayers[s].name).css({"z-index":s});}this.fire(w.type,w);return(u);}else{if(this.svgLayers[0]==v){this.fire(w.type,w);
return(0+this.divLayers.length);}t=this.svgLayers[u-this.divLayers.length-2];this.svgLayers[u-2-this.divLayers.length]=v;
this.svgLayers[u-1-this.divLayers.length]=t;this.graphics.sendBackward(v.group);this.fire(w.type,w);return(u);
}},bringToTop:function(v,s){var u=this.getLayerCurrentIndex(v,s);if(u<0){return;}var w=new e.event.MapEvent(e.event.MapEvent.LAYER_REORDERED,this);
w.affectedLayer=v;if(e.Map.isTileLayer(v.layerType)){if(this.divLayers[this.divLayers.length-1]==v){this.fire(w.type,w);
return this.divLayers.length;}this.divLayers.splice(u-1,1);this.divLayers.push(v);for(var t=0;t<this.divLayers.length;
t++){e.$("#tilelayer_"+this.divLayers[t].name).css({"z-index":t});}this.fire(w.type,w);return(this.divLayers.length);
}else{var x=this.divLayers.length;if(this.svgLayers[this.svgLayers.length-2]==v){if(!s){this.fire(w.type,w);
}return(this.svgLayers.length+x);}if(s){this.svgLayers.splice(u-x-1,1);this.svgLayers.push(v);}else{this.svgLayers.splice(u-x-1,1);
this.svgLayers.splice(this.svgLayers.length-2,0,v);}if(!v.group){return;}this.graphics.bringToTop(v.group);
if(!s){this.graphics.bringToTop(this.getDefaultFeatureLayer().group);this.graphics.bringToTop(this.getToolFeatureLayer().group);
this.fire(w.type,w);}return(this.svgLayers.length+x);}},sendToBottom:function(u){var t=this.getLayerCurrentIndex(u);
if(t<0){return;}var v=new e.event.MapEvent(e.event.MapEvent.LAYER_REORDERED,this);v.affectedLayer=u;if(e.Map.isTileLayer(u.layerType)){if(this.divLayers[0]==u){this.fire(v.type,v);
return 1;}this.divLayers.splice(t-1,1);this.divLayers.splice(0,0,u);for(var s=0;s<this.divLayers.length;
s++){e.$("#tilelayer_"+this.divLayers[s].name).css({"z-index":s});}this.fire(v.type,v);return 1;}else{var w=this.divLayers.length;
if(this.svgLayers.length>2&&this.svgLayers[0]==u){this.fire(v.type,v);return(1+w);}if(this.svgLayers.length<2){return -1;
}this.svgLayers.splice(t-w-1,1);this.svgLayers.splice(0,0,u);this.graphics.sendToBottom(u.group);this.fire(v.type,v);
return(1+w);}},setInfoWindowStyle:function(s){this.infoWindowOptions=s;},displayInfoWindow:function(t,x,v){if(this.infoWindowOptions){var u=this.infoWindowOptions;
e.$.each(u,function(y,z){if(!v[y]){v[y]=z;}});}if(!this.infoLayer){this.infoLayer=new e.infowindow.InfoWindow(this,"1",v);
this.tab=false;}if(!t||!x){return null;}var s=this;var w=function(){var A=s.getMapContext().getUniverse();
s.deleteListener(e.event.MapEvent.MAP_INITIALIZED,w);var y=v?v:{};y.universe=A;var z=function(B){if(B){t=B;
}s.infoLayer.showInfoWindow(x,t,v);};if(A.srid!=t.srid){t.transform(A.srid,z);}else{z();}};if(s.initialized){w();
}else{this.on(e.event.MapEvent.MAP_INITIALIZED,w);}},displayTabbedInfoWindow:function(t,v,u){if(!this.infoLayer){this.infoLayer=new e.infowindow.InfoWindow(this,"1",u);
this.tab=true;}if(!t||!v){return null;}var s=this;var x=this.getMapContext().getUniverse();var w=function(){s.deleteListener(e.event.MapEvent.MAP_INITIALIZED,w);
var y=u?u:{};y.universe=x;var z=function(A){if(A){t=A;}s.infoLayer.showTabInfoWindow(t,v,u);};if(x.srid!=t.srid){t.transform(x.srid,z);
}else{z();}};if(s.initialized){w();}else{this.on(e.event.MapEvent.MAP_INITIALIZED,w,this);}},printReset:function(){this.$oracleMapDiv[0].className="";
if(this.$printMapDiv){this.$printMapDiv.empty();}},getLabelGridBox:function(y){var v=this.getMapContext();
var z=v.getUniverse();var x=v.getZoomLevel();var w=z.getZoomLevels();if(!y){y=x;}var s=w[x];var u=z.bound;
var t=u.getWidth()/s.resolution;var A=u.getHeight()/s.resolution/s.stretchRatio;return{minX:0,minY:0,maxX:t,maxY:A};
},refreshVectorLayerLabels:function(){if(!this.svgLayers||this.svgLayers.length<=0){return;}var v=false;
var s=this.svgLayers.length;var u,t;for(u=0;u<s;u++){if(this.svgLayers[u].labelsVisible()){v=true;break;
}}if(!v){return;}this.grid.clear();for(u=0;u<s;u++){t=this.svgLayers[u];if(t.labelsVisible()){t.clearAllLabels();
}t.addMarkerBoundToGrid();}for(u=s-1;u>-1;u--){t=this.svgLayers[u];if(t.isVisible()&&t.labelsVisible()){t.addLabels();
}}},getLayerByName:function(t){var s=this.svgLayers.length;while(s--){if(this.svgLayers[s].name===t){return this.svgLayers[s];
}}s=this.divLayers.length;while(s--){if(this.divLayers[s].name===t){return this.divLayers[s];}}},getFeatureLayers:function(){return this.svgLayers;
},getTileLayers:function(){return this.divLayers;},getDefaultFeatureLayer:function(){if(!e.gv.internalLayersEnabled){return{};
}if(e.notNull(this.defaultFeatureLayer)){this.defaultFeatureLayer.bringToTop(true);return this.defaultFeatureLayer;
}else{this.defaultFeatureLayer=new e.layer.VectorLayer("ii_oracle_maps_internal_editing",{def:{type:e.layer.VectorLayer.TYPE_LOCAL}});
this.defaultFeatureLayer.selectionEnable=false;this.defaultFeatureLayer.setBringToTopOnMouseOver(false);
this.addLayer(this.defaultFeatureLayer);return this.defaultFeatureLayer;}},getToolFeatureLayer:function(){if(!e.gv.internalLayersEnabled){return{};
}if(e.notNull(this.toolFeatureLayer)){this.toolFeatureLayer.bringToTop(true);if(this.defaultFeatureLayer){this.getDefaultFeatureLayer();
}return this.toolFeatureLayer;}else{this.toolFeatureLayer=new e.layer.VectorLayer("ii_oracle_maps_internal_others",{def:{type:e.layer.VectorLayer.TYPE_LOCAL}});
this.toolFeatureLayer.selectionEnable=false;this.toolFeatureLayer.setBringToTopOnMouseOver(false);this.toolFeatureLayer.enableFeatureEditing(true);
this.addLayer(this.toolFeatureLayer);this.getDefaultFeatureLayer();return this.toolFeatureLayer;}},touchStart:function(t){t.preventDefault();
var z=e.util.DomUtil;this.touchCount=z.getTouchCount(t);if(this.touchCount>2){return;}this.pinchZoomScale=1;
var B=this.touchStartLocs;if(this.touchCount==1){var y=z.getTouchesPosition(t);B.length=0;B.push(y);var x=this.lastTouchTimeStamp;
var w=t.timeStamp;this.lastTouchTimeStamp=w;if(w-x<500&&this.initialized){this.doubleTap=true;t.preventDefault();
}else{this.doubleTap=false;}this.tStartLocsX=B[0].x;this.tStartLocsY=B[0].y;}else{if(this.touchCount==2){var A=z.getChangedTouchesPosition(t);
if(A.length==1){B.push(A[0]);}else{if(A.length==2){B.length=0;B.push(A[0]);B.push(A[1]);}}this.doubleTap=false;
}}if(B.length==2){var v=B[1].x-B[0].x;var u=B[1].y-B[0].y;this.pinchZoomStartDist=Math.sqrt(v*v+u*u);
}this.moveflag=true;var s=this.$oracleMapDiv.offset();this.mLocX=B[0].x-s.left;this.mLocY=B[0].y-s.top;
},touchMove:function(s){s.preventDefault();if(this.touchStartLocs.length===0){return;}var C=e.util.DomUtil;
var t=this.$oracleMapDiv.offset();this.mLocX=this.touchStartLocs[0].x-t.left;this.mLocY=this.touchStartLocs[0].y-t.top;
if(this.touchCount==2||C.getTouchesPosition(s).length){var A=C.getTouchesScale(s);if(e.isNull(A)){var v=C.getTouchesPosition(s);
var w=v[0].x-v[1].x;var u=v[0].y-v[1].y;var D=Math.sqrt(w*w+u*u);A=D/this.pinchZoomStartDist;}this.pinchZoomScale=A;
if(A==1||A<=0){return;}var z=this.getMapZoomLevel();if(A>1&&z>=this.maxZoom){return;}else{if(A<1&&z<=0){return;
}}this.pinchZooming=true;this.graphics.setVisible(this.draggableGroup,false);this.$heatMapDiv.css({visibility:"hidden"});
this.$customLayersDiv.css({visibility:"hidden"});for(var B=0;B<this.divLayers.length;B++){if(this.divLayers[B].zoomControl){this.divLayers[B].zoomControl.scaleTiles(A);
}}return;}var E=C.getTouchesPosition(s);var y=E.x-this.touchStartLocs[0].x;var x=E.y-this.touchStartLocs[0].y;
this.touchStartLocs[0].x=E.x;this.touchStartLocs[0].y=E.y;if(this.moveflag&&this.enableMapAction.drag){this.pan(y,x,false);
}},touchEnd:function(t){t.preventDefault();this.touchCount-=e.util.DomUtil.getTouchCount(t);if(this.touchCount>0){return;
}var v=this.pinchZoomScale;if(this.pinchZooming){var s=this.getScaleZoomLevel(v);this.setMapZoomLevel(s);
this.pinchZoomScale=1;this.pinchZooming=false;this.graphics.setVisible(this.draggableGroup,true);this.$heatMapDiv.css({visibility:"visible"});
this.$customLayersDiv.css({visibility:"visible"});this.doubleTap=false;}else{var u;if(this.doubleTap&&this.enableMapAction.dbclick){this.setMapCenterAndZoomLevel(this.getCursorLocation(),e.MapContext(this).getZoomLevel()+1,true);
t.preventDefault();}else{if(this.moveflag){this.moveflag=false;u=new e.event.MapEvent(e.event.MapEvent.MAP_RECENTERED,this);
this.fire(u.type,u);}}if(this.touchStartLocs.length===1&&this.touchStartLocs[0]&&((this.tStartLocsX-this.touchStartLocs[0].x)===0)&&((this.tStartLocsY-this.touchStartLocs[0].y)===0)){u=new e.event.MapEvent(e.event.MouseEvent.MOUSE_CLICK,this);
this.fire(u.type,u);}}this.touchStartLocs.length=0;},getScaleZoomLevel:function(v){var y=this.getMapContext();
var w=y.getZoomLevel();if(v>0&&(v<1&&v>0.9||v>1&&v<1.1)){return w;}var A=y.getUniverse().getZoomLevels();
var D=A.length-1;var s=A[w];var C=s.resolution;var B=C/v;var z,u,x,t;if(v<1){for(z=w-1;z>=0;z--){u=A[z].resolution;
if(B<=u){x=B/A[z+1].resolution;t=u/B;if(x>t){return z;}break;}}return z+1;}else{for(z=w+1;z<=D;z++){u=A[z].resolution;
if(B>=u){x=A[z-1].resolution/B;t=B/u;if(x>t){return z;}break;}}return z-1;}},cleanMap:function(){this.displayed=false;
this.initialized=false;var u=new e.event.MapEvent(e.event.MapEvent.MAP_CLEAN,this);this.fire(u.type,u);
var t=0;if(this.graphics){this.graphics.clearGroup(this.draggableGroup);this.graphics.clearGroup(this.blockerGroup);
this.graphics.clearGroup(this.fixedGroup);for(t=0;t<this.svgLayers.length;t++){this.graphics.clearGroup(this.svgLayers[t].group);
}}this.$customLayersDiv.empty();this.$tileLayersDiv.empty();this.$fkGraphicLayersDiv.unbind();for(t=0;
t<this.decorationArray.length;t++){var s=this.decorationArray[t];if(s.type=="OverviewMap"){s.$DecorationBtnDiv.remove();
s.$DecorationDiv.remove();}}},checkCenter:function(){if(!this.overview&&this.hasExternal){return;}var z=this.getMapContextToken();
var y=z.universe;var x=z.zoomLevel;var v=y.zoomLevels[x].resolution;var u=y.zoomLevels[x].stretchRatio;
var w=y.bound;if(!z.homeCenter){z.homeCenter=new e.geometry.Point((w.getMinX()+w.getMaxX())/2,(w.getMinY()+w.getMaxY())/2,y.srid);
}z.centerPoint=z.homeCenter.clone();if(this.wraparound){z.roundMapCenterPoint=z.homeCenter.clone();}var t=z.centerPoint;
var C=z.deviceWindow;var E=t.getX()-C.w/2*v;var B=t.getX()+C.w/2*v;var D=t.getY()-C.h/2*v*u;var A=t.getY()+C.h/2*v*u;
var G={x:true,y:true};var s=z.centerPoint.getX();var F=z.centerPoint.getY();if(!this.wraparound){if(E<w.getMinX()&&B>w.getMaxX()||B-E>w.getWidth()){s=(w.getMinX()+w.getMaxX())/2;
}else{if(E<w.getMinX()){s=w.getMinX()+C.w/2*v;}else{if(B>w.getMaxX()){s=w.getMaxX()-C.w/2*v;}else{G.x=false;
}}}}if(D<w.getMinY()&&A>w.getMaxY()||A-D>w.getHeight()){F=(w.getMinY()+w.getMaxY())/2;}else{if(D<w.getMinY()){F=w.getMinY()+C.h/2*v*u;
}else{if(A>w.getMaxY()){F=w.getMaxY()-C.h/2*v*u;}else{G.y=false;}}}z.centerPoint.setPoint(s,F);if(this.wraparound){z.roundMapCenterPoint.setPoint(s,F);
}return G;},resetUniverse:function(B,D){var A=this.getMapContextToken();if(A.universe.srid!==B.srid){this.iterateVectorLayers(function(E){E.rtree=null;
});}A.universe=B;A.transform=null;this.graphics.setLeftTop(this.draggableGroup,0,0);var z=this.divLayers.length;
var x=D.getZIndex()-1;while(x>0){this.removeLayer(this.divLayers[0]);x--;}this.universeLayerIndex=0;z=this.svgLayers.length;
for(var v=0;v<z;v++){var w=this.svgLayers[v];w.dataLoaded=false;w.loaded=false;w.heatMap=null;if(w.renderingStyle&&w.renderingStyle.styleType=="HeatMap"&&w.renderingStyle.containerVectorLayer){w.renderingStyle.containerVectorLayer.dataLoaded=false;
}if(w.boundingTheme){w.loadedBoundingTheme=false;}}var y=A.universe;if(this.overview){var t=this.overview.submap.getMapContextToken();
var C=t.universe;if(this.overview.submap){C.zoomLevels=y.zoomLevels;C.srid=y.srid;C.bound=y.bound;if(this.overview.layer&&this.overview.layer.parentMap){var u=this.overview.layer;
if(u.copyFeatures){this.overview.mainmap.overviewLayer.deleteListener(e.event.LayerEvent.FEATURES_LOADED,u.copyFeatures);
}this.overview.submap.removeLayer(this.overview.layer);}var s=this;A.centerPoint.transform(A.universe.srid,function(E){A.centerPoint=E;
t.centerPoint=A.centerPoint;t.homeCenter=A.centerPoint;t.zoomLevel=A.zoomLevel-s.overview.calMapZoomDiff();
});}}this.boundingThemeLoading=false;this.boundingThemeLoaded=false;this.boundingLayerName=null;this.extentRect=null;
this.resetTag=true;this.init();},getMapAsSVG:function(u){var B=this.graphics;var C=B.oui;var x=C.viewportBounds;
var t=x.width;var E=x.height;var z=this.divLayers.length;var s=this;var w=B.createGroup({x:0,y:0});var y;
for(y=0;y<z;y++){this.divLayers[y].exportToSVG(w,t,E);}var A=[w,this.draggableGroup];for(y=0;y<this.decorationArray.length;
y++){var v=this.decorationArray[y];if(v instanceof e.control.ScaleBar||v instanceof e.control.CopyRight){if(v.defaultGroup){A.push(v.defaultGroup);
}}}var D=function(){if(!s.graphics){return;}for(var G=0;G<z;G++){if(s.divLayers[G].loadImg!==0){h.setTimeout(D,200);
return;}}var F=new C.io.svg.SVGExporter().snapshotNodes(A,x,t,E);F.style="overflow:hidden";var I=C.io.XMLConverter.convert(F,"");
B.clearGroup(w);u(I);};h.setTimeout(D,0);},getFlattenedCanvas:function(z,u,A,B){var y=this.graphics.oui;
var s=y.viewportBounds;var x=Math.round(s.width),v=Math.round(s.height);if(!u){u=x;}if(!A){A=v;}B=B||{};
B.navigationPanelBar=B.navigationPanelBar||false;if(B.scaleBar===f){B.scaleBar=true;}if(B.copyRight===f){B.copyRight=true;
}this.getTileCanvas(u,A);var t=this;this.drawVectorInPrintCanvas(u,A,function(w){t.drawImageEnd(u,A,w,function(C){var D=e.$("#printVC"+t.mapInstanceId);
D.remove();z(C);});},B);},getTileCanvas:function(t,v){for(var u=0,s=this.divLayers.length;u<s;u++){if(this.divLayers[u].isVisible()){this.divLayers[u].canvas=document.createElement("canvas");
this.divLayers[u].canvas.width=t;this.divLayers[u].canvas.height=v;this.divLayers[u].drawTilesImages(t,v);
}}},drawVectorInPrintCanvas:function(B,M,x,u){var Q=e.$("<div id ='printVC"+this.mapInstanceId+"' style='visibility:hidden;width:"+B+"px;height:"+M+"px'></div>");
e.$(document.body).append(Q);var E=this;var O=new e.Map(Q[0],{universe:this.getMapContext().getUniverse()});
var y=this.svgLayers.length;var P=0;for(var J=0,L=this.svgLayers.length;J<L;J++){var I=this.svgLayers[J];
if(I.isVisible()){if(I.clustering&&I.dataBufferWindow){var s=I.maxClusteringLevel;var K=I.vCluster.minPointCount;
var v=I.vCluster.threshold;var C=I.vCluster.clusterStyle;var t=I.zoomInLevels;var R;if(t===false||t===0){t=0;
R=false;}else{R=true;}I=I.clone();if(typeof C!=="undefined"){var A=C.marker;A=new e.style.VariableMarker(C.origConfig);
I.enableClustering(true,{clusterStyle:A,minPointCount:K,maxClusteringLevel:s,threshold:v,enableZoomIn:R,zoomInLevels:t});
}else{e.util.Logger.severe("CLUSTER_ERROR","OM.Map","Cluster configuration lost");}}else{I=I.clone();
}O.addLayer(I);P++;}else{y--;}}O.setMapCenter(this.getMapCenter());O.setMapZoomLevel(this.getMapZoomLevel());
for(var G=0;G<E.decorationArray.length;G++){var D=E.decorationArray[G];if(u.navigationPanelBar&&D instanceof e.control.NavigationPanelBar&&D.isVisible()){var z=new e.control.NavigationPanelBar({orientation:D.orientation,style:D.style,anchorPosition:D.anchorPosition});
z.setStyle({position:D.position,backgroundColor:D.backgroundColor,buttonColor:D.buttonColor});O.addMapDecoration(z);
}else{if(u.scaleBar&&D instanceof e.control.ScaleBar&&D.isVisible()){var N=new e.control.ScaleBar({format:D.format,anchorPosition:D.anchorPosition});
N.setStyle({fontSize:D.fontSize,scalebar_color:D.scalebar_color,thickness:D.thickness,maxLength:D.maxLength});
O.addMapDecoration(N);}else{if(u.copyRight&&D instanceof e.control.CopyRight&&D.isVisible()){var F=new e.control.CopyRight({textValue:D.textValue,anchorPosition:D.anchorPosition,fontSize:D.fontSize,fontFamily:D.fontFamily,fill:D.fontColor});
O.addMapDecoration(F);}}}}O.on(e.event.MapEvent.MAP_AFTER_REFRESH,function(){O.getVectorCanvas(B,M,x,u);
});O.init();},getVectorCanvas:function(A,J,y,v){var u=document.createElement("canvas");u.width=A;u.height=J;
var E=u.getContext("2d");var G,I;for(G=0,I=this.svgLayers.length;G<I;G++){var F=this.svgLayers[G];if(F.checkVisible()&&F.heatMap){var M=F.getHeatmapDivId()+">canvas";
var t=e.$(M)[0];E.drawImage(t,t.offsetLeft,t.offsetTop);}}var z=this.$fkGraphicLayersDiv.children()[0];
if(z.tagName=="CANVAS"){var s=[];for(G=0;G<this.decorationArray.length;G++){var C=this.decorationArray[G];
if((v&&v.navigationPanelBar===false&&C instanceof e.control.NavigationPanelBar&&C.isVisible())||(v&&v.scaleBar===false&&C instanceof e.control.ScaleBar&&C.isVisible())||(v&&v.copyRight===false&&C instanceof e.control.CopyRight&&C.isVisible())){C.setVisible(false);
s.push(C);}}setTimeout(function(){E.drawImage(z,z.offsetLeft,z.offsetTop);var w=s.pop();while(w){w.setVisible(true);
w=s.pop();}y(u);},50);}else{var D=[this.draggableGroup,this.fixedGroup];var L=this.graphics.oui;var B=new L.io.svg.SVGExporter().snapshotNodes(D,L.viewportBounds,A,J);
B.style="overflow:hidden";var x=L.io.XMLConverter.convert(B,"");try{E.drawSvg(x,0,0,A,J);}catch(K){e.util.Logger.alert("MAPVIEWER_9040","OM.Map.getMapAsImage");
}y(u);}},drawImageEnd:function(s,v,u,A){var t=document.createElement("canvas");t.width=s;t.height=v;var z=t.getContext("2d");
var x=this;var y=function(){for(var B=0,w=x.divLayers.length;B<w;B++){if(x.divLayers[B].canvas&&x.divLayers[B].loadingImg){setTimeout(y,100);
return;}}for(B=0,w=x.divLayers.length;B<w;B++){if(x.divLayers[B].canvas){z.drawImage(x.divLayers[B].canvas,0,0);
}}z.drawImage(u,0,0);A(t);};setTimeout(y,100);},getMapAsServerImage:function(w,v,s,u){var t=this.mapviewerURL+"/omserver";
this.getMapAsXML("GIF_URL",function(x){var y={xml_request:x};e.util.HttpRequest.send(t,y,function(B){var A=e.$(B).find("map_content");
if(e.isNull(A)){e.util.Logger.alert("MAPVIEWER_9009","OM.Map.getMapAsServerImage",x);return;}var z=A.attr("url");
w(z);},"xml");},v,s,u);},deleteFeatureInfoWindow:function(s){if(this.infoLayer){this.infoLayer.deleteInfoWindowById(s);
}},getMapAsXML:function(B,C,s,D,I){var v=e.MapContext(this);if(!B){B="GIF_URL";}var y=v.getUniverse().getMapBounds().getWidth();
if(v.getQueryWindow().getMinX()<-y/2||v.getQueryWindow().getMaxX()>y/2){var F=v.getZoomLevel();s=this.getLabelGridBox(F).maxX;
}if(!s){s=v.getDeviceWidth();}if(!D){D=v.getDeviceHeight();}var t='<?xml version="1.0" standalone="yes"?>';
t=t+'<map_request datasource="'+e.gv.defaultDataSource+'" format="'+B+'" width="'+s+'" height="'+D+'" antialiase="true" transparent="true" srid="'+v.getUniverse().getSRID()+'"';
var u=false;var E;for(var x=this.divLayers.length-1;x>-1;x--){var z=this.divLayers[x];if(z.isVisible()){if(z.getStaticMapURL){u=true;
E=z.getStaticMapURL(s,D);break;}}}I=I||{};I.navigationPanelBar=I.navigationPanelBar||false;if(I.scaleBar===f){I.scaleBar=true;
}if(I.copyRight===f){I.copyRight=true;}var G=v.getQueryWindow().getHeight();var A=this.getMapCenter();
var w='<center size="'+G+'"><geoFeature><geometricProperty typeName="center"><Point><coordinates>'+A.getX()+","+A.getY()+"</coordinates></Point></geometricProperty></geoFeature></center>";
if(u){E=E.replace(/&/g,"&amp;");this.drawVectorInPrintCanvas(s,D,function(J){t+=' bgimage="'+E+'"';t+=' bgimage2="'+J.toDataURL()+'">';
t+=w+"</map_request>";C(t);},I);}else{this.getFlattenedCanvas(function(J){t+=' bgimage="'+J.toDataURL()+'">';
t+=w+"</map_request>";C(t);},s,D,I);}},print:function(){e.$(document.body).css("cursor","wait");this.$oracleMapDiv.css("cursor","wait");
var s=this;this.getMapAsSVG(function(u){e.$(document.body).css("cursor","");s.$oracleMapDiv.css("cursor","");
var t=h.open();t.document.write(u);t.print();});},enableMapDrag:function(s){this.enableMapAction.drag=s;
},enableMapWraparound:function(s){this.wraparound=s;},enableMouseWheelZooming:function(s){this.enableMapAction.mousewheel=s;
},enableMapZoom:function(s){this.zoomEnabled=s;if(this.overview){this.overview.enableOverViewMapZoom(s);
}},enableDoubleClick:function(s){this.enableMapAction.dbclick=s;},setMouseWheelZoomBehavior:function(s){this.mouseWheelZoomBehavior=s;
},setHomeMap:function(s,t){var u=this.getMapContextToken();if(s){u.homeMapCenter=s;}if(t){u.homeMapZoomlevel=t;
}},enableZoomAnimation:function(s){this.tileLayerZoomAnimation=s;},setEnabledZoomLevels:function(A){if(this.universe){this.getMapContextToken().universe=this.universe;
}if(!e.util.ValidationUtil.isNumberArray(A)){return;}A.sort(function s(C,B){return C-B;});this.enableZoomLevels=A;
if(this.divLayers.length===0&&this.svgLayers.length>2){var u={};var w=[];var v;var t;var z=this.getMapContext().getUniverse().getZoomLevels().length;
for(var x=0;x<this.enableZoomLevels.length;x++){if(z-1<this.enableZoomLevels[x]){v=this.getMapContext().getUniverse().getZoomLevels()[z-1].resolution;
t=this.getMapContext().getUniverse().getZoomLevels()[z-1].stretchRatio;}else{v=this.getMapContext().getUniverse().getZoomLevels()[this.enableZoomLevels[x]].resolution;
t=this.getMapContext().getUniverse().getZoomLevels()[this.enableZoomLevels[x]].stretchRatio;}w[x]=new e.universe.ZoomLevel(v,{stretchRatio:t});
}u.zoomLevels=w;u.srid=this.getMapContext().getUniverse().getSRID();u.bounds=this.getMapContext().getUniverse().getMapBounds();
u.numberOfZoomLevels=this.enableZoomLevels.length;var y=new e.universe.Universe(u);this.universe=this.getMapContext().getUniverse();
this.getMapContextToken().universe=y;}},enableInfoWindowEventPropagation:function(s){this.infoWindowEventPropogation=s;
},closeInfoWindows:function(){if(this.infoLayer){this.infoLayer.closeInfoWindows();}},replaceLayer:function(u,x){for(var w=0,t=this.divLayers.length;
w<t;w++){if(this.divLayers[w]==u){this.divLayers[w]=x;x.parentMap=this;this.overviewLayer=x;var s=e.event.MapEvent,v=e.event.LayerEvent;
this.on(s.I_MAP_DRAGGING,x.panEvent,x);this.on(s.MAP_RECENTERED,x.recenter,x);this.on(s.I_MAP_CENTER_ZOOM,x.setCenterAndZoomlevel,x);
this.on(s.MAP_BEFORE_REFRESH,x.refreshEvent,x);this.on(s.MAP_REDRAW,x.redraw,x);this.on(s.MAP_DESTROY,x.destroy,x);
x.addListener(v.FINISH_GOT_CONFIG,this.newLayerConfigLoaded);x.addListener(v.FINISH_LOAD,this.layerFinish);
x.addListener(v.ALL_TILES_LOADED,this.layerFinish);x.addListener(v.INIT_ERROR,this.layerErr);x.addListener(v.RENDERING_STYLE_CHANGED,this.layerStyleChanged);
x.addListener(v.NSDP_MAPPED,this.nsdpMapped);if(x.setContainer){x.setContainer(this.$tileLayersDiv[0]);
}this.deleteLayerListener(u);break;}}},setAllInitialParams:function(){var s=this.getMapContextToken();
if(e.isNull(s.centerPoint)){s.centerPoint=new e.geometry.Point((s.universe.bound.getMinX()+s.universe.bound.getMaxX())/2,(s.universe.bound.getMinY()+s.universe.bound.getMaxY())/2,s.universe.srid);
}if(e.isNull(s.homeCenter)){s.homeCenter=s.centerPoint;}if(e.isNull(s.zoomLevel)){s.zoomLevel=0;}if(!s.homeMapCenter){s.homeMapCenter=s.centerPoint;
}if(!s.homeMapZoomlevel){s.homeMapZoomlevel=s.zoomLevel;}},changeOverView:function(){if(this.userSetOL||!this.overview){return;
}for(var u=this.divLayers.length-1;u>=0;u--){if(e.notNull(this.divLayers[u].tileLayerConfig)&&!this.divLayers[u].tileLayerConfig.isTransparentImage){if(this.overviewLayer!==this.divLayers[u]){if(this.divLayers[u].layerType!==e.LayerTypes.DYNAMIC_TILE||this.divLayers[u].hideInOverviewMap===false){if(this.divLayers[u].isVisible()){this.overviewLayer=this.divLayers[u];
this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer});return;}}}}}if(this.divLayers.length>0){if(this.overviewLayer!==this.divLayers[0]){this.overviewLayer=this.divLayers[0];
this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer});}}else{if(this.svgLayers.length>2){for(var t=0,s=this.svgLayers.length;
t<s;t++){if(this.svgLayers[t]!=this.toolFeatureLayer&&this.svgLayers[t]!=this.defaultFeatureLayer){if(this.overviewLayer!==this.svgLayers[t]){this.overviewLayer=this.svgLayers[t];
this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer});}return;}}}}},addVectorLayerByURL:function(s,t,u){this.addLayer(new e.layer.VectorLayer(this.generateLayerName(),{def:{type:e.layer.VectorLayer.TYPE_DATAPACK,url:s},renderingStyle:t,boundingTheme:u}),"URL_Layer");
},generateLayerName:(function(){var s=0;return function(){return"URL_Layer_"+(++s);};}()),enableURLDragDrop:function(t,s){this.drapDrop=t;
if(s){if(s.style){this.ddStyle=s.style;}if(s.zoomToTheme){this.ddZoom=s.zoomToTheme;}}},setMouseCursorStyle:function(s,t){if(s=="hand"){s=e.CursorTypes.POINTER;
}if(t=="dragging"){this.cursorStyleDragging=s;}else{if(t=="default"){this.cursorStyleDefault=s;this.changeCursor(s);
}}},changeCursor:function(s){this.$oracleMapDiv.css("cursor",s);if(this.graphics.oui&&this.graphics.oui.tree&&this.graphics.oui.tree.canvas){this.graphics.oui.tree.canvas.style.cursor=s;
}},isStoppedEvent:function(s){if(s.type&&e.event.EventSource.stopEvents[s.type]){e.event.EventSource.stopEvents[s.type]=false;
return true;}return false;},setStoppedEvent:function(s){if(e.notNull(s)){e.event.EventSource.stopEvents[s]=true;
}},setTooltipStyle:function(s){if(e.notNull(s)){var t={border:{},text:{},padding:{}};var u={titleStyle:{},headerStyle:{},contentStyle:{}};
if(e.notNull(s.titleStyle)){u.titleStyle=s.titleStyle;if(s.titleStyle.hAlign=="LEFT"){u.titleStyle.hAlign=0;
}else{if(s.titleStyle.hAlign=="CENTER"){u.titleStyle.hAlign=0.5;}else{u.titleStyle.hAlign=1;}}}if(e.notNull(s.headerStyle)){u.headerStyle=s.headerStyle;
if(s.headerStyle.hAlign=="LEFT"){u.headerStyle.hAlign=0;}else{if(s.headerStyle.hAlign=="CENTER"){u.headerStyle.hAlign=0.5;
}else{u.headerStyle.hAlign=1;}}}if(e.notNull(s.contentStyle)){u.contentStyle=s.contentStyle;if(s.contentStyle.hAlign=="LEFT"){u.contentStyle.hAlign=0;
}else{if(s.contentStyle.hAlign=="CENTER"){u.contentStyle.hAlign=0.5;}else{u.contentStyle.hAlign=1;}}}if(e.notNull(s.opacity)){t.opacity=s.opacity;
}if(e.notNull(s.background)){t.background=s.background;}if(e.notNull(s.padding)){t.padding=s.padding;
}if(e.notNull(s.borderColor)){t.border.stroke=s.borderColor;}if(e.notNull(s.textColor)){t.text.fill=s.textColor;
}if(e.notNull(s.rx)){t.border.rx=s.rx;}if(e.notNull(s.ry)){t.border.ry=s.ry;}if(e.notNull(s.fontSize)){t.text.fontSize=s.textSize;
}if(e.notNull(s.fontWeight)){t.text.fontWeight=s.fontWeight;}if(e.notNull(s.strokeThickness)){t.border.strokeThickness=s.strokeThickness;
}if(e.notNull(s.shadow)){t.shadow=s.shadow;}else{t.shadow=null;}this.graphics.setTooltipStyle(t);this.graphics.storeCustomTooltipTextStyle(u);
}},appendUTFGridLayerHTML:function(s){if(e.isNull(this.utfgridHTMLArray)){e.util.Logger.warning("","OM.Map.appendUTFGridLayerHTML","the utfgrid html array has not be instantiated.");
return;}this.utfgridHTMLArray.push(s);}});e.Map.setProxyPath=function(s){if(s&&s.indexOf("/")===0){e.gv.proxyPath=s;
}};e.Map.getProxyPath=function(){return e.gv.proxyPath;};e.Map.isTileLayer=function(s){return s===e.LayerTypes.TILE||s===e.LayerTypes.DYNAMIC_TILE||s===e.LayerTypes.EXTERNAL;
};e.Map.setErrorHandler=function(s){e.util.Logger.errorHandler=s;};e.Map.setAPIKey=function(s,u){var t=e.util.HttpRequest.getDomain(u);
e.gv.mvKeyMap[t]=s;};e.Map.setLocale=function(u,t){var s;if(e.notNull(t)){s=u+"-"+t;}else{s=u;}e.gv.loadMessage(s);
};e.Map.ZOOM_KEEP_MOUSE_POINT=1;e.Map.ZOOM_CENTER_ON_MOUSE=2;e.Map.ZOOM_KEEP_CENTER=3;e.server.ServerMapRequest=e.Class.extend({initialize:function(s){if(e.isNull(s)){s="http://"+document.location.host+"/mapviewer";
}this.baseURL=s;this.datasource=null;this.antialiase=null;this.transparent=null;this.bgcolor=null;this.basemap=null;
this.themesArray=[];this.stylesArray=[];this.width=null;this.height=null;this.isclienttilereq=null;this.tileServerURL=null;
this.format=null;this.enableUTFGrid=null;this.grid_res=4;this.minX=null;this.minY=null;this.maxX=null;
this.maxY=null;this.srid=null;},setImageFormat:function(s){this.format=s;},setImageWidth:function(s){this.width=s;
},setImageHeight:function(s){this.height=s;},setBasemap:function(s){this.basemap=s;},setUTFGridResolution:function(s){this.grid_res=s;
},setClientTileRequest:function(s){this.isclienttilereq=s;},setBBox:function(u,s,w,v,t){this.minX=u;this.minY=s;
this.maxX=w;this.maxY=v;this.srid=e.notNull(t)?t:8307;},setEnableUTFGrid:function(s){this.enableUTFGrid=s;
},setMapServerURL:function(s){this.baseURL=s;},validateTheme:function(u){if(e.notNull(this.themesArray)&&this.themesArray.length>0){for(var t=0,s=this.themesArray.length;
t<s;t++){if(u.name===this.themesArray[t].name){e.util.Logger.warning("MAPVIEWER_9085","OM.server.ServerMapRequest","Theme ["+u.name+"] already existed.");
return false;}}}return true;},validateStyle:function(u){if(e.notNull(this.stylesArray)&&this.stylesArray.length>0){for(var t=0,s=this.stylesArray.length;
t<s;t++){if(u.styleName===this.stylesArray[t].styleName){e.util.Logger.warning("MAPVIEWER_9086","OM.server.ServerMapRequest","Style ["+u.styleName+"] already existed.");
return false;}}}return true;},addTheme:function(s){if(e.notNull(s)&&Object.prototype.toString.call(s)==="[object Object]"){if(this.validateTheme(s)){this.themesArray.push(s);
}}else{e.util.Logger.warning("MAPVIEWER_9087","OM.server.ServerMapRequest",s);}},addThemes:function(u){if(e.notNull(u)&&Object.prototype.toString.call(u)==="[object Array]"){for(var t=0,s=u.length;
t<s;t++){this.addTheme(u[t]);}}else{e.util.Logger.warning("MAPVIEWER_9088","OM.server.ServerMapRequest",u.stringify());
}},addStyle:function(s){if(e.notNull(s)&&Object.prototype.toString.call(s)==="[object Object]"){if(this.validateStyle(s)){this.stylesArray.push(s);
}}else{e.util.Logger.warning("MAPVIEWER_9089","OM.server.ServerMapRequest",s);}},addStyles:function(u){if(e.notNull(u)&&Object.prototype.toString.call(u)==="[object Array]"){for(var t=0,s=u.length;
t<s;t++){this.addStyle(u[t]);}}else{e.util.Logger.warning("MAPVIEWER_9088","OM.server.ServerMapRequest",u.stringify());
}},setProperties:function(s){for(var t in s){if(s.hasOwnProperty(t)){if(t==="datasource"||t==="dataSource"){this.datasource=s[t];
}else{if(t==="antialiase"||t==="antiAliase"){this.antialiase=s[t];}else{if(t==="transparent"){this.transparent=s[t];
}else{if(t==="bgcolor"||t==="bgColor"){this.bgcolor=s[t];}else{if(t==="basemap"||t==="baseMap"){this.basemap=s[t];
}else{if(t==="width"||t==="imageWidth"){this.width=Number(s[t]);}else{if(t==="height"||t==="imageHeight"){this.height=Number(s[t]);
}else{if(t==="utfgridresolution"||t==="UTFGridResolution"){this.greid_res=s[t];}else{if(t==="enableutfgrid"||t==="enableUTFGrid"){this.enableUTFGrid=s[t];
}else{if(t==="isclienttilereq"||t==="isClientTileReq"){this.isclienttilereq=s[t];}else{if(t==="tileserverurl"||t==="tileServerURL"){this.tileServerURL=s[t];
}}}}}}}}}}}}}},toXMLString_Themes:function(){if(e.isNull(this.themesArray)||this.themesArray.length<1){return"";
}var v="<themes>";for(var u=0,s=this.themesArray.length;u<s;u++){var t=this.themesArray[u];if(e.notNull(t)){v+=t.toXMLString();
}}v+="</themes>";return v;},toXMLString_Styles:function(){if(e.isNull(this.stylesArray)||this.stylesArray.length<1){return"";
}var v="<styles>";for(var u=0,s=this.stylesArray.length;u<s;u++){var t=this.stylesArray[u];v+=t.toXMLString();
}v+="</styles>";return v;},hasTheme:function(u){if(typeof u!=="string"){e.util.Logger.warning("MAPVIEWER_9090","OM.server.ServerMapRequest",u);
}if(e.isNull(this.themesArray)){return false;}else{for(var t=0,s=this.themesArray.length;t<s;t++){if(this.themesArray[t].name.toLowerCase()===u.toLowerCase()){return true;
}}}},getTheme:function(u){for(var t=0,s=this.themesArray.length;t<s;t++){if(u===this.themesArray[t].name){return this.themesArray[t];
}}e.util.Logger.warning("MAPVIEWER_9091","OM.server.ServerMapRequest","Theme ["+u+"] not found.");return null;
},getThemes:function(){return this.themesArray;},setBindingParameters:function(w){var x=null;for(var v=0,t=w.length;
v<t;v++){x=w[v];for(var u in x){var s=this.getTheme(u.trim());if(e.notNull(s)){s.setBindingParameters(x[u.trim()]);
}}}},clone:function(){var s={};e.$.extend(s,this);return s;},getServerURL:function(){var s;if(this.isclienttilereq===true||this.isclienttilereq==="true"){s=(e.notNull(this.tileServerURL)?this.tileServerURL:this.baseURL+"/omserver");
}else{if(e.isNull(this.baseURL)){s="http://"+document.location.host+"/mapviewer/omserver";}else{s=this.baseURL+"/omserver";
}}return s;},toXMLString:function(){var v=this.getServerURL();var y='?xml_request=<?xml version="1.0" standalone="yes"?>';
var x="<map_request";x+=' width="'+(e.notNull(this.width)?this.width+'"':'"600"');x+=' height="'+(e.notNull(this.height)?this.height+'"':'"400"');
x+=((this.isclienttilereq===true||this.isclienttilereq==="true")?' isclienttilereq="true"':"");x+=' format="'+(e.isNull(this.format)?'PNG_STREAM"':this.format+'"');
x+=e.isNull(this.datasource)?"":' datasource="'+this.datasource+'"';x+=e.isNull(this.bgcolor)?"":' bgcolor="'+encodeURIComponent(this.bgcolor)+'"';
x+=e.isNull(this.basemap)?"":' basemap="'+this.basemap+'"';x+=e.isNull(this.transparent)?"":' transparent="'+this.transparent+'"';
x+=e.isNull(this.antialiase)?"":' antialiase="'+this.antialiase+'"';x+=">";x+='<box srsName="'+(e.isNull(this.srid)?"EPSG:4326":e.gv.sridToSRS(this.srid)+'">');
x+="<coordinates>"+this.minX+","+this.minY+","+this.maxX+","+this.maxY+"</coordinates>";x+="</box>";var w=this.toXMLString_Themes();
var u=this.toXMLString_Styles();var z=v+y+x+encodeURIComponent(w)+encodeURIComponent(u);if(this.enableUTFGrid){var A=' grid_id="'+e.util.MiscUtil.md5Hash(z)+'" grid_res="'+this.grid_res+'"';
var t=z.indexOf("PNG_STREAM");z=z.substring(0,t+11)+A+z.substring(t+11);}z+="</map_request>";return z;
}});e.server.ServerFeature=e.Class.extend({initialize:function(s){this.name=s;this.dataSource=null;},setDataSourceName:function(s){this.dataSource=s;
},getDataSourceName:function(){return this.dataSource;},toXMLString:function(){var t="<feature />";return t;
}});e.server.ServerTheme=e.Class.extend({initialize:function(s,t){this.name=s;this.type=t;this.dataSource=null;
},setDataSourceName:function(s){this.dataSource=s;},getDataSourceName:function(){return this.dataSource;
},setName:function(s){this.name=s;}});e.server.ServerTheme.TYPE_JDBC="jdbc";e.server.ServerTheme.TYPE_PREDEFINED="predefined";
e.server.ServerPredefinedTheme=e.server.ServerTheme.extend({initialize:function b(s){b.base.call(this,s,e.server.ServerTheme.TYPE_PREDEFINED);
this.bindingParams=null;},toXMLString:function(){var t=this.name;if(e.isNull(t)){e.util.Logger.warning("MAPVIEWER_9092","OM.server.ServerPredefinedTheme");
return;}var s=this.bindingParams;var y='<theme name="'+t.toUpperCase()+'">';if(e.notNull(s)){var u="";
for(var v=0,x=s.length;v<x;v++){var w=s[v];var A=w.value;var z=w.type;if(e.notNull(A)&&e.notNull(z)){u+='<parameter value="'+A+'" type="'+z+'"/>';
}else{e.util.Logger.warning("MAPVIEWER_9093","OM.server.ServerPredefinedTheme");}}if(e.notNull(u)){u="<binding_parameters>"+u+"</binding_parameters>";
}y+=u;}y+="</theme>";return y;},setBindingParameters:function(s){if(e.isNull(s)||s.length===0){e.util.Logger.warning("MAPVIEWER_9094","OM.server.ServerPredefinedTheme",s.stringify());
return;}this.bindingParams=s;}});e.server.ServerJDBCTheme=e.server.ServerTheme.extend({initialize:function b(s){b.base.call(this,s,e.server.ServerTheme.TYPE_JDBC);
this.geomColumn=null;this.xColumn=null;this.yColumn=null;this.jdbc_srid=null;this.label_column=null;this.label_style=null;
this.executeAsis=null;this.sql=null;this.executeAsis=false;this.geomColumn=null;this.infoColumns=[];e.util.Logger.warning("MAPVIEWER_9083","OM.server.ServerJDBCTheme.initialize");
},addInfoColumn:function(s){this.infoColumns.push(s);},setQuery:function(s){this.sql=s;},setExecuteAsis:function(s){this.executeAsis=(s===true||s==="true");
},setXColumnName:function(s){this.xColumn=s;},setYColumnName:function(s){this.yColumn=s;},setRenderingStyleName:function(s){this.renderingStyleName=s;
},setLabelColumnName:function(s){this.label_column=s;},setLabelStyleName:function(s){this.label_style=s;
},setRenderingStyleValueColumns:function(s){this.renderingStyleValueColumns=s;},setSRID:function(s){this.jdbc_srid=s;
},setGeometryColumnName:function(s){this.geomColumn=s;},toXMLString_JDBC_Query:function(){var x="<jdbc_query";
x+=e.notNull(this.dataSource)?' datasource="'+this.dataSource+'"':"";x+=e.notNull(this.geomColumn)?' spatial_column="'+this.geomColumn+'"':"";
x+=e.notNull(this.xColumn)?' x_column="'+this.xColumn+'"':"";x+=e.notNull(this.yColumn)?' y_column="'+this.yColumn+'"':"";
x+=e.notNull(this.jdbc_srid)?' jdbc_srid="'+this.jdbc_srid+'"':"";x+=e.notNull(this.label_column)?' label_column="'+this.label_column+'"':"";
x+=e.notNull(this.label_style)?' label_style="'+this.label_style+'"':"";x+=this.executeAsis===true?' asis="true"':"";
x+=">";x+=e.notNull(this.sql)?this.sql:"";var w="";if(this.infoColumns.length>0){var u=this.infoColumns;
for(var v=0,t=u.length;v<t;v++){var y=u[v];w+='<field column="'+y.column+'" name="'+y.name+'"/>';}w="<hidden_info>"+w+"</hidden_info>";
}x+=w;x+="</jdbc_query>";return x;},toXMLString_Rendering:function(){if(e.isNull(this.renderingStyleName)){return"";
}var s="<rendering><style ";s+='name="'+this.renderingStyleName+'"';if(e.notNull(this.renderingStyleValueColumns)){s+=' value_columns="'+this.renderingStyleValueColumns+'"';
}s+="/></rendering>";return s;},toXMLString:function(){if(e.isNull(this.name)){e.util.Logger.warning("MAPVIEWER_9095","OM.server.ServerJDBCTheme");
return"";}var t=this.name;var s=this.toXMLString_JDBC_Query();var v=this.toXMLString_Rendering();var u='<theme name="'+t.toUpperCase()+'">';
u+=s+v+"</theme>";return u;}});e.layer.Layer=e.Class.extend({mixin:e.event.EventSource,initialize:function(s){this.name=s;
this.group=null;this.visible=true;this.minVisibleLevel=0;this.maxVisibleLevel=100;this.minVisibleScale=0;
this.maxVisibleScale=1000000000;this.visibleBound=null;this.parentMap=null;this.zIndex=null;this.opacity=1;
this.layerType=null;this.customType="";this.loaded=false;this.serverURL=null;},init:function(){},initLayer:function(u){this.initCalled=true;
this.init(u);var s=e.event.LayerEvent;var t=new s(s.LAYER_INITIALIZED,this);if(this.parentMap){t.mapContext=this.parentMap.getMapContext();
this.fire(s.LAYER_INITIALIZED,t);}},panEvent:function(s){this.pan(s.xOffset,s.yOffset);},refreshEvent:function(s){this.refresh(s,true);
},setCenterAndZoomlevel:function(){},recenter:function(){},pan:function(){},destroy:function(){this.parentMap=null;
this.deleteAllListeners();},isVisible:function(){if(this.real){return this.real.isVisible();}if(!this.isInZoomLevelRange()){return false;
}else{return this.visible;}},setVisible:function(v){if(v){if(!this.isInZoomLevelRange()){return;}}if(this.real){return this.real.setVisible(v);
}var s=e.event.LayerEvent;var u=new s(s.LAYER_VISIBILITY_CHANGED,this);var t=this.visible;var w=v;if(this.visible===v){return;
}this.visible=v;if(this.setVisibleImpl){this.setVisibleImpl();}else{if(this.visible){if(this.group&&this.parentMap&&this.parentMap.graphics){this.parentMap.graphics.applyStyle(this.group,{display:true});
}if(this.parentMap&&this.parentMap.displayed){this.refresh(null,false);}}else{if(this.group&&this.parentMap&&this.parentMap.graphics){this.parentMap.graphics.applyStyle(this.group,{display:false});
}}}u.newVisibility=w;u.oldVisibility=t;if(this.parentMap){u.mapContext=this.parentMap.getMapContext();
}this.fire(s.LAYER_VISIBILITY_CHANGED,u);},refresh:function(){if(this.real){return this.real.refresh();
}var u=(arguments.length>0)?arguments[0]:null;var t=(arguments.length>1)?arguments[1]:null;if(t){var s=e.event.LayerEvent;
u=new s(s.BEFORE_REFRESH,this);if(this.parentMap){u.mapContext=this.parentMap.getMapContext();}this.fire(s.BEFORE_REFRESH,u);
}},redraw:function(){if(this.real){return this.real.redraw(arguments);}if(arguments.length>0){this.refresh(arguments[0],false);
}},setZoomLevelRange:function(t,s){if(this.real){return this.real.setZoomLevelRange(t,s);}this.minVisibleLevel=t;
this.maxVisibleLevel=s;if(this.displayed){this.refresh(null,false);}},isInZoomLevelRange:function(){if(e.isNull(this.parentMap)||e.isNull(this.parentMap.getMapContext())){return false;
}var s=this.parentMap.getMapContext().getZoomLevel();return(s>=this.minVisibleLevel&&s<=this.maxVisibleLevel);
},setVisibleBound:function(s){if(this.real){return this.real.setVisibleBound(s);}if(!s instanceof e.geometry.Rectangle){return;
}this.visibleBound=s;if(this.displayed){if(this.changeVisibleBound){this.changeVisibleBound();}else{this.refresh();
}}},bringForward:function(){if(this.real){return this.real.bringForward();}if(this.parentMap){return this.parentMap.bringForward(this);
}},sendBackward:function(){if(this.real){return this.real.sendBackward();}if(this.parentMap){return this.parentMap.sendBackward(this);
}},bringToTop:function(){if(this.real){return this.real.bringToTop();}var s=false;if(arguments.length>0){s=arguments[0];
}if(this.parentMap){return this.parentMap.bringToTop(this,s);}},sendToBottom:function(){if(this.real){return this.real.sendToBottom();
}if(this.parentMap){return this.parentMap.sendToBottom(this);}},setZIndex:function(s){if(this.real){return this.real.setZIndex(s);
}if(this.parentMap){return this.parentMap.setLayerIndex(this,s);}},getZIndex:function(){if(this.real){return this.real.getZIndex();
}if(this.parentMap){return this.parentMap.getLayerCurrentIndex(this);}},getName:function(){return this.name;
},setOpacity:function(s){if(!e.util.ValidationUtil.isNumber(s)){return;}if(this.real){return this.real.setOpacity(s);
}if(s>1||s<0){return;}else{this.opacity=s;}if(this.displayed&&this.changeOpacity){this.changeOpacity();
}},getOpacity:function(){if(this.real){return this.real.getOpacity();}return this.opacity;},getLayerConfig:function(){},getDataSouce:function(){return this.dataSource;
},clone:function(s){var t={};e.$.extend(t,this);if(s){t.name=s;}else{t.name=t.name+"_clone";}t.deleteAllListeners();
return t;}});e.layer.TileLayer=e.layer.Layer.extend({initialize:function b(t,s){b.base.call(this,t,s);
if(s){this.dataSource=s.dataSource;this.tileLayer=s.tileLayer;if(e.notNull(s.tileServerURL)){this.serverURL=s.tileServerURL;
if(s.isDynamicTileLayer===true){if(this.serverURL.indexOf("/omserver")===-1){e.util.Logger.warning("MAPVIEWER_9075","OM.layer.Tilelayer.initialize");
var u=this.serverURL.indexOf("/mcserver");if(u>0){this.serverURL=this.serverURL.substring(0,u)+"/omserver";
e.util.Logger.warning("MAPVIEWER_9076","OM.layer.Tilelayer.initialize");}}}}this.tileImagesURL=s.tileImagesURL;
this.tileLayerConfig=s.tileLayerConfig;this.getTileURL=s.getTileURL;this.mapSource=this.dataSource+"."+this.tileLayer;
this.isLocalTileLayer=s.isLocalTileLayer;if(this.isLocalTileLayer&&s.isInZXYOrder){this.isInZXYOrder=s.isInZXYOrder;
}if(s.enableUTFGrid===true||s.enableUTFGrid==="true"){this.enableUTFGrid=true;this.mouseETypeUTFGrid=((s.infoWindowTrigger===e.event.MouseEvent.MOUSE_OVER||s.infoWindowTrigger===e.event.MouseEvent.MOUSE_MOVE)?e.event.MouseEvent.MOUSE_MOVE:e.event.MouseEvent.MOUSE_CLICK);
this.utfgridResolution=this.getUTFGridResolution(s.utfGridResolution);this.enableUTFGridInfoWindow=true;
}else{this.enableUTFGrid=false;this.enableUTFGridInfoWindow=false;}if(s.enableUTFGridInfoWindow===false||s.enableUTFGridInfoWindow==="false"){this.enableUTFGridInfoWindow=false;
}if(s.isWMSTileLayer){this.initialize_WMSTL(s);}else{if(s.isDynamicTileLayer){this.initialize_DTL(s);
this.bindingParameters=null;}}}this.layerType=(e.notNull(this.layerType)?this.layerType:e.LayerTypes.TILE);
this.zIndex=0;this.initError=false;this.TILING_FACTOR=20;this.UTFGRID_RESOLUTION=4;this.meshLength=0;
this.maxMeshY=0;this.xFactors=[];this.yFactors=[];this.addListener(e.event.LayerEvent.TILE_IMG_LOADED,this.tileImgLoadedHandler);
this.addListener(e.event.LayerEvent.TILE_IMG_LOAD_ERROR,this.tileImgLoadedHandler);this.tilesImgLoaded=0;
this.tilesPercent=0;this.requiredBinds=0;this.initRequiredBinds=0;},initialize_DTL:function(t){this.isDynamicTileLayer=true;
this.layerType=e.LayerTypes.DYNAMIC_TILE;var v;if(e.isNull(t)){e.util.Logger.warning("MAPVIEWER_9070","OM.layer.TileLayer.initialize_DTL");
return;}this.xOffset_DynamicTL=0;this.yOffset_DynamicTL=0;this.tileLayerConfig={};if(t.tileLayerConfig){this.tileLayerConfig.tileImageHeight=t.tileLayerConfig.tileImageHeight;
this.tileLayerConfig.tileImageWidth=t.tileLayerConfig.tileImageWidth;this.tileLayerConfig.tileImageFormat=t.tileLayerConfig.tileImageFormat;
if(e.isNull(this.tileLayerConfig.tileImageFormat)||this.tileLayerConfig.tileImageFormat==="PNG"){this.tileLayerConfig.tileImageFormat="image/png";
}if(e.isNull(this.tileLayerConfig.tileImageHeight)||e.isNull(this.tileLayerConfig.tileImageWidth)||this.tileLayerConfig.tileImageHeight<=0||this.tileLayerConfig.tileImageWidth<=0){this.tileLayerConfig.tileImageHeight=256;
this.tileLayerConfig.tileImageWidth=256;}}else{var s=new e.layer.TileLayerConfig();this.tileLayerConfig.tileImageHeight=s.tileImageHeight;
this.tileLayerConfig.tileImageWidth=s.tileImageHeight;this.tileLayerConfig.tileImageFormat="image/png";
}if(t.universe){this.tileLayerConfig.bounds=t.universe.bound;this.tileLayerConfig.srid=t.universe.srid;
this.tileLayerConfig.zoomLevels=t.universe.zoomLevels;}else{if(e.isNull(this.parentMap)){v=new e.universe.ElocationUniverse();
this.tileLayerConfig.bounds=v.bound;this.tileLayerConfig.srid=v.srid;this.tileLayerConfig.zoomLevels=v.zoomLevels;
e.util.Logger.warning("MAPVIEWER_9072","OM.layer.TileLayer.initialize_DTL");}else{var u=this.parentMap.getMapContext();
if(!e.isNull(u)){v=u.getUniverse();if(e.isNull(v)){v=new e.universe.ElocationUniverse();e.util.Logger.warning("MAPVIEWER_9072","OM.layer.TileLayer.initialize_DTL");
}this.tileLayerConfig.bounds=v.bound;this.tileLayerConfig.srid=v.srid;this.tileLayerConfig.zoomLevels=v.zoomLevels;
}else{e.util.Logger.warning("MAPVIEWER_9084","OM.layer.TileLayer.initialize_DTL");}}}if(e.notNull(t.urlBuilder)){this.customImgPath_DynamicTL=t.urlBuilder;
if(e.notNull(t.urlBuilderOptions)){this.urlBuilderParams=t.urlBuilderOptions;}}if(e.notNull(t.hideInOverviewMap)){this.hideInOverviewMap=t.hideInOverviewMap;
}else{this.hideInOverviewMap=true;}this.serverMapRequest=t.serverMapRequest;},initialize_WMSTL:function(t){this.isWMSTileLayer=true;
this.layerType=e.LayerTypes.DYNAMIC_TILE;if(e.isNull(t)){e.util.Logger.warning("MAPVIEWER_9069","OM.layer.TileLayer.initialize_WMSTL");
return;}this.serverURL=t.wmsServerURL;if(e.isNull(this.serverURL)){e.util.Logger.warning("MAPVIEWER_9066","OM.layer.TileLayer.initialize_WMSTL");
}if(t.tileLayerConfig){this.tileLayerConfig.tileImageHeight=t.tileLayerConfig.tileImageHeight;this.tileLayerConfig.tileImageWidth=t.tileLayerConfig.tileImageWidth;
this.tileLayerConfig.tileImageFormat=t.tileLayerConfig.tileImageFormat;if(e.isNull(this.tileLayerConfig.tileImageFormat)||this.tileLayerConfig.tileImageFormat==="PNG"){this.tileLayerConfig.tileImageFormat="image/png";
}if(e.isNull(this.tileLayerConfig.tileImageHeight)||e.isNull(this.tileLayerConfig.tileImageWidth)||this.tileLayerConfig.tileImageHeight<=0||this.tileLayerConfig.tileImageWidth<=0){this.tileLayerConfig.tileImageHeight=256;
this.tileLayerConfig.tileImageWidth=256;}}else{this.tileLayerConfig={};var s=new e.layer.TileLayerConfig();
this.tileLayerConfig.tileImageHeight=s.tileImageHeight;this.tileLayerConfig.tileImageWidth=s.tileImageHeight;
this.tileLayerConfig.tileImageFormat="image/png";}if(t.universe){this.tileLayerConfig.bounds=t.universe.bound;
this.tileLayerConfig.srid=t.universe.srid;this.tileLayerConfig.zoomLevels=t.universe.zoomLevels;}else{if(!e.isNull(this.parentMap)){var v=this.parentMap.getMapContext();
if(!e.isNull(v)){var u=v.getUniverse();if(e.isNull(u)){u=new e.universe.ElocationUniverse();}this.tileLayerConfig.bounds=u.bound;
this.tileLayerConfig.srid=u.srid;this.tileLayerConfig.zoomLevels=u.zoomLevels;}else{}}else{}}if(!e.isNull(t.urlBuilderOptions)){this.optParams_WMSTL=t.urlBuilderOptions;
if(e.isNull(this.optParams_WMSTL.layers)){e.util.Logger.warning("MAPVIEWER_9067","OM.layer.TileLayer.initialize_WMSTL");
}if(e.isNull(this.optParams_WMSTL.version)){e.util.Logger.warning("MAPVIEWER_9068","OM.layer.TileLayer.initialize_WMSTL");
}}if(e.notNull(t.hideInOverviewMap)){this.hideInOverviewMap=t.hideInOverviewMap;}else{this.hideInOverviewMap=true;
}},setCenterAndZoomlevel:function(u){var t=this.parentMap.getMapContext();var s=t.getCenterPoint();var v=u.preMapCenter;
if(e.notNull(u.beforeZoomLevel)){this.zoom(u.beforeZoomLevel,u.afterZoomLevel,v,s);}},getLayerConfig:function(t,s){this.getTileLayerConfig(t,s);
},getTileLayerConfig:function(t,v){var z;if(!this.tileLayerConfig){z=this.dataSource+"."+this.tileLayer;
var u=e.gv.CacheConfig[z];if(u){this.tileLayerConfig=u;}}if(this.tileLayerConfig){var A=new e.event.LayerEvent(e.event.LayerEvent.FINISH_GOT_CONFIG,this);
A.config=this.getEnabledConfig(this.tileLayerConfig);A.mapContext=this.parentMap.getMapContext();this.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,A);
if(v){v(this.tileLayerConfig);}else{return this.tileLayerConfig;}}else{var y=this;var B;if(!this.isLocalTileLayer){var w='<?xml version="1.0" standalone="yes"?><map_cache_admin_request><get_client_config map_cache_names="'+z+'" format="JSON"/></map_cache_admin_request>';
this.serverURL=this.getTileServerURL();var s=this.serverURL;B=function(){if(!y.parentMap||!y.parentMap.graphics){return;
}y.initError=true;e.util.Logger.alert("MAPVIEWER_9001","OM.layer.Tilelayer.getTileLayerConfig","["+z+"]");
var D=e.event;var C=new D.LayerEvent(D.LayerEvent.INIT_ERROR,y);if(!y.parentMap){return;}C.mapContext=y.parentMap.getMapContext();
y.fire(D.LayerEvent.INIT_ERROR,C);return;};e.util.HttpRequest.send(s,{xml_request:w},function(J){if(!y.parentMap||!y.parentMap.graphics){return;
}if(J&&J[0]){var E=J[0].coordSys;var W=new e.layer.TileLayerConfig();W.bounds=new e.geometry.Rectangle(E.minX,E.minY,E.maxX,E.maxY,E.srid);
W.srid=E.srid;W.tileImageFormat=J[0].format;W.isTransparentImage=J[0].transparent;W.copyright=J[0].copyright;
var F=J[0].zoomLevels;var Q=F.length;if(F&&Q>0){W.tileImageWidth=F[0].tileImageWidth;W.tileImageHeight=F[0].tileImageHeight;
W.zoomLevels=new Array(Q);if(y.enableUTFGrid&&(J[0].utfgrid===true||J[0].utfgrid==="true")){y.getUTFGridResolution(J[0].utfGridResolution);
}else{y.enableUTFGrid=false;}for(var P=0;P<Q;P++){var I=F[P].tileWidth/W.tileImageWidth;var C=F[P].tileHeight/W.tileImageHeight;
var K=C/I;W.zoomLevels[P]={resolution:I,stretchRatio:K,infotip:""};}}if(J[0].customTags){W.customTags=J[0].customTags;
}y.tileLayerConfig=W;var T;if(J[0].clientTileAccess){var G;var M=J[0].clientTileAccess;if(M.lib_url&&M.key){M.lib_url=M.lib_url.replace("=$$key$$","="+M.key);
}if(M.map_type_visible=="false"){M.map_type_visible=false;}else{M.map_type_visible=true;}var D;if(M.type=="google"){D={libURL:M.lib_url,mapTypeList:M.map_type_values.replace(/MVGoogleTileLayer/g,"OM.layer.GoogleTileLayer"),mapTypeVisible:M.map_type_visible};
if(M.appID){D.appID=M.appID;}if(M.key){D.key=M.key;}if(M.client){D.clientID=M.client;}G=new e.layer.GoogleTileLayer(y.name,D);
}else{if(M.type=="tomtom"){if(M.display_traffic=="true"){M.display_traffic=true;}else{M.display_traffic=false;
}D={APIKey:M.key,libURL:M.lib_url,displayTraffic:M.display_traffic};G=new e.layer.TomTomTileLayer(y.name,D);
}else{if(M.type=="bing"||M.type=="bingV7"){D={key:M.key,libURL:M.lib_url,mapTypeList:M.map_type_values.replace(/MVBingTileLayer/g,"OM.layer.BingTileLayer"),mapTypeVisible:M.map_type_visible};
if(M.appID){D.appID=M.appID;}G=new e.layer.BingTileLayer(y.name,D);}else{if(M.type=="mapviewer"){if(M.appID){D.appID=M.appID;
}var Y=M.dataSource||"";var N=M.tile_layer_name;var S=M.tileServerURL;var O=-1;if(e.notNull(N)){O=N.indexOf(".");
if(O>0){Y=N.substring(0,O);N=N.substring(O+1);}}var X=S.length;var U="/mcserver";X-=U.length;var R=S.indexOf(U,X);
if(!(R!==-1&&R===X)){O=S.indexOf(U);S=S.substring(0,O+U.length);}var L={};if(e.notNull(Y)){L.dataSource=Y;
}L.tileLayer=N;L.tileServerURL=S;G=new e.layer.TileLayer(y.name,L);}else{if(M.type=="nokia"){D={key:M.key,libURL:M.lib_url,mapTypeList:M.map_type_values.replace(/MVNokiaTileLayer/g,"OM.layer.NokiaTileLayer"),mapTypeVisible:M.map_type_visible};
if(M.appID){D.appID=M.appID;}G=new e.layer.NokiaTileLayer(y.name,D);}}}}}if(M.default_map_type){if(M.default_map_type=="OM.layer.GoogleTileLayer.TYPE_ROAD"){G.setMapType(e.layer.GoogleTileLayer.TYPE_ROAD);
}if(M.default_map_type=="OM.layer.GoogleTileLayer.TYPE_SATELLITE"){G.setMapType(e.layer.GoogleTileLayer.TYPE_SATELLITE);
}if(M.default_map_type=="OM.layer.GoogleTileLayer.TYPE_SHADED"){G.setMapType(e.layer.GoogleTileLayer.TYPE_SHADED);
}if(M.default_map_type=="OM.layer.BingTileLayer.TYPE_ROAD"){G.setMapType(e.layer.BingTileLayer.TYPE_ROAD);
}if(M.default_map_type=="OM.layer.BingTileLayer.TYPE_SATELLITE"){G.setMapType(e.layer.BingTileLayer.TYPE_SATELLITE);
}if(M.default_map_type=="OM.layer.BingTileLayer.TYPE_HYBRID"){G.setMapType(e.layer.BingTileLayer.TYPE_HYBRID);
}if(M.default_map_type=="OM.layer.BingTileLayer.TYPE_SHADED"){G.setMapType(e.layer.BingTileLayer.TYPE_SHADED);
}if(M.default_map_type=="OM.layer.NokiaTileLayer.TYPE_ROAD"){G.setMapType(e.layer.NokiaTileLayer.TYPE_ROAD);
}if(M.default_map_type=="OM.layer.NokiaTileLayer.TYPE_HYBRID"){G.setMapType(e.layer.NokiaTileLayer.TYPE_HYBRID);
}if(M.default_map_type=="OM.layer.NokiaTileLayer.TYPE_TERRAIN"){G.setMapType(e.layer.NokiaTileLayer.TYPE_TERRAIN);
}}G.tileLayerConfig=W;var V=y.parentMap;V.replaceLayer(y,G);y.real=G;T=new e.event.LayerEvent(e.event.LayerEvent.FINISH_GOT_CONFIG,G);
T.config=G.getEnabledConfig(W);T.mapContext=V.getMapContext();G.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,T);
}else{T=new e.event.LayerEvent(e.event.LayerEvent.FINISH_GOT_CONFIG,y);T.config=y.getEnabledConfig(W);
T.mapContext=y.parentMap.getMapContext();y.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,T);}if(v){v(W);}}else{B();
return null;}},"json",function(D){if(!y.parentMap||!y.parentMap.graphics){return;}y.initError=true;if(D&&D.responseText){try{var C=e.$(e.$.parseXML(D.responseText));
var E=C.find("oms_error");if(E.length>0){e.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",E.text());
}}catch(I){e.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",D.responseText);
}}else{e.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig","["+z+"]");}var G=e.event;
var F=new G.LayerEvent(G.LayerEvent.INIT_ERROR,y);if(!y.parentMap){return;}F.mapContext=y.parentMap.getMapContext();
y.fire(G.LayerEvent.INIT_ERROR,F);return;});}else{var x=this.tileImagesURL+"/instance.json";y=this;B=function(){if(!y.parentMap||!y.parentMap.graphics){return;
}y.initError=true;e.util.Logger.alert("MAPVIEWER_9044","OM.layer.Tilelayer.getTileLayerConfig","["+x+"]");
var D=e.event;var C=new D.LayerEvent(D.LayerEvent.INIT_ERROR,y);if(!y.parentMap){return;}C.mapContext=y.parentMap.getMapContext();
y.fire(D.LayerEvent.INIT_ERROR,C);return;};e.util.HttpRequest.send(x,{},function(M){if(!y.parentMap||!y.parentMap.graphics){return;
}try{M=JSON.parse(M);}catch(K){e.util.Logger.alert("MAPVIEWER_9044","OM.layer.Tilelayer.getTileLayerConfig","");
}var F=M[0].coordSys;var E=new e.layer.TileLayerConfig();E.bounds=new e.geometry.Rectangle(F.minX,F.minY,F.maxX,F.maxY,F.srid);
E.srid=F.srid;E.tileImageFormat=M[0].format;E.isTransparentImage=M[0].transparent;E.copyright=M[0].copyright;
var L=M[0].zoomLevels;var J=L.length;if(L&&J>0){E.tileImageWidth=L[0].tileImageWidth;E.tileImageHeight=L[0].tileImageHeight;
E.zoomLevels=new Array(J);for(var G=0;G<J;G++){var D=L[G].tileWidth/E.tileImageWidth;var I=L[G].tileHeight/E.tileImageHeight;
var C=I/D;E.zoomLevels[G]={resolution:D,stretchRatio:C,infotip:""};}}if(M[0].customTags){E.customTags=M[0].customTags;
}E.isXYZStorageScheme=(M[0].xyzStorageScheme==="true"||M[0].xyzStorageScheme===true);E.isInZXYOrder=(M[0].inZXYOrder==="true"||M[0].inZXYOrder===true);
y.tileLayerConfig=E;var K=new e.event.LayerEvent(e.event.LayerEvent.FINISH_GOT_CONFIG,y);K.config=y.getEnabledConfig(E);
K.mapContext=y.parentMap.getMapContext();y.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,K);if(v){v(E);}},"text",B);
}}},init:function(){var y=0;var V=this.parentMap.getMapContext();this.winWidth=V.getDeviceWidth();this.winHeight=V.getDeviceHeight();
var W=V.getCenterPoint();var B=W.getX();var A=W.getY();var v=this.getRealZoomLevel(V.getZoomLevel());
if(!this.checkVisible(v)){var J=e.event;var P=new J.LayerEvent(J.LayerEvent.FINISH_LOAD,this);P.mapContext=this.parentMap.getMapContext();
this.fire(J.LayerEvent.FINISH_LOAD,P);return;}this.tileImageWidth=this.tileLayerConfig.tileImageWidth;
this.tileImageHeight=this.tileLayerConfig.tileImageHeight;this.bufferX=Math.ceil(this.tileImageWidth/2);
this.bufferY=Math.ceil(this.tileImageHeight/2);this.tileNumX=Math.ceil((this.winWidth+this.bufferX*2)/this.tileImageWidth);
this.centerMesh=null;this.centerMesh=new e.layer.Mesh(this.tileLayerConfig,B,A,v);var w=this.tileLayerConfig.bounds;
this.tileNumInCSBoun=Math.ceil((w.getMaxX()-w.getMinX())/this.centerMesh.mw);var S=this.tileLayerConfig.zoomLevels[v];
var u=S.resolution;var X=S.resolution*S.stretchRatio;this.pixPerX=this.tileImageWidth/this.centerMesh.mw;
this.pixPerY=this.tileImageHeight/this.centerMesh.mh;this.coverPixel=(this.centerMesh.mw*this.tileNumInCSBoun-(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX()))*this.pixPerX;
if(this.parentMap.wraparound){var z=(this.tileNumX/this.tileNumInCSBoun)*this.coverPixel;var N=(this.tileImageWidth/2);
this.tileNumX=this.tileNumX+Math.ceil(z/N)+1;}this.tileNumY=Math.ceil((this.winHeight+this.bufferY*2)/this.tileImageHeight);
this.tileMinX=0;this.tileMinY=0;this.initTileArray();var t=Math.floor(this.tileNumX/2);var R=Math.floor(this.tileNumY/2);
var M=this.winWidth/2-(B-this.centerMesh.minX)/u;var L=this.winHeight/2+(A-this.centerMesh.minY)/X-this.tileImageHeight;
while(true){var D=M-t*this.tileImageWidth;if(D>0){t++;continue;}var s=L-R*this.tileImageHeight;if(s>0){R++;
continue;}var x=M+(this.tileNumX-t)*this.tileImageWidth-this.winWidth;if(x<0){t--;continue;}var K=L+(this.tileNumY-R)*this.tileImageHeight-this.winHeight;
if(K<0){R--;continue;}var O=x+D,C=K+s;if(O>this.tileImageWidth){t++;continue;}else{if(O<(-1)*this.tileImageWidth){t--;
continue;}}if(C>this.tileImageHeight){R++;continue;}if(C<(-1)*this.tileImageHeight){R--;continue;}break;
}this.origLeft=M-t*this.tileImageWidth;this.origTop=L-R*this.tileImageHeight;this.divLeft=this.origLeft;
this.divTop=this.origTop;var F=V.getTransform();var I=F.toScreenPoint(W.getX(),W.getY());this.offsetX=I.x-V.getDeviceWidth()/2;
this.offsetY=I.y-V.getDeviceHeight()/2;this.jqLayerDiv.css({left:this.divLeft,top:this.divTop});this.createImageNode(t,R,this.tileImageWidth,this.tileImageHeight,t*this.tileImageWidth,R*this.tileImageHeight);
y++;this.centerMesh.moveMeshCode(-1,1);var U=Math.max(t,this.tileNumX-t);var T=Math.max(R,this.tileNumY-R);
var G,Q;for(var E=1;E<=Math.max(U,T);E++){for(G=t-E,Q=R-E;G<=t+E;G++){if(!(G<0||G>=this.tileNumX||Q<0||Q>=this.tileNumY)){this.createImageNode(G,Q,this.tileImageWidth,this.tileImageHeight,G*this.tileImageWidth,Q*this.tileImageHeight);
y++;}this.centerMesh.moveMeshCode(1,0);}this.centerMesh.moveMeshCode(-(E*2+1),-1);for(G=t-E,Q=R-E+1;Q<=R+E-1;
Q++){if(!(G<0||G>=this.tileNumX||Q<0||Q>=this.tileNumY)){this.createImageNode(G,Q,this.tileImageWidth,this.tileImageHeight,G*this.tileImageWidth,Q*this.tileImageHeight);
y++;}this.centerMesh.moveMeshCode(0,-1);}for(G=t-E,Q=R+E;G<=t+E;G++){if(!(G<0||G>=this.tileNumX||Q<0||Q>=this.tileNumY)){this.createImageNode(G,Q,this.tileImageWidth,this.tileImageHeight,G*this.tileImageWidth,Q*this.tileImageHeight);
y++;}this.centerMesh.moveMeshCode(1,0);}this.centerMesh.moveMeshCode(-1,1);for(G=t+E,Q=R+E-1;Q>=R-E+1;
Q--){if(!(G<0||G>=this.tileNumX||Q<0||Q>=this.tileNumY)){this.createImageNode(G,Q,this.tileImageWidth,this.tileImageHeight,G*this.tileImageWidth,Q*this.tileImageHeight);
y++;}this.centerMesh.moveMeshCode(0,1);}this.centerMesh.moveMeshCode(-(E*2+1),1);}this.centerMesh.moveMeshCode(E,-(E));
this.centerMesh.moveMeshCode(-t+Math.floor(this.tileNumX/2),R-Math.floor(this.tileNumY/2));if(!this.zoomControl){this.zoomControl=new e.layer.TileZoomAnimation(this);
}this.zoomControl.tileInitialized();this.displayed=true;if(this.enableUTFGridInfoWindow){if(!this.hasListener(this.mouseETypeUTFGrid)){this.on(this.mouseETypeUTFGrid,this.getAndStoreUTFGridAttr);
}}this.initRequiredBinds=y;},getAndStoreUTFGridAttr:function(){var x=this;if(e.isNull(x.isVisible())||x.isVisible()===false){return;
}var t=x.getFeatureInfo();var s="";if(t&&!e.$.isEmptyObject(t)){for(var u in t){if((typeof u)==="string"&&u.trim().length>0){var w=t[u];
if(!e.isNull(w)){s+="<tr bgcolor='#bbbbbb'><td colspan='2' align='left'>"+u+"</td></tr>";for(var v in w){s+="<tr bgcolor='#dddddd'><td align='right'>"+v+"</td><td align='left'>"+w[v]+"</td></tr>";
}}}}}x.parentMap.appendUTFGridLayerHTML(s);},buildUTFGridReq:function(v){var t=v.indexOf("/omserver");
if(t==-1){return null;}var x=v.substring(0,t);t=v.indexOf(" grid_id=")+" grid_id=".length;var w=v.indexOf(" grid_res");
var u=v.substring(t+1,w-1);var s=x+"/images/utfgrid/utfgrid"+u+".json";return s;},getUpperLeftTileCode:function(z,v){var y=this.centerMesh.mX;
var x=this.centerMesh.mY;var t=Math.max(z,this.tileNumX-z);var s=Math.max(v,this.tileNumY-v);var w=Math.max(t,s);
y-=Math.min(z,w);x+=Math.min(v,w);var u=[];u.push(y);u.push(x);return u;},initTileArray:function(){this.clearLayer();
this.jqLayerDiv=e.$("<div id ='tilelayer_"+this.name+"'></div>");this.jqLayerDiv.css({position:"absolute","z-index":this.getZIndex()-1});
this.parentMap.$tileLayersDiv.append(this.jqLayerDiv);this.transImgURL=e.util.MiscUtil.transparentImgURL;
var B=this.tileLayerConfig.isTransparentImage;var x,w;var s=function(C){C.preventDefault();return false;
};var y=function(C){C.preventDefault();};var t;var z;var u;var v;var A;for(x=0;x<this.tileNumX;x++){t=[];
z=e.browser.touchSupported;for(w=0;w<this.tileNumY;w++){u=e.util.DomUtil.createImageNode(this.transImgURL,B);
v=e.$(u);if(z){v.bind("click",s);v.bind("focus",s);}else{v.bind("mouseout",s);v.bind("mousedown",y);}this.jqLayerDiv.append(v);
A={};A.node=v;A.grid=null;A.gridsrc=null;t.push(A);}this.tileArray.push(t);}},createImageNode:function(B,v,C,t,s,z){if(B===0&&v===0&&this.transImgURL){this.leftNum=this.centerMesh.mX;
this.topNum=this.centerMesh.mY;}var E=this.meshImgPath(this.centerMesh.mX,this.centerMesh.mY);var A=this.tileArray[B][v].node;
if(e.isNull(A)){var D=e.util.DomUtil.createImageNode(null,this.isTransparent);A=e.$(D);this.jqLayerDiv.append(A);
this.tileArray[B][v].node=A;}A.css({position:"absolute",left:s,top:z});if(e.browser.msie){A.css({width:C,height:t});
}if((this.zoomControl)&&(this.zoomControl.zooming)){A.css("display","none");}if(e.browser.mobileWebkit&&!e.browser.android){A.css("-webkit-transform","translate3d(0,0,0)");
}if(this.enableUTFGrid){var u;if(this.isDynamicTileLayer){u=this.buildUTFGridReq(E);}else{u=this.meshUTFGridPath(this.centerMesh.mX,this.centerMesh.mY);
}this.tileArray[B][v].gridsrc=u;}this.bindAndLoadTile(this.tileArray[B][v]);e.util.DomUtil.setImageSrc(A,E,this.opacity);
A[0].mx=this.centerMesh.mX;A[0].my=this.centerMesh.mY;},fetchUTFGrid:function(s){if(e.isNull(s.gridsrc)){s.grid={};
return;}e.$.ajax({dataType:"text",url:s.gridsrc,data:"",cache:true,success:function(t){if(!e.isNull(t)){s.grid=t;
}else{e.util.Logger.warning("MAPVIEWER_9065","OM.layer.TileLayer.fetchUTFGrid",s.gridsrc);}}});},cloneGrid:function(t){var u;
if(e.isNull(t)||"object"!=typeof t){return t;}if(t instanceof Object){u={};for(var s in t){if(t.hasOwnProperty(s)){u[s]=this.cloneGrid(t[s]);
}}return u;}throw new Error("Unable to copy utfgrid Object{grid:'', src:''}! Its type isn't supported.");
},decodeCharVal:function(s){if(e.notNull(s)){var t=s.charCodeAt(0);if(t>=93){t--;}if(t>=35){t--;}return t-32;
}},featureInfoToJSON:function(s,u,v){if(s.length!==u.length&&s.length!==v.length){e.util.Logger.warning("MAPVIEWER_9080","OM.layer.Tilelayer.featureInfoToJSON");
return null;}var w={};for(var t=0;t<v.length;t++){if(v[t]){w[s[t]]=v[t];}}return w;},getFeatureInfo:function(){var D=this.parentMap.mLocX;
var C=this.parentMap.mLocY;var A,z,t,s;var y,G;var I;var B=[];var w=[],x=[];var u=this;var L=D-u.divLeft;
var K=C-u.divTop;G=parseInt(L/u.tileImageWidth);y=parseInt(K/u.tileImageHeight);A=L-G*u.tileImageWidth;
z=K-y*u.tileImageHeight;try{I=JSON.parse(u.tileArray[G][y].grid);if(e.isNull(I)){return;}var O=parseInt(I.resolution);
t=parseInt(A/O);s=parseInt(z/O);}catch(E){return;}for(var F in I){if(F!=="rows"&&F!=="columns"&&F!=="resolution"){B.push(F);
try{var J=I[F].grid[s][t];var N=this.decodeCharVal(J);if(e.notNull(N)){w.push(N);var M=I[F].data[N];if(!e.isNull(M)){x.push(M);
}else{x.push("");}}}catch(E){}}}var v=this.featureInfoToJSON(B,w,x);return v;},meshImgPath:function(D,C){if(this.parentMap.wraparound){if(C<0||C>=(this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh){return this.transImgURL;
}else{if(D<0){while(true){D=parseInt(Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw))+D;
if(D>=0){break;}}}else{if(D>=(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw){while(true){D=D-parseInt(Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw));
if(D<(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw){break;
}}}}}}else{if(D<0||D>=(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw||C<0||C>=(this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh){return this.transImgURL;
}}if(this.visibleBound){var M=Math.floor((this.visibleBound.getMinX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw);
var L=Math.ceil((this.visibleBound.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw);
var z=Math.floor((this.visibleBound.getMinY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh);
var w=Math.ceil((this.visibleBound.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh);
if(D<M||D>=L||C<z||C>=w){return this.transImgURL;}}var I=this.centerMesh.zoom;if(this.getTileURL){var J=this.tileLayerConfig.zoomLevels[I];
var t=J.resolution;var R=J.resolution*J.stretchRatio;var s=this.tileLayerConfig.tileImageWidth*t;var B=this.tileLayerConfig.tileImageHeight*R;
var Q=this.tileLayerConfig.bounds.getMinX()+D*s;var P=Q+s;var O=this.tileLayerConfig.bounds.getMinY()+C*B;
var N=O+B;var u=new e.geometry.Rectangle(Q,O,P,N,this.tileLayerConfig.srid);var K=this.getTileURL(I,D,C,u);
if(!K){return this.transImgURL;}else{return K;}}else{var v=null;var A=null;if(this.isLocalTileLayer){v=this.tileImagesURL;
var G=Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw)-1;
var E=Math.ceil((this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)-1;
this.maxMeshY=E;if(this.tileLayerConfig.isXYZStorageScheme){A=this.tileImagesURL+"/"+I+"/";if(this.tileLayerConfig.isInZXYOrder){A+=D+"/"+(this.maxMeshY-C)+"."+this.tileLayerConfig.tileImageFormat;
}else{A+=(this.maxMeshY-C)+"/"+D+"."+this.tileLayerConfig.tileImageFormat;}}else{var F=Math.max(G,E);
this.calcMeshCode(D,C,F);A=this.tileImagesURL+"/"+this.getMeshStr(I)+"."+this.tileLayerConfig.tileImageFormat;
}return A;}else{if(this.isDynamicTileLayer){return this.getDynamicTL_URL(D,C,I);}else{if(this.isWMSTileLayer){return this.getWMSTL_URL(D,C,I);
}else{if(this.mapSource){v=this.mapSource.toUpperCase();}else{v=this.dataSource.toUpperCase()+"."+this.tileLayer.toUpperCase();
}A=this.serverURL+"?request=gettile&format="+this.tileLayerConfig.tileImageFormat;A+="&zoomlevel="+I+"&mapcache="+v+"&mx="+D+"&my="+C;
if(this.reloadNumber){A+="&reload="+this.reloadNumber;}return A;}}}}},defaultImgPath_DynamicTL:function(t,v,s,A,z,y){var u;
if(e.notNull(this.serverMapRequest)){var x=this.serverMapRequest.clone();x.setImageWidth(t);x.setImageHeight(v);
x.setBBox(s,A,z,y,this.tileLayerConfig.srid);x.setProperties({isclienttilereq:true,tileServerURL:this.serverURL});
if(this.enableUTFGrid){x.setEnableUTFGrid(true);x.setUTFGridResolution(this.utfgridResolution);}u=x.toXMLString();
}return u;},getDynamicTL_URL:function(I,F,A){var u=this.tileLayerConfig.zoomLevels[A];var C=u.resolution;
var B=u.resolution*u.stretchRatio;var J=this.tileLayerConfig.tileImageWidth;var D=this.tileLayerConfig.tileImageHeight;
var G=J*C;var E=D*B;var z=this.tileLayerConfig.bounds.getMinX()+I*G;var t=z+G;var v=this.tileLayerConfig.bounds.getMinY()+F*E;
var s=v+E;var K;if(e.isNull(this.customImgPath_DynamicTL)){K=this.defaultImgPath_DynamicTL(J,D,z,v,t,s);
}else{K=this.customImgPath_DynamicTL(J,D,z,v,t,s,this.urlBuilderParams);}return K;},buildWMSTL_URL:function(A,z,v,u,t,s){var x="";
var y=this.serverURL+"?request=getmap&bbox="+v+","+u+","+t+","+s+"&width="+A+"&height="+z;if(!e.isNull(this.optParams_WMSTL)){for(var B in this.optParams_WMSTL){if(B.toLowerCase()==="bgcolor"){x=x+"&"+B+"="+encodeURIComponent(this.optParams_WMSTL[B]);
}else{x=x+"&"+B+"="+this.optParams_WMSTL[B];}}}return y+x;},getWMSTL_URL:function(F,D,z){var u=this.tileLayerConfig.zoomLevels[z];
var B=u.resolution;var A=u.resolution*u.stretchRatio;var E=this.tileLayerConfig.tileImageWidth*B;var C=this.tileLayerConfig.tileImageHeight*A;
var w=this.tileLayerConfig.bounds.getMinX()+F*E;var t=w+E;var v=this.tileLayerConfig.bounds.getMinY()+D*C;
var s=v+C;return this.buildWMSTL_URL(this.tileLayerConfig.tileImageWidth,this.tileLayerConfig.tileImageHeight,w,v,t,s);
},meshUTFGridPath:function(E,C){if(this.parentMap.wraparound){if(C<0||C>=(this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh){return this.transUTFGridURL;
}else{if(E<0){while(true){E=parseInt(Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw))+E;
if(E>=0){break;}}}else{if(E>=(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw){while(true){E=E-parseInt(Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw));
if(E<(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw){break;
}}}}}}else{if(E<0||E>=(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw||C<0||C>=(this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh){return this.transUTFGridURL;
}}if(this.visibleBound){var M=Math.floor((this.visibleBound.getMinX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw);
var L=Math.ceil((this.visibleBound.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw);
var z=Math.floor((this.visibleBound.getMinY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh);
var w=Math.ceil((this.visibleBound.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh);
if(E<M||E>=L||C<z||C>=w){return this.transUTFGridURL;}}var J=this.centerMesh.zoom;if(this.getTileURL){var K=this.tileLayerConfig.zoomLevels[J];
var t=K.resolution;var R=K.resolution*K.stretchRatio;var s=this.tileLayerConfig.tileImageWidth*t;var B=this.tileLayerConfig.tileImageHeight*R;
var Q=this.tileLayerConfig.bounds.getMinX()+E*s;var P=Q+s;var O=this.tileLayerConfig.bounds.getMinY()+C*B;
var N=O+s;var u=new e.geometry.Rectangle(Q,O,P,N,this.tileLayerConfig.srid);var D=this.getTileURL(J,E,C,u);
if(!D){return this.transUTFGridURL;}else{return D;}}else{var v=null,A=null;if(this.isLocalTileLayer){v=this.tileImagesURL;
var I=Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw)-1;
var F=Math.ceil((this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)-1;
this.maxMeshY=F;if(this.tileLayerConfig.isXYZStorageScheme){A=this.tileImagesURL+"/"+J+"/";if(this.tileLayerConfig.isInZXYOrder){A+=E+"/"+(this.maxMeshY-C)+".json";
}else{A+=(this.maxMeshY-C)+"/"+E+".json";}}else{var G=Math.max(I,F);this.calcMeshCode(E,C,G);A=this.tileImagesURL+"/"+this.getMeshStr(J)+".json";
}return A;}else{if(this.mapSource){v=this.mapSource.toUpperCase();}else{v=this.dataSource.toUpperCase()+"."+this.tileLayer.toUpperCase();
}A=this.serverURL+"?request=getutfgrid&format=json";A+="&zoomlevel="+J+"&mapcache="+v+"&mx="+E+"&my="+C;
if(this.reloadNumber){A+="&reload="+this.reloadNumber;}return A;}}},bindAndLoadTile:function(t){var s=this;
var u=e.$(t.node);u.imgLoadFinished=false;u.bind("load",function(){u.imgLoadFinished=true;u.unbind("load");
u.css("display","");if(s.enableUTFGrid){s.fetchUTFGrid(t);}var w=new e.event.LayerEvent(e.event.LayerEvent.TILE_IMG_LOADED,s);
s.fire(e.event.LayerEvent.TILE_IMG_LOADED,w);});u.bind("error",function v(){u.unbind("error");u.imgLoadFinished=true;
var w=new e.event.LayerEvent(e.event.LayerEvent.TILE_IMG_LOAD_ERROR,s);s.fire(e.event.LayerEvent.TILE_IMG_LOAD_ERROR,w);
});},pan:function(){if(e.isNull(this.parentMap)){return;}var G=this.getRealZoomLevel(this.parentMap.getMapContext().getZoomLevel());
if(!this.checkVisible(G)){var P=e.event;var O=new P.MapEvent(P.LayerEvent.FINISH_LOAD,this);O.mapContext=this.parentMap.getMapContext();
this.fire(P.LayerEvent.FINISH_LOAD,O);return;}var R=this.parentMap.getMapContext();var u=R.getCenterPoint();
var S=R.getTransform().toScreenPoint(u.getX(),u.getY());var W=this.origLeft-S.x+this.winWidth/2+this.offsetX;
var V=this.origTop-S.y+this.winHeight/2+this.offsetY;var w=W+this.tileMinX;var v=V+this.tileMinY;var K=0;
var N=0;while(true){var s=w-K*this.tileImageWidth;if(s>0){K++;continue;}var aa=v-N*this.tileImageHeight;
if(aa>0){N++;continue;}var ab=w+(this.tileNumX-K)*this.tileImageWidth-this.winWidth;if(ab<0){K--;continue;
}var y=v+(this.tileNumY-N)*this.tileImageHeight-this.winHeight;if(y<0){N--;continue;}var T=ab+s,I=y+aa;
if(T>this.tileImageWidth){K++;continue;}else{if(T<(-1)*this.tileImageWidth){K--;continue;}}if(I>this.tileImageHeight){N++;
continue;}if(I<(-1)*this.tileImageHeight){N--;continue;}break;}var L=this.tileMinX-K*this.tileImageWidth;
var J=this.tileMinY-N*this.tileImageHeight;this.divLeft=W+L;this.divTop=V+J;this.jqLayerDiv.css({left:W,top:V});
if(K===0&&N===0){return;}var D=Math.floor(this.tileNumX/2);var Z=Math.floor(this.tileNumY/2);var C=this.centerMesh.mX-D;
var A=this.centerMesh.mY+Z;var ac=0;var Y,E,U;var Q,x;var M;var ad;if(K!==0){for(Y=0;(K>0?Y<K:Y>K);(K>0?Y++:Y--)){var z;
if(K>0){z=this.tileMinX-(Y+1)*this.tileImageWidth;}else{z=this.tileMinX+(this.tileNumX-Y)*this.tileImageWidth;
}if(K>0){this.leftNum--;}else{this.leftNum++;}if(K>0){E=this.tileArray[this.tileArray.length-1];this.tileArray.pop();
for(ad=0;ad<E.length;ad++){e.util.DomUtil.setImageSrc(E[ad].node,null);if(N===0||(N>0&&ad<E.length-N)||(N<0&&ad>=-N)){x=this.meshImgPath(C-Y-1,A-ad);
e.util.DomUtil.setImageSrc(E[ad].node,x);E[ad].node[0].mx=C-Y-1;E[ad].node[0].my=A-ad;if(this.enableUTFGrid){if(this.isDynamicTileLayer){M=this.buildUTFGridReq(x);
}else{M=this.meshUTFGridPath(C-Y-1,A-ad);}E[ad].gridsrc=M;}this.bindAndLoadTile(E[ad]);ac++;}if(this.parentMap.wraparound){E[ad].node[0].style.zIndex=C-Y-1;
U=this.tileArray[0][ad].node[0].style.zIndex;if(U%this.tileNumInCSBoun===0){E[ad].node[0].style.left=parseInt(this.tileArray[0][ad].node[0].style.left)-this.tileImageWidth+this.coverPixel+"px";
}else{E[ad].node[0].style.left=parseInt(this.tileArray[0][ad].node[0].style.left)-this.tileImageWidth+"px";
}}else{e.$(E[ad].node).css("left",z);}}this.tileArray.unshift(E);}else{E=this.tileArray[0];this.tileArray.shift();
for(ad=0;ad<E.length;ad++){e.util.DomUtil.setImageSrc(E[ad].node,null);if(N===0||(N>0&&ad<E.length-N)||(N<0&&ad>=-N)){x=this.meshImgPath(C+this.tileNumX-Y,A-ad);
e.util.DomUtil.setImageSrc(E[ad].node,x);E[ad].node[0].mx=C+this.tileNumX-Y;E[ad].node[0].my=A-ad;if(this.enableUTFGrid){if(this.isDynamicTileLayer){M=this.buildUTFGridReq(x);
}else{M=this.meshUTFGridPath(C+this.tileNumX-Y,A-ad);}E[ad].gridsrc=M;}this.bindAndLoadTile(E[ad]);ac++;
}if(this.parentMap.wraparound){E[ad].node[0].style.zIndex=C+this.tileNumX-Y;U=this.tileArray[this.tileArray.length-1][ad].node[0].style.zIndex;
if(U%this.tileNumInCSBoun==(this.tileNumInCSBoun-1)||U%this.tileNumInCSBoun==-1){E[ad].node[0].style.left=parseInt(this.tileArray[this.tileArray.length-1][ad].node[0].style.left)+this.tileImageWidth-this.coverPixel+"px";
}else{E[ad].node[0].style.left=parseInt(this.tileArray[this.tileArray.length-1][ad].node[0].style.left)+this.tileImageWidth+"px";
}}else{e.$(E[ad].node).css("left",z);}}this.tileArray.push(E);}}}if(N!==0){var X;for(X=0;(N>0?X<N:X>N);
(N>0?X++:X--)){var B;if(N>0){B=this.tileMinY-(X+1)*this.tileImageHeight;this.topNum++;}else{B=this.tileMinY+(this.tileNumY-X)*this.tileImageHeight;
this.topNum--;}for(Y=0;Y<this.tileArray.length;Y++){E=this.tileArray[Y];var F;if(N>0){F=E[E.length-1];
Q=F.node;e.util.DomUtil.setImageSrc(Q,null);E.pop();E.unshift(F);e.$(Q).css("top",B);x=this.meshImgPath(C-K+Y,A+X+1);
e.util.DomUtil.setImageSrc(Q,x);Q[0].mx=C-K+Y;Q[0].my=A+X+1;if(this.enableUTFGrid){if(this.isDynamicTileLayer){M=this.buildUTFGridReq(x);
}else{M=this.meshUTFGridPath(C-K+Y,A+X+1);}E[0].gridsrc=M;}this.bindAndLoadTile(E[0]);ac++;}else{F=E[0];
Q=F.node;e.util.DomUtil.setImageSrc(Q,null);E.shift();E.push(F);e.$(Q).css("top",B);x=this.meshImgPath(C-K+Y,A-this.tileNumY+X);
e.util.DomUtil.setImageSrc(Q,x);Q[0].mx=C-K+Y;Q[0].my=A-this.tileNumY+X;if(this.enableUTFGrid){if(this.isDynamicTileLayer){M=this.buildUTFGridReq(x);
}else{M=this.meshUTFGridPath(C-K+Y,A-this.tileNumY+X);}E[E.length-1].gridsrc=M;}this.bindAndLoadTile(E[E.length-1]);
ac++;}}}}this.requiredBinds+=ac;if(this.parentMap.wraparound){this.tileMinX=parseInt(this.tileArray[0][0].node[0].style.left);
}else{this.tileMinX=this.tileMinX-K*this.tileImageWidth;}this.tileMinY=this.tileMinY-N*this.tileImageHeight;
this.centerMesh.moveMeshCode(-K,N);},refresh:function d(u,t){if(e.isNull(this.parentMap)){return;}if(e.isNull(t)){t=true;
}d.base.call(this,u,t);this.reloadNumber=Math.round(Math.random()*10000000000);if(this.parentMap){this.parentMap.getMapContext().getTransform();
this.clearLayer();this.init();}if(t){var s=new e.event.LayerEvent(e.event.LayerEvent.AFTER_REFRESH,this);
if(this.parentMap){s.mapContext=this.parentMap.getMapContext();}this.fire(e.event.LayerEvent.AFTER_REFRESH,s);
}},checkVisible:function(t){if(this.initError){return false;}if(!this.isVisible()){return false;}if(t>=this.tileLayerConfig.zoomLevels.length){return false;
}if(t<this.minVisibleLevel||t>this.maxVisibleLevel){return false;}if(this.parentMap.enableZoomLevels){for(var s=0;
s<this.parentMap.enableZoomLevels.length;s++){if(this.parentMap.enableZoomLevels[s]==t){return true;}}return false;
}return true;},clearLayer:function(){if(this.jqLayerDiv&&this.zoomControl&&!this.zoomControl.zooming){this.jqLayerDiv.remove();
this.jqLayerDiv=null;}this.tileArray=[];},changeOpacity:function(){var u=this.tileArray.length;var w=e.util.DomUtil.changeOpacity;
for(var v=0;v<u;v++){var s=this.tileArray[v].length;for(var t=0;t<s;t++){w(this.tileArray[v][t].node,this.opacity);
}}},zoom:function(t,v,x,s){var w=this.getRealZoomLevel(t);var u=this.getRealZoomLevel(v);if(!this.checkVisible(w)){this.init();
return;}if(!this.zoomControl){this.zoomControl=new e.layer.TileZoomAnimation(this);}if(!this.checkVisible(u)){this.clearLayer();
this.zoomControl.tileInitialized();return;}if(this.parentMap.tileLayerZoomAnimation){if(this.zoomControl.scaling){this.init();
this.zoomControl.endScaling();}else{this.zoomControl.showTiles(w,u,x,s);}}else{this.init();this.zoomControl.tileInitialized();
}},getTileServerURL:function(){if(this.serverURL==this.parentMap.mapviewerURL){this.serverURL=this.serverURL+"/mcserver";
}return this.serverURL;},setVisibleImpl:function(){if(this.jqLayerDiv){this.jqLayerDiv.css("visibility",this.visible?"visible":"hidden");
}if(this.visible){this.init();}},getCustomTags:function(){if(this.tileLayerConfig&&this.tileLayerConfig.customTags){return this.tileLayerConfig.customTags;
}else{return{};}},destroy:function o(){this.clearLayer();if(this.zoomContorl){this.zoomControl.destroy();
}this.initError=null;this.zoomControl=null;o.base.call(this);},getEnabledConfig:function(t){if(this.parentMap.enableZoomLevels){var v=new e.layer.TileLayerConfig();
v.bounds=t.bounds;v.srid=t.srid;v.tileImageFormat=t.tileImageFormat;v.isTransparentImage=t.isTransparentImage;
v.tileImageWidth=t.tileImageWidth;v.tileImageHeight=t.tileImageHeight;v.customTags=t.customTags;v.zoomLevels=[];
var w=[];for(var u=0;u<this.parentMap.enableZoomLevels.length;u++){if(t.zoomLevels.length<=this.parentMap.enableZoomLevels[u]||this.parentMap.enableZoomLevels[u]<0){continue;
}var s=t.zoomLevels[this.parentMap.enableZoomLevels[u]];if(s){w.push(this.parentMap.enableZoomLevels[u]);
v.zoomLevels.push(s);}else{e.util.Logger.warning("MAPVIEWER_9039","OM.layer.Tilelayer.setEnabledZoomLevels","["+this.parentMap.enableZoomLevels[u]+"]");
}}this.parentMap.enableZoomLevels=w;return v;}return t;},getRealZoomLevel:function(t){if(this.parentMap.enableZoomLevels){if(t>=this.parentMap.enableZoomLevels.length){t=this.parentMap.enableZoomLevels.length;
}var s=this.parentMap.enableZoomLevels[t];return s;}return t;},exportToSVG:function(v){var s=parseInt(this.jqLayerDiv.css("left"));
var w=parseInt(this.jqLayerDiv.css("top"));var t=this.parentMap.graphics;t.setLeftTop(v,s,w);var u=this;
u.loadImg=0;this.jqLayerDiv.find("img").each(function(){var z=this.src;var y=e.$(this);s=parseInt(y.css("left"));
w=parseInt(y.css("top"));u.loadImg++;var x=t.drawImage({x:s,y:w},{src:z,width:256,height:256},{group:v});
x.handleEvent=function(A){this.resourceUpdate(A);u.loadImg--;};});return v;},drawTilesImages:function(t,x){var s=this.parentMap.getMapCenter();
var y=this.serverURL+"?request=getmap&mapcache="+this.dataSource+"."+this.tileLayer+"&zoomlevel="+this.parentMap.getMapZoomLevel()+"&cx="+s.getX()+"&cy="+s.getY()+"&width="+t+"&height="+x;
this.loadingImg=true;var v=this;var u=new Image();u.onload=function(){v.loadingImg=false;v.canvas.getContext("2d").drawImage(u,0,0,t,x);
};u.onerror=function(){v.loadingImg=false;v.canvas=null;};u.src=y;},clone:function n(s){var t=n.base.call(this,s);
if(t.displayed){t.jqLayerDiv=null;t.displayed=false;t.zoomControl=null;}return t;},prepareDrag:function(){var s=this.jqLayerDiv[0];
this.downLoc={l:s.offsetLeft,t:s.offsetTop};},calcMeshCode:function(v,u,s){var t=Math.ceil((Math.log(s)/Math.log(this.TILING_FACTOR)));
this.meshLength=Math.max(1,t);this.xFactors.length=this.meshLength;this.yFactors.length=this.meshLength;
this.factors(v,this.xFactors);this.factors(u,this.yFactors);},factors:function(s,w){for(var v=0;v<this.meshLength;
v++){var u=s/this.TILING_FACTOR;w[this.meshLength-1-v]=Math.floor(s%this.TILING_FACTOR);s=u;}},getMeshStr:function(u){var t="/"+u;
for(var s=0;s<this.meshLength;s++){if(s<this.meshLength){t+="/";}t+=this.xFactors[s]+"_"+this.yFactors[s];
}return t;},tileImgLoadedHandler:function(s){if(s instanceof e.event.LayerEvent&&(s.type===e.event.LayerEvent.TILE_IMG_LOADED||s.type===e.event.LayerEvent.TILE_IMG_LOAD_ERROR)){var u=this.requiredBinds+this.initRequiredBinds;
if(u===0){u=1;}this.tilesImgLoaded++;this.tilesPercent=100*(this.tilesImgLoaded/u);var t;if(this.tilesImgLoaded>=u){t=new e.event.LayerEvent(e.event.LayerEvent.ALL_TILES_LOADED,this);
this.tilesImgLoaded=0;this.requiredBinds=0;this.initRequiredBinds=0;}else{t=new e.event.LayerEvent(e.event.LayerEvent.TILE_IMG_LOADING,this);
}this.lastEvent=t.type;if(u>1){this.parentMap.showProgressBar(this.parentMap.getProgress());}else{}}else{return;
}},getTilesPercentStatus:function(){return this.tilesPercent;},setEnableUTFGridInfoWindow:function(s){this.enableUTFGridInfoWindow=s;
this.parentMap.updateUTFGridLayerCount();},setInfoWindowTrigger:function(s){this.mouseETypeUTFGrid=((s===e.event.MouseEvent.MOUSE_OVER||s===e.event.MouseEvent.MOUSE_MOVE)?e.event.MouseEvent.MOUSE_MOVE:e.event.MouseEvent.MOUSE_CLICK);
this.parentMap.validateUTFGridLayerTriggers();this.parentMap.updateUTFGridLayerListener();},setVisible:function l(s){l.base.call(this,s);
this.parentMap.changeOverView();this.parentMap.updateUTFGridLayerCount();},getUTFGridResolution:function(s){var u;
if(e.isNull(s)){return this.UTFGRID_RESOLUTION;}else{try{u=parseInt(s);if(e.isNull(u)||u<1){return this.UTFGRID_RESOLUTION;
}else{return u;}}catch(t){return this.UTFGRID_RESOLUTION;}}},setBindingParameters:function(s){var t=this.serverMapRequest;
if(e.notNull(t)){t.setBindingParameters(s);}}});e.layer.TileLayerConfig=function(s){this.tileImageWidth=256;
this.tileImageHeight=256;this.tileImageFormat="PNG";this.isTransparentImage=false;this.isXYZStorageScheme=false;
this.isInZXYOrder=false;this.enableUTFGrid=false;this.utfgridResolution=4;if(s){this.srid=s.srid;this.zoomLevels=s.zoomLevels;
this.bounds=s.bounds;if(s.tileImageWidth){this.tileImageWidth=s.tileImageWidth;}if(s.tileImageHeight){this.tileImageHeight=s.tileImageHeight;
}if(s.tileImageFormat){this.tileImageFormat=s.tileImageFormat;}if(s.isTransparentImage){this.isTransparentImage=s.isTransparentImage;
}if(s.customTags){this.customTags=s.customTags;}if(s.isXYZStorageScheme){this.isXYZStorageScheme=s.isXYZStorageScheme;
if(s.isInZXYOrder){this.isInZXYOrder=s.isInZXYOrder;}}if(s.enableUTFGrid){this.enableUTFGrid=true;this.utfgridResolution=s.utfgridResolution;
}}};e.layer.TileLayerConfig.prototype.equals=function(t){if(this.srid!=t.srid){return false;}if(this.zoomLevels&&t.zoomLevels&&this.zoomLevels.length!=t.zoomLevels.length){return false;
}var s=this.zoomLevels.length;for(var u=0;u<s;u++){if(this.zoomLevels[u].resolution!=t.zoomLevels[u].resolution||this.zoomLevels[u].stretchRatio!=t.zoomLevels[u].stretchRatio){return false;
}}return true;};e.layer.TileLayerConfig.CONFIG_ELOCATION=new e.layer.TileLayerConfig();e.layer.TileLayerConfig.CONFIG_S_ELOCATION=new e.layer.TileLayerConfig();
e.layer.TileLayerConfig.CONFIG_GOOGLE=new e.layer.TileLayerConfig();e.layer.TileLayerConfig.CONFIG_TOMTOM=new e.layer.TileLayerConfig();
e.layer.TileLayerConfig.CONFIG_LOCATIONBOX=new e.layer.TileLayerConfig();e.layer.TileLayerConfig.CONFIG_WGS84_WORLD=new e.layer.TileLayerConfig();
e.layer.TileLayerConfig.CONFIG_OSM=new e.layer.TileLayerConfig();e.layer.TileLayerConfig.setConstants=function(){var s=e.layer.TileLayerConfig;
var t=new e.universe.WorldMercatorUniverse();s.CONFIG_ELOCATION.zoomLevels=t.getZoomLevels();s.CONFIG_ELOCATION.srid=t.getSRID();
s.CONFIG_ELOCATION.bounds=t.getMapBounds();s.CONFIG_ELOCATION.tileImageFormat="PNG";s.CONFIG_ELOCATION.isTransparentImage=false;
t=new e.universe.WorldMercatorUniverse();s.CONFIG_S_ELOCATION.zoomLevels=t.getZoomLevels();s.CONFIG_S_ELOCATION.srid=t.getSRID();
s.CONFIG_S_ELOCATION.bounds=t.getMapBounds();s.CONFIG_S_ELOCATION.tileImageFormat="PNG";s.CONFIG_S_ELOCATION.isTransparentImage=false;
t=new e.universe.WorldMercatorUniverse();s.CONFIG_GOOGLE.zoomLevels=t.getZoomLevels();s.CONFIG_GOOGLE.srid=t.getSRID();
s.CONFIG_GOOGLE.bounds=t.getMapBounds();if(e.notNull(e.universe.TomTomUniverse)){t=new e.universe.TomTomUniverse();
s.CONFIG_TOMTOM.zoomLevels=t.getZoomLevels();s.CONFIG_TOMTOM.srid=t.getSRID();s.CONFIG_TOMTOM.bounds=t.getMapBounds();
}if(e.notNull(e.universe.LocationBoxUniverse)){t=new e.universe.LocationBoxUniverse();s.CONFIG_LOCATIONBOX.zoomLevels=t.getZoomLevels();
s.CONFIG_LOCATIONBOX.srid=t.getSRID();s.CONFIG_LOCATIONBOX.bounds=t.getMapBounds();}t=new e.universe.LatLonUniverse();
s.CONFIG_WGS84_WORLD.zoomLevels=t.getZoomLevels();s.CONFIG_WGS84_WORLD.srid=t.getSRID();s.CONFIG_WGS84_WORLD.bounds=t.getMapBounds();
t=new e.universe.OSMUniverse();s.CONFIG_OSM.zoomLevels=t.getZoomLevels();s.CONFIG_OSM.srid=t.getSRID();
s.CONFIG_OSM.bounds=t.getMapBounds();};e.layer.TileLayerConfig.setConstants();e.layer.TileZoomAnimation=e.Class.extend({initialize:function(s){this.ldiff=0;
this.tdiff=0;this.tileLayer=s;this.tileArray=null;this.aniDiv=null;this.zooming=false;this.timeouts=[];
this.imageWidth=s.tileLayerConfig.tileImageWidth;this.imageHeight=s.tileLayerConfig.tileImageHeight;this.animate=e.browser.msie&&!("transition" in document.documentElement.style)?false:true;
},computeTilesOffset:function(){var t=this.tileLayer.jqLayerDiv;if(t){var s=e.util.DomUtil.getElementPos(t);
this.ldiff=-s.left;this.tdiff=-s.top;}},getScreenXY:function(t,A,z){var u=this.tileLayer.tileLayerConfig.zoomLevels[z];
var w=1/u.resolution;var v=w/u.stretchRatio;var s=this.newCenter;return{x:(t-s.getX())*w,y:(s.getY()-A)*v};
},copyTiles:function(s){if(this.aniDiv&&this.aniDiv.parent()){return false;}this.oldLevel=s;this.aniDiv=this.tileLayer.jqLayerDiv;
this.tileArray=this.tileLayer.tileArray;this.aniDiv.css("zIndex",this.tileLayer.zIndex+1);return true;
},transformTiles:function(K,E){var x=this.getScreenXY(this.oldCenter.getX(),this.oldCenter.getY(),K);
var B=this.getScreenXY(this.newCenter.getX(),this.newCenter.getY(),K);var J=this.tileLayer.tileLayerConfig;
var C=J.zoomLevels[K];var s=J.zoomLevels[E];var y=J.bounds;var z=this.getLeftTopTile();var I=z.x*this.imageWidth*C.resolution+y.getMinX();
var F=(z.y+1)*this.imageHeight*C.resolution*C.stretchRatio+y.getMinY();var D=this.getScreenXY(I,F,K);
var u=this.getScreenXY(I,F,E);var L=C.resolution/s.resolution;var A=(B.x-x.x+D.x-u.x)*-1-z.l*(L-1);var v=(B.y-x.y+D.y-u.y)*-1-z.t*(L-1);
var w="translate3d("+A+"px,"+v+"px, 0px) scale("+L+")";var G=this;if(e.browser.webkit3d){this.aniDiv.css("-webkit-transition","-webkit-transform 0.25s cubic-bezier(0,0,0.5,1)");
this.aniDiv.bind("webkitTransitionEnd",function(){G.zooming=false;});this.aniDiv.css("-webkit-transform",w);
}else{this.aniDiv.css("transition","transform 0.25s cubic-bezier(0,0,0.5,1)");this.aniDiv.bind("transitionend",function(){G.zooming=false;
});this.aniDiv.css("transform",w);}this.zooming=true;},getLeftTopTile:function(){var s=this.tileArray;
var t;if(s[0][0].node[0].src!==this.tileLayer.transImgURL){t=s[0][0].node;}else{if(s[1][0].node[0].src!==this.tileLayer.transImgURL){t=s[1][0].node;
}else{if(s[0][1].node[0].src!==this.tileLayer.transImgURL){t=s[0][1].node;}else{t=s[1][1].node;}}}var u=t.position();
return{x:t[0].mx,y:t[0].my,l:u.left,t:u.top};},showTiles:function(t,u,v,s){if(!this.tileLayer.isVisible()||e.isNull(this.tileLayer.tileArray)||this.tileLayer.tileLayerConfig.isTransparentImage){this.reset();
return;}this.newCenter=s;this.oldCenter=v;if(this.animate){this.computeTilesOffset();this.copyTiles(t);
this.transformTiles(this.oldLevel,u);this.tileLayer.init();this.tileLayer.jqLayerDiv.css("visibility","hidden");
}else{this.tileLayer.jqLayerDiv.css("visibility","hidden");this.tileLayer.init();}},reset:function(){this.ldiff=0;
this.tdiff=0;if(this.aniDiv&&this.aniDiv.parent()){this.aniDiv.remove();}this.tileArray=null;this.aniDiv=null;
this.zooming=false;for(var s=0;s<this.timeouts.length;s++){clearTimeout(this.timeouts[s]);}this.timeouts=[];
if(this.tileLayer.isVisible()){this.tileLayer.init();}},tileInitialized:function(){if(!this.tileLayer||!this.tileLayer.parentMap){return;
}if((this.hasTilesLoadFinished()||this.tileLayer.isLocalTileLayer)&&!this.zooming){if(this.aniDiv){this.startClear();
}if(this.tileLayer.jqLayerDiv){this.tileLayer.jqLayerDiv.css("visibility",this.tileLayer.visible?"visible":"hidden");
}var v=e.event;var u=new v.LayerEvent(v.LayerEvent.FINISH_LOAD,this.tileLayer);u.mapContext=this.tileLayer.parentMap.getMapContext();
this.tileLayer.fire(v.LayerEvent.FINISH_LOAD,u);}else{var s=this;var t=setTimeout(function(){s.tileInitialized();
},70);this.timeouts.push(t);}},hasTilesLoadFinished:function(){if(!(this.tileArray)&&!this.tileLayer.tileArray){return true;
}if(!this.tileLayer.isLocalTileLayer){for(var t=0;t<this.tileLayer.tileArray.length;t++){for(var s=0;
s<this.tileLayer.tileArray[t].length;s++){if(!this.hasTileLoaded(this.tileLayer.tileArray[t][s].node)){return false;
}}}}return true;},hasTileLoaded:function(s){if(s[0].src===e.util.MiscUtil.transparentImgURL){return true;
}if(e.browser.msie){return s.imgLoadFinished;}else{return(Math.abs(s[0].offsetWidth-this.imageWidth)<=1);
}},startClear:function(){if(e.browser.msie){for(var t=0;t<this.tileLayer.tileArray.length;t++){for(var s=0;
s<this.tileLayer.tileArray[t].length;s++){this.tileLayer.tileArray[t][s].node.css("display","");}}}if(this.aniDiv){this.aniDiv.css("zIndex",this.tileLayer.zIndex);
}this.clearCloneTiles();},clearCloneTiles:function(){if(!this.tileLayer||!this.tileLayer.parentMap){return;
}if(this.hasTilesLoadFinished()){var v;for(v=0;v<this.tileLayer.tileArray.length;v++){for(var u=0;u<this.tileLayer.tileArray[v].length;
u++){this.tileLayer.tileArray[v][u].node.css("display","");}}this.removeCloneTiles();for(v=0;v<this.timeouts.length;
v++){clearTimeout(this.timeouts[v]);}this.timeouts=[];var x=e.event;var w=new x.LayerEvent(x.LayerEvent.FINISH_LOAD,this.tileLayer);
w.mapContext=this.tileLayer.parentMap.getMapContext();this.tileLayer.fire(x.LayerEvent.FINISH_LOAD,w);
}else{var s=this;var t=setTimeout(function(){s.clearCloneTiles();},70);this.timeouts.push(t);}},removeCloneTiles:function(){if(this.aniDiv&&this.aniDiv.parent()){this.aniDiv.remove();
this.aniDiv=null;}this.zooming=false;},scaleTiles:function(v){if(!this.scaling&&(!this.tileLayer.isVisible()||e.isNull(this.tileLayer.tileArray))){this.reset();
return;}var y,x,C;if(!this.scaling){this.computeTilesOffset();this.copyTiles();this.scaling=true;for(y=0;
y<this.tileArray.length;y++){for(x=0;x<this.tileArray[y].length;x++){C=this.tileArray[y][x].node;var A=e.util.DomUtil.getElementPos(e.$(C));
C.origLeft=A.left;C.origTop=A.top;}}}var t=this.tileLayer.tileLayerConfig;var z=t.tileImageWidth*v;var s=t.tileImageWidth*v;
var w=this.tileLayer.parentMap.getMapContext();var B=w.getDeviceWidth()/2+this.ldiff;var u=w.getDeviceHeight()/2+this.tdiff;
for(y=0;y<this.tileArray.length;y++){for(x=0;x<this.tileArray[y].length;x++){C=this.tileArray[y][x].node;
this.scaleTile(C,v,z,s,B,u);}}},scaleTile:function(z,B,u,y,x,A){z.zoomFinished=true;if(B==1){return;}var s=x-(x-z.origLeft)*B;
var v=A-(A-z.origTop)*B;e.$(z).css({left:s,top:v,width:(u+1),height:(y+1)});},endScaling:function(){this.scaling=false;
var y=this.tileLayer.jqLayerDiv;if(y){var s=e.util.DomUtil.getElementPos(y);var v=s.left;var x=s.top;
var w=e.util.DomUtil.getElementPos(y.parent().parent());var t=w.left;var u=w.Top;y.css({left:v+t,top:x+u});
}this.startClear();},destroy:function(){this.tileLayer=null;}});e.layer.Mesh=function(u,t,s,v){var x=u.zoomLevels[v];
this.mw=u.tileImageWidth*x.resolution;this.mh=u.tileImageHeight*x.resolution*x.stretchRatio;var w=u.bounds;
this.mX=Math.floor((t-w.getMinX())/this.mw);this.mY=Math.floor((s-w.getMinY())/this.mh);this.zoom=v;this.minX=this.mX*this.mw+w.getMinX();
this.minY=this.mY*this.mh+w.getMinY();};e.layer.Mesh.prototype.moveMeshCode=function(t,s){this.mX=this.mX+t;
this.mY=this.mY+s;};e.layer.VectorLayer=e.layer.Layer.extend({initialize:function b(s,A){if(e.isNull(A)||e.isNull(A.def)||e.isNull(A.def.type)){throw new Error("Invalid or null VectorLayer options found.");
}var u=A.def;this.options=A;b.base.call(this,s);this.useRTree=(e.notNull(A&&A.useRTree))?A.useRTree:e.gv.useRTree;
this.layerType=e.LayerTypes.VECTOR;this.dataCache=new e.util.GeoDataCache(s);this.cachingEnabled=false;
this.dataLoaded=false;this.initError=false;this.name=s;var w=e.layer.VectorLayer;this.type=u.type;this.xRatio=2;
this.yRatio=2;this.searchBuffer=e.browser.touchSupported?10:5;this.enableXHR=(u&&u.enableXHR)?true:false;
this.selectArray=[];this.jsonp=false;if(typeof u.jsonp!=="undefined"){this.jsonp=u.jsonp;}this.flag=true;
this.mbr=null;this.bfMbr=null;var y=u.dataSource||u.datasource;if(this.type==w.TYPE_PREDEFINED){this.dataSource=y;
this.themeName=u.theme;if(u.url){this.serverURL=u.url;}this.loadOnDemand=u.loadOnDemand;this.workspace=u.workspace;
this.featureArray=[];}else{if(this.type==w.TYPE_LOCAL){this.featureArray=[];var x=u.features?u.features.length:0;
for(var v=0;v<x;v++){var z=u.features[v];if(this.isValidId(z.id)){this.featureArray.push(z);}else{e.util.Logger.warning("MAPVIEWER_9005","OM.layer.VectorLayer");
continue;}}}else{if(this.type==w.TYPE_JDBC){this.dataSource=y;this.sql=u.sql;this.serverURL=u.url;this.featureArray=[];
this.geometryColumn=u.geometryColumn;this.labelColumn=u.labelColumn?u.labelColumn.toUpperCase():null;
this.keyColumn=u.keyColumn?u.keyColumn.toUpperCase():null;this.baseTable=u.baseTable?u.baseTable.toUpperCase():null;
this.loadOnDemand=u.loadOnDemand;this.workspace=u.workspace;this.jdbcSrid=e.notNull(u.jdbcSrid)?u.jdbcSrid:8307;
}else{if(this.type==w.TYPE_DATAPACK){var t=u.dataPackUrl||u.url;if(t){this.serverURL=t;}else{this.serverURL="invalid url";
}this.featureArray=[];this.geometryColumn=u.geometryColumn;this.labelColumn=u.labelColumn?u.labelColumn.toUpperCase():null;
}else{if(this.type==w.TYPE_GEORSS){this.serverURL=u.url;}else{if(this.type==w.TYPE_WFS){}}}}}}if(A.renderingStyle&&A.renderingStyle.effects&&A.renderingStyle.effects.length>0){this.visualFilter=A.renderingStyle.effects[0];
}this.renderingStyle=A.renderingStyle;if(A.renderingStyle){this.renderingStyle=A.renderingStyle;}this.styleAttributes=A.styleAttributes;
this.boundingTheme=A.boundingTheme;this.infoWindow=e.isNull(A.infoWindow)?true:A.infoWindow;this.boundingZoomLevel=null;
this.selectionEnable=false;this.selectionMode=e.layer.VectorLayer.SINGLE_SELECTION;this.keepSelected=false;
this.bringToTopFlag=true;this.selectedFeatures=[];this.featureEditable=false;this.hoverFeature=null;this.hoverStyle=null;
this.hoverEnable=false;this.mapping=false;this.showToolTip=true;this.mouseCursor=e.CursorTypes.POINTER;
this.loadingStyle=0;this.areaIdx=0;this.changeManager=null;this.undoManager=null;this.attributeTypes=null;
this.notNullAttributes=[];this.rtree=null;this.segmentRtree={};this.sharedBoundary=false;this.selectionChecker=null;
this.pointerSensitivity=true;},setRenderingStyle:function(w,u){if(!w){return;}if(this.parentMap&&this.isServerSideStyle(w,"rendering")){if(u){this.styleAttributes=u;
}return;}var s=this.renderingStyle;var v=this.styleAttributes;this.renderingStyle=w;this.heatMap=null;
if(u){this.styleAttributes=u;if(w instanceof e.style.BucketStyle){w.generateBuckets(this.featureArray,this.styleAttributes,false);
}}if(w.effects&&w.effects.length>0){this.setVisualFilter(w.effects[0]);}if(!this.visible&&this.displayed){this.parentMap.graphics.remove(this.realGroup);
this.clearFeatureShapes();this.displayed=false;}if(this.displayed){if(e.util.Logger.DEBUG){console.time("setRenerdingStyle");
}var t=this.parentMap.graphics;t.remove(this.realGroup);this.clearFeatureShapes();this.displayFeatures(false);
if(e.util.Logger.DEBUG){console.timeEnd("setRenerdingStyle");}if(this.getFeatureGeometryType()=="POINT"||this.renderingStyle.styleType=="PieChart"||this.renderingStyle.styleType=="BarChart"){this.parentMap.refreshVectorLayerLabels();
}}if(s!=w||!e.util.MiscUtil.arraysAreEqual(v,this.styleAttributes)){var x=new e.event.LayerEvent(e.event.LayerEvent.RENDERING_STYLE_CHANGED,this);
x.newStyle=w;x.attributes=u;if(this.parentMap){x.mapContext=this.parentMap.getMapContext();}this.fire(e.event.LayerEvent.RENDERING_STYLE_CHANGED,x);
}},getAllFeatures:function(){return this.featureArray;},size:function(){return(this.featureArray)?this.featureArray.length:0;
},getRenderingStyle:function(){return this.renderingStyle;},setLabelingStyle:function(w){if(!w){return;
}if(this.parentMap&&this.isServerSideStyle(w,"label")){return;}this.labelingStyle=w;this.setLabelsVisible(true);
if(this.displayed){var s=this.featureArray?this.featureArray.length:0;for(var v=0;v<s;v++){var u=this.featureArray[v];
u.setLabelingStyle(this.labelingStyle);}this.parentMap.refreshVectorLayerLabels();}var t=e.event.LayerEvent;
var x=new t(t.LABELING_STYLE_CHANGED,this);x.style=w;if(this.parentMap){x.mapContext=this.parentMap.getMapContext();
}this.fire(t.LABELING_STYLE_CHANGED,x);},getLabelingStyle:function(){return this.labelingStyle;},setLabelColumn:function(s){this.labelColumn=s;
},getLabelColumn:function(){return this.labelColumn;},getSelectedFeatures:function(){return this.selectedFeatures;
},setSelectStyle:function(t){if(!t){return;}else{if(this.parentMap&&this.isServerSideStyle(t,"select")){return;
}}this.enableFeatureSelection(true);this.selectionStyle=t;if(t.effects&&t.effects.length>0){this.setSelectVisualFilter(t.effects[0]);
}var s=e.event.LayerEvent;var u=new s(s.SELECTION_STYLE_CHANGED,this);u.style=t;if(this.parentMap){u.mapContext=this.parentMap.getMapContext();
}this.fire(s.SELECTION_STYLE_CHANGED,u);},getSelectStyle:function(){return this.selectionStyle;},setHoverStyle:function(t){if(!t){return;
}if(this.parentMap&&this.isServerSideStyle(t,"hover")){return;}this.enableFeatureHover(true);if(t.effects&&t.effects.length>0){this.setHoverVisualFilter(t.effects[0]);
}this.hoverStyle=t;var s=e.event.LayerEvent;var u=new s(s.SELECTION_STYLE_CHANGED,this);u.style=t;if(this.parentMap){u.mapContext=this.parentMap.getMapContext();
}this.fire(s.HOVER_STYLE_CHANGED,u);},getHoverStyle:function(){return this.hoverStyle;},setHoverVisualFilter:function(s){this.hoverFilter=s;
},clearSelectedFeatures:function(){var s=this.selectedFeatures?this.selectedFeatures.length:0;for(var u=s;
u>0;u--){var t=this.selectedFeatures.pop();t.enableFeatureEditing(false);this.resetFeatureStates(t);}},resetFeatureStates:function(t){t.selected=false;
t.hover=false;if(t.selectShape){t.graphics.remove(t.selectShape);t.selectShape=null;}if(t.hoverShape){t.graphics.remove(t.hoverShape);
t.hoverShape=null;}t.setRenderingStyle(t.oldStyle);var s=this.parentMap.graphics;if(t.shape){if(this.graphicFilter&&!this.visualFilter.applyToLayer){s.applyStyle(t.shape,{filter:this.graphicFilter});
}else{s.applyStyle(t.shape,{filter:s.oui.filters.NONE});}}},setSelectionChecker:function(s){if(typeof s==="function"){this.selectionChecker=s;
}},getSelectionChecker:function(){return this.selectionChecker;},setPointerSensitivity:function(s){this.pointerSensitivity=s;
if(this.realGroup){this.realGroup.applyStyle({pointerSensitivity:s});}},getPointerSensitivy:function(){return this.pointerSensitivity;
},selectFeature:function(z){if(!(z&&z.draggable)){if(!this.selectionEnable||(!this.selectionStyle&&!this.featureEditable)){return;
}}var x;if(e.notNull(this.selectionChecker)){var u=this.selectionChecker.call(this,z);if(!u){return;}}if(z.parentFeature){var v=z.parentFeature;
v.parentLayer.selectFeature(v);return v;}if(!z.selected&&z.displayed){if(this.selectionMode===e.layer.VectorLayer.SINGLE_SELECTION){this.clearSelectedFeatures();
}if(z.hoverShape){z.graphics.remove(z.hoverShape);z.hoverShape=null;}if(this.selectionStyle){if(!z.oldStyle){if(z.renderingStyle){z.oldStyle=z.renderingStyle;
}else{z.oldStyle=this.getDefaultRenderingStyle(z.geo.type);}}if(this.selectionStyle.styleType=="PulseAnimation"||this.selectionStyle.styleType=="AnimationColor"){var w=z.shape;
z.displayFeature([this.selectionStyle]);z.selectShape=z.shape;z.shape=w;}else{var t=this.getHoverSelectStyle(this.selectionStyle,z);
z.setRenderingStyle(t);}}if(z.displayed&&z.shape){x=this.parentMap.graphics;if(this.selectVisualFilter){var y=x.getGraphicFilter(this.selectVisualFilter);
x.applyStyle(z.shape,{filter:y});}else{x.applyStyle(z.shape,{filter:x.oui.filters.NONE});}z.startAnimation();
}if(this.featureEditable){z.enableFeatureEditing(true);}if(z.draggable){z.enableFeatureDragging(true);
}this.selectedFeatures.push(z);z.selected=true;if(this.bringToTopFlag){z.getShapeIndex();z.bringToTop();
}var A=e.event.LayerEvent;var s=new A(A.FEATURE_SELECTED,this);s.selectedFeature=z;s.mapContext=this.parentMap.getMapContext();
this.fire(A.FEATURE_SELECTED,s);}else{if(!this.keepSelected){this.deselectFeature(z);}}return z;},hover:function(u){if(!this.hoverEnable){return null;
}if(u.hover||u.selected){return null;}this.deHover(this.hoverFeature);if(!u.oldStyle){if(u.renderingStyle){u.oldStyle=u.renderingStyle;
}else{u.oldStyle=this.getDefaultRenderingStyle(u.geo.type);}}if(this.hoverStyle){if(this.hoverStyle.styleType=="PulseAnimation"||this.hoverStyle.styleType=="AnimationColor"){var t=u.shape;
u.displayFeature([this.hoverStyle]);u.hoverShape=u.shape;u.shape=t;}else{var v=this.getHoverSelectStyle(this.hoverStyle,u);
u.setRenderingStyle(v);}}if(u.displayed&&u.shape){if(this.hoverFilter){var s=this.parentMap.graphics.getGraphicFilter(this.hoverFilter);
this.parentMap.graphics.applyStyle(u.shape,{filter:s});}else{this.parentMap.graphics.applyStyle(u.shape,{filter:this.parentMap.graphics.oui.filters.NONE});
}u.startAnimation();}this.hoverFeature=u;u.hover=true;return u;},deHover:function(t){if(!t||!t.hover){return;
}var u=t.selected;if(t.editable){return;}if(t.hoverShape){t.graphics.remove(t.hoverShape);t.hoverShape=null;
}else{if(!u){t.setRenderingStyle(t.oldStyle);this.bringSelectedFeaturesToTop();if(t.displayed&&t.shape){var s=this.parentMap.graphics;
if(this.graphicFilter&&!this.visualFilter.applyToLayer){s.applyStyle(t.shape,{filter:this.graphicFilter});
}else{s.applyStyle(t.shape,{filter:s.oui.filters.NONE});}}}}if(this.hoverFeature){this.hoverFeature.hover=false;
this.hoverFeature=null;}},bringSelectedFeaturesToTop:function(){var u=this.getSelectedFeatures();if(e.notNull(u)){for(var t=0;
t<u.length;t++){var s=u[t];if(e.isNull(s.parentLayer)){e.util.Logger.warning(null,"VectorLayer.bringSelectedFeaturesToTop","Feature has no parent layer, possibly because feature ID is no longer valid: "+s.id);
return;}this.bringFeatureToTop(s);}}},deselectFeature:function(w){var t;if(w.selected){w.enableFeatureEditing(false);
if(w.selectShape){w.graphics.remove(w.selectShape);w.selectShape=null;}if(w.hover){if(this.hoverStyle){if(this.hoverStyle.styleType==="PulseAnimation"||this.hoverStyle.styleType==="AnimationColor"){var s=w.shape;
w.displayFeature([this.hoverStyle]);w.hoverShape=w.shape;w.shape=s;}else{var x=this.getHoverSelectStyle(this.hoverStyle,w);
w.setRenderingStyle(x);}}if(w.displayed&&w.shape){t=this.parentMap.graphics;if(this.hoverFilter){t.applyStyle(w.shape,{filter:this.hoverGraphicFilter});
}else{t.applyStyle(w.shape,{filter:t.oui.filters.NONE});}w.startAnimation();}}else{if(w.oldStyle){w.setRenderingStyle(w.oldStyle);
}if(w.displayed&&w.shape){t=this.parentMap.graphics;if(this.graphicFilter&&!this.visualFilter.applyToLayer){t.applyStyle(w.shape,{filter:this.graphicFilter});
}else{t.applyStyle(w.shape,{filter:t.oui.filters.NONE});}}}w.selected=false;this.bringSelectedFeaturesToTop();
var z=this.selectedFeatures?this.selectedFeatures.length:0;for(var v=0;v<z;v++){if(this.selectedFeatures[v]===w){this.selectedFeatures.splice(v,1);
break;}}var u=e.event.LayerEvent;var y=new u(u.FEATURE_DESELECTED,this);y.deselectedFeature=w;y.mapContext=this.parentMap.getMapContext();
this.fire(u.FEATURE_DESELECTED,y);}return w;},enableFeatureSelection:function(s,t){this.selectionEnable=s;
if(s){if(t==e.layer.VectorLayer.MULTIPLE_SELECTION||t==e.layer.VectorLayer.SINGLE_SELECTION){this.selectionMode=t;
}else{this.selectionMode=e.layer.VectorLayer.SINGLE_SELECTION;}}},getSelectionMode:function(){return this.selectionMode;
},setKeepSelected:function(s){this.keepSelected=s;},enableFeatureHover:function(s){this.hoverEnable=s;
},enableFeatureEditing:function(t){if(this.featureEditable===t){return true;}var v=e.layer.VectorLayer;
if(t){if(this.type===v.TYPE_JDBC||this.type===v.TYPE_PREDEFINED){if(e.isNull(this.keyColumn)||e.isNull(this.baseTable)||e.isNull(this.geometryColumn)){e.util.Logger.alert("MAPVIEWER_9052","OM.layer.VectorLayer.enableFeatureEditing","");
return false;}if(this.keyColumn.toUpperCase()==="ROWID"){e.util.Logger.alert("MAPVIEWER_9053","OM.layer.VectorLayer.enableFeatureEditing","");
return false;}}}this.featureEditable=t;if(t){this.selectionEnable=true;this.changeManager=new e.edit.EditChangeManager({layer:this});
this.undoManager=new e.UndoManager();this.createRtree();return true;}if(this.selectedFeatures){var s=this.selectedFeatures.length;
for(var u=0;u<s;u++){this.selectedFeatures[u].enableFeatureEditing(false);}}this.changeManager=null;this.undoManager=null;
if(this.useRTree===false){this.rtree=null;}this.segmentRtree={};return true;},getUndoManager:function(){return this.undoManager;
},isFeatureEditable:function(){return this.featureEditable;},saveEditing:function(s){if(e.notNull(this.changeManager)&&this.changeManager.hasChanges){var N=e.layer.VectorLayer;
if(this.type===N.TYPE_PREDEFINED||this.type===N.TYPE_JDBC){var v=this.serverURL+"/dataserver/"+this.dataSource;
var u={};var ab=e.util.HttpRequest.getDomain(this.serverURL);if(!ab){ab=e.util.HttpRequest.localDomain;
}var aa=e.gv.mvKeyMap[ab];if(aa){u.key=aa;}if(this.sessionId){u.ssid=this.sessionId;}var D="save_session_layer";
var y="insert_features";var C="update_features";var R="delete_features";var G='<?xml version="1.0" standalone="yes"?>\n';
G+="<edit_request>\n";G+="\t<"+D;G+=' data_source="'+this.dataSource+'"';G+=' editor="dummy">\n';G+="\t\t<layer ";
G+='base_table="'+this.baseTable+'" ';G+='key_column="'+this.keyColumn+'" ';G+='spatial_column="'+this.geometryColumn+'" ';
var w="geometry";if(e.notNull(this.spatialType)){w=this.spatialType;}G+='spatial_type="'+this.spatialType+'" ';
if(e.isNull(this.workspace)){G+='workspace="LIVE">\n';}else{G+='workspace="'+this.workspace+'">\n';}G+="\t\t\t<"+y+">\n";
var V=this.changeManager.getNewFeatures();var X="string";if(e.notNull(V)&&V.length>0){for(var P=0;P<V.length;
P++){var A=V[P];if(e.isNull(A)){continue;}G+='\t\t\t\t<feature key="'+A.id+'">\n';X="string";if(e.notNull(this.attributeTypes[this.keyColumn])){X=this.attributeTypes[this.keyColumn];
}G+='\t\t\t\t\t<attribute name="'+this.keyColumn+'" type="'+X+'">\n';G+="\t\t\t\t\t\t<value>"+A.id+"</value>\n";
G+="\t\t\t\t\t</attribute>\n";if(e.notNull(this.attrNames)){for(var E=0;E<this.attrNames.length;E++){if(this.attrNames[E]===this.keyColumn){continue;
}var I=A.getAttributeValue(this.attrNames[E]);if(e.notNull(I)){X="string";if(e.notNull(this.attributeTypes[this.attrNames[E]])){X=this.attributeTypes[this.attrNames[E]];
}var O=this.attrNames[E];var t=A.getRealColumnName(O);if(e.notNull(t)){O=t;}G+='\t\t\t\t\t<attribute name="'+O+'" type="'+X+'">\n';
G+="\t\t\t\t\t\t<value>"+I+"</value>\n";G+="\t\t\t\t\t</attribute>\n";}}}G+='\t\t\t\t\t<attribute name="'+this.geometryColumn+'" type="'+w.toLowerCase()+'">\n';
G+="\t\t\t\t\t\t<value>"+A.geo.toGML()+"</value>\n";G+="\t\t\t\t\t</attribute>\n";G+="\t\t\t\t</feature>\n";
}}G+="\t\t\t</"+y+">\n";G+="\t\t\t<"+C+">\n";var J=this.changeManager.getModifiedFeatures();if(e.notNull(J)&&J.length>0){for(var M=0;
M<J.length;M++){var B=J[M];if(e.isNull(B)){continue;}G+='\t\t\t\t<feature key="'+B.id+'">\n';X="string";
if(e.notNull(this.attributeTypes[this.keyColumn])){X=this.attributeTypes[this.keyColumn];}G+='\t\t\t\t\t<attribute name="'+this.keyColumn+'" type="'+X+'">\n';
G+="\t\t\t\t\t\t<value>"+B.id+"</value>\n";G+="\t\t\t\t\t</attribute>\n";var U=this.changeManager.getChangedAttributesOfModifiedFeature(B.id);
if(e.notNull(U)){for(var Q=0;Q<U.length;Q++){if(U[Q]===this.keyColumn){continue;}var T=B.getAttributeValue(U[Q]);
if(e.notNull(T)){X="string";if(e.notNull(this.attributeTypes[U[Q]])){X=this.attributeTypes[U[Q]];}var L=U[Q];
var Z=B.getRealColumnName(L);if(e.notNull(Z)){L=Z;}G+='\t\t\t\t\t<attribute name="'+L+'" type="'+X+'">\n';
G+="\t\t\t\t\t\t<value>"+T+"</value>\n";G+="\t\t\t\t\t</attribute>\n";}}}if(this.changeManager.hasSpatialAttributeChanged(B.id)){G+='\t\t\t\t\t<attribute name="'+this.geometryColumn+'" type="'+w+'">\n';
G+="\t\t\t\t\t\t<value>"+B.geo.toGML()+"</value>\n";G+="\t\t\t\t\t</attribute>\n";}G+="\t\t\t\t</feature>\n";
}}G+="\t\t\t</"+C+">\n";G+="\t\t\t<"+R+">\n";var z=this.changeManager.getRemovedFeatures();if(e.notNull(z)&&z.length>0){for(var K=0;
K<z.length;K++){var F=z[K];if(e.isNull(F)){continue;}G+='\t\t\t\t<feature key="'+F.id+'"/>\n';}}G+="\t\t\t</"+R+">\n";
G+="\t\t</layer>\n";G+="\t</"+D+">\n";G+="</edit_request>\n";u.xml_request=G;var Y=this;u.refresh=Math.round(Math.random()*100000);
var S=false;var x=function(ac){Y.saveDataRequest=null;if(ac){e.util.Logger.alert("MAPVIEWER_9057","OM.layer.VectorLayer.saveEditing",ac.responseText);
}return;};if(e.notNull(this.saveDataRequest)){this.saveDataRequest.abort();}var W="xml";this.saveDataRequest=e.util.HttpRequest.send(v,u,function(ac){var ai=ac.documentElement;
var ae=ai.getElementsByTagName(D);var aj=false;if(e.notNull(ae)){var ah=ae[0].attributes.getNamedItem("data_source").value;
var ag=ae[0].attributes.getNamedItem("layer").value;aj=ae[0].attributes.getNamedItem("success").value;
if(aj==="true"){Y.changeManager.clearChanges();Y.undoManager=new e.UndoManager();e.util.Logger.info("MAPVIEWER_9058","OM.layer.VectorLayer.saveEditing","["+ah+","+ag+","+aj+"]");
}else{var ad=ae[0].childNodes[1];var af=ad.childNodes[1];e.util.Logger.warning("MAPVIEWER_9057","OM.layer.VectorLayer.saveEditing","["+ah+","+ag+","+aj+","+af.textContent+"]");
}}else{e.util.Logger.warning("MAPVIEWER_9057","OM.layer.VectorLayer.saveEditing","Unexpected response.");
}Y.saveDataRequest=null;if(e.notNull(s)){s(aj);}},W,x,S);}else{e.util.Logger.warning("MAPVIEWER_9056","OM.layer.VectorLayer.saveEditing","");
if(e.notNull(s)){s(false);}}}else{if(e.notNull(s)){s(false);}}},enableInfoWindow:function(s){this.infoWindow=s;
},setBoundingTheme:function(s){this.boundingTheme=s;},zoomToTheme:function(){var s=this;if(!this.parentMap||!this.parentMap.initialized){setTimeout(function(){s.zoomToTheme();
},300);return;}this.mbr=null;this.bfMbr=null;this.loadBoundingTheme(function(w,v,z,y){var u=s.calculateCenterAndZoomLevel(w,v,z,y);
if(u&&u.length>1){var x=u[0];var t=u[1];s.parentMap.setMapCenterAndZoomLevel(t,x);}});},centerToTheme:function(){var s=this;
if(!this.parentMap||!this.parentMap.initialized){setTimeout(function(){s.centerToTheme();},300);return;
}this.loadBoundingTheme(function(w,v,y,x){var u=s.calculateCenterAndZoomLevel(w,v,y,x);if(u&&u.length>1){var t=u[1];
s.parentMap.setMapCenter(t);}});},setBringToTopOnMouseOver:function(s){this.bringToTopFlag=s;},getFeatureGeometryType:function(){if(this.type==e.layer.VectorLayer.TYPE_LOCAL){}else{if(this.featureArray&&this.featureArray.length>0){var s=this.featureArray[0].geo;
if(s.type=="Point"||s.type=="OrientedPoint"||s.type=="MultiPoint"||s.type=="OrientedMultiPoint"){return"POINT";
}else{if(s.type=="LineString"||s.type=="MultiLineString"){return"LINESTRING";}else{if(s.type=="Polygon"||s.type=="MultiPolygon"){return"POLYGON";
}}}}}return"";},setSelectVisualFilter:function(s){this.selectVisualFilter=s;},setVisualFilter:function(v){this.visualFilter=v;
if(this.displayed&&this.visualFilter){this.graphicFilter=this.parentMap.graphics.getGraphicFilter(this.visualFilter);
if(this.visualFilter.applyToLayer){this.parentMap.graphics.applyStyle(this.realGroup,{filter:this.graphicFilter});
}else{var s=this.featureArray?this.featureArray.length:0;for(var u=0;u<s;u++){var t=this.featureArray[u];
if(t.shape){this.parentMap.graphics.applyStyle(t.shape,{filter:this.graphicFilter});}}}}else{if(this.displayed&&e.isNull(this.visualFilter)){this.graphicFilter=null;
this.parentMap.graphics.applyStyle(this.realGroup,{filter:this.parentMap.graphics.oui.filters.NONE});
}}},getSelectVisualFilter:function(){return this.selectVisualFilter;},getVisualFilter:function(){return this.visualFilter;
},setLabelsVisible:function(s){this.showLables=s;if(s&&!this.labelingStyle){this.setLabelingStyle(e.style.StyleStore.defaulTextStyle);
}},labelsVisible:function(){return this.showLables;},getExtent:function(){if(!this.mbr){var A=this.featureArray?this.featureArray.length:0;
var E={minX:null,minY:null,maxX:null,maxY:null};var C={minX:null,minY:null,maxX:null,maxY:null};var D=e.geometry.Geometry.calculateMBR;
var G=this.renderingStyle;var x=e.notNull(G)&&e.notNull(G.hasBinding)&&G.hasBinding();var v=e.notNull(this.nsdpData)&&e.notNull(this.nsdpKey);
var t=function(K,P){var J,O,L,I;if(K.getMBR){var M=K.getMBR();J=M.getMinX();L=M.getMinY();O=M.getMaxX();
I=M.getMaxY();}else{var N=D(K.coordinates,K.type,K.dimension);J=N.minX;L=N.minY;O=N.maxX;I=N.maxY;}if(P.minX===null||J<P.minX){P.minX=J;
}if(P.minY===null||L<P.minY){P.minY=L;}if(P.maxX===null||O>P.maxX){P.maxX=O;}if(P.maxY===null||I>P.maxY){P.maxY=I;
}};var w=this.parentMap.getMapContext().getUniverse().getSRID();var u=false;var s=false;var z=function(I){t(I,E);
if(u||s){t(I,C);}};for(var y=0;y<A;y++){var F=this.featureArray[y];u=(x&&G.isFeatureBound(F));s=v?e.notNull(this.getNsdpDataForFeature(F)):false;
var B=F.getGeometry();if(w!==B.srid){B.transform(w,z);}else{t(B,E);if(u||s){t(B,C);}}}if(e.notNull(E.minX)&&e.notNull(E.minY)&&e.notNull(E.maxX)&&e.notNull(E.maxY)){this.mbr=new e.geometry.Rectangle(E.minX,E.minY,E.maxX,E.maxY,w);
}else{this.mbr=null;}if(!x&&!v){this.bfMbr=this.mbr;}else{if(e.notNull(C.minX)&&e.notNull(C.minY)&&e.notNull(C.maxX)&&e.notNull(C.maxY)){this.bfMbr=new e.geometry.Rectangle(C.minX,C.minY,C.maxX,C.maxY,w);
}else{this.bfMbr=null;}}}return this.mbr;},getAttributeNames:function(){return this.attrNames;},setNSDP:function(s){if(!s||!s.keyColumn){return;
}this.clearNSDP();this.nsdpKey=s.keyColumn;this.nsdpKey=this.nsdpKey.toUpperCase();this.nsdp=s;if(typeof this.nsdp.ignoreCase==="undefined"){this.nsdp.ignoreCase=true;
}var t=this;var w=function(y){e.util.Logger.finest("parsing NSDP XML data...");var x=null;if(typeof y==="string"){y=e.$.trim(y);
var z=e.$.parseXML(y);x=e.$(z);}else{x=e.$(y);}t.nsdpTitleArray=[];x.find("th").each(function(){var A=e.$(this);
var B=A.text();t.nsdpTitleArray.push(B);});t.nsdpData={};x.find("tr").each(function(){var C=e.$(this);
var A=0;var B=null;var D={};C.find("td").each(function(){if(A===0){B=e.$(this).text();}else{var E=t.nsdpTitleArray[A].toUpperCase();
D[E]=e.$(this).text();}A++;});if(B){B=t.nsdp.ignoreCase?B.toUpperCase():B;t.nsdpData[B]=D;}});if(t.parentMap&&t.name===t.parentMap.boundingLayerName){t.loadBoundingTheme();
}if(t.displayed){if(t.renderingStyle instanceof e.style.BucketStyle){t.renderingStyle.clearBuckets();
}t.redraw(false);}};var v=function(E){e.util.Logger.finest("parsing NSDP JSON data...");if(typeof E==="string"){E=e.$.parseJSON(E);
}if(!E.items||E.items.length===0){return;}var A=E.items,z=A.length;t.nsdpData={};t.nsdpTitleArray=[];
var y=s.keyAttr,F=false;if(e.isNull(y)){y=s.keyColumn;}if(e.notNull(A[0][y])){F=true;}var B;for(B in A[0]){t.nsdpTitleArray.push(B);
if(!F&&B.toUpperCase()==y.toUpperCase()){F=true;y=B;}}for(var x=0;x<z;x++){var D=A[x][y];if(e.isNull(D)){continue;
}var C={};for(B in A[x]){if(B==y){continue;}C[B.toUpperCase()]=A[x][B];}D=t.nsdp.ignoreCase&&D.toUpperCase?D.toUpperCase():D;
t.nsdpData[D]=C;}if(t.displayed){if(t.renderingStyle instanceof e.style.BucketStyle){t.renderingStyle.clearBuckets();
}t.redraw(false);}};if(s&&s.url){e.$.ajaxSetup({async:false});try{e.$.get(s.url,null,function(x){try{w(x);
}catch(y){v(x);}},"text").fail(function(){e.util.Logger.warning("MAPVIEWER_9042","OM.layer.VectorLayer.setNSDP",s.url);
});}catch(u){e.util.Logger.warning(null,"OM.layer.VectorLayer.setNSDP","Exception when loading nsdp url data.");
}finally{e.$.ajaxSetup({async:true});}}else{if(s&&s.xml){w(e.util.XMLUtil.parse(s.xml));}else{if(s&&s.json){v(s.json);
}}}},applyFilter:function(t,s){if(typeof(s)==="undefined"||!!s){if(t.filterMode===e.filter.Filter.CLIENT_SIDE){if(!this.filterArray){this.filterArray=[];
}this.filterArray.push(t);this.replace=false;this.doFilter();this.loadOnDemand=false;return this;}else{}}else{if(t.filterMode==e.filter.Filter.CLIENT_SIDE){var u=this.clone();
u.loadOnDemand=false;u.filterArray=this.filterArray?e.$.extend([],this.filterArray):[];u.filterArray.push(t);
this.replace=false;u.doFilter();return u;}else{}}},removeFilter:function(t){if(this.filterArray){for(var s=this.filterArray.length;
s>-1;s--){if(t==this.filterArray[s]){this.filterArray.splice(s,1);break;}}}},removeFilterAll:function(){this.filterArray=[];
},doFilter:function(s,y){if((!this.filterArray||this.filterArray.length===0)&&(!y)){return;}var t=this.filterArray;
if(this.replace){t=[y];}for(var w=0;w<t.length;w++){var x=t[w];if(s){if(!x.evaluate(s)){return true;}}else{if(!this.featureArray||this.featureArray.length===0){return;
}else{for(var u=this.featureArray.length-1;u>-1;u--){var v=this.featureArray[u];if(this.replace&&v.selected){continue;
}if(x.evaluate(v)){if(this.replace){this.selectFeature(v);}}else{if(!this.replace){this.removeFeature(v);
}}}}}}},selectFeatureByFilter:function(s){if(!s){return;}this.enableFeatureSelection(true,e.layer.VectorLayer.MULTIPLE_SELECTION);
if(s.filterMode==e.filter.Filter.CLIENT_SIDE){this.replace=true;this.doFilter(null,s);this.replace=false;
this.loadOnDemand=false;return this;}},addToRtree:function(u,w){if((this.featureEditable===false&&this.useRTree===false)||e.isNull(u)){return;
}var v=e.isNull(w)?u.getGeometry():w;var s=v.getMBR();var t={x:s.getMinX(),y:s.getMinY(),w:s.getWidth(),h:s.getHeight()};
if(!this.containsKey(u,t)){if(e.isNull(this.rtree)){this.rtree=new e.RTree(10);}this.rtree.insert(t,u);
u.rtreeKeys.push(t);}},containsKey:function(u,t){if(e.isNull(u.rtreeKeys)){u.rtreeKeys=[];}if(e.isNull(t)){t={};
}var v=u.rtreeKeys;for(var s=0;s<v.length;s++){if(v[s].x===t.x&&v[s].y===t.y&&v[s].w===t.w&&v[s].h===t.h){return true;
}}return false;},removeFromRtree:function(t){if(this.useRTree===false||e.isNull(t)||e.isNull(this.rtree)||e.isNull(t.rtreeKeys)){return;
}var u=t.rtreeKeys;for(var s=0;s<u.length;s++){this.rtree.remove(u[s],t);}t.rtreeKeys=[];},beforeZoom:function(){this.pixMaxXDistance=null;
this.pixMaxYDistance=null;},updatedSearchWindow:function(C,y){if(e.notNull(C.shape)){if(y===e.GeomTypes.POINT||y===e.GeomTypes.ORIENTEDPOINT||y===e.GeomTypes.MULTIPOINT||y===e.GeomTypes.ORIENTEDMULTIPOINT){var B=C.getGeometry();
var s=C.shape.getLayoutBounds();if(y===e.GeomTypes.MULTIPOINT||y===e.GeomTypes.ORIENTEDMULTIPOINT){var z=B.coordinates;
B=new e.geometry.Point(z[0][0],z[0][1]);if(C.shape.childrenCount>1){s=C.shape.getChildAt(0).getLayoutBounds();
}}if(e.notNull(s)&&e.notNull(this.parentMap)){var t=this.parentMap;var w=this;var x=t.getScreenLocation(B);
var v=t.graphics.getLeftTop(t.draggableGroup);s.x=v.x+s.x;s.y=v.y+s.y;var A=Math.abs(s.x-x.x)+s.width/2;
var u=Math.abs(s.y-x.y)+s.height/2;if(e.isNull(w.pixMaxXDistance)||w.pixMaxXDistance<A){w.pixMaxXDistance=A;
}if(e.isNull(w.pixMaxYDistance)||w.pixMaxYDistance<u){w.pixMaxYDistance=u;}}}}},getSearchWindow:function(u){var t,y;
if(e.notNull(this.pixMaxXDistance)){t=this.pixMaxXDistance*2;}else{t=this.searchBuffer;}if(e.notNull(this.pixMaxYDistance)){y=this.pixMaxYDistance*2;
}else{y=this.searchBuffer;}var z=this.pixToCoord(t,y);if(e.notNull(z)){var s=z.width;var x=z.height;var v={x:u.getX()-s/2,y:u.getY()-x/2,w:s,h:x,srid:this.parentMap.getMapContext().getUniverse().srid};
return v;}return null;},pixToCoord:function(x,s){var y=this.parentMap;var v=y.getMapContext();var z=v.getUniverse();
var u=v.getZoomLevel();if(z&&z.zoomLevels){u=y.checkZoomLevel(u);var t=z.zoomLevels[u].resolution;var w=z.zoomLevels[u].stretchRatio;
return{width:Math.abs(x*t),height:Math.abs(s*t*w)};}},findFeature:function(A,w){if(e.isNull(this.rtree)){return null;
}try{var B=null;var x=e.util.DomUtil.getTouchesClientPosition(A);if(e.notNull(x.x)){A.clientX=x.x;A.clientY=x.y;
}var z=this.parentMap.getScreenPointLocation(A.clientX,A.clientY);var s=this.getSearchWindow(z);var u=this.rtree.search(s);
for(var v=0;v<u.length;v++){B=u[v];if(this.pointInFeature(A.clientX,A.clientY,B)){return B;}}if(w===false){return null;
}for(var t=0;t<u.length;t++){B=u[t];if(this.pointNearFeature(z,B)){B.fkNode=B.shape;return B;}}}catch(y){}return null;
},pointInFeature:function(s,v,u){if(e.notNull(u)){if(e.notNull(u.shape)){if(this.pointInShape(s,v,u.shape,u)){return true;
}if(this.pointInShape(s,v,u.ghostShape,u)){return true;}if(e.notNull(u.shapeArray)){for(var t=0;t<u.shapeArray.length;
t++){if(this.pointInShape(s,v,u.shapeArray[t],u)){return true;}}}}}return false;},pointInShape:function(s,w,t,u){if(e.isNull(t)){return false;
}var v=t.hitTest(s,w);if(v){u.fkNode=v;v.feature=u;return true;}else{return false;}},pointNearFeature:function(F,J){var z=J.getGeometry();
var E=z.coordinates;var D=z.getType();var s=null;var I=Number.MAX_VALUE;var A=[];switch(D){case e.GeomTypes.POINT:case e.GeomTypes.ORIENTEDPOINT:s=this.minDistance({x:F.getX(),y:F.getY()},[{x:z.getX(),y:z.getY()}]);
break;case e.GeomTypes.MULTIPOINT:case e.GeomTypes.ORIENTEDMULTIPOINT:var G=[];for(var y=0;y<E.length;
y++){var B=E[y];for(var x=0;x<B.length;x+=2){G.push({x:B[x],y:B[x+1]});}}s=this.minDistance({x:F.getX(),y:F.getY()},G);
break;case e.GeomTypes.LINESTRING:for(var w=0;w<E.length-2;w+=2){A.push([{x:E[w],y:E[w+1]},{x:E[w+2],y:E[w+3]}]);
}s=this.minPointSegmentDistance({x:F.getX(),y:F.getY()},A);break;case e.GeomTypes.MULTILINESTRING:for(var v=0;
v<E.length;v++){var C=E[v];for(var u=0;u<C.length-2;u+=2){A.push([{x:C[u],y:C[u+1]},{x:C[u+2],y:C[u+3]}]);
}}s=this.minPointSegmentDistance({x:F.getX(),y:F.getY()},A);break;}if(e.notNull(s)&&e.notNull(J.parentLayer)&&e.notNull(J.parentLayer.parentMap)){var t=J.parentLayer.parentMap.getMapContext().getTransform();
I=t.toScreenXLength(s);}return I<=this.searchBuffer;},minDistance:function(s,v){var u=Number.MAX_VALUE;
for(var t=0;t<v.length;t++){u=Math.min(u,e.util.GeomUtil.distance(s.x,s.y,v[t].x,v[t].y));}return u;},minPointSegmentDistance:function(s,t){var v=Number.MAX_VALUE;
for(var u=0;u<t.length;u++){v=Math.min(v,e.util.GeomUtil.pointSegmentDistance(s.x,s.y,t[u][0].x,t[u][0].y,t[u][1].x,t[u][1].y));
}return v;},addFeature:function(u){if(this.doFilter(u)){return;}if(!this.featureArray){this.featureArray=[];
}if(this.isValidId(u.id)){this.featureArray.push(u);u.parentLayer=this;this.addToRtree(u);if(this.displayed){var t=u.geo;
var w=this;var v=function(D){var C=D.getMBR();u.geo=D;var B=w.parentMap.getMapZoomLevel();if(w.clustering&&B<=w.maxClusteringLevel){w.vCluster.addFeature(u);
}if(!u.displayed){var G=w.parentMap.getMapContext();var A=G.getWholeMapNum();var F=G.getBaseWholeMapIndex();
if(e.notNull(w.featureGroupArr)&&w.featureGroupArr.length>0){if(e.notNull(u.activeIdx)){w.realGroup=w.featureGroupArr[u.activeIdx];
}else{w.realGroup=w.featureGroupArr[0];}}if(e.isNull(w.realGroup)){w.realGroup=w.parentMap.graphics.createGroup();
w.realGroup.applyStyle({cursor:w.mouseCursor});if(!w.pointerSensitivity){w.realGroup.applyStyle({pointerSensitivity:false});
}w.group.appendChild(w.realGroup);}u.group=w.realGroup;u.screenTransformObj=w.parentMap.getMapContext().getTransform();
u.graphics=w.parentMap.graphics;u.parentLayer=w;w.display(u,C);var z,E,y;if(A>1){if(e.isNull(w.featureGroupArr)){w.featureGroupArr=[];
}if(e.notNull(u.activeIdx)){A=u.activeIdx+1;}if(e.isNull(w.featureGroupArr[A-1])){w.featureGroupArr[A-1]=w.realGroup;
z=G.getUniverse().getZoomLevels()[G.getZoomLevel()].resolution;E=G.getUniverse().getMapBounds().getWidth();
y=(G.getCenterPoint().getX()-G.getRoundMapCenterPoint().getX())/z;w.realGroup.translate((A-1-F)*E/z-y,0);
}if(e.notNull(u.activeIdx)){return;}for(var x=1;x<A;x++){if(!u.shapeArray){u.shapeArray=[];}u.shapeArray.push(u.shape);
if(e.notNull(w.featureGroupArr[x])){w.realGroup=w.featureGroupArr[x];}else{w.realGroup=w.parentMap.graphics.createGroup();
w.realGroup.applyStyle({cursor:w.mouseCursor});if(!w.pointerSensitivity){w.realGroup.applyStyle({pointerSensitivity:false});
}w.group.appendChild(w.realGroup);w.featureGroupArr[x]=w.realGroup;z=G.getUniverse().getZoomLevels()[G.getZoomLevel()].resolution;
E=G.getUniverse().getMapBounds().getWidth();y=(G.getCenterPoint().getX()-G.getRoundMapCenterPoint().getX())/z;
w.realGroup.translate((x-F)*E/z-y,0);}w.display(u,C);}}}};var s=this.parentMap.getMapContext().getUniverse().getSRID();
if(s!=t.srid){t.transform(s,v);}else{v(t);}if(this.labelsVisible()&&u.label){this.parentMap.refreshVectorLayerLabels();
}}}else{e.util.Logger.warning("MAPVIEWER_9005","OM.layer.VectorLayer.addFeature");}},addFeatures:function(u){if(!this.featureArray){this.featureArray=[];
}var s=u?u.length:0;for(var t=0;t<s;t++){if(this.isValidId(u[t].id)&&!this.doFilter(u[t])){this.featureArray.push(u[t]);
}else{e.util.Logger.warning("MAPVIEWER_9005","OM.layer.VectorLayer.addFeatures");continue;}}},clearFeature:function(x){if(this.parentMap){var y=this.name+"_"+x.id;
this.parentMap.deleteFeatureInfoWindow(y);}x.clearAnimation();x.animations=null;if(x.moveAnimation){x.pauseMoveAnimation();
}if(x.selected){this.deselectFeature(x);}if(x.shape){x.shape.feature=null;this.parentMap.graphics.remove(x.shape);
x.shape=null;}if(x.shapeArray){var t=x.shapeArray.length;for(var u=0;u<t;u++){if(x.shapeArray[u]){x.shapeArray[u].feature=null;
this.parentMap.graphics.remove(x.shapeArray[u]);}}x.shapeArray=null;}if(x.shapeGroup){var w=x.shapeGroup.length;
for(var v=1;v<w;v++){x.shapeGroup[v].feature=null;this.parentMap.graphics.remove(x.shapeGroup[v]);}x.shapeGroup=null;
}if(x.labelShape){x.labelShape.feature=null;this.parentMap.graphics.remove(x.labelShape);}if(x.labelShapeArr){for(var s=0;
s<x.labelShapeArr.length;s++){this.parentMap.graphics.remove(x.labelShapeArr[s]);}x.labelShapeArr=null;
}x.group=null;x.screenTransformObj=null;x.graphics=null;x.parentLayer=null;x.displayed=false;x.inCluster=false;
this.removeFromRtree(x);if(e.notNull(x.$customDiv)){x.$customDiv.remove();x.$customDiv=null;}},removeFeature:function(u){var s;
var t;if(u&&u.editable&&u.featureEditingProperties){u.deleteEditingProperties();}s=this.featureArray?this.featureArray.length:0;
for(t=0;t<s;t++){if(this.featureArray[t]===u){this.featureArray.splice(t,1);if(e.notNull(this.rtree)&&e.notNull(u.geo)){var w=u.geo.getMBR();
if(e.notNull(w)){var v={x:w.getMinX(),y:w.getMinY(),w:w.getWidth(),h:w.getHeight()};this.rtree.remove(v,u);
if(e.notNull(this.segmentRtree)&&e.notNull(this.segmentRtree[u.id])){delete this.segmentRtree[u.id];}}}this.clearFeature(u);
return u;}}return null;},removeAllFeatures:function(){var s=this.featureArray?this.featureArray.length:0;
if(e.isNotNull(this.parentMap)){this.parentMap.graphics.clearGroup(this.group);}for(var u=s-1;u>=0;u--){var t=this.featureArray.pop();
this.clearFeature(t);}if(e.notNull(this.rtree)){this.rtree=new e.RTree(10);}this.segmentRtree={};this.realGroup=null;
this.featureArray=[];return s;},initGroup:function(){if(this.parentMap&&this.parentMap.graphics){this.group=this.parentMap.graphics.createGroup({opacity:this.opacity,visibility:true});
this.parentMap.draggableGroup.appendChild(this.group);}},init:function(){var x=this.parentMap.getMapContext();
var F=x.getDeviceWidth();var z=x.getDeviceHeight();if(!this.serverURL&&(this.type==e.layer.VectorLayer.TYPE_JDBC||this.type==e.layer.VectorLayer.TYPE_PREDEFINED)){this.serverURL=this.parentMap.mapviewerURL;
}if(this.renderingStyle){this.isServerSideStyle(this.renderingStyle,"rendering");}if(this.labelStyle){this.isServerSideStyle(this.labelStyle,"label");
}if(this.hoverStyle){this.isServerSideStyle(this.hoverStyle,"hover");}if(this.selectionStyle){this.isServerSideStyle(this.selectionStyle,"select");
}if(this.otherStyles&&this.otherStyles.length>0){for(var v=0;v<this.otherStyles.length;v++){if(this.isServerSideStyle(this.otherStyles[v],"secondary")){this.otherStyles.splice(v,1);
v--;}}}var D=this.parentMap.graphics;if(this.group){this.clearFeatureShapes();if(this.group.childrenCount===0){this.parentMap.draggableGroup.appendChild(this.group);
}}var s=e.event.MouseEvent;var A=this;A.timeStamp=0;if(this.useRTree){this.tooltipTimer=new e.util.TimerManager();
var u=this.parentMap.graphics.oui.tooltipManager._properties.showDelay;var C=this.parentMap.graphics.oui.tooltipManager._properties.hideDelay;
var B=this.parentMap.graphics.oui.tooltipManager._properties.dismissDelay;this.on(e.event.MouseEvent.MOUSE_MOVE,function(){if(!A.showToolTip){return;
}A.tooltipTimer.reset("show");});this.on(e.event.MouseEvent.MOUSE_OUT,function(){if(!A.showToolTip){return;
}A.tooltipTimer.cancel("show");A.tooltipTimer.cancel("dismiss");A.tooltipTimer.schedule("hide",C,function(){A.parentMap.graphics.oui.tooltipManager.hideTooltip();
});});this.on(e.event.MouseEvent.MOUSE_OVER,function(w){if(!A.showToolTip){return;}var G=w.feature;var I=w.evt;
A.tooltipTimer.cancel("hide");A.tooltipTimer.cancel("dismiss");A.tooltipTimer.schedule("show",u,function(){if(!A.showToolTip){return;
}var J=G.getTip();if(J&&J.length>0){A.parentMap.graphics.oui.tooltipManager.showTooltip(I.target,J,I.clientX,I.clientY);
}A.tooltipTimer.schedule("dismiss",B,function(){A.parentMap.graphics.oui.tooltipManager.hideTooltip();
});});});}var E=function(G){var J=A.getTargetFeature(G.target);var M=A.parentMap.getMapContext();if(e.isNull(J)){return;
}var N=e.event.MouseEvent;var I=G.type;if((I===N.MOUSE_CLICK||I===N.MOUSE_DOWN)&&G.button===2||I===N.TOUCH_LONG_PRESS){I=N.MOUSE_RIGHT_CLICK;
}else{if(I===N.TOUCH_TAP){I=N.MOUSE_CLICK;}}if(!A.parentMap.enableMapAction.mouse){return;}var L=new N(I,J);
L.evt=G;L.mapContext=M;J.fire(I,L);L=new N(I,A);L.evt=G;L.feature=J;if((I===N.MOUSE_OVER||I===N.MOUSE_OUT)&&G.relatedTarget!==null){var K=A.getTargetFeature(G.relatedTarget);
if(J===K){return;}}if(I===N.MOUSE_OVER){if(A.hoverEnable){A.hover(J);}if(A.bringToTopFlag){J.getShapeIndex();
J.bringToTop();}}else{if(I===N.MOUSE_OUT){if(A.bringToTopFlag){J.setShapeIndex();}if(A.hoverEnable){A.deHover(J);
}}else{if(I===N.MOUSE_CLICK&&!J.multi||I===N.TOUCH_TAP){if(A.selectionEnable&&!J.cluster){A.selectFeature(J);
}if(A.infoWindow&&!J.cluster&&!A.featureEditable){A.showInfoWindow(J);e.event.EventSource.stopEvents[G.type]=true;
}if(A.featureEditable){e.event.EventSource.stopEvents[G.type]=true;}if(J.parentFeature&&J.parentFeature.getGeometry().type==="OrientedPoint"){var w=J.parentFeature;
w.parentLayer.deselectFeature(w);}}else{if(I===N.TOUCH_END&&A.parentMap.enableMapAction.mouse){A.endFeatureDragging(G);
G.stopPropagation();}else{if(I===N.MOUSE_UP&&L.feature.id==="overview_rectangle"&&L.feature.dragging===true){A.endFeatureDragging(G);
G.stopPropagation();}}}}}L.mapContext=M;A.fire(I,L);};D.attachEventListener(s.MOUSE_OVER,E,this.group);
D.attachEventListener(s.MOUSE_OUT,E,this.group);var y=function(w){if(w.button===2){return;}A.lastMouseDown=A.parentMap.getCursorLocation();
var G=A.getTargetFeature(w.target);if(!G){return;}if(G&&G.editable){A.focusFeature=G;G.startDrag(w,true);
}else{if(G&&G.draggable){A.selectFeature(G);A.focusFeature=G;if(G.startDrag){G.startDrag(w,true);if(G.dragStartListener){w.markerX=G.getMarkerX();
w.markerY=G.getMarkerY();w.markerSRID=G.getMarkerSRID();G.dragStartListener.call(this,w);}}}else{if(G&&e.notNull(G.parentFeature)){A.focusFeature=G.parentFeature;
G.parentFeature.startDrag(w,false);}}}A.curTopFeature=G;};if(e.browser.touchSupported){D.attachEventListener(s.TOUCH_TAP,E,this.group);
D.attachEventListener(s.TOUCH_LONG_PRESS,E,this.group);D.attachEventListener(s.TOUCH_END,E,this.group);
D.attachEventListener(s.TOUCH_START,function(I){I.preventDefault();var G=e.util.DomUtil;var w=G.getTouchCount(I);
if(w==1){I.button=0;var J=G.getTouchesClientPosition(I);I.clientX=J.x;I.clientY=J.y;y(I);}},this.group);
}D.attachEventListener(s.MOUSE_CLICK,E,this.group);D.attachEventListener(s.MOUSE_RIGHT_CLICK,E,this.group);
D.attachEventListener(s.MOUSE_UP,E,this.group);D.attachEventListener(s.MOUSE_DOWN,E,this.group);D.attachEventListener(e.event.MouseEvent.MOUSE_DOWN,y,this.group);
D.attachEventListener(s.MOUSE_MOVE,E,this.group);A.draggingFeature=function(O){if(e.notNull(A.focusFeature)){A.focusFeature.featureDragging(O);
if(A.focusFeature.draggingListener){var I=A.focusFeature.parentLayer.parentMap.getMapContext();var L=I.getUniverse();
var K=L.getZoomLevels(0);var w=K[I.getZoomLevel()];var N=A.focusFeature.mouseLocX-A.focusFeature.startX;
var M=A.focusFeature.mouseLocY-A.focusFeature.startY;var J=N*w.resolution;var G=M*w.resolution;O.markerX=A.focusFeature.getMarkerX()+J;
O.markerY=A.focusFeature.getMarkerY()+G;O.markerSRID=A.focusFeature.getMarkerSRID();A.focusFeature.draggingListener.call(this,O);
}}};A.draggingFeature_touch=function(w){var G=e.util.DomUtil.getTouchesPosition(w);w.pageX=G.x;w.pageY=G.y;
A.draggingFeature(w);};A.draggingFeature_win8Touch=function(w){w.pageX=w.gesture.touches[0].pageX;w.pageY=w.gesture.touches[0].pageY;
A.draggingFeature(w);};this.parentMap.$oracleMapDiv.mousemove(A.draggingFeature);if(e.gv.isWin8Touch){e.Hammer(this.parentMap.$oracleMapDiv[0]).on("drag",A.draggingFeature_win8Touch);
}this.parentMap.$oracleMapDiv.bind("touchmove",A.draggingFeature_touch);A.endFeatureDragging=function(G){if(e.notNull(A.focusFeature)){var w=A.focusFeature;
if(w.endDragOrietation){G.focusFeature=w;w.endDragOrietation(G);}else{w.endDrag(G);if(w.dragEndListener){G.markerX=w.getMarkerX();
G.markerY=w.getMarkerY();G.markerSRID=w.getMarkerSRID();if(w.draggingListener){setTimeout(function(){w.dragEndListener.call(this,G);
},100);}else{w.dragEndListener.call(this,G);}}}if(e.notNull(A.curTopFeature)){var I=A.curTopFeature;w.focusProperties(I);
A.curTopFeature=null;}A.focusFeature=null;}};A.endFeatureDragging_touch=function(w){var G=e.util.DomUtil.getTouchesPosition(w);
w.pageX=G.x;w.pageY=G.y;A.endFeatureDragging(w);};e.$(document).mouseup(A.endFeatureDragging);e.$(document).mouseout(A.endFeatureDragging);
this.parentMap.$oracleMapDiv.bind("touchend",A.endFeatureDragging_touch);this.orgWidth=F;this.orgHeight=z;
if((this.type==e.layer.VectorLayer.TYPE_PREDEFINED||this.type==e.layer.VectorLayer.TYPE_JDBC||this.type==e.layer.VectorLayer.TYPE_DATAPACK||this.type==e.layer.VectorLayer.TYPE_GEORSS)&&!(this.boundingTheme&&this.loadedBoundingTheme)){this.setWindow();
this.refreshImpl();}else{this.setWindow();if(!this.checkVisible()){var t=new e.event.LayerEvent(e.event.LayerEvent.FINISH_LOAD,this);
t.mapContext=this.parentMap.getMapContext();this.fire(e.event.LayerEvent.FINISH_LOAD,t);return;}this.displayFeatures();
}},redrawFeature:function(s){this.removeFeature(s);this.addFeature(s);},setWindow:function(){var v=this.parentMap.getMapContext();
var A=v.getUniverse();var x=A.getZoomLevels();if(!x){return;}var t=x[v.getZoomLevel()];var u=A.bound;
this.minX=u.getMinX();this.minY=u.getMinY();this.windowW=u.getWidth();this.windowH=u.getHeight();var B=this.parentMap.graphics;
var z=B.getLeftTop(this.parentMap.draggableGroup);this.orgDraggbleGroupPos=z;var s=v.getCenterPoint();
this.parentMap.graphics.setLeftTop(this.group,0,0);var C=this.orgWidth*this.xRatio*t.resolution;var y=this.orgHeight*this.yRatio*t.resolution*t.stretchRatio;
this.dataBufferWindow={x:s.getX()-C/2,y:s.getY()-y/2,w:C,h:y};},refresh:function d(t,s){if(e.isNull(s)){s=true;
}d.base.call(this,t,s);this.reloadNumber=Math.round(Math.random()*10000000000);this.refreshImpl(t,s);
},emptyCustomLayer:function(){var s=this.getCustomLayerDiv();if(s.length>0){s.children().each(function(t,u){e.$(u).data("f").displayed=false;
e.$(u).remove();});}},refreshImpl:function(F,t,z){if(e.isNull(this.group)){return;}var A=(F&&F.type===e.event.MapEvent.MAP_BEFORE_REFRESH)?F.bigPan:false;
if(t){if(!A){this.loaded=false;}this.clearFeatureShapes();this.clearAllLabels();if(!A){this.dataLoaded=false;
}}else{if((F&&F.beforeZoomLevel!==null&&F.afterZoomLevel!==null&&F.beforeZoomLevel!==F.afterZoomLevel)){this.setWindow();
}else{if(this.loadOnDemand){this.loaded=false;this.clearFeatureShapes();this.clearAllLabels();this.dataLoaded=false;
}else{this.clearAllLabels();}}}if(!this.checkVisible()){var u=e.event;var y=new u.MapEvent(u.LayerEvent.FINISH_LOAD,this);
y.mapContext=this.parentMap.getMapContext();this.fire(u.LayerEvent.FINISH_LOAD,y);return;}var J=this.parentMap.getMapContext();
var x=J.getUniverse();var M=x.getZoomLevels();var C=M[J.getZoomLevel()];var L=J.getCenterPoint();var v=this.orgWidth*this.xRatio*C.resolution;
var B=this.orgHeight*this.yRatio*C.resolution*C.stretchRatio;this.dataBufferWindow={x:L.getX()-v/2,y:L.getY()-B/2,w:v,h:B};
this.emptyCustomLayer();var N=this;var D=x.getSRID();var s=null;if(this.loadOnDemand){var K=this.visibleBound?Math.max(this.dataBufferWindow.x,this.visibleBound.getMinX()):this.dataBufferWindow.x;
var I=this.visibleBound?Math.max(this.dataBufferWindow.y,this.visibleBound.getMinY()):this.dataBufferWindow.y;
var G=this.visibleBound?Math.min(this.dataBufferWindow.x+v,this.visibleBound.getMaxX()):this.dataBufferWindow.x+v;
var E=this.visibleBound?Math.min(this.dataBufferWindow.y+B,this.visibleBound.getMaxY()):this.dataBufferWindow.y+B;
s=new e.geometry.Rectangle(K,I,G,E,D);}if((this.loadOnDemand||!this.dataLoaded&&this.type!=e.layer.VectorLayer.TYPE_LOCAL)&&z!==false){this.getThemeData(s,function(){N.mapping=false;
if(N.renderingStyle instanceof e.style.BucketStyle){N.renderingStyle.generateBuckets(this.featureArray,this.styleAttributes,false);
}N.displayFeatures(t);});}else{this.displayFeatures(t);}},delayDisplayFeatures:function(u){var t=this;
var s=function(v){if(t.loadingStyle>0){setTimeout(s,100,v);}else{t.displayFeatures(v);}};s(u);},displayFeatures:function(u){e.util.Logger.finest(null,"VectorLayer","["+this.name+"] displayFeatures called.");
if(this.loadingStyle>0){this.delayDisplayFeatures(u);return;}this.loading=true;this.loaded=false;this.displayCount=0;
if(e.util.Logger.DEBUG){console.time("["+this.name+"] displayFeatures");console.time("["+this.name+"] displayFeatures-complete");
}if(this.visualFilter){this.graphicFilter=this.parentMap.graphics.getGraphicFilter(this.visualFilter);
}var w=this;var s=this.parentMap.graphics;var v=false;if(e.isNull(this.realGroup)){v=true;this.realGroup=s.createGroup();
this.realGroup.applyStyle({cursor:w.mouseCursor});if(!this.pointerSensitivity){this.realGroup.applyStyle({pointerSensitivity:false});
}}if(this.graphicFilter&&this.visualFilter.applyToLayer){this.parentMap.graphics.applyStyle(this.realGroup,{filter:this.graphicFilter});
}if(this.renderingStyle&&this.renderingStyle.styleType=="HeatMap"){this.displayHeatMap();return;}var t=this.parentMap.getMapContext().getZoomLevel();
if(this.clustering&&t<=this.maxClusteringLevel){this.vCluster.displayAsCluster(this.dataBufferWindow);
}this.mappingNSDP();if(this.mfMarker){if(!this.vmf){this.vmf=new e.layer.VectorLayerMultiFeature(this);
this.vmf.checkLocation();}this.vmf.display();}this.displayBatch(0,v,this,u);},displayBatch:function(s,D,w,E){e.util.Logger.finest(null,"VectorLayer","["+this.name+"] displayBatch called with start="+s+".");
if(!w.group){return;}if(w.renderingStyle&&w.renderingStyle instanceof e.style.BucketStyle&&(!w.styleAttributes||w.styleAttributes.length===0)&&(!w.nsdpTitleArray||w.nsdpTitleArray.length<1)){e.util.Logger.warning("MAPVIEWER_9042","OM.layer.VectorLayer.displayBatch","");
}var y;var x=w.featureArray?w.featureArray.length:0;var t=w.parentMap.getMapContext().getUniverse().getSRID();
var v,F;var C=function(G){return function(){var I=G.getGeometry();I.transform(t,function(K){var M=K.getMBR();
G.srid=t;G.geo=K;if(F.labelBox){var L=G.labelBox;var J=new e.geometry.LineString([L[0],L[1],L[2],L[3]],I.srid);
J.transform(t,function(N){var O=N.coordinates;G.labelBox=[O[0],O[1],O[2],O[3]];w.display(G,M);});}else{w.display(G,M);
}});}();};var A=function(){B(v,false,w,E);};for(v=s;v<x;v++){F=w.featureArray[v];if((F.displayed||F.multi)&&w.parentMap.getMapContext().getWholeMapNum()==1||e.notNull(F.activeIdx)&&F.activeIdx!==this.areaIdx||F.inCluster){F.removeGhostShape();
continue;}if(w.enableBatch){w.displayCount++;if(w.displayCount>w.numberInBatch){if(D){w.group.appendChild(w.realGroup);
}else{for(var u=s;u<=v;u++){F=w.featureArray[u];if(F.displayed){F.startAnimation();}}}w.displayCount=0;
var B=w.displayBatch;h.setTimeout(A,1000);return;}}var z=F.geo;if(F.displayed){if(!F.shapeArray){F.shapeArray=[F.shape];
}else{F.shapeArray.push(F.shape);}}if(t!==z.srid){C(F);}else{if(this.type!==e.layer.VectorLayer.TYPE_LOCAL){y=null;
if(!w.loadOnDemand){if(!z.mbr){if(z.coordinates){y=e.geometry.Geometry.calculateMBR(z.coordinates,z.type);
}else{y=e.geometry.Geometry.calculateGeomCollectionMBR(z.geometries,z.type);}z.mbr=new e.geometry.Rectangle(y.minX,y.minY,y.maxX,y.maxY,z.srid);
}}w.display(F,z.mbr);}else{y=z.getMBR();w.display(F,y);}}}w.displayed=true;if(e.util.Logger.DEBUG){console.timeEnd("["+this.name+"] displayFeatures");
}if(D){w.group.appendChild(w.realGroup);}for(v=s;v<x;v++){F=w.featureArray[v];if(F.displayed){F.startAnimation();
}}w.displayEnd(E);},displayEnd:function(B){e.util.Logger.finest(null,"VectorLayer","["+this.name+"] displayEnd called.");
this.bringSelectedFeaturesToTop();this.getShadowArea();var C=this.parentMap.getMapContext();var x=C.getWholeMapNum();
if(x>1){var A=C.getBaseWholeMapIndex();if(e.isNull(this.areaIdx)){this.areaIdx=0;}if(!this.featureGroupArr){this.featureGroupArr=[];
}this.featureGroupArr.push(this.realGroup);var t=C.getUniverse().getZoomLevels()[C.getZoomLevel()].resolution;
var z=C.getUniverse().getMapBounds().getWidth();var u=(C.getCenterPoint().getX()-C.getRoundMapCenterPoint().getX())/t;
this.realGroup.translate((this.areaIdx-A)*z/t-u,0);this.areaIdx++;if(this.areaIdx<x){this.realGroup=this.parentMap.graphics.createGroup();
this.lineGroup=null;this.realGroup.applyStyle({cursor:this.mouseCursor});if(!this.pointerSensitivity){this.realGroup.applyStyle({pointerSensitivity:false});
}this.displayBatch(0,true,this,false);return;}}var y=this.parentMap.getMapContext().getZoomLevel();if(this.clustering&&y<=this.maxClusteringLevel){this.vCluster.showClusterInWrapAround();
}if(e.util.Logger.DEBUG){console.timeEnd("["+this.name+"] displayFeatures-complete");}this.loading=false;
var D=e.event.LayerEvent;var v=this.parentMap.getMapContext();var s=new D(D.FINISH_LOAD,this);s.mapContext=v;
this.fire(D.FINISH_LOAD,s);s=new D(D.FEATURES_DISPLAYED,this);s.mapContext=v;this.fire(D.FEATURES_DISPLAYED,s);
if(B){s=new D(D.FEATURES_DISPLAYED,this);s.mapContext=this.parentMap.getMapContext();this.fire(D.AFTER_REFRESH,s);
}},display:function(E,z){var x=this.dataBufferWindow;if(e.notNull(z)&&(z.getMaxX()<x.x||z.getMaxY()<x.y||z.getMinX()>x.x+x.w||z.getMinY()>x.y+x.h)){var A=this.parentMap.getMapContext().getUniverse().getMapBounds().getWidth();
if(e.notNull(z)&&z.getMaxX()<x.x&&z.getMaxX()+A>x.x){}else{if(e.notNull(z)&&z.getMinX()>x.x+x.w&&z.getMinX()-A<x.x+x.w){}else{return;
}}}if(e.notNull(z)&&this.visibleBound&&(z.getMinX()>this.visibleBound.getMaxX()||z.getMinY()>this.visibleBound.getMaxY()||z.getMaxX()<this.visibleBound.getMinX()||z.getMaxY()<this.visibleBound.getMinY())){return;
}if(this.mapping&&!E.mapping&&!this.nsdp.fullDisplay){return;}E.group=this.realGroup;E.screenTransformObj=this.parentMap.getMapContext().getTransform();
E.screenPoints=null;E.graphics=this.graphics?this.graphics:this.parentMap.graphics;E.parentLayer=this;
var t=this.getFeatureStyles(E);E.oldStyle=null;E.hover=false;if(E.selected){E.oldStyle=t;if(E.selected&&this.selectionStyle){var u={};
if(this.selectionStyle.styleType==="PulseAnimation"||this.selectionStyle.styleType==="AnimationColor"){var y=E.shape;
E.displayFeature([this.selectionStyle]);E.selectShape=E.shape;E.shape=y;u=E.oldStyle;}else{u=this.getHoverSelectStyle(this.selectionStyle,E);
}t=u;if(this.parentMap.wraparound){E.renderingStyle=t;}}}if(t!==null){E.setRenderingStyle(t);t=[t];}else{t=[];
}if(this.otherStyles){t=t.concat(this.otherStyles);}if(t.length===0){var D=this.getDefaultRenderingStyle(E.geo.type);
if(D){t.push(D);E.setRenderingStyle(D);}else{return;}}t=E.getAllStyles(t);if(e.notNull(this.labelingStyle)){if(e.isNull(E.getLabelingStyle())){E.setLabelingStyle(this.labelingStyle);
}}else{if(!E.labelStyle&&E.labelStyleName){var C=e.style.StyleStore.getServerSideStyle(this.dataSource,E.labelStyleName);
E.setLabelingStyle(C);}}var v=this;var B=function(){if(t[0].styleType==="Marker"&&t[0].src&&(t[0].width===null||t[0].height===null)){setTimeout(B,300);
}else{E.displayFeature(t);E.startAnimation();if(v.selectVisualFilter&&E.selected){var s=v.parentMap.graphics.getGraphicFilter(v.selectVisualFilter);
v.parentMap.graphics.applyStyle(E.shape,{filter:s});}else{if(v.graphicFilter&&!v.visualFilter.applyToLayer&&E.shape){v.parentMap.graphics.applyStyle(E.shape,{filter:this.graphicFilter});
}}}};B();},mappingNSDP:function(){if(this.mapping){return;}if(this.nsdpTitleArray){if(this.attrNames){if(this.nsdpTitleArray[0].toUpperCase()==this.nsdpKey){this.nsdpTitleArray.shift();
}this.attrNames=this.attrNames.concat(this.nsdpTitleArray);}else{if(this.nsdpTitleArray[0].toUpperCase()==this.nsdpKey){this.attrNames=this.nsdpTitleArray.slice(1);
}}}if(this.nsdpData&&this.nsdpKey){var t=this.featureArray?this.featureArray.length:0;for(var w=0;w<t;
w++){var v=this.featureArray[w];var s=this.getNsdpDataForFeature(v);if(e.notNull(s)){e.$.extend(v.attributes,s);
v.columns=[];for(var y in s){v.columns.push(y);}v.mapping=true;}else{v.mapping=false;}}this.mapping=true;
var u=e.event.LayerEvent;var x=new u(u.NSDP_MAPPED,this);this.fire(u.NSDP_MAPPED,x);}},getNsdpDataForFeature:function(s){var u=null;
if(e.notNull(s.attributes)){u=s.getAttributeValue(this.nsdpKey);}if(e.isNull(u)){u=s.id;}u=this.nsdp.ignoreCase?u.toUpperCase():u;
var t=this.nsdpData[u];return t;},clearNSDP:function(){if(!this.nsdpTitleArray){return;}var u=this.nsdpTitleArray.length;
var x=this.attrNames.length;this.attrNames.splice(x-u,u);if(this.nsdpData&&this.mapping){var s=this.featureArray?this.featureArray.length:0;
for(var w=0;w<s;w++){var v=this.featureArray[w];if(v.mapping){for(var t=0;t<u;t++){v.attributes[this.nsdpTitleArray[t].toUpperCase()]=null;
}}v.mapping=false;}this.mapping=false;}},isValidId:function(u){var s=this.featureArray?this.featureArray.length:0;
for(var t=0;t<s;t++){if(this.featureArray[t].id==u){return false;}}return true;},getFeature:function(u){var s=this.featureArray?this.featureArray.length:0;
for(var t=0;t<s;t++){if(this.featureArray[t].id==u){return this.featureArray[t];}}return null;},getFeaturesByAttribute:function(z,D){var x,w,y,t,C=false,s,B,A;
var v=this.featureArray?this.featureArray.length:0;if(v===0){return null;}z=z.toUpperCase();y=this.getAttributeNames();
y.forEach(function(E){if(z===E.toUpperCase()){C=true;}});if(!C){return null;}var u=(D instanceof Array);
if(u){A=D.length;}x=[];for(t=0;t<v;t++){w=this.featureArray[t];B=w.getAttributeValue(z);if(!B){continue;
}if(u){for(s=0;s<A;s++){if(D[s]===B){x.push(w);}}}else{}}return x;},getAllThemeData:function(t,s){this.getThemeData(null,t,s);
},getThemeData:function(D,C,w){if(this.usedInOverview){return;}if(this.initError){C();return;}if(this.type===e.layer.VectorLayer.TYPE_GEORSS){this.getGeoRss(D,C,w);
return;}if(this.type!==e.layer.VectorLayer.TYPE_LOCAL&&this.loadOnDemand&&e.isNull(this.sessionId)){this.getSessionId(D,C);
return;}if(e.notNull(this.getDataRequest)){this.getDataRequest.abort();}this.loading=true;var y=this;
var s=this.serverURL;if(this.type!==e.layer.VectorLayer.TYPE_DATAPACK){s+="/dataserver/"+this.dataSource;
}var v={};y.lastEvent=e.event.LayerEvent.VECTOR_LAYER_LOADING_THEME;if(y.type===e.layer.VectorLayer.TYPE_PREDEFINED||y.type===e.layer.VectorLayer.TYPE_JDBC){if(y.parentMap){y.parentMap.showProgressBar(y.parentMap.getProgress());
}}if(this.options){if(this.options.simplify){v.simplify=this.options.simplify;if(this.options.threshold){v.threshold=this.options.threshold;
}if(this.options.simplifyAlgorithm){v.simplifyAlgorithm=this.options.simplifyAlgorithm;}}if(this.options.dadp){v.dadp=this.options.dadp;
}}if(this.type===e.layer.VectorLayer.TYPE_PREDEFINED){v.t=this.themeName;if(e.notNull(this.workspace)){v.workspace=this.workspace;
}}else{if(this.type===e.layer.VectorLayer.TYPE_JDBC){if(e.notNull(this.workspace)){v.workspace=this.workspace;
}v.t=this.name;v.sql=this.sql;if(this.keyColumn){v.id_col=this.keyColumn;}if(this.baseTable){v.base_table=this.baseTable;
}if(this.geometryColumn){v.geom_col=this.geometryColumn;}if(this.jdbcSrid){v.jdbc_srid=this.jdbcSrid;
}}}e.$.extend(v,this.queryParameter);if(D){v.bbox=D.getMinX()+","+D.getMinY()+","+D.getMaxX()+","+D.getMaxY();
}var u=e.util.HttpRequest.getDomain(this.serverURL);if(!u){u=e.util.HttpRequest.localDomain;}var A=e.gv.mvKeyMap[u];
if(A){v.key=A;}if(this.type!==e.layer.VectorLayer.TYPE_DATAPACK){v.include_label_box="true";var B=null;
if(this.parentMap){B=this.parentMap.getMapContext().getUniverse().getSRID();}if(B){v.to_srid=B;v.bbox_srid=B;
}if(this.sessionId){v.ssid=this.sessionId;}}if(this.type!==e.layer.VectorLayer.TYPE_DATAPACK){v.refresh=Math.round(Math.random()*100000);
}var z=y.type===e.layer.VectorLayer.TYPE_DATAPACK?true:false;var x=function(G){y.initError=true;y.getDataRequest=null;
if(G){e.util.Logger.alert("MAPVIEWER_9006","OM.layer.VectorLayer.getThemeData",G.responseText);}if(w){w();
}var F=e.event;var E=new F.LayerEvent(F.LayerEvent.INIT_ERROR,y);if(e.notNull(y.parentMap)){E.mapContext=y.parentMap.getMapContext();
}y.fire(F.LayerEvent.INIT_ERROR,E);return;};if(this.enableXHR){v.$enableXHR=true;}var t=(this.jsonp)?"jsonp":"text";
e.util.Logger.fine("","VectorLayer.getThemeData","["+y.name+"] Sending data loading request.");this.getDataRequest=e.util.HttpRequest.send(s,v,function(E){if(!y.parentMap||!y.parentMap.graphics){return;
}var M;var L=false;if(typeof E==="string"){y.lastEvent=e.event.LayerEvent.VECTOR_LAYER_PARSING_THEME;
E=E.trim();L=E.indexOf("{")===0||E.indexOf("[")===0;}try{y.parentMap.showProgressBar(y.parentMap.getProgress());
if(typeof E!=="object"){E=e.$.parseJSON(E);}}catch(K){if(L){e.util.Logger.warning(null,"OM.layer.VectorLayer.getThemeData",K);
}try{E=e.$(e.$.parseXML(E));var G=E.find("oms_error");if(G.length>0){e.util.Logger.alert("MAPVIEWER_9007","OM.layer.VectorLayer.getThemeData",G.text());
x();return;}M=new e.layer.KMLParser(y);var J=M.parse(E,C);if(!J){M=new e.layer.GeoRSSParser(y);J=M.parse(E,C);
if(!J){e.util.Logger.alert("MAPVIEWER_9008","OM.layer.VectorLayer.getThemeData");x();return;}}return;
}catch(F){x();return;}}y.getDataRequest=null;try{M=new e.layer.GeoJSONParser(y);M.parse(E,C,x);}catch(I){e.util.Logger.warning("MAPVIEWER_9101","OM.layer.VectorLayer.getThemeData",I.message);
x();return;}},t,x,z);},getGeoRss:function(x,y,t){if(this.initError){y();return;}this.loading=true;var v=this;
var u=this.serverURL;var w={};var s=function(B){v.initError=true;v.getDataRequest=null;if(B){e.util.Logger.alert("MAPVIEWER_9008","OM.layer.VectorLayer.getThemeData",B.responseText);
}if(t){t();}var A=e.event;var z=new A.LayerEvent(A.LayerEvent.INIT_ERROR,v);z.mapContext=v.parentMap.getMapContext();
v.fire(A.LayerEvent.INIT_ERROR,z);return;};this.attrNames=["link","updated","content","summary"];this.getDataRequest=e.util.HttpRequest.send(u,w,function(z){var A=e.$(z).find("oms_error");
if(A.length>0){e.util.Logger.alert("MAPVIEWER_9008","OM.layer.VectorLayer.getThemeData",A.text());s();
return;}var B=new e.layer.GeoRSSParser(v);if(!B.parse(z,y,t)){s();}},"xml",s,true,true);},isBoundingTheme:function(){return this.boundingTheme;
},loadBoundingTheme:function(z){var v=this;var s=this.parentMap.getMapContext();this.orgWidth=this.orgWidth?this.orgWidth:s.getDeviceWidth();
this.orgHeight=this.orgHeight?this.orgHeight:s.getDeviceHeight();var w=new e.event.LayerEvent(e.event.LayerEvent.FINISH_GOT_CONFIG,this);
var y=v.renderingStyle&&v.renderingStyle.hasBinding();var t=e.notNull(v.nsdpData)&&e.notNull(v.nsdpKey);
var A=function(B){if(!B){var C=v.getExtent();B=C?C.coordinates:null;if((y||t)&&e.notNull(v.bfMbr)){B=v.bfMbr.coordinates;
}}if(!B){v.dataLoaded=false;u();return;}else{v.dataLoaded=true;}if(z){z(B[0],B[1],B[2],B[3]);}else{w.bbox=[B[0],B[1],B[2],B[3]];
w.mapContext=v.parentMap.getMapContext();v.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,w);}};var u=function(){v.loadedBoundingTheme=true;
e.util.Logger.warning("MAPVIEWER_9049","OM.layer.VectorLayer.loadBoundingTheme",v.name);var C=v.parentMap.getMapContext();
var B=C.getUniverse().getMapBounds();if(z){z(B.getMinX(),B.getMinY(),B.getMaxX(),B.getMaxY());}else{w.bbox=[B.getMinX(),B.getMinY(),B.getMaxX(),B.getMaxY()];
w.mapContext=C;v.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,w);}};var x;if(this.mbr){x=this.mbr;A([x.getMinX(),x.getMinY(),x.getMaxX(),x.getMaxY()]);
}else{if((!this.loadOnDemand&&this.dataLoaded)||this.type===e.layer.VectorLayer.TYPE_LOCAL){x=this.getExtent();
if((y||t)&&e.notNull(this.bfMbr)){x=this.bfMbr;}if(e.isNull(x)){x=this.parentMap.getMapContext().getUniverse().getMapBounds();
}A([x.getMinX(),x.getMinY(),x.getMaxX(),x.getMaxY()]);}else{this.getAllThemeData(A,u);}}},calculateCenterAndZoomLevel:function(w,u,t,s){var A=this.parentMap.getMapContext();
var E=A.getUniverse();if(w===0&&u===0&&t===0&&s===0){return[A.getZoomLevel(),A.getCenterPoint()];}if(this.type===e.layer.VectorLayer.TYPE_LOCAL){var F=this.getExtent()||this.getExtent();
var I=this.renderingStyle&&this.renderingStyle.hasBinding();if(I&&e.notNull(this.bfMbr)){F=this.bfMbr;
}if(e.isNull(F)){F=this.parentMap.getMapContext().getUniverse().getMapBounds();}w=F.getMinX();u=F.getMinY();
t=F.getMaxX();s=F.getMaxY();}else{if(e.isNull(this.mbr)){var J=E.getSRID();this.mbr=new e.geometry.Rectangle(w,u,t,s,J);
}}var G=(t-w)/A.getDeviceWidth();var z=(s-u)/A.getDeviceHeight();var C=E.getZoomLevels();var D=E.getZoomLevelNumber();
var v=null;for(var B=0;B<D;B++){if(G>C[B].resolution||z>C[B].resolution*C[B].stretchRatio){v=B===0?0:B-1;
break;}}if(e.isNull(v)){v=(e.gv.pointZoomLevel===e.gv.MID_ZOOM)?Math.floor(D/2):D-1;}var y=(w+t)/2;var x=(u+s)/2;
this.loadedBoundingTheme=true;this.boundingZoomLevel=v;return new Array(v,new e.geometry.Point(y,x,E.getSRID()));
},getLayerConfig:function(){var s=new e.event.LayerEvent(e.event.LayerEvent.FINISH_GOT_CONFIG,this);s.mapContext=this.parentMap.getMapContext();
this.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,s);},setCenterAndZoomlevel:function(s){this.refreshImpl(s,false);
},recenter:function(B){if(this.displayed){var C=this.dataBufferWindow;var F=C.x+C.w/2;var D=C.y+C.h/2;
var y=this.parentMap.getMapContext();var A=y.getUniverse();var E=y.getRoundMapCenterPoint();var s=y.getCenterPoint();
var z=A.getZoomLevels();var u=z[y.getZoomLevel()];if(!this.refreshCenterX){this.refreshCenterX=F;}var x;
if(!this.parentMap.wraparound){x=Math.abs(s.getX()-F)/u.resolution;}else{x=Math.abs(E.getX()-this.refreshCenterX)/u.resolution;
}var w=Math.abs(s.getY()-D)/u.resolution*u.stretchRatio;var v=(this.orgWidth*this.xRatio-this.orgWidth)/2;
var t=(this.orgHeight*this.yRatio-this.orgHeight)/2;if(v<x||t<w){this.clearFeatureShapes();if(this.featureGroupArr){this.featureGroupArr.length=0;
}else{this.featureGroupArr=[];}if(this.parentMap.wraparound){this.refreshCenterX=y.getRoundMapCenterPoint().getX();
}this.loaded=false;this.areaIdx=0;this.refreshImpl(B,false);}else{this.refreshShadowGeom();}}else{if(this.parentMap&&this.parentMap.initialized){this.loaded=false;
this.refreshImpl(B,false);}}},checkVisible:function(){var s=this.isInZoomLevelRange();if(!s){return false;
}if(!this.isVisible()){return false;}return true;},clearFeatureShapes:function(){this.parentMap.graphics.clearGroup(this.group);
var s=this.featureArray?this.featureArray.length:0;for(var x=s-1;x>=0;x--){var w=this.featureArray[x];
w.clearAnimation();w.animations=null;if(w.moveAnimation){if(this.parentMap.wraparound){w.stopMoveAnimation();
}else{w.pauseMoveAnimation();}}w.group=null;w.screenTransformObj=null;w.graphics=null;w.displayed=false;
w.inCluster=false;w.parentLayer=null;w.markerSize=null;if(w.shapeGroup){var v=w.shapeGroup.length;for(var u=0;
u<v;u++){w.shapeGroup[u].feature=null;}w.shapeGroup=null;}else{if(w.shape){this.parentMap.graphics.remove(w.shape);
w.shape.feature=null;w.shape=null;}}if(w.labelShape){w.labelShape.feature=null;}w.labelShape=null;if(w.ghostShape){w.ghostShape.feature=null;
}w.ghostShape=null;w.ghostGeom=null;if(e.notNull(w.shapeArray)){w.shapeArray=null;}}this.lineGroup=null;
this.realGroup=null;this.labelGroup=null;this.featureGroupArr=null;if(this.vCluster){this.vCluster.clearAllClusterFeatures();
}if(this.heatMap){var t=e.$(this.getHeatmapDivId());if(t.length>0){t.empty();}}this.areaIdx=0;this.emptyCustomLayer();
this.displayed=false;},getCustomLayerDiv:function(){var u=this.getCustomLayerDivId();var t=e.$("#"+u);
if(t.length<=0){if(e.notNull(this.parentMap)){var s=e.$("<div id='"+u+"' style='position:absolute;'>");
s.css({display:"block",left:"0px",top:"0px",width:0+"px",height:0+"px"});this.parentMap.$customLayersDiv.append(s);
s.on("mouseout",function(v){v.stopPropagation();});t=s;}}return t;},getHeatmapDivId:function(){return"#"+this.getDivId("heatmap_");
},getCustomLayerDivId:function(){return this.getDivId("customDiv");},getDivId:function(s){var t=s+this.parentMap.mapInstanceId+"_"+this.name;
return t.replace(/([ #;?%&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1");},showInfoWindow:function(G,E){var x="";
var A=G.attributes;if(!A&&this.type!==e.layer.VectorLayer.TYPE_LOCAL){return;}var v=0;var B,u;if(G.InfoHtml){x=G.InfoHtml;
}else{if(this.attrNames&&this.attrNames.length>0){var z=this.attrNames.length;var y=[];for(var w=0;w<z;
w++){B=this.attrNames[w];var F=B.toUpperCase();u="#bbbbbb";if(v%2===0){u="#dddddd";}if(F!="_LABEL_"&&G.attributes[F]&&y.indexOf(F)===-1){v++;
D=G.attributes[F];if(D){if(typeof D==="string"&&!e.util.DomUtil.isHtml(D)){D=D.replace(/\s/g,"&nbsp;");
}}else{D="";}x+="<tr bgcolor='"+u+"'><td align='right'>"+B+"</td><td align='left'>"+D+"</td></tr>";y.push(F);
}}x="<table cellspacing='2' style='margin: auto;border-spacing: 2px;border-collapse: separate;'>"+x+"</table>";
}else{if(this.type===e.layer.VectorLayer.TYPE_DATAPACK||this.type===e.layer.VectorLayer.TYPE_LOCAL){for(B in G.attributes){var D=G.attributes[B];
if(D){if(typeof D==="string"){D=D.replace(/\s/g,"&nbsp;");}}else{continue;}u="#bbbbbb";if(v%2===0){u="#dddddd";
}v++;if(B!=="_LABEL_"){x+="<tr bgcolor='"+u+"'><td align='right'>"+B+"</td><td align='left'>"+D+"</td></tr>";
}}if(v===0){return;}x="<table cellspacing='2' style='margin: auto;border-spacing: 2px;border-collapse: separate;'>"+x+"</table>";
}else{return;}}}var t={};var C;if(G.label){C=(G.label+"").replace(/ /g,"&nbsp;");t.title=C;}else{if(A&&e.notNull(A._LABEL_)){C=(G.attributes._LABEL_+"").replace(/ /g,"&nbsp;");
t.title=C;}}var s=this.parentMap;if(!E){E=s.getCursorLocation();}t.id=this.name+"_"+G.id;if(e.notNull(E)){s.displayInfoWindow(E,x,t);
}else{s.displayInfoWindow(G.getGeometry(),x,t);}},getSessionId:function(w,v){var s=this.serverURL+"/dataserver/"+this.dataSource;
var u={get_session_id:"yes"};var t=this;e.util.HttpRequest.send(s,u,function(x){t.sessionId=x;t.getThemeData(w,v);
},"text");},removeGraphics:function(){this.clearSelectedFeatures();if(this.group){var s=this.parentMap.graphics;
this.clearFeatureShapes();s.remove(this.group);this.group=null;}},changeVisibleBound:function(){if(this.type==e.layer.VectorLayer.TYPE_PREDEFINED&&!this.loadOnDemand){this.clearFeatureShapes();
}this.refreshImpl();},changeOpacity:function(){if(this.parentMap&&this.parentMap.graphics){this.parentMap.graphics.applyStyle(this.group,{opacity:this.opacity});
}},getNSDPXML:function(){if(!this.nsdp){return"";}var t='<ns_data_provider provider_id="defaultNSDP">';
t+='<for_theme name="'+this.name+'"/>';t+='<join spatial_key_column="'+this.nsdpKey+'"/>';t+="<parameters>";
if(this.nsdp.xml){t+='<parameter name="xml" value="'+this.nsdp.xml.replace(/</g,"&lt;")+'"/>';}else{if(this.nsdp.url){t+='<parameter name="xml_url" value="'+this.nsdp.url+'"/>';
}}t+="</parameters>";t+="</ns_data_provider>";return t;},selectAllFeatures:function(){var s=this.featureArray?this.featureArray.length:0;
for(var u=0;u<s;u++){var t=this.featureArray[u];if(this.selectionEnable&&!t.selected){if(!t.oldStyle){t.oldStyle=t.renderingStyle;
}t.setRenderingStyle(this.selectionStyle);if(this.selectedFeatures){this.selectedFeatures.push(t);}else{this.selectedFeatures=new Array(t);
}t.selected=true;}}return null;},addMarkerBoundToGrid:function(){var z=this.getFeatureGeometryType();
if(z===""||z==="LINESTRING"||z==="POLYGON"){return;}var v=this.featureArray?this.featureArray.length:0;
for(var t=0;t<v;t++){var F=this.featureArray[t];if(F.displayed&&F.screenPoints){var C=F.screenPoints.x;
var B=F.screenPoints.y;var D,u,E;if(F.markerSize){D=F.markerSize.w;u=F.markerSize.h;}else{if(F.renderingStyle){E=F.renderingStyle;
}else{if(this.otherStyles&&this.otherStyles.length>0){E=this.otherStyles[0];}else{E=this.getDefaultRenderingStyle(F.geo.type);
}}D=E.realWidth?E.realWidth:E.width;u=E.realHeight?E.realHeight:E.height;F.markerSize={w:D,h:u};}var A=[C-D/2,B-u/2,C+D/2,B+u/2];
this.parentMap.grid.insert(A);}}if(this.vCluster){this.vCluster.addClusterFeatureToLabelGrid();}},addLabels:function(){if(!this.group){return;
}var y=this.featureArray?this.featureArray.length:0;var C=this.parentMap.getMapContext();var x=C.getWholeMapNum();
var B=C.getBaseWholeMapIndex();if(!this.labelGroupArray){this.labelGroupArray=[];}else{this.labelGroupArray.length=0;
}for(var u=0;u<x;u++){if(!this.labelGroup){this.labelGroup=this.parentMap.graphics.createGroup({opacity:this.opacity,visibility:true});
this.group.appendChild(this.labelGroup);}if(x>1){var s=C.getUniverse().getZoomLevels()[C.getZoomLevel()].resolution;
var A=C.getUniverse().getMapBounds().getWidth();var t=(C.getCenterPoint().getX()-C.getRoundMapCenterPoint().getX())/s;
this.labelGroup.translate((u-B)*A/s-t,0);if(!this.labelGroupArray){this.labelGroupArray=[];}this.labelGroupArray.push(this.labelGroup);
this.labelGroup=null;}}if(this.shadow){this.getShadowArea();}if(x>1){this.labelGroup=this.labelGroupArray[0];
}for(var v=0;v<y;v++){var D=this.featureArray[v];if(D.labelShape){continue;}D.addLabel(this.parentMap.grid);
if(D.labelShape){D.labelShapeArr=[];for(u=1;u<x;u++){var z=this.parentMap.graphics.cloneText(D.labelShape);
if(z){z.applyStyle({cursor:this.mouseCursor});z.feature=D;this.labelGroupArray[u].appendChild(z);D.labelShapeArr.push(z);
}}}}},clearAllLabels:function(){this.mask=null;if(this.labelGroup){this.parentMap.graphics.clearGroup(this.labelGroup);
}if(this.labelGroupArray){for(var t=0;t<this.labelGroupArray.length;t++){this.parentMap.graphics.clearGroup(this.labelGroupArray[t]);
}this.labelGroupArray.length=0;}var s=this.featureArray?this.featureArray.length:0;for(var v=0;v<s;v++){var u=this.featureArray[v];
if(u.labelShape){u.labelShape.feature=null;u.labelShape=null;}}},enableDisplayInBatch:function(t,s){this.enableBatch=t;
if(t){this.batchInterval=s&&s.interval?s.interval:200;this.numberInBatch=s&&s.numberInBatch?s.numberInBatch:100;
}},enableClustering:function(t,s){this.clustering=t;if(t){this.vCluster=new e.layer.VectorLayerCluster(this,s);
}this.maxClusteringLevel=s&&s.maxClusteringLevel?s.maxClusteringLevel:100;this.clickZoomInLevels=-1;if(s&&s.enableZoomIn===false){this.clickZoomInLevels=0;
}else{if(s&&s.zoomInLevels){this.clickZoomInLevels=parseInt(s.zoomInLevels);}}},getFeatureIndex:function(u){var s=this.featureArray.length;
if(s===0){return -1;}for(var t=0;t<s;t++){if(this.featureArray[t]==u){return t+1;}}return -1;},bringFeatureForward:function(u){var s=u.parentLayer.parentMap.getMapContext().getGraphics();
if(u.displayed&&u.shape){if(u.shapeGroup&&u.shapeGroup.length>1){for(var t=0;t<u.shapeGroup.length;t++){s.bringForward(u.shapeGroup[t]);
}}else{s.bringForward(u.shape);}if(u.labelShape){s.bringForward(u.labelShape);}}},sendFeatureBackward:function(u){var s=u.parentLayer.parentMap.getMapContext().getGraphics();
if(u.displayed&&u.shape){if(u.labelShape){s.sendBackward(u.labelShape);}if(u.shapeGroup&&u.shapeGroup.length>1){for(var t=0;
t<u.shapeGroup.length;t++){s.sendBackward(u.shapeGroup[t]);}}else{s.sendBackward(u.shape);}}},bringFeatureToTop:function(u){var s=u.parentLayer.parentMap.getMapContext().getGraphics();
if(u.displayed&&u.shape){if(u.shapeGroup&&u.shapeGroup.length>1){for(var t=0;t<u.shapeGroup.length;t++){s.bringToTop(u.shapeGroup[t]);
}}else{s.bringToTop(u.shape);}if(u.labelShape){s.bringToTop(u.labelShape);}}},sendFeatureToBottom:function(u){var s=u.parentLayer.parentMap.getMapContext().getGraphics();
if(u.displayed&&u.shape){if(u.labelShape){s.sendToBottom(u.labelShape);}if(u.shapeGroup&&u.shapeGroup.length>1){for(var t=0;
t<u.shapeGroup.length;t++){s.sendToBottom(u.shapeGroup[t]);}}else{s.sendToBottom(u.shape);}}},getTargetFeature:function(s){var t=s.feature;
while(e.isNull(t)&&s.parentNode){s=s.parentNode;t=s.feature;}return t;},getLineGroup:function(){if(!this.lineGroup){this.lineGroup=[];
var t=this.parentMap.graphics;for(var s=0;s<4;s++){this.lineGroup[s]=t.createGroup();this.realGroup.appendChild(this.lineGroup[s]);
}}return this.lineGroup;},redraw:function(s){var t=this.parentMap.getMapContext();this.orgWidth=t.getDeviceWidth();
this.orgHeight=t.getDeviceHeight();this.setWindow();this.clearFeatureShapes();this.refreshImpl(null,null,s);
},calculateLayerGradientBound:function(){var t=this.parentMap.getMapContext();var z=t.getUniverse();var s=t.getMapCenter();
var y=z.getZoomLevels();var x=y[t.getZoomLevel()];var w=(s.getX()-this.minX)/x.resolution;var u=(s.getY()-this.minY)/x.resolution/x.stretchRatio;
var v={x1:w-this.orgWidth/2,y1:u-this.orgHeight/2,x2:w+this.orgWidth/2,y2:u+this.orgHeight/2,useObjectBoundingBox:false};
return v;},clearLayer:function(){this.removeGraphics();var s=this.featureArray?this.featureArray.length:0;
if(this.type===e.layer.VectorLayer.TYPE_LOCAL){for(var t=s-1;t>=0;t--){this.featureArray[t].deleteAllListeners();
}}else{this.featureArray=null;}this.transform=null;this.dataCache=null;this.dataLoaded=false;this.vCluster=null;
this.mbr=null;this.bfMbr=null;if(this.vmf){this.vmf.destroy();this.vmf=null;}if(this.draggingFeature){this.parentMap.$oracleMapDiv.unbind("mousemove",this.draggingFeature);
this.parentMap.$oracleMapDiv.unbind("touchmove",this.draggingFeature_touch);e.Hammer(this.parentMap.$oracleMapDiv[0]).off("drag",this.draggingFeature_win8Touch);
}this.draggingFeature=null;if(this.endFeatureDragging){e.$(document).unbind("mouseup",this.endFeatureDragging);
e.$(document).unbind("mouseout",this.endFeatureDragging);this.parentMap.$oracleMapDiv.unbind("touchend",this.endFeatureDragging_touch);
}this.endFeatureDragging=null;this.toolTipCustomizer=null;},destroy:function o(){this.clearLayer();o.base.call(this);
},addSecondaryStyle:function(s){if(this.parentMap&&this.isServerSideStyle(s,"secondary")){return;}else{if(!this.otherStyles){this.otherStyles=[s];
}else{this.otherStyles.push(s);}}},removeSecondaryStyle:function(u){if(this.otherStyles===null){return null;
}var s=this.otherStyles.length;for(var t=0;t<s;t++){if(this.otherStyles[t]===u){this.otherStyles.splice(t,1);
return u;}}return null;},setVisibleImpl:function(){if(e.isNull(this.parentMap)){return;}if(this.heatMap){var s=e.$(this.getHeatmapDivId());
s.toggle(this.visible);}this.getCustomLayerDiv().toggle(this.visible);if(this.group&&this.parentMap&&this.parentMap.graphics){this.parentMap.graphics.applyStyle(this.group,{display:this.visible});
}if(this.visible&&this.parentMap&&this.parentMap.displayed&&!this.displayed){if(this.type!==e.layer.VectorLayer.TYPE_LOCAL&&!this.dataLoaded&&!this.initError){this.refresh(null,false);
}else{this.displayFeatures();}}if(this.parentMap&&this.parentMap.displayed){this.parentMap.refreshVectorLayerLabels();
}return;},clone:function n(t,z,w){var y=n.base.call(this,t);y.getDataRequest=null;y.boundingTheme=false;
y.sessionId=null;if(this.renderingStyle&&this.renderingStyle.styleType=="HeatMap"&&this.renderingStyle.containerVectorLayer){y.renderingStyle=this.renderingStyle.clone();
y.renderingStyle.containerVectorLayer=y.renderingStyle.containerVectorLayer.clone("over_"+y.renderingStyle.containerVectorLayer.name,true,true);
y.heatMap=null;}if(y.displayed||y.dataLoaded){y.featureArray=[];var s=this.featureArray.length;for(var v=0;
v<s;v++){var u=this.featureArray[v].clone();u.parentLayer=y;y.featureArray.push(u);}}else{if(z){y.usedInOverview=true;
y.containerLayer=w;var x=e.event;y.copyFeatures=function(B){var E=B.target;y.featureArray=[];var A=E.featureArray.length;
for(var D=0;D<A;D++){var C=E.featureArray[D].clone();y.featureArray.push(C);}y.dataLoaded=true;if(!y.containerLayer){y.displayFeatures();
}};this.on(x.LayerEvent.FEATURES_LOADED,y.copyFeatures);}}y.displayed=false;y.group=null;y.realGroup=null;
y.labelGroup=null;y.lineGroup=null;y.graphics=null;return y;},displayHeatMap:function(){this.loaded=false;
var B=this.featureArray?this.featureArray.length:0;var s=this.parentMap.getMapContext();var t=s.getUniverse().getSRID();
var u=s.getTransform();this.xRatio=1.2;this.yRatio=1.2;this.setWindow();var E=this.orgWidth*this.xRatio;
var y=this.orgHeight*this.yRatio;var D=u.toScreenPoint(this.dataBufferWindow.x,this.dataBufferWindow.y+this.dataBufferWindow.h);
if(!this.heatMap){this.heatMap=new e.layer.VectorLayerHeatMap(this.renderingStyle,this);}if(this.styleAttributes&&this.styleAttributes.length>0){this.heatMap.isValued=true;
}e.style.Style.calculateStyleSize(this.renderingStyle,s);this.heatMap.init(E,y,D.x,D.y,this.renderingStyle.spotlightRadius);
var z=this;var A=0;var G=function(w){return function(){C.transform(t,function(J){A--;w.srid=t;w.geo=J;
z.addFeatureToHeatMap(w,D);});}();};for(var x=0;x<B;x++){var I=this.featureArray[x];var C=I.getGeometry();
if(C.type!="Point"&&C.type!="OrientedPoint"&&C.type!="MultiPoint"&&C.type!="OrientedMultiPoint"){continue;
}if(t!==C.srid){A++;G(I);}else{z.addFeatureToHeatMap(I,D);}}var F=function(N){var K="heatmap_"+z.parentMap.mapInstanceId+"_"+z.name;
var Q=e.$("#"+K);if(Q.length===0){Q=e.$("<div id='"+K+"' style='position:absolute;'>");z.parentMap.$heatMapDiv.append(Q);
}else{Q.empty();}if(z.renderingStyle.isTop){z.parentMap.$heatMapDiv.css({"z-index":"105"});}else{z.parentMap.$heatMapDiv.css({"z-index":"90"});
}Q.css({display:"block",left:"0px",top:"0px",width:z.orgWidth+"px",height:z.orgHeight+"px"});var M=z.parentMap.getMapContext();
var P=M.getUniverse();var J=M.getZoomLevel();var L=P.getZoomLevels()[J];var w=M.getCenterPoint();var O=(z.dataBufferWindow.x-w.getX())/L.resolution+M.getDeviceWidth()/2;
var R=(w.getY()-z.dataBufferWindow.y-z.dataBufferWindow.h)/L.resolution/L.stretchRatio+M.getDeviceHeight()/2;
N.style.cssText="position:absolute;left:"+O+"px;top:"+R+"px;";Q[0].appendChild(N);z.displayed=true;if(e.util.Logger.DEBUG){console.timeEnd("["+z.name+"] displayFeatures");
}z.displayEnd();};var v=function(){if(A!==0||z.heatMap.loadingBoundaray){setTimeout(v,100);}else{z.heatMap.drawHeatMap(F);
}};v();},addFeatureToHeatMap:function(D){D.parentLayer=this;var B=1;var z=D.geo;var s=this.parentMap.getMapContext().getTransform();
if(e.notNull(this.styleAttributes)&&this.styleAttributes.length>0){B=Number(D.getAttributeValue(this.styleAttributes[0]));
}else{B=this.renderingStyle.getDataValueFromBinding(D);}if(isNaN(B)||e.isNull(B)){B=1;}var v=this.dataBufferWindow;
var A,w,C;if(z.type==="Point"||z.type==="OrientedPoint"){A=z.coordinates[0];w=z.coordinates[1];if(A<v.x||w<v.y||A>v.x+v.w||w>v.y+v.h){return;
}C=s.toHeatMapPoint(A,w,0,0,this.heatMap.scale);this.heatMap.addData(C.x,C.y,B);}else{if(z.type=="MultiPoint"||z.type=="OrientedMultiPoint"){var u=z.coordinates.length;
for(var t=0;t<u;t++){A=z.coordinates[t][0];w=z.coordinates[t][1];if(A<v.x||w<v.y||A>v.x+v.w||w>v.y+v.h){continue;
}C=this.screenTransformObj.toHeatMapPoint(A,w,0,0,this.heatMap.scale);this.heatMap.addData(C.x,C.y,B);
}}}},pan:function(){if(e.isNull(this.parentMap)){return;}if(this.displayed){var x=this.parentMap.getMapContext();
var s=x.getCenterPoint();var z=this.dataBufferWindow.x+this.dataBufferWindow.w/2-s.getX();var y=this.dataBufferWindow.y+this.dataBufferWindow.h/2-s.getY();
var v=x.getTransform();var w=v.toScreenXLength(z);var B=v.toScreenYLength(-y);if(this.heatMap){var A=e.$(this.getHeatmapDivId());
if(A.length>0){A.css({left:w,top:B});}}var u=this.getCustomLayerDiv();if(u.length>0){u.css({left:w,top:B});
}}},getHoverSelectStyle:function(z,w){if(z.styleType!="Color"){return z;}var t=w.oldStyle,y=w.geo.type;
if(t.resolve){var x=t.resolve(w);if(x){t=x;}}var v={};if(t.styleType=="Marker"&&(y=="Point"||y=="MultiPoint"||y=="OrientedPoint"||y=="OrientedMultiPoint")){if(t.vectorDef&&t.vectorDef.length>0&&t.vectorDef[0].style){e.$.extend(true,v,t);
e.$.extend(v.vectorDef[0].style,z.origConfig);v.bindings=[];}else{v=z;}}else{if(t.styleType=="Line"&&(y=="LineString"||y=="MultiLineString")){var u={};
e.$.extend(u,t.origConfig,z.origConfig);v=new e.style.Line(u);}else{if(t.styleType=="LinearGradient"||t.styleType=="RadialGradient"){e.$.extend(v,t,z.origConfig);
if(v.stops1){v.stops=v.stops1;}}else{e.$.extend(v,t,z.origConfig);v.bindings=z.bindings;}}}return v;},setToolTipCustomizer:function(s){if(s&&typeof s==="function"){this.toolTipCustomizer=s;
}},enableToolTip:function(s){this.showToolTip=s;if(this.displayed){this.redraw();}},enableIndicatorFeatures:function(t,s){this.shadow=t;
if(t){this.setLabelsVisible(true);this.leadLine=s&&s.leadLine?s.leadLine:false;this.maxIndicators=s&&s.maxIndicators?s.maxIndicators:8;
if(s.maxIndicators===0){this.maxIndicators=0;}this.shadowLev={};this.shadowLev.min=s&&s.enabledZoomLevels&&s.enabledZoomLevels.min?s.enabledZoomLevels.min:0;
this.shadowLev.max=s&&s.enabledZoomLevels&&s.enabledZoomLevels.max?s.enabledZoomLevels.max:9;this.indicatorSize={};
this.indicatorSize.w=s&&s.indicatorSize&&s.indicatorSize.width/10?s.indicatorSize.width/10:4;this.indicatorSize.h=s&&s.indicatorSize&&s.indicatorSize.height/10?s.indicatorSize.height/10:3;
this.indicatorPos=s&&s.position?s&&s.position:3;if(typeof this.indicatorPos!="object"){this.shadowAnchor=this.indicatorPos;
}}},getShadowArea:function(){if(this.shadow){this.ghostNum=-1;var t=this.parentMap.getMapContext();var x=t.getUniverse();
var v,u;if(t.getZoomLevel()<=this.shadowLev.max&&t.getZoomLevel()>=this.shadowLev.min){if(this.shadowAnchor===1||this.shadowAnchor===3){v=t.getDeviceWidth()/2-5;
u=t.getDeviceHeight()/2;}if(this.shadowAnchor===4||this.shadowAnchor===6){v=t.getDeviceWidth()/2-5;u=t.getDeviceHeight()/2-10;
}var s=t.getZoomLevel();var y=v*x.getZoomLevels()[s].resolution;var w=u*x.getZoomLevels()[s].resolution*x.getZoomLevels()[s].stretchRatio;
this.transformLon=10*x.getZoomLevels()[s].resolution;this.transformLat=10*x.getZoomLevels()[s].resolution*x.getZoomLevels()[s].stretchRatio;
var A=t.getCenterPoint();var z=Math.round(this.maxIndicators/2);if(this.shadowAnchor===1){this.shadowArea=new e.geometry.Rectangle(A.getX()-y,A.getY()+w,A.getX()-y+this.indicatorSize.w*this.transformLon,A.getY()+w+this.indicatorSize.h*this.transformLat,x.srid);
}else{if(this.shadowAnchor===3){this.shadowArea=new e.geometry.Rectangle(A.getX()+y-this.indicatorSize.w*this.transformLon,A.getY()+w,A.getX()+y,A.getY()+w+this.indicatorSize.h*this.transformLat,x.srid);
}else{if(this.shadowAnchor===4){this.shadowArea=new e.geometry.Rectangle(A.getX()+y-this.indicatorSize.w*this.transformLon,A.getY()-w+z*this.indicatorSize.h*this.transformLat+z*this.transformLat,A.getX()+y,A.getY()-w+z*this.indicatorSize.h*this.transformLat+z*this.transformLat+this.indicatorSize.h*this.transformLat,x.srid);
}else{if(this.shadowAnchor===6){this.shadowArea=new e.geometry.Rectangle(A.getX()-y,A.getY()-w+z*this.indicatorSize.h*this.transformLat+z*this.transformLat,A.getX()-y+this.indicatorSize.w*this.transformLon,A.getY()-w+z*this.indicatorSize.h*this.transformLat+z*this.transformLat+this.indicatorSize.h*this.transformLat,x.srid);
}else{if(this.indicatorPos&&this.indicatorPos instanceof e.geometry.Point){this.shadowArea=new e.geometry.Rectangle(this.indicatorPos.getX(),this.indicatorPos.getY(),this.indicatorPos.getX()+this.indicatorSize.w*this.transformLon,this.indicatorPos.getY()+this.indicatorSize.h*this.transformLat);
}}}}}}else{this.shadowArea=null;}}},createShadowGeometry:function(u){if(!this.shadowArea){return null;
}var x=this.maxIndicators;var t=u.getGeometry();var w=t.getMBR();if(t.getType()!==e.GeomTypes.POLYGON&&t.getType()!==e.GeomTypes.MULTIPOLYGON&&!t.mbr){return;
}var v=this.parentMap.getMapContext().getQueryWindow();if(w.getMaxX()>v.getMaxX()||w.getMinX()<v.getMinX()||w.getMinY()<v.getMinY()||w.getMaxY()>v.getMaxY()){return;
}this.ghostNum++;var s;if(x===0){return;}if(this.ghostNum<Math.round(x/2)||this.leadLine&&this.ghostNum<x){s=new e.geometry.Rectangle(this.shadowArea.getMinX(),this.shadowArea.getMinY()-(this.indicatorSize.h+1)*this.transformLat,this.shadowArea.getMaxX(),this.shadowArea.getMaxY()-(this.indicatorSize.h+1)*this.transformLat,t.srid);
}else{if(this.ghostNum==Math.round(x/2)&&x!==1){if(this.shadowAnchor==3||this.shadowAnchor==4){s=new e.geometry.Rectangle(this.shadowArea.getMinX()-(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMinY(),this.shadowArea.getMaxX()-(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMaxY(),t.srid);
}if(this.shadowAnchor==1||this.shadowAnchor==6||!this.shadowAnchor){s=new e.geometry.Rectangle(this.shadowArea.getMinX()+(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMinY(),this.shadowArea.getMaxX()+(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMaxY(),t.srid);
}}else{if(Math.round(x/2)<this.ghostNum&&this.ghostNum<x){s=new e.geometry.Rectangle(this.shadowArea.getMinX(),this.shadowArea.getMinY()+(this.indicatorSize.h+1)*this.transformLat,this.shadowArea.getMaxX(),this.shadowArea.getMaxY()+(this.indicatorSize.h+1)*this.transformLat,t.srid);
}}}this.shadowArea=s;this.addToRtree(u,s);return s;},refreshShadowGeom:function(){if(!this.shadow||!this.showLables){return;
}var v=this.featureArray;var s=v.length;this.getShadowArea();for(var u=0;u<s;u++){var w=v[u];if(w.displayed&&w.label){w.removeGhostShape();
if(!w.labelShape){var t=this.createShadowGeometry(w);if(t){w.drawGhostGeom(t,[w.renderingStyle]);w.drawGhostLabel(t);
}}}}},createRtree:function(){if(e.notNull(this.rtree)){return;}if(e.util.Logger.DEBUG){console.time("start of createRtree");
}this.rtree=new e.RTree(10);var s=this.featureArray.length;for(var t=0;t<s;t++){var u=this.featureArray[t];
this.addToRtree(u);}if(e.util.Logger.DEBUG){console.timeEnd("end of createRtree");}},searchFeatures:function(s){if(e.isNull(this.rtree)||e.isNull(s)){return null;
}return this.rtree.search(s);},setQueryParameters:function(){if(arguments.length<=0){return;}this.queryParameter={paramnum:arguments.length};
for(var t=0;t<arguments.length;t++){if(e.isNull(arguments[t])){this.queryParameter["param"+(t+1)]=null;
continue;}var u=arguments[t];if(typeof u!=="object"){this.queryParameter["param"+(t+1)]=u;continue;}else{if(u instanceof e.geometry.Geometry){this.queryParameter["param"+(t+1)]=u.toString();
this.queryParameter["paramtype"+(t+1)]="geometry";continue;}}if(e.isNull(u.type)){var s=e.util.ValidationUtil;
if(typeof u.value==="object"){if(s.isNumberArray(u.value)){u.type="narray";}else{u.type="sarray";}}else{if(s.isNumber2(u.value)){u.type="number";
}else{u.type="string";}}}if(e.isNull(u.sqlType)){if(u.type==="sarray"){u.sqlType="MV_STRINGLIST";}else{if(u.type==="narray"){u.sqlType="MV_NUMBERLIST";
}}}if(u.type==="sarray"){this.queryParameter["param"+(t+1)]='"'+u.value.join('","')+'"';}else{if(u.type==="narray"){this.queryParameter["param"+(t+1)]=u.value.join(",");
}}this.queryParameter["sqltype"+(t+1)]=u.sqlType;this.queryParameter["paramtype"+(t+1)]=u.type;}},setMultiFeatureMarker:function(s){this.mfMarker=s;
},getFeatureStyles:function(u){var v=null;if(this.renderingStyle){v=this.renderingStyle;}else{if(u.styleName){v=e.style.StyleStore.getServerSideStyle(this.dataSource,u.styleName);
}else{if(u.oldStyle){v=u.oldStyle;}else{v=u.renderingStyle;}}}if(this.loadOnDemand){var s=this.selectedFeatures.length;
for(var t=0;t<s;t++){if(this.selectedFeatures[t].id==u.id){u.selected=true;this.selectedFeatures[t]=u;
}}}if(v&&v.stylelist&&v.stylelist.length>1){u.lineGroup=this.getLineGroup();}return v;},getDefaultRenderingStyle:function(s){switch(s){case"Point":case"MultiPoint":case"OrientedPoint":case"OrientedMultiPoint":return e.style.StyleStore.defaultMarkerStyle;
case"LineString":case"MultiLineString":return e.style.StyleStore.defaultLineStyle;case"Polygon":case"MultiPolygon":case"Rectangle":case"GeoemtryCollection":return e.style.StyleStore.defaultPolygonStyle;
}return null;},setMouseCursorStyle:function(s){if(typeof s==="object"){this.mouseCursor={definition:[{type:"image",src:s.src}],hotspotX:s.hotspotX,hotspotY:s.hotspotY};
}else{this.mouseCursor=s;}if(this.realGroup){this.realGroup.applyStyle({cursor:this.mouseCursor});}},isServerSideStyle:function(v,u){if(!(v instanceof e.style.Style)&&v.dataSource&&v.name){var t=this;
var s=v.url;if(e.isNull(s)){if(this.type===e.layer.VectorLayer.TYPE_JDBC||this.type===e.layer.VectorLayer.TYPE_PREDEFINED){s=this.serverURL;
}else{s=this.parentMap.mapviewerURL;}}t.loadingStyle++;e.style.StyleStore.getServerSideStyle(v.dataSource,v.name,{url:s,callback:function(w){t.loadingStyle--;
if(u==="rendering"){if(e.isNull(w)){t.renderingStyle=w;}else{t.setRenderingStyle(w,t.styleAttributes);
}}else{if(u==="hover"){t.setHoverStyle(w);}else{if(u==="select"){t.setSelectStyle(w);}else{if(u==="secondary"){t.otherStyles.push(w);
}else{if(u==="label"){t.setLabelingStyle(w);}}}}}}});return true;}return false;},getAttributeType:function(t){if(typeof t!=="string"){return null;
}var s=this.attributeTypes;var u=t.toUpperCase();if(s&&e.notNull(s[u])){return s[u];}else{return null;
}},hasSharedBoundary:function(){return this.sharedBoundary;},setSharedBoundary:function(s){this.sharedBoundary=s;
}});e.layer.VectorLayer.SINGLE_SELECTION=0;e.layer.VectorLayer.MULTIPLE_SELECTION=1;e.layer.VectorLayer.TYPE_PREDEFINED=0;
e.layer.VectorLayer.TYPE_JDBC=1;e.layer.VectorLayer.TYPE_DATAPACK=2;e.layer.VectorLayer.TYPE_LOCAL=3;
e.layer.VectorLayer.TYPE_GEORSS=4;e.layer.VectorLayer.TYPE_WFS=5;e.layer.VectorLayer.ERROR_COUNT=5;e.layer.MarkerLayer=e.layer.VectorLayer.extend({initialize:function b(s){var t={def:{type:e.layer.VectorLayer.TYPE_LOCAL}};
b.base.call(this,s,t);this.markerStyle=new e.style.Marker({width:50,height:50,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAG3klEQVRoQ+2XaWwUZRzG37n26LWUAi0toi1IImhiggqioiEhqYkJH5SEIyECMSAYTCiKHAot5xflC2CQ+EFEjgBRULlrLeEoJKACBakNaaDHUloshXZLa3d8nndmyrZAod3tasgOeTvnzjy///P83xkU8ZgsymPCIWIg/zcnY47EHOmhCsSi1UOF7fZtY450u3Q99MOYI/6bzSMVoWWHW2BTtO5P87mKwr1PtxwpqWjcXXOrafSvl81eQphtGhTczZS7vK0prH0Fa1Med86HHn89U63rk+g5MiQjblw4MF0GKa9t/vzQ6bIZeQUivqG00NLcyRIMEqTjRdi3D7XUVYg18yY0jB3+5IYBKa6c7sJ0GaSkMlD88ffXhx4vPNBWZefhJsoO2VKkaartNYXAKArOWdZJyGfTVPHl/PEXhqR7h0UN5PK1pqq pm6rSLp46bD3TSlFbhSWAs++Ix76qqnYIuQNcRM5E5FRFFxneRrFj5RR/Vqqnf1RBpn3rT7tw6pD1TOiSuulCEBC2x9Yxxsp2BiCOA5Zr1oUm1unegNi1fHL0QaZvrkorPglH7D5HXe9xQfaFqt0VDyAnbmh96ZBc4E4GQHbkTYg+CKNFR6RYRsSxoYMDKsUzUkEahX8QLbd0AuJ3ckaDIx5EK/cdgLijGy2nR6QTVl5k88oYaYrMPY9JoXRFJo5rjdw4bzllOWaKAeiR7YvH+TOjDSKjVZR/1wlqoig6IsVqQtGgnk7ogCIEz2nctvuI7xU7XhlxAbF9wZv/Dcj5ol+cXhcaBEoAiKQ4RcU+QUzbAd2Q0FbjwzHu0xruIW7p7gax7ZOx/sx+RvSjdeEkQDiN2pU2IZKRsqJkOaKohnSDYPKY3SPsG4XXYvpV4F66+5bYkjM6+iCM1vmTBTIqrLEJwW1iIUw1AMA+oXgZM+zLbSt6ElZOEtbsxWbfPOdFgOjRdUT2yCl8njAamtvKOsSzoRXdJYXLinNtO8N9XAiD6AbiJd2y3iMZntti08znogtSWhW48v626if+IAgqyxlINVzSAUUHFPJP0TxmCkO6QwdUuBcEKB1QNDiCbzD2FN/uWQmNYsPUQVcH9dUHWtNZ15cuf2uV+gNb1hXenLh1D16IsicIABBUXzM8gHPJZlawVhgxVJ4QcsZizOx+ke8TvlDRN28NaRWzRidvHZyqT+o6gvWLLoNU1jUPr6hpyJ+xrc5XVXoa1adoCDbcEIxtwKgciJyAK4rtitXsgJIuBuWrR8Of3nFCZD+tiKkjvLmpPm1p1ED4IMJU1gTyZ+6s91WW/AZHLPEOhIZ9xkwwaoBT4ZhB4UiUm5Oa/EA2RYpXFa8NNsS7L+i5ZqBxfVpaYnVUQdpgapsAc9tXVXYJIF6hQbjq9iJdcRCPmAFCh3oPetztUoROGGzrIEnG6VcGGWLi8+FDdCtao RWTztTeyZ/9wx2fv7xMaG7kBECMFd1xGbqIhxX8EIlDGxFExydML1w26ilDZGcFVu/e/t3Xc+fOvt6JE+ykVox/7DW37/631P5hl3uk4wMlzI2W/A/2mL5qf4VQ3PFwxit0lyHi3Ypwo6O9hircaCOCJCNxI7J0MVQr2bgqd+HOfft++rsTCHzkiBaMAMYtjNsYTTZQO5iwQSji0tWal+pb4g/N39eadLW2QTridasiAeI9cIQghmoiTooYmamLlBtHdy7/bNHBM2eKbj4AgiIJ0YzRiMHrajEI3WC7E1EQFoJfgolr1m18Y1T25G9WFAQTSmuDMlLxBtzQAaGbom+cKiHiyg/uXbls4ZHic+dY4dDFEUYAB4KiCVGDwfjdsB3h+XZLOI44EAm4Y1+M1PdmzRkxPWd13hdHgt6yOlMkoi84S/VLUMXLgPBc+fngquVLjv1Z3A6CAM5g/jnu2E7U2wDXbAhG7B4IEoUDws8sJF4kY/SzYXpPmjJt2Jwla+etPx70XqkLiv5Jmng1SxMJ5XtDIZzoOI3sNDP7gRAUTAg6QDfqHuSEY0skQJJwsxSM3jZUAmCe+XDp2nlfnTC9w9I10af6wP5Vyz49evH8WcbEqTpFcybimr1AADYyIdjUBOFgvHj+npnKgQjXERaBriBAgvHy2YNgibt+PDzlL++otzPrC/esWLqg4OzZ31lVinaqTnEUTfEOABvbOUYwgnYK4MCE40joPRwgvCEEQZLGjHlz4EeLl4zPW5Sz/8SJY5xtKCpUNAWHgjgOPZLwUDfCdaTjvbjvAHmxTSiu+T50ZiEHxKn2fV9u97vxw45FwpEHARGKUzMXpy/uO+M8TOSjnO8pkEd5dkSviYFEtJwRuFnMkQgUMaK3iDkS0XJG4GaPjSP/Al31T1GL6r+HAAAAAElFTkSuQmCC",yOffset:-12,xOffset:2,textStyle:{fontSize:15,fill:"#ffffff"},textOffset:{x:0,y:-15}});
},addMapMarker:function(s){if(e.isNull(s)){return;}if(e.isNull(s.renderingStyle)){s.renderingStyle=this.markerStyle;
}if(e.notNull(s.label)){s.setMarkerText(s.label);}this.addFeature(s);},removeMapMarker:function(s){this.removeFeature(s);
},addMapMarkers:function(t){if(e.isNull(t)){return;}var w;var v=[];var s=t.length;for(var u=0;u<s;u++){w=t[u];
if(e.isNull(w)){continue;}if(e.isNull(w.renderingStyle)){w.renderingStyle=this.markerStyle;}if(e.notNull(w.label)){w.setMarkerText(w.label);
}v.push(w);}this.addFeatures(v);}});e.layer.BuiltinExternalTileLayer=e.layer.TileLayer.extend({initialize:function b(t,v,s){b.base.call(this,t);
this.layerType=e.LayerTypes.EXTERNAL;var u=e.layer.BuiltinExternalTileLayer;if(!v||!u.tileLayerConfigs||!u.tileLayerConfigs[v]){}else{this.tileLayerConfig=u.tileLayerConfigs[v];
}if(s){this.customParameters=s;}},init:function(s){},pan:function(s,t){},setCenterAndZoomlevel:function(){var t=e.event;
var s=new t.MapEvent(t.LayerEvent.FINISH_LOAD,this);s.mapContext=this.parentMap.getMapContext();this.fire(t.LayerEvent.FINISH_LOAD,s);
this.setMapCenterAndZoomlevel();},setMapCenterAndZoomlevel:function(){},setMapType:function(s){},resize:function(){},setVisibleImpl:function(){if(this.container){var s=e.$(this.container);
s.css("visibility",this.visible?"visible":"hidden");s.css("display",this.visible?"":"none");}if(this.visible&&this.parentMap.displayed){this.init(this.container);
}},checkVisible:function(){if(!this.isVisible()){return false;}if(this.parentMap){var s=this.parentMap.getMapZoomLevel();
if(s>=this.tileLayerConfig.zoomLevels.length){return false;}if(s<this.minVisibleLevel||s>this.maxVisibleLevel){return false;
}}return true;},setContainer:function(){var s=e.$("<div id ='tilelayer_"+this.name+"'></div>");s.css({position:"absolute",left:"0px","z-index":this.getZIndex()-1,top:"0px",width:"100%",height:"100%",overflow:"hidden"});
this.parentMap.$tileLayersDiv.append(s);var t=e.$("<div id ='transparent_tilelayer_"+this.name+"'></div>");
t.css({position:"absolute",left:"0px","z-index":this.getZIndex(),top:"0px",width:"100%",height:"100%",background:"white",opacity:"0",overflow:"hidden"});
s.append(t);this.container=s[0];},getLayerConfig:function(){var u=new e.event.LayerEvent(e.event.LayerEvent.FINISH_GOT_CONFIG,this);
u.config=this.getEnabledConfig(this.tileLayerConfig);if(this.parentMap){u.mapContext=this.parentMap.getMapContext();
}this.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,u);var t=e.event;var s=new t.MapEvent(t.LayerEvent.FINISH_LOAD,this);
s.mapContext=this.parentMap.getMapContext();this.fire(t.LayerEvent.FINISH_LOAD,s);},destroy:function(){if(this.mapTypeControl){this.mapTypeControl.destroy();
}if(this.container){e.$(this.container).empty().remove();}},refresh:function d(u,s){if(e.isNull(s)){s=true;
}d.base.call(this,u,s);this.reloadNumber=Math.round(Math.random()*10000000000);if(this.parentMap&&this.map){this.setCenterAndZoomlevel();
}if(s){var t=new e.event.LayerEvent(e.event.LayerEvent.AFTER_REFRESH,this);if(this.parentMap){t.mapContext=this.parentMap.getMapContext();
}this.fire(e.event.LayerEvent.AFTER_REFRESH,t);}},exportToSVG:function(B,A,x){var u=0,C=0;if(this.maxWidth&&A>this.maxWidth){u=(A-this.maxWidth)/2;
A=this.maxWidth;}else{if(this.minWidth&&A<this.minWidth){u=(this.minWidth-A)/2;A=this.minWidth;}}if(this.maxHeight&&x>this.maxHeight){C=(x-this.maxHeight)/2;
x=this.maxHeight;}else{if(this.minHeight&&x<this.minHeight){C=(this.minHeight-x)/2;x=this.minHeight;}}var y=this;
y.loadImg=0;var s=this.getStaticMapURL(A,x);var z=this.parentMap.graphics;y.loadImg++;var v=z.drawImage({x:u,y:C},{src:s,width:A,height:x},{group:B});
v.handleEvent=function(t){this.resourceUpdate(t);y.loadImg--;};return B;},drawTilesImages:function(u,z){var s=0,y=0;
if(this.maxWidth&&u>this.maxWidth){s=(u-this.maxWidth)/2;u=this.maxWidth;}else{if(this.minWidth&&u<this.minWidth){s=(this.minWidth-u)/2;
u=this.minWidth;}}if(this.maxHeight&&z>this.maxHeight){y=(z-this.maxHeight)/2;z=this.maxHeight;}else{if(this.minHeight&&z<this.minHeight){y=(this.minHeight-z)/2;
z=this.minHeight;}}var x=this;x.loadImg=0;var A=this.getStaticMapURL(u,z);x.loadingImg=true;var v=new Image();
v.onload=function(){x.loadingImg=false;var t=x.canvas.getContext("2d");t.drawImage(v,s,y);};v.onerror=function(){x.loadingImg=false;
x.canvas=null;};v.src=A;},clone:function(s){var t={};e.$.extend(t,this);if(s){t.name=s;}else{t.name=t.name+"_clone";
}t.deleteAllListeners();t.map=null;return t;}});e.layer.BuiltinExternalTileLayer.register=function(t,s){var u=e.layer.BuiltinExternalTileLayer;
if(typeof u.tileLayerConfigs==="undefined"){u.tileLayerConfigs=[];}u.tileLayerConfigs[t]=s;};e.layer.BingTileLayer=e.layer.BuiltinExternalTileLayer.extend({initialize:function b(u,t){b.base.call(this,u);
this.key=t&&t.key?t.key:"your_bing_api_key";this.libURL=null;this.over=arguments.length>2?arguments[2]:false;
var s=e.layer.BingTileLayer;if(!this.over&&typeof Microsoft!=="undefined"){h.OM_finishLoadBingJsV7();
}if(!this.over&&!s.LOADEDJS&&!s.LOADING){s.LOADING=true;if(t&&t.libURL){this.libURL=t.libURL;e.$.getScript(this.libURL+"&onscriptload=OM_finishLoadBingJsV7");
}else{e.$.getScript(e.gv.secureHttp()+"//ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0&onscriptload=OM_finishLoadBingJsV7");
}}this.mapType=(t&&t.mapType)?t.mapType:s.TYPE_ROAD;this.map_type_values=(t&&t.mapTypeList)?t.mapTypeList:null;
this.tileLayerConfig=e.layer.TileLayerConfig.CONFIG_GOOGLE;this.mapTypeVisible=(t&&e.notNull(t.mapTypeVisible))?t.mapTypeVisible:true;
this.maxWidth=900;this.maxHeight=834;this.minWidth=80;this.minHeight=80;},init:function(){if(!this.container){return;
}var t=this;var u=function(x){if(!t.parentMap){return;}var v=t.parentMap.getMapContext();var w=function(F){var y;
if(e.notNull(F)){y=new Microsoft.Maps.Location(F.getY(),F.getX());}else{y=new Microsoft.Maps.Location(v.getCenterPoint().getY(),v.getCenterPoint().getX());
}t.checkMapType();try{t.map=new Microsoft.Maps.Map(x,{credentials:t.key,center:y,mapTypeId:e.layer.BingTileLayer.TYPES[t.mapType],zoom:t.getRealZoomLevel(v.getZoomLevel())+1,animate:false,labelOverlay:Microsoft.Maps.LabelOverlay.hidden,showDashboard:false,showCopyright:false,showScalebar:false,disableKeyboardInput:true});
if(t.map_type_values&&!t.over){var B=t.map_type_values.split(";");var A={road:null,satellite:null,mercator:null};
for(var D=0;D<B.length;D++){if(B[D]==="OM.layer.BingTileLayer.TYPE_ROAD"){A.road=e.layer.BingTileLayer.TYPE_ROAD;
}else{if(B[D]==="OM.layer.BingTileLayer.TYPE_AERIAL"){A.satellite=e.layer.BingTileLayer.TYPE_AERIAL;}}}var E=null;
for(var G in A){if(A[G]===t.mapType){E=G;}}t.mapTypeControl=new e.control.MapTypeControl(t.parentMap,t,{enableTypes:A,type:E});
if(t.mapTypeControl.infoDecoration){t.mapTypeControl.infoDecoration.setVisible(t.mapTypeVisible);}}}catch(C){}var z=function(){var J=e.event;
var I=new J.MapEvent(J.LayerEvent.FINISH_LOAD,t);I.mapContext=v;t.fire(J.LayerEvent.FINISH_LOAD,I);};
Microsoft.Maps.Events.addHandler(t.map,"viewchangeend",z);};v.getCenterPoint().transform(8307,function(y){w(y);
});};var s=function(){if(e.layer.BingTileLayer.LOADEDJS){u(t.container);}else{setTimeout(s,500);}};s();
},pan:function(t,u){if(this.map){var s=this.map.getOptions();s.center=this.map.getCenter();s.animate=false;
s.centerOffset=new Microsoft.Maps.Point(t,u);this.map.setView(s);}},setCenterAndZoomlevel:function(){if(this.map){var s=this.parentMap.getMapContext();
var v=this.getRealZoomLevel(s.getZoomLevel());var u=this;var t=function(x){var w=u.map.getOptions();w.zoom=v+1;
w.center=new Microsoft.Maps.Location(x.getY(),x.getX());u.map.setView(w);};s.getCenterPoint().transform(8307,function(w){t(w);
});}},setMapType:function(t){this.mapType=t;var s=null;if(this.map){this.checkMapType();s=e.layer.BingTileLayer.TYPES[this.mapType];
this.map.setMapType(s);if(this.cloneLayer){this.cloneLayer.setMapType(this.mapType);}}},resize:function(){if(this.map){var s=this.parentMap.getMapContext();
this.map.setOptions({height:s.getDeviceWidth(),width:s.getDeviceHeight()});}},getMapType:function(){return this.mapType;
},checkMapType:function(){var s=e.layer.BingTileLayer.TYPES[this.mapType];if(!s){this.mapType=e.layer.BingTileLayer.TYPE_ROAD;
}},getStaticMapURL:function(y,u){var A="http://dev.virtualearth.net/REST/V1/Imagery/Map/";var x=this.map.getCenter();
var s=x.latitude+","+x.longitude;var t;var v=e.layer.BingTileLayer;switch(this.mapType){case v.TYPE_AERIAL:t="Aerial";
break;case v.TYPE_MERCATOR:t="AerialWithLabels";break;default:t="Road";}var B=this.map.getZoom();var C="mapSize="+y+","+u;
var z="key="+this.key;A=A+t+"/"+s+"/"+B+"?"+C+"&"+z;return A;},clone:function(s){if(!s){s=this.name+"_clone";
}this.cloneLayer=new e.layer.BingTileLayer(s,{key:this.key,libURL:this.libURL,mapType:this.mapType},true);
return this.cloneLayer;}});e.layer.BingTileLayer.TYPE_ROAD="road";e.layer.BingTileLayer.TYPE_AERIAL="aerial";
e.layer.BingTileLayer.TYPE_AUTO="auto";e.layer.BingTileLayer.TYPE_MERCATOR="mercator";e.layer.BingTileLayer.TYPES=[];
e.layer.BingTileLayer.LOADEDJS=false;e.layer.BingTileLayer.LOADING=false;h.OM_finishLoadBingJsV7=h.OM_finishLoadBingJsV7||function(){e.layer.BingTileLayer.LOADEDJS=true;
e.layer.BingTileLayer.TYPES[e.layer.BingTileLayer.TYPE_ROAD]=Microsoft.Maps.MapTypeId.road;e.layer.BingTileLayer.TYPES[e.layer.BingTileLayer.TYPE_AERIAL]=Microsoft.Maps.MapTypeId.aerial;
e.layer.BingTileLayer.TYPES[e.layer.BingTileLayer.TYPE_AUTO]=Microsoft.Maps.MapTypeId.auto;e.layer.BingTileLayer.TYPES[e.layer.BingTileLayer.TYPE_MERCATOR]=Microsoft.Maps.MapTypeId.mercator;
};e.layer.ElocationTileLayer=e.layer.TileLayer.extend({initialize:function b(s){b.base.call(this,s,{dataSource:"ELOCATION_MERCATOR",tileLayer:"world_map",tileServerURL:e.gv.secureHttp()+"//elocation.oracle.com/mapviewer/mcserver",tileLayerConfig:e.layer.TileLayerConfig.CONFIG_ELOCATION});
},getStaticMapURL:function(v,s){var u="http://elocation.oracle.com/mapviewer/omserver?";var x='xml_request=<?xml version="1.0" standalone="yes"?><map_request ';
var z='width="'+v+'" height="'+s+'" antialiase="false" datasource="ELOCATION_MERCATOR" basemap="world_map" format="PNG_STREAM">';
var y=new e.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMinX(),this.parentMap.getMapWindowBoundingBox().getMinY(),3857);
var t=new e.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMaxX(),this.parentMap.getMapWindowBoundingBox().getMaxY(),3857);
var w='<box srsName="EPSG:3857"><coordinates>'+y.getX()+","+y.getY()+","+t.getX()+","+t.getY()+"</coordinates></box></map_request>";
u=u+x+z+w;return u;}});e.layer.NokiaTileLayer=e.layer.BuiltinExternalTileLayer.extend({initialize:function b(t,s){b.base.call(this,t);
this.libURL=null;var u=e.layer.NokiaTileLayer;this.over=arguments.length>2?arguments[2]:false;if(!this.over&&(typeof nokia==="undefined")&&!u.LOADING){if(s&&s.libURL){this.libURL=s.libURL;
}else{this.libURL=e.gv.secureHttp()+"//js.api.here.com/se/2.5.3/jsl.js?blank=true";}var v=document.createElement("script");
v.type="text/javascript";v.src=this.libURL;document.getElementsByTagName("head")[0].appendChild(v);v.onload=m;
u.LOADING=true;}else{if(!u.LOADING){u.LOADED=true;}}this.key=(s&&s.key)?s.key:null;this.appID=(s&&s.appID)?s.appID:null;
if(!this.appID&&s&&s.appId){this.appID=s.appId;}if(!this.appID&&s&&s.appid){this.appID=s.appid;}if(!this.appID&&s&&s.app_id){this.appID=s.app_id;
}this.defaultLanguage=(s&&s.defaultLanguage)?s.defaultLanguage:null;this.mapType=(s&&s.mapType)?s.mapType:u.TYPE_NORMAL;
this.map_type_values=(s&&s.mapTypeList)?s.mapTypeList:null;this.mapTypeVisible=(s&&e.notNull(s.mapTypeVisible))?s.mapTypeVisible:true;
this.tileLayerConfig=e.layer.TileLayerConfig.CONFIG_GOOGLE;this.maxWidth=2048;this.maxHeight=2048;},init:function(){var v=null;
var t=this;var s=function(){if(!t.parentMap){return;}var x=t.parentMap.getMapContext();var w=x.getCenterPoint();
var y=function(G){var D=w.getX();var C=w.getY();if(G){D=G.getX();C=G.getY();}v=t.getRealZoomLevel(x.getZoomLevel())+1;
t.checkMapType();if(t.map){return;}nokia.Settings.set("appId",t.appID);nokia.Settings.set("authenticationToken",t.key);
if(e.gv.secureHttp()=="https:"){nokia.Settings.set("secureConnection","force");}if(t.defaultLanguage){nokia.Settings.set("defaultLanguage",t.defaultLanguage);
}t.map=new nokia.maps.map.Display(t.container,{zoomLevel:v,center:[C,D]});t.map.set("baseMapType",t.map[t.mapType]);
if(t.map_type_values&&!t.over){var B=t.map_type_values.split(";");var A={road:null,satellite:null,shaded:null};
for(var E=0;E<B.length;E++){if(B[E]=="OM.layer.NokiaTileLayer.TYPE_NORMAL"){A.road=e.layer.NokiaTileLayer.TYPE_NORMAL;
}else{if(B[E]=="OM.layer.NokiaTileLayer.TYPE_SATELLITE"){A.satellite=e.layer.NokiaTileLayer.TYPE_SATELLITE;
}else{if(B[E]=="OM.layer.NokiaTileLayer.TYPE_TERRAIN"){A.shaded=e.layer.NokiaTileLayer.TYPE_TERRAIN;}}}}var F=null;
for(var I in A){if(A[I]==t.mapType){F=I;}}t.mapTypeControl=new e.control.MapTypeControl(t.parentMap,t,{enableTypes:A,type:F});
if(t.mapTypeControl.infoDecoration){t.mapTypeControl.infoDecoration.setVisible(t.mapTypeVisible);}}var J=e.event;
var z=new J.MapEvent(J.LayerEvent.FINISH_LOAD,t);z.mapContext=t.parentMap.getMapContext();t.fire(J.LayerEvent.FINISH_LOAD,z);
};w.transform(8307,function(z){y(z);});};var u=h.setInterval(function(){if(!e.layer.NokiaTileLayer.LOADING&&e.layer.NokiaTileLayer.LOADED){s();
clearInterval(u);}},500);},setCenterAndZoomlevel:function(){var t=this.parentMap.getMapContext();var v=this.getRealZoomLevel(t.getZoomLevel());
var s=this;var u=function(w){if(s.map){s.map.setAttributes(f,new nokia.maps.geo.Coordinate(w.getY(),w.getX()),v+1,f,f);
var y=e.event;var x=new y.MapEvent(y.LayerEvent.FINISH_LOAD,s);x.mapContext=s.parentMap.getMapContext();
s.fire(y.LayerEvent.FINISH_LOAD,x);}};t.getCenterPoint().transform(8307,function(w){u(w);});},setMapType:function(s){this.mapType=s;
if(this.map){this.checkMapType();this.map.set("baseMapType",this.map[this.mapType]);if(this.cloneLayer){this.cloneLayer.setMapType(this.mapType);
}}},getMapType:function(){return this.mapType;},checkMapType:function(){var s=e.layer.NokiaTileLayer;
var t=s.TYPES[this.mapType];if(!t){this.mapType=s.TYPE_ROAD;}},pan:function(s,t){if(this.map){this.map.pan(0,0,-s,-t);
}},clone:function(s){if(!s){s=this.name+"_clone";}this.cloneLayer=new e.layer.NokiaTileLayer(s,{libURL:this.libURL,mapType:this.mapType,key:this.key,appID:this.appID},true);
return this.cloneLayer;},getStaticMapURL:function(t,y){var x="http://m.nok.it/";var v=this.map.center;
var s=v.latitude+","+v.longitude;var u="&t=0";var w=e.layer.NokiaTileLayer;if(this.mapType==w.TYPE_TERRAIN){u="&t=2";
}else{if(this.mapType==w.TYPE_SATELLITE){u="&t=1";}}var z=this.map.zoomLevel;var A="&w="+t+"&h="+y;x=x+"?app_id="+this.appID+"&token="+this.key+"&c="+s+"&z="+z+u+A+"&nord ";
return x;}});var m=function(){nokia.Features.load(nokia.Features.getFeaturesFromMatrix(["all"]),c,g,null,false);
};var c=function(){e.layer.NokiaTileLayer.LOADING=false;e.layer.NokiaTileLayer.LOADED=true;};var g=function(){};
e.layer.NokiaTileLayer.TYPE_NORMAL="NORMAL";e.layer.NokiaTileLayer.TYPE_TERRAIN="TERRAIN";e.layer.NokiaTileLayer.TYPE_SATELLITE="SATELLITE";
e.layer.NokiaTileLayer.LOADING=false;e.layer.NokiaTileLayer.LOADED=false;e.layer.NokiaTileLayer.TYPES=[];
e.layer.NokiaTileLayer.TYPES[e.layer.NokiaTileLayer.TYPE_NORMAL]="NORMAL";e.layer.NokiaTileLayer.TYPES[e.layer.NokiaTileLayer.TYPE_TERRAIN]="TERRAIN";
e.layer.NokiaTileLayer.TYPES[e.layer.NokiaTileLayer.TYPE_SATELLITE]="SATELLITE";e.layer.HereTileLayer=e.layer.BuiltinExternalTileLayer.extend({initialize:function b(u,t){b.base.call(this,u);
var s=e.layer.HereTileLayer;this.over=arguments.length>2?arguments[2]:false;if(t&&t.libURL){this.libURL=t.libURL;
if(this.libURL.indexOf("/",this.libURL.length-1)===-1){this.libURL=this.libURL+"/";}}else{this.libURL="http://js.api.here.com/v3/3.0/";
}var v=this;if(!this.over&&typeof H==="undefined"&&!s.LOADING){e.util.Logger.finest("","OM.layer.HereTileLayer.initialize","Loading HERE API ...");
e.layer.HereTileLayer.LOADING=true;e.$.getScript(v.libURL+"mapsjs-core.js",function(){e.$.when(e.$.getScript(v.libURL+"mapsjs-service.js"),e.$.getScript(v.libURL+"mapsjs-mapevents.js"),e.$.Deferred(function(w){e.$(w.resolve);
})).done(function(){s.LOADING=false;s.LOADED=true;e.util.Logger.finest("","OM.layer.HereTileLayer.initialize","HERE API just loaded.");
});});}else{if(!s.LOADING){s.LOADED=true;e.util.Logger.finest("","OM.layer.HereTileLayer.initialize","HERE API already loaded.");
}}this.appCode=(t&&t.appCode)?t.appCode:null;this.appID=(t&&t.appID)?t.appID:null;if(!this.appID&&t&&t.appId){this.appID=t.appId;
}if(!this.appID&&t&&t.appid){this.appID=t.appid;}if(!this.appID&&t&&t.app_id){this.appID=t.app_id;}if(t&&t.useHTTPS){this.useHTTPS=t.useHTTPS;
}else{this.useHTTPS=false;}if(t&&t.useCIT){this.useCIT=t.useCIT;}else{this.useCIT=false;}if(t&&t.mapType){this.mapType=t.mapType;
}else{this.mapType="NORMAL_MAP";}this.map_type_values=(t&&t.mapTypeList)?t.mapTypeList:null;this.mapTypeVisible=(t&&e.notNull(t.mapTypeVisible))?t.mapTypeVisible:true;
this.tileLayerConfig=e.layer.TileLayerConfig.CONFIG_GOOGLE;this.maxWidth=2048;this.maxHeight=2048;},init:function(){var v=null;
var s=this;var t=function(){if(!s.parentMap){e.util.Logger.finest("","OM.layer.HereTileLayer.init_Here","A HereTileLayer instance already created.");
return;}var y=s.parentMap.getMapContext();var x=y.getCenterPoint();var w=function(I){var D=x.getX();var C=x.getY();
if(I){D=I.getX();C=I.getY();}v=s.getRealZoomLevel(y.getZoomLevel())+1;s.checkMapType();if(s.map){return;
}try{s.platform=new H.service.Platform({app_id:s.appID,app_code:s.appCode,useHTTPS:s.useHTTPS,useCIT:s.useCIT});
}catch(G){e.util.Logger.warning("MAPVIEWER_9077","OM.layer.HereTileLayer.showHereMap",G.message);return;
}e.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.service.Platform instance created.");
try{s.mapLayers=s.platform.createDefaultLayers();s.map=new H.Map(s.container,s.mapLayers.normal.map,{zoom:v,center:{lng:D,lat:C}});
s.setBaseLayer(s.map,s.mapLayers,s.mapType);}catch(G){e.util.Logger.warning("MAPVIEWER_9078","OM.layer.HereTileLayer.showHereMap",G.message);
return;}e.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.Map instance created.");try{s.events=new H.mapevents.MapEvents(s.map);
s.behavior=new H.mapevents.Behavior(s.events);}catch(G){e.util.Logger.warning("MAPVIEWER_9079","OM.layer.HereTileLayer.showHereMap",G.message);
return;}e.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.mapevents.MapEvents and H.mapevents.Behavior instances created.");
s.parentMap.addListener(e.event.MapEvent.MAP_RESIZED,function(){s.map.getViewPort().resize();});if(s.map_type_values&&!s.over){var B=s.map_type_values.split(";");
var A={road:null,satellite:null,terrain:null};for(var E=0;E<B.length;E++){if(B[E]=="OM.layer.HereTileLayer.TYPE_NORMAL_MAP"){A.road="road";
}else{if(B[E]=="OM.layer.HereTileLayer.TYPE_SATELLITE_MAP"){A.satellite="satellite";}else{if(B[E]=="OM.layer.HereTileLayer.TYPE_TERRAIN_MAP"){A.terrain="terrain";
}}}}var F=null;if(e.layer.HereTileLayer.TYPE_NORMAL_MAP===s.mapType){F="road";}else{if(e.layer.HereTileLayer.TYPE_SATELLITE_MAP===s.mapType){F="satellite";
}else{if(e.layer.HereTileLayer.TYPE_TERRAIN_MAP===s.mapType){F="terrain";}}}s.mapTypeControl=new e.control.MapTypeControl(s.parentMap,s,{enableTypes:A,type:F});
if(s.mapTypeControl.infoDecoration){s.mapTypeControl.infoDecoration.setVisible(s.mapTypeVisible);}}var J=e.event;
var z=new J.MapEvent(J.LayerEvent.FINISH_LOAD,s);z.mapContext=s.parentMap.getMapContext();s.fire(J.LayerEvent.FINISH_LOAD,z);
};x.transform(8307,function(z){w(z);});};var u=h.setInterval(function(){if(!e.layer.HereTileLayer.LOADING&&e.layer.HereTileLayer.LOADED){t();
clearInterval(u);}},500);},setCenterAndZoomlevel:function(){var t=this.parentMap.getMapContext();var v=this.getRealZoomLevel(t.getZoomLevel());
var s=this;var u=function(w){if(s.map){s.map.setCenter({lng:w.getX(),lat:w.getY()});s.map.setZoom(v+1);
var y=e.event;var x=new y.MapEvent(y.LayerEvent.FINISH_LOAD,s);x.mapContext=s.parentMap.getMapContext();
s.fire(y.LayerEvent.FINISH_LOAD,x);}};t.getCenterPoint().transform(8307,function(w){u(w);});},setMapType:function(s){if(s==="road"){s="NORMAL_MAP";
}else{if(s==="satellite"){s="SATELLITE_MAP";}else{if(s==="terrain"){s="TERRAIN_MAP";}}}this.mapType=s;
if(this.map){this.checkMapType();this.setBaseLayer(this.map,this.mapLayers,this.mapType);if(this.cloneLayer){this.cloneLayer.setMapType(this.mapType);
}}},getMapType:function(){return this.mapType;},checkMapType:function(){var s=e.layer.HereTileLayer;var t=s.TYPES[this.mapType];
if(e.isNull(t)){this.mapType=s.TYPE_NORMAL_MAP;}},clone:function(s){if(!s){s=this.name+"_clone";}this.cloneLayer=new e.layer.HereTileLayer(s,{libURL:this.libURL,mapType:this.mapType,key:this.appCode,appID:this.appID},true);
return this.cloneLayer;},getStaticMapURL:function(t,y){var x="http://image.maps.api.here.com/mia/1.6/mapview";
var w=this.map.getCenter();var s=w.lat+","+w.lng;var u="&t=0";var v=e.layer.HereTileLayer;if(this.mapType==v.TYPE_TERRAIN_MAP){u="&t=2";
}else{if(this.mapType==v.TYPE_SATELLITE_MAP){u="&t=1";}}var z=this.map.getZoom();var A="&w="+t+"&h="+y;
x=x+"?app_id="+this.appID+"&app_code="+this.appCode+"&c="+s+"&z="+z+u+A+"&nodot ";return x;},setBaseLayer:function(u,s,t){if(e.isNull(u)||e.isNull(s)){e.util.Logger.warning("MAPVIEWER_9074","OM.layer.HereTileLayer.setBaseLayer");
return;}if(e.isNull(t)){t="NORMAL_MAP";}if(t.toUpperCase()==="NORMAL_MAP"){u.setBaseLayer(s.normal.map);
}else{if(t.toUpperCase()==="SATELLITE_MAP"){u.setBaseLayer(s.satellite.map);}else{if(t.toUpperCase()==="TERRAIN_MAP"){u.setBaseLayer(s.terrain.map);
}else{if(t.toUpperCase()==="NORMAL_TRAFFIC"){u.setBaseLayer(s.normal.traffic);}else{if(t.toUpperCase()==="SATELLITE_TRAFFIC"){u.setBaseLayer(s.satellite.traffic);
}else{if(t.toUpperCase()==="TERRAIN_TRAFFIC"){u.setBaseLayer(s.terrain.traffic);}else{if(t.toUpperCase()==="NORMAL_PANORAMA"){u.setBaseLayer(s.normal.panorama);
}else{if(t.toUpperCase()==="SATELLITE_PANORAMA"){u.setBaseLayer(s.satellite.panorama);}else{if(t.toUpperCase()==="TERRAIN_PANORAMA"){u.setBaseLayer(s.terrain.panorama);
}else{if(t.toUpperCase()==="NORMAL_TRANSIT"){u.setBaseLayer(s.normal.transit);}else{if(t.toUpperCase()==="NORMAL_XBASE"){u.setBaseLayer(s.normal.xbase);
}else{if(t.toUpperCase()==="SATELLITE_XBASE"){u.setBaseLayer(s.satellite.xbase);}else{if(t.toUpperCase()==="TERRAIN_XBASE"){u.setBaseLayer(s.terrain.xbase);
}else{if(t.toUpperCase()==="NORMAL_BASE"){u.setBaseLayer(s.normal.base);}else{if(t.toUpperCase()==="SATELLITE_BASE"){u.setBaseLayer(s.satellite.base);
}else{if(t.toUpperCase()==="TERRAIN_BASE"){u.setBaseLayer(s.terrain.base);}else{if(t.toUpperCase()==="NORMAL_LABELS"){u.setBaseLayer(s.normal.labels);
}else{if(t.toUpperCase()==="SATELLITE_LABELS"){u.setBaseLayer(s.satellite.labels);}else{if(t.toUpperCase()==="TERRAIN_LABELS"){u.setBaseLayer(s.terrain.labels);
}else{u.setBaseLayer(s.normal.map);}}}}}}}}}}}}}}}}}}}},pan:function(){var u=this.parentMap.getMapContext();
var t=this;var s=function(v){if(t.map){t.map.setCenter({lng:v.getX(),lat:v.getY()});var x=e.event;var w=new x.MapEvent(x.LayerEvent.FINISH_LOAD,t);
w.mapContext=t.parentMap.getMapContext();t.fire(x.LayerEvent.FINISH_LOAD,w);}};u.getCenterPoint().transform(8307,function(v){s(v);
});}});e.layer.HereTileLayer.TYPE_NORMAL_MAP="NORMAL_MAP";e.layer.HereTileLayer.TYPE_SATELLITE_MAP="SATELLITE_MAP";
e.layer.HereTileLayer.TYPE_TERRAIN_MAP="TERRAIN_MAP";e.layer.HereTileLayer.TYPE_NORMAL_TRAFFIC="NORMAL_TRAFFIC";
e.layer.HereTileLayer.TYPE_SATELLITE_TRAFFIC="SATELLITE_TRAFFIC";e.layer.HereTileLayer.TYPE_TERRAIN_TRAFFIC="TERRAIN_TRAFFIC";
e.layer.HereTileLayer.TYPE_NORMAL_PANORAMA="NORMAL_PANORAMA";e.layer.HereTileLayer.TYPE_SATELLITE_PANORAMA="SATELLITE_PANORAMA";
e.layer.HereTileLayer.TYPE_TERRAIN_PANORAMA="TERRAIN_PANORAMA";e.layer.HereTileLayer.TYPE_NORMAL_TRANSIT="NORMAL_TRANSIT";
e.layer.HereTileLayer.TYPE_NORMAL_XBASE="NORMAL_XBASE";e.layer.HereTileLayer.TYPE_SATELLITE_XBASE="SATELLITE_XBASE";
e.layer.HereTileLayer.TYPE_TERRAIN_XBASE="TERRAIN_XBASE";e.layer.HereTileLayer.TYPE_NORMAL_BASE="NORMAL_BASE";
e.layer.HereTileLayer.TYPE_SATELLITE_BASE="SATELLITE_BASE";e.layer.HereTileLayer.TYPE_TERRAIN_BASE="TERRAIN_BASE";
e.layer.HereTileLayer.TYPE_NORMAL_LABELS="NORMAL_LABELS";e.layer.HereTileLayer.TYPE_SATELLITE_LABELS="SATELLITE_LABELS";
e.layer.HereTileLayer.TYPE_TERRAIN_LABELS="TERRAIN_LABELS";e.layer.HereTileLayer.LOADING=false;e.layer.HereTileLayer.LOADED=false;
e.layer.HereTileLayer.TYPES=[];e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_NORMAL_MAP]="NORMAL_MAP";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_TERRAIN_MAP]="TERRAIN_MAP";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_SATELLITE_MAP]="SATELLITE_MAP";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_NORMAL_TRAFFIC]="NORMAL_TRAFFIC";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_TERRAIN_TRAFFIC]="TERRAIN_TRAFFIC";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_SATELLITE_TRAFFIC]="SATELLITE_TRAFFIC";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_NORMAL_PANORAMA]="NORMAL_PANORAMA";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_TERRAIN_PANORAMA]="TERRAIN_PANORAMA";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_SATELLITE_PANORAMA]="SATELLITE_PANORAMA";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_NORMAL_TRANSIT]="NORMAL_TRANSIT";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_NORMAL_XBASE]="NORMAL_XBASE";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_TERRAIN_XBASE]="TERRAIN_XBASE";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_SATELLITE_XBASE]="SATELLITE_XBASE";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_NORMAL_BASE]="NORMAL_BASE";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_TERRAIN_BASE]="TERRAIN_BASE";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_SATELLITE_BASE]="SATELLITE_BASE";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_NORMAL_LABELS]="NORMAL_LABELS";
e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_TERRAIN_LABELS]="TERRAIN_LABELS";e.layer.HereTileLayer.TYPES[e.layer.HereTileLayer.TYPE_SATELLITE_LABELS]="SATELLITE_LABELS";
e.layer.GoogleTileLayer=e.layer.BuiltinExternalTileLayer.extend({initialize:function b(t,s){b.base.call(this,t);
this.libURL=null;this.tileSource="google";var u=e.layer.GoogleTileLayer;this.over=arguments.length>2?arguments[2]:false;
this.map_type_values=(s&&s.mapTypeList)?s.mapTypeList:null;this.mapTypeVisible=(s&&e.notNull(s.mapTypeVisible))?s.mapTypeVisible:true;
this.tilt=(s&&s.tilt)?s.tilt:0;if(s&&s.key){this.key=s.key;}if(s&&s.clientID){this.clientID=s.clientID;
}var v="";if(!this.clientID&&this.key){v+="&key="+this.key;}else{if(this.clientID){v+="&client="+this.clientID;
}}if(!this.over&&typeof google!=="undefined"){e.finishLoadGoogleV3();}else{if(!this.over&&!u.LOADING){if(s&&s.libURL){this.libURL=s.libURL+"&callback=OM.finishLoadGoogleV3"+v;
}else{this.libURL=e.gv.secureHttp()+"//maps.google.com/maps/api/js?v=3&sensor=false&callback=OM.finishLoadGoogleV3"+v;
}e.$.getScript(this.libURL);u.LOADING=true;}}this.tileLayerConfig=e.layer.TileLayerConfig.CONFIG_GOOGLE;
this.mapType=(s&&s.mapType)?s.mapType:e.layer.GoogleTileLayer.TYPE_ROAD;this.maxWidth=640;this.maxHeight=640;
},init:function(){var y=null;var u=null;var s=this;var t=e.layer.GoogleTileLayer;var x=this.container;
var w=function(){if(!s.parentMap){return;}var A=s.parentMap.getMapContext();var z=A.getCenterPoint();
var B=function(L){var F=z.getX();var E=z.getY();if(L){F=L.getX();E=L.getY();}if(F!==null&&E!==null){y=new google.maps.LatLng(E,F);
}var K=A.getZoomLevel();if(K!==null){u=s.getRealZoomLevel(K)+1;}s.checkMapType();var N={zoom:u,center:y,mapTypeId:t.TYPES[s.mapType],tilt:s.tilt,navigationControl:false,panControl:false,zoomControl:false,mapTypeControl:false,streetViewControl:false,draggable:false,keyboardShortcuts:false,scrollwheel:false};
s.map=new google.maps.Map(x,N);if(s.map_type_values&&!s.over){var D=s.map_type_values.split(";");var C={road:null,satellite:null,shaded:null,hybrid:null};
for(var G=0;G<D.length;G++){if(D[G]=="OM.layer.GoogleTileLayer.TYPE_ROAD"){C.road=t.TYPE_ROAD;}else{if(D[G]=="OM.layer.GoogleTileLayer.TYPE_SATELLITE"){C.satellite=t.TYPE_SATELLITE;
}else{if(D[G]=="OM.layer.GoogleTileLayer.TYPE_SHADED"){C.shaded=t.TYPE_SHADED;}else{if(D[G]=="OM.layer.GoogleTileLayer.TYPE_HYBRID"){C.hybrid=t.TYPE_HYBRID;
}}}}}var I=null;for(var M in C){if(C[M]==s.mapType){I=M;}}s.mapTypeControl=new e.control.MapTypeControl(s.parentMap,s,{enableTypes:C,type:I});
if(s.mapTypeControl.infoDecoration){s.mapTypeControl.infoDecoration.setVisible(s.mapTypeVisible);}}var J=function(){var P=e.event;
var O=new P.MapEvent(P.LayerEvent.FINISH_LOAD,s);O.mapContext=A;s.fire(P.LayerEvent.FINISH_LOAD,O);};
google.maps.event.addListener(s.map,"tilesloaded",J);};z.transform(8307,function(C){B(C);});};var v=h.setInterval(function(){if(!t.LOADING&&e.layer.GoogleTileLayer.LOADED){clearInterval(v);
w();}},500);},setCenterAndZoomlevel:function(){if(this.map){var t=this.parentMap.getMapContext();var v=this.getRealZoomLevel(t.getZoomLevel());
var s=this;var u=function(w){s.map.setOptions({zoom:v+1,center:new google.maps.LatLng(w.getY(),w.getX())});
};t.getCenterPoint().transform(8307,function(w){u(w);});}},setMapType:function(s){this.mapType=s;if(this.map){this.checkMapType();
this.map.setMapTypeId(e.layer.GoogleTileLayer.TYPES[this.mapType]);if(this.cloneLayer){this.cloneLayer.setMapType(this.mapType);
}this.parentMap.setMapZoomLevel(this.map.getZoom()-1);}},resize:function(){if(this.map){google.maps.event.trigger(this.map,"resize");
}},getMapType:function(){return this.mapType;},checkMapType:function(){var t=e.layer.GoogleTileLayer;
var s=t.TYPES[this.mapType];if(!s){this.mapType=t.TYPE_ROAD;}},pan:function(s,t){if(this.map){this.map.panBy(-s,-t);
}},clone:function(s){if(!s){s=this.name+"_clone";}this.cloneLayer=new e.layer.GoogleTileLayer(s,{libURL:this.libURL,mapType:this.mapType},true);
return this.cloneLayer;},getStaticMapURL:function(t,C){var y="http://maps.google.com/maps/api/staticmap?";
var z=this.map.getCenter();var s="center="+z.lat()+","+z.lng();var D="zoom="+(this.map.getZoom());var E="size="+t+"x"+C;
var w;switch(this.mapType){case e.layer.GoogleTileLayer.TYPE_SATELLITE:w="satellite";break;case e.layer.GoogleTileLayer.TYPE_HYBRID:w="hybrid";
break;case e.layer.GoogleTileLayer.TYPE_SHADED:w="terrain";break;default:w="roadmap";}w="maptype="+w;
var v="sensor=false";var B="";var x="&";if(e.isNull(this.clientID)&&this.key){B=x+"key="+this.key;}else{if(this.clientID){B=x+"client="+this.clientID;
var A="/maps/api/staticmap?"+s+x+D+x+E+x+w+x+v+B;var u=e.util.MiscUtil.signURL(this.key,A);if(e.notNull(u)){B=B+x+"signature="+u;
}}}y=y+s+x+D+x+E+x+w+x+v+B;return y;}});e.finishLoadGoogleV3=e.finishLoadGoogleV3||function(){var s=e.layer.GoogleTileLayer;
e.layer.GoogleTileLayer.LOADED=true;e.layer.GoogleTileLayer.LOADING=false;if(s.TYPES===null){s.TYPES=[];
s.TYPES[s.TYPE_ROAD]=google.maps.MapTypeId.ROADMAP;s.TYPES[s.TYPE_SATELLITE]=google.maps.MapTypeId.SATELLITE;
s.TYPES[s.TYPE_HYBRID]=google.maps.MapTypeId.HYBRID;s.TYPES[s.TYPE_SHADED]=google.maps.MapTypeId.TERRAIN;
}};e.layer.GoogleTileLayer.TYPE_ROAD="road";e.layer.GoogleTileLayer.TYPE_SATELLITE="satellite";e.layer.GoogleTileLayer.TYPE_HYBRID="hybrid";
e.layer.GoogleTileLayer.TYPE_SHADED="shaded";e.layer.GoogleTileLayer.LOADING=false;e.layer.GoogleTileLayer.LOADED=false;
e.layer.GoogleTileLayer.TYPES=null;e.layer.Cluster=e.Class.extend({initialize:function(s,u,t){this.clusterX=s;
this.clusterY=u;this.numberOfPoints=1;this.featureArray=[t];this.updateFlag=true;this.mbr=null;},addFeature:function(s,u,t){this.clusterX=(this.clusterX*this.numberOfPoints+s)/(this.numberOfPoints+1);
this.clusterY=(this.clusterY*this.numberOfPoints+u)/(this.numberOfPoints+1);this.numberOfPoints++;this.featureArray.push(t);
this.updateFlag=true;this.mbr=null;},addCluster:function(s){this.clusterX=(this.clusterX*this.numberOfPoints+s.clusterX*s.numberOfPoints)/(this.numberOfPoints+s.numberOfPoints);
this.clusterY=(this.clusterY*this.numberOfPoints+s.clusterY*s.numberOfPoints)/(this.numberOfPoints+s.numberOfPoints);
this.numberOfPoints+=s.numberOfPoints;this.featureArray=this.featureArray.concat(s.featureArray);},getMBR:function(){if(e.notNull(this.mbr)){return this.mbr;
}var y;var A;var v=Number.MAX_VALUE;var t=-Number.MAX_VALUE;var u=Number.MAX_VALUE;var s=-Number.MAX_VALUE;
var x=this.featureArray.length;for(var w=0;w<x;w++){y=this.featureArray[w].getGeometry().getMBR();if(e.isNull(A)){A=y.getSRID();
}if(y.getMinX()<v){v=y.getMinX();}if(y.getMaxX()>t){t=y.getMaxX();}if(y.getMinY()<u){u=y.getMinY();}if(y.getMaxY()>s){s=y.getMaxY();
}}var z=new e.geometry.Rectangle(v,u,t,s,A);this.mbr=z;return z;},getMBP:function(){var u=null,s=null;
var t=[];this.iterateCoordinates(function(w){t.push(w);if(u===null||w.x<u.x){u=w;}if(s===null||w.x>s.x){s=w;
}});var v=[].concat(this.buildConvexHull([u,s],t),this.buildConvexHull([s,u],t));return v;},getDistant:function(u,v){var s=v[1].x-v[0].x,t=v[0].y-v[1].y;
return(t*(u.x-v[0].x)+s*(u.y-v[0].y));},findMostDistantPointFromBaseLine:function(t,v){var x=0,s=null;
var w=[];for(var u=v.length-1;u>=0;u--){var y=v[u];var z=this.getDistant(y,t);if(z>0){w.push(y);}else{continue;
}if(z>x){x=z;s=y;}}return{maxPoint:s,newPoints:w};},buildConvexHull:function(s,v){var w=[];var u=this.findMostDistantPointFromBaseLine(s,v);
if(u.maxPoint){w=w.concat(this.buildConvexHull([s[0],u.maxPoint],u.newPoints));w=w.concat(this.buildConvexHull([u.maxPoint,s[1]],u.newPoints));
return w;}else{return[s[0]];}},iterateCoordinates:function(z){var s=this.featureArray.length;for(var w=0;
w<s;w++){var v=this.featureArray[w];var u=v.getGeometry();var x=u.coordinates;if(u.type==="Polygon"){x=x[0];
}var y=u.dim;for(var t=0;t<x.length;t+=y){z({x:x[t],y:x[t+1]});}}},removeFeature:function(s,v,u){for(var t=0;
t<this.featureArray.length;t++){if(this.featureArray[t]==u){if(this.numberOfPoints>1){this.clusterX=(this.clusterX*this.numberOfPoints-s)/(this.numberOfPoints-1);
this.clusterY=(this.clusterY*this.numberOfPoints-v)/(this.numberOfPoints-1);}this.numberOfPoints--;this.featureArray.splice(t,1);
this.updateFlag=true;return true;}}return false;},createClusterFeature:function(x,t,w){var s=new e.geometry.Point(this.clusterX,this.clusterY,t);
this.clusterFeatureId=x;var v=new e.Feature(x,s,{renderingStyle:w});v.cluster=this;var u=function(A){var z=A.target;
var y=z.parentLayer;var C=y.parentMap;var B=z.cluster.getMBR();if(y.clickZoomInLevels===-1){C.zoomToExtent(B);
}else{if(y.clickZoomInLevels>0){C.setMapCenterAndZoomLevel(B.getCenter(),C.getMapZoomLevel()+y.clickZoomInLevels);
}}};v.addListener(e.event.MouseEvent.MOUSE_CLICK,u);this.updateFlag=false;return v;}});e.layer.VectorLayerCluster=e.Class.extend({initialize:function(t,s){this.vectorLayer=t;
this.threshold=s&&s.threshold?s.threshold:30;this.clusterStyle=s&&s.clusterStyle?s.clusterStyle:null;
this.clusterSelectStyle=e.notNull(s.clusterSelectStyle)?s.clusterSelectStyle:null;this.clusterHoverStyle=e.notNull(s.clusterHoverStyle)?s.clusterHoverStyle:null;
this.minPointCount=s&&s.minPointCount?s.minPointCount:2;},initCluster:function(v,t){this.gridSizeInX=this.threshold*v;
this.gridSizeInY=this.threshold*t;this.clusters={};var s=this.vectorLayer.parentMap.getMapContext();var w=s.getUniverse().getMapBounds();
var u=this.vectorLayer.visibleBound;this.minX=u?Math.max(u.getMinX(),w.getMinX()):w.getMinX();this.maxX=u?Math.min(u.getMaxX(),w.getMaxX()):w.getMaxX();
this.minY=u?Math.max(u.getMinY(),w.getMinY()):w.getMinY();this.maxY=u?Math.min(u.getMaxY(),w.getMaxY()):w.getMaxY();
this.numInX=Math.ceil((this.maxX-this.minX)/this.gridSizeInX);this.numInY=Math.ceil((this.maxY-this.minY)/this.gridSizeInY);
this.clusterFeatureArray=[];this.initialized=true;},addFeatureToCluster:function(t){var w=t.getGeometry().getMBR();
var s=(w.getMinX()+w.getMaxX())/2;var z=(w.getMinY()+w.getMaxY())/2;var v=Math.floor((s-this.minX)/this.gridSizeInX);
var u=Math.floor((z-this.minY)/this.gridSizeInY);if(!this.clusters[v]){this.clusters[v]={};}if(!this.clusters[v][u]){this.clusters[v][u]=new e.layer.Cluster(s,z,t);
}else{this.clusters[v][u].addFeature(s,z,t);}return{x:v,y:u};},displayAsCluster:function(v){e.util.Logger.finest(null,"VectorLayerCluster","["+this.vectorLayer.name+"] displayAsCluster called.");
var w=this.vectorLayer.parentMap.getMapContext();var B=w.getUniverse();var t=w.getZoomLevel();if(this.vectorLayer.maxClusteringLevel<t){return;
}if(!this.initialized){var F=B.getZoomLevels()[t];this.initCluster(F.resolution,F.resolution*F.stretchRatio);
}var y=w.getWholeMapNum();if(y>1){var s=B.getMapBounds();v={x:s.getMinX(),y:s.getMinY(),w:s.getWidth(),h:s.getHeight()};
}this.startX=Math.floor((v.x-this.minX)/this.gridSizeInX);this.endX=Math.ceil((v.x+v.w-this.minX)/this.gridSizeInX);
this.startY=Math.floor((v.y-this.minY)/this.gridSizeInY);this.endY=Math.ceil((v.y+v.h-this.minY)/this.gridSizeInY);
var D=this.vectorLayer.featureArray;var A=D?D.length:0;var u=B.getSRID();var C=this;var z=0;this.totolPointNumber=0;
var G=function(J){return function(){var K=J.getGeometry();K.transform(u,function(L){J.srid=u;J.geo=L;
C.addFeatureToCluster(J);z--;});}();};for(var x=0;x<A;x++){var I=D[x];I.inCluster=false;if((I.geo.type==="Point"||I.geo.type==="Polygon")&&!I.displayed){this.totolPointNumber++;
if(I.geo.srid!==u){z++;G(I);}else{this.addFeatureToCluster(I);}}}var E=function(){if(z===0){var J=C.mergeAllClusters(v);
while(J){J=C.mergeAllClusters(v);}C.showAllClusters();}else{h.setTimeout(E,100);}};E();},showAllClusters:function(){var s=this.vectorLayer.parentMap.getMapContext().getUniverse().getSRID();
for(var u=this.startX;u<this.endX;u++){for(var t=this.startY;t<this.endY;t++){if(e.notNull(this.clusters[u])&&e.notNull(this.clusters[u][t])&&this.clusters[u][t].numberOfPoints>=this.minPointCount){var w="-CL"+u+"-"+t;
var v=this.getClusterFeatureById(w);if(!v){v=this.clusters[u][t].createClusterFeature(w,s,this.clusterStyle);
this.displayClusterFeature(v);}else{this.updateMarkerText(v);}}}}},displayClusterFeature:function(w){this.clusterFeatureArray.push(w);
w.group=this.vectorLayer.realGroup;w.screenTransformObj=this.vectorLayer.parentMap.getMapContext().getTransform();
w.graphics=this.vectorLayer.parentMap.graphics;w.parentLayer=this.vectorLayer;w.markerText=w.cluster.numberOfPoints;
var u=w.renderingStyle;if(u instanceof e.style.BucketStyle){u.generateBuckets([this.minPointCount,this.totolPointNumber],"_NUMBERINCLUSTER",true);
u=u.getRealStyle(w.cluster.numberOfPoints);w.renderingStyle=u;}if(e.isNull(u)){u=w.renderingStyle;}else{w.renderingStyle=u;
}w.displayFeature([u]);if(w.shape){w.shape.applyStyle({tooltip:w.cluster.numberOfPoints+""});}var v=w.cluster.featureArray.length;
for(var s=0;s<v;s++){var t=w.cluster.featureArray[s];t.displayed=true;t.inCluster=true;t.clusterId=w.id;
}},mergeAllClusters:function(){var u=false;for(var t=this.startX;t<this.endX;t++){for(var v=this.startY;
v<this.endY;v++){if(e.notNull(this.clusters[t])&&e.notNull(this.clusters[t][v])){var s=this.mergeCluster(t,v);
if(e.notNull(s)){u=true;}}}}return u;},mergeCluster:function(C,B){var z=this.gridSizeInX*this.gridSizeInY;
var t=z;var v=z;var A=z;var s=z;var F=z;var u=z;var w=z;var E=z;if(C+1<this.numInX&&e.notNull(this.clusters[C+1])&&e.notNull(this.clusters[C+1][B])){t=this.getSquareDistance(this.clusters[C][B],this.clusters[C+1][B]);
}if(B+1<this.numInY&&e.notNull(this.clusters[C][B+1])){v=this.getSquareDistance(this.clusters[C][B],this.clusters[C][B+1]);
}if(C-1>=0&&e.notNull(this.clusters[C-1])&&e.notNull(this.clusters[C-1][B])){A=this.getSquareDistance(this.clusters[C][B],this.clusters[C-1][B]);
}if(B-1>=0&&e.notNull(this.clusters[C][B-1])){s=this.getSquareDistance(this.clusters[C][B],this.clusters[C][B-1]);
}if(C+1<this.numInX&&B+1<this.numInY&&e.notNull(this.clusters[C+1])&&e.notNull(this.clusters[C+1][B+1])){F=this.getSquareDistance(this.clusters[C][B],this.clusters[C+1][B+1]);
}if(C-1>=0&&B+1<this.numInY&&e.notNull(this.clusters[C-1])&&e.notNull(this.clusters[C-1][B+1])){u=this.getSquareDistance(this.clusters[C][B],this.clusters[C-1][B+1]);
}if(C+1<this.numInX&&B-1>=0&&e.notNull(this.clusters[C+1])&&e.notNull(this.clusters[C+1][B-1])){w=this.getSquareDistance(this.clusters[C][B],this.clusters[C+1][B-1]);
}if(C-1>=0&&B-1>=0&&e.notNull(this.clusters[C-1])&&e.notNull(this.clusters[C-1][B-1])){E=this.getSquareDistance(this.clusters[C][B],this.clusters[C-1][B-1]);
}var D=Math.min(t,Math.min(v,Math.min(A,Math.min(s,Math.min(F,Math.min(u,Math.min(w,E)))))));if(D<z){if(t===D){this.mergeHorizontal(C,B,1);
return{directionX:1,directionY:0};}else{if(v===D){this.mergeVertical(C,B,1);return{directionX:0,directionY:1};
}else{if(A===D){this.mergeHorizontal(C,B,-1);return{directionX:-1,directionY:0};}else{if(s===D){this.mergeVertical(C,B,-1);
return{directionX:0,directionY:-1};}else{if(F===D){this.mergeDiagonal(C,B,1,1);return{directionX:1,directionY:1};
}else{if(u===D){this.mergeDiagonal(C,B,-1,1);return{directionX:-1,directionY:1};}else{if(w===D){this.mergeDiagonal(C,B,1,-1);
return{directionX:1,directionY:-1};}else{this.mergeDiagonal(C,B,-1,-1);return{directionX:-1,directionY:-1};
}}}}}}}return null;}},getSquareDistance:function(t,s){return(t.clusterX-s.clusterX)*(t.clusterX-s.clusterX)+(t.clusterY-s.clusterY)*(t.clusterY-s.clusterY);
},mergeHorizontal:function(s,v,u){this.clusters[s][v].addCluster(this.clusters[s+1*u][v]);var t=Math.floor((this.clusters[s][v].clusterX-this.minX)/this.gridSizeInX);
if(t==s){this.removeAllFeatureInCluster(this.clusters[s+1*u][v]);this.clusters[s+1*u][v]=null;}else{if(t==(s+u)){this.removeAllFeatureInCluster(this.clusters[s+1*u][v]);
this.clusters[s+1*u][v]=this.clusters[s][v];this.removeAllFeatureInCluster(this.clusters[s][v]);this.clusters[s][v]=null;
}}},mergeVertical:function(s,v,u){this.clusters[s][v].addCluster(this.clusters[s][v+1*u]);var t=Math.floor((this.clusters[s][v].clusterY-this.minY)/this.gridSizeInY);
if(t==v){this.removeAllFeatureInCluster(this.clusters[s][v+1*u]);this.clusters[s][v+1*u]=null;}else{if(t==(v+u)){this.removeAllFeatureInCluster(this.clusters[s][v+1*u]);
this.clusters[s][v+1*u]=this.clusters[s][v];this.removeAllFeatureInCluster(this.clusters[s][v]);this.clusters[s][v]=null;
}}},mergeDiagonal:function(s,z,u,t){this.clusters[s][z].addCluster(this.clusters[s+1*u][z+t]);var w=Math.floor((this.clusters[s][z].clusterX-this.minX)/this.gridSizeInX);
var v=Math.floor((this.clusters[s][z].clusterY-this.minY)/this.gridSizeInY);if(w==s&&v==z){this.removeAllFeatureInCluster(this.clusters[s+u][z+t]);
this.clusters[s+1*u][z+1*t]=null;}else{if(w==(s+u)&&v==(z+t)){this.removeAllFeatureInCluster(this.clusters[s+u][z+t]);
this.clusters[s+1*u][z+1*t]=this.clusters[s][z];this.removeAllFeatureInCluster(this.clusters[s][z]);this.clusters[s][z]=null;
}else{if(e.isNull(this.clusters[w][v])){this.clusters[w][v]=this.clusters[s][z];}else{this.clusters[w][v].addCluster(this.clusters[s][z]);
}this.removeAllFeatureInCluster(this.clusters[s][z]);this.clusters[s][z]=null;this.removeAllFeatureInCluster(this.clusters[s+u][z+t]);
this.clusters[s+u][z+t]=null;}}},removeAllFeatureInCluster:function(u){var y=u.clusterFeatureId;if(e.isNull(y)){for(var t=0;
t<u.featureArray.length;t++){var w=u.featureArray[t];if(w.parentLayer){w.parentLayer.clearFeature(w);
}}return;}var x=this.getClusterFeatureById(y);if(x){x.parentLayer.clearFeature(x);}u.clusterFeatureId=null;
var s=this.clusterFeatureArray?this.clusterFeatureArray.length:0;for(var v=0;v<s;v++){if(this.clusterFeatureArray[v]==x){this.clusterFeatureArray.splice(v,1);
break;}}},redrawCluster:function(u,t,A){if(e.isNull(u)){return;}var v=this.vectorLayer.parentMap.getMapContext().getUniverse().getSRID();
if(u.numberOfPoints>=this.minPointCount){var z="-CL"+t+"-"+A;var w=this.getClusterFeatureById(z);if(!w){this.removeAllFeatureInCluster(u);
w=u.createClusterFeature(z,v,this.clusterStyle);this.displayClusterFeature(w);return true;}else{var s=new e.geometry.Point(u.clusterX,u.clusterY,v);
w.setGeometry(s);this.updateMarkerText(w);return true;}}return false;},getClusterFeatureById:function(t){for(var s=0;
s<this.clusterFeatureArray.length;s++){if(this.clusterFeatureArray[s].id==t){return this.clusterFeatureArray[s];
}}return null;},clearAllClusterFeatures:function(){var s=this.clusterFeatureArray?this.clusterFeatureArray.length:0;
for(var u=s-1;u>0;u--){var t=this.clusterFeatureArray[u];t.group=null;t.screenTransformObj=null;t.graphics=null;
t.displayed=false;t.inCluster=false;t.parentLayer=null;this.clusterFeatureArray.pop();}this.clusterFeatureArray=null;
this.initialized=false;},updateMarkerText:function(t){if(t.shape.childrenCount>1){var s=t.shape.lastChild;
s.applyStyle({textValue:t.cluster.numberOfPoints});}},addFeature:function(v){var w=this.addFeatureToCluster(v);
var z=this.mergeCluster(w.x,w.y);var u=this.clusters[w.x][w.y];var t=false;if(e.isNull(z)){t=this.redrawCluster(u,w.x,w.y);
}else{var s=w.x+z.directionX;var A=w.y+z.directionY;if(e.notNull(u)){t=this.redrawCluster(u,w.x,w.y);
}else{if(e.notNull(this.clusters[s][A])){t=this.redrawCluster(this.clusters[s][A],s,A);}}}if(t){v.displayed=true;
}},addClusterFeatureToLabelGrid:function(){var t=this.clusterFeatureArray?this.clusterFeatureArray.length:0;
for(var v=0;v<t;v++){var B=this.clusterFeatureArray[v];if(B.displayed&&B.screenPoints){var s=B.screenPoints.x;
var C=B.screenPoints.y;var u=B.renderingStyle.width;var z=B.renderingStyle.height;var A=[s-u/2,C-z/2,s+u/2,C+z/2];
this.vectorLayer.parentMap.grid.insert(A);}}},showClusterInWrapAround:function(){var t=this.vectorLayer.parentMap.getMapContext();
var v=t.getWholeMapNum();var s=this.clusterFeatureArray?this.clusterFeatureArray.length:0;for(var u=1;
u<v;u++){for(var w=0;w<s;w++){var x=this.clusterFeatureArray[w];x.group=this.vectorLayer.featureGroupArr[u];
x.displayFeature([x.renderingStyle]);if(x.shape){x.shape.applyStyle({tooltip:x.cluster.numberOfPoints+""});
}}}}});e.layer.InteractiveTileLayer=e.layer.TileLayer.extend({initialize:function b(u,t){b.base.call(this,u,t);
if(!t||!t.themes){return;}this.themes=[];var s=t.themes.length;for(var v=0;v<s;v++){this.themes.push({name:t.themes[v],identify:false});
}this.tileLayerConfig=t.tileLayerConfig;this.origServerURL=t.tileServerURL;this.registerIds=new Array(s);
this.registered=false;},init:function b(){if(!this.registered){this.registerThemes();}else{b.base.call(this);
}},registerThemes:function(){var t=this.getTileServerURL();var w=this.parentMap.getMapContext();var A=w.getUniverse();
var u=A.getMapBounds();var B=A.getSRID()+";"+u.getMinX()+";"+u.getMinY()+";"+u.getMaxX()+";"+u.getMaxY();
var y=A.getZoomLevels();var E="";var C=y.length;var x;for(x=0;x<C;x++){E+=1/y[x].resolution+";";}C=this.themes.length;
var z=this;var v={request:"rt",cs:B,zl:E};var D=function(F){return function(){e.util.HttpRequest.send(t,v,function(P){var J=e.$.trim(P);
var L=e.$(J);var O=L.filter("mcs_error")[0];if(e.notNull(O)){var G=O.innerHTML;G=G.trim();var Q=G.split(":");
if(Q.length>2){var K=Q[2];e.util.Logger.alert("MAPVIEWER_9002","OM.layer.InteractiveTileLayer.registerThemes",K);
}z.registerIds[F]="";}else{z.registerIds[F]=J;}var N=z.registerIds.length;for(var M=0;M<N;M++){if(e.isNull(z.registerIds[M])){return;
}}z.registered=true;z.mapSource=z.registerIds.join(";");N=z.registerIds.length;for(M=0;M<N;M++){if(z.registerIds[M]!==""){z.init(z);
z.combineClickableIds();return;}}z.initError=true;var R=e.event;var I=new R.LayerEvent(R.LayerEvent.INIT_ERROR,z);
I.mapContext=z.parentMap.getMapContext();z.fire(R.LayerEvent.INIT_ERROR,I);return;});}();};for(x=0;x<C;
x++){var s=this.themes[x].name;v.theme=s;D(x);}},enableFeatureIdentification:function(v,t){var s=this.themes.length;
for(var u=0;u<s;u++){var w=this.themes[u];if(w.name==v){w.identify=t;}}if(this.displayed){this.combineClickableIds();
}},combineClickableIds:function(){var u="";var s=this.themes.length;for(var t=0;t<s;t++){if(this.themes[t].identify){u=u+this.registerIds[t]+";";
}}s=u.length;if(s>=1){this.clickIds=u.substring(0,s-1);}else{this.clickIds=0;}},identifyFeatures:function(w){if(!this.clickIds){return;
}var t=this.getFOIServerURL();var v=this.parentMap.getMapContext();var z=v.getUniverse();var y=this.parentMap.getMapWindowBoundingBox();
var s=z.getZoomLevels()[v.getZoomLevel()];var x={request:"idtf",tids:this.clickIds,x:w.getX(),y:w.getY(),ratx:1/s.resolution,raty:s.stretchRatio/s.resolution,bbox:y.getMinX()+":"+y.getMinY()+":"+y.getMaxX()+":"+y.getMaxY()};
var u=this;e.util.HttpRequest.send(t,x,function(D){var B=null;try{B=e.$.parseJSON(D);if(B.foiarray.length<1||!B.attrnames){return;
}var I=B.attrnames.length;var M=B.foiarray[0];var F="";for(var E=0;E<I;E++){var K=B.attrnames[E];var G=M.attrs[E];
var C="#bbbbbb";if(E%2===0){C="#dddddd";}F+="<tr bgcolor='"+C+"'><td align='right'>"+K+"</td><td align='left'>"+G+"</td></tr>";
}F="<table>"+F+"</table>";var A={};if(e.notNull(M.name)){var L=(M.name+"").replace(/ /g,"&nbsp;");A.title=L;
}A.id=M.name+"_"+M.id;u.parentMap.displayInfoWindow(w,F,A);}catch(J){e.util.Logger.alert("MAPVIEWER_9009","OM.layer.InteractiveTileLayer.identifyFeatures",D);
}},"text");},getLayerConfig:function(){var s=new e.event.LayerEvent(e.event.LayerEvent.FINISH_GOT_CONFIG,this);
if(this.tileLayerConfig){s.config=this.tileLayerConfig;}if(this.parentMap){s.mapContext=this.parentMap.getMapContext();
}this.fire(e.event.LayerEvent.FINISH_GOT_CONFIG,s);},setLayerConfig:function(t){var s={};s.tileImageWidth=256;
s.tileImageHeight=256;s.tileImageFormat="PNG";s.isTransparentImage=true;s.srid=t.getSRID();s.zoomLevels=t.getZoomLevels();
s.bounds=t.getMapBounds();this.tileLayerConfig=new e.layer.TileLayerConfig(s);},getFOIServerURL:function(){if(!this.FOIServerURL){if(this.origServerURL){this.FOIServerURL=this.FOIServerURL+"/foi";
}else{this.FOIServerURL=this.parentMap.mapviewerURL+"/foi";}}return this.FOIServerURL;}});e.layer.EditableFeature=e.Feature.extend({initialize:function b(v,u,s){if(e.notNull(u)){b.base.call(this,v,u,s);
}this.edit=false;this.editable=true;this.dragging=false;this.modified=false;this.editing=false;this.contextMenu=null;
this.dragging_flag=false;this.point_dragging=false;this.refresh_dragging=false;this.mbrMaxX=null;this.mbrMinX=null;
this.init();this.pointToSnap=null;var t=this;this.setParentThat=function(w){t=w;};this.endEditing=function(w){if(w&&w.evt&&(w.evt.relatedTarget||t.dragging)){return;
}var x;if(w&&w.target){x=w.target.parentFeature;}if(!x&&w&&w.focusFeature){x=w.focusFeature.parentFeature;
}if(!x&&w){x=w.focusFeature;}if(!x){x=t;}x.parentLayer.parentMap.deleteListener(e.event.MapEvent.I_MAP_CENTER_ZOOM,this.calDistance,this);
x.editable=false;x.editing=false;var y=x.geo;if(y.type==="Point"||y.type==="MultiPoint"){x.deleteEditingProperties();
x.setRenderingStyle(x.normalStyle);return;}else{if(y.type==="OrientedPoint"){x.deleteEditingProperties();
x.displayFeature([x.renderingStyle]);return;}else{if(y.type==="Polygon"||y.type==="LineString"||y.type==="MultiPolygon"||y.type==="MultiLineString"){x.deleteEditingProperties();
}}}if(x.parentLayer.parentMap.wraparound){x.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh();
}};this.shapePointMoving=function(w){if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}t.dragging=true;t.point_dragging=true;t.featurePointMoving(w,true);};this.possiblePointMoving=function(w){if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}t.dragging=true;t.point_dragging=true;t.featurePointMoving(w,false);};this.resizePointMoving=function(w){if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}this.parentFeature.addResizeHandles(w);};this.showContextMenu=function(E){if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}var A=E.target.parentLayer.parentMap;var J=E.evt.clientX;var I=E.evt.clientY;var z=E.target;var B=new e.layer.Menu(A,{left:J,top:I});
var w=function(){if(z){t.deleteShapePoint(z);if(z.parentFeature){var x=new e.event.LayerEvent(e.event.LayerEvent.FEATURE_EDITED,z.parentFeature);
z.parentFeature.fire(e.event.LayerEvent.FEATURE_EDITED,x);z.parentFeature.addResizeHandles.apply(z.parentFeature);
}}};var D=function(){if(z){var y=B;var M=y.location.left;var x=y.location.top;var R=z.parentLayer.parentMap.getScreenPointLocation(M,x);
var O=z.parentLayer.parentMap.getScreenPointLocation(M-5,x-5);var T=R.coordinates[0]-O.coordinates[0];
var S=O.coordinates[1]-R.coordinates[1];var N=Math.sqrt((T*T)+(S*S));var K=e.util.GeomUtil.findGeometryElement(z.getGeometry(),R.coordinates[0],R.coordinates[1],N);
if(K!==-1){var L=z.getGeometry().clone(true);L=e.util.GeomUtil.removeGeometryElement(L,K);if(e.notNull(L)){if(e.notNull(z.parentLayer.changeManager)){var P=e.edit.EditChangeEvent;
var Q=z.parentLayer.changeManager.updateFeature(z.id,z,L,P.SPATIAL_UPDATE);if(e.notNull(Q)){z.parentLayer.getUndoManager().addEdit({feature:z,changeManager:z.parentLayer.changeManager,editChangeEvent:Q,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"remove feature element";},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.fire(e.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.addEditProperties();
},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.fire(e.event.LayerEvent.FEATURE_EDITED);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}}z.setGeometry(L);z.fire(e.event.LayerEvent.FEATURE_EDITED);
z.deleteEditingProperties();z.addEditProperties(true);}}}};var C=function(){if(z){var Y=z.parentLayer;
if(e.isNull(Y)){return;}var x=B;var P=x.location.left;var V=x.location.top;var S=z.parentLayer.parentMap.getScreenPointLocation(P,V);
var L=z.parentLayer.parentMap.getScreenPointLocation(P-5,V-5);var O=S.coordinates[0]-L.coordinates[0];
var N=L.coordinates[1]-S.coordinates[1];var K=Math.sqrt((O*O)+(N*N));var aa=e.util.GeomUtil.findGeometryElement(z.getGeometry(),S.coordinates[0],S.coordinates[1],K);
if(aa===-1){e.util.Logger.alert("MAPVIEWER_9061","OM.EditableFeature.showContextMenu","");return;}var Z=z.getGeometry().clone(true);
Z=e.util.GeomUtil.removeGeometryElement(Z,aa);if(e.isNull(Z)){e.util.Logger.alert("MAPVIEWER_9062","OM.EditableFeature.showContextMenu","");
return;}var y=e.util.GeomUtil.cloneGeometryElement(z.getGeometry(),aa);if(e.isNull(y)){e.util.Logger.alert("MAPVIEWER_9063","OM.EditableFeature.showContextMenu","");
return;}var ac="<tr><td><table>";var U=[];var X=[];var T=e.layer.VectorLayer;var M="";var R=""+Math.floor((Math.random()*1000)+1);
if(Y.type===T.TYPE_PREDEFINED||Y.type===T.TYPE_JDBC){if(e.notNull(Y.keyColumn)){U.push(Y.keyColumn);}else{return;
}}else{U.push("ID");}if(e.notNull(Y.notNullAttributes)){for(var W=0;W<Y.notNullAttributes.length;W++){if(Y.notNullAttributes[W]!==Y.keyColumn){U.push(Y.notNullAttributes[W].toUpperCase());
}}}for(var ab=0;ab<U.length;ab++){var Q=document.getElementById("_wb_attr"+ab+A.instanceId);if(e.notNull(Q)){Q.outerHTML="";
}if(ab!==0){X.push(M);}else{X.push(R);}ac+="<tr><td>"+U[ab]+" : </td><td><input type='text' style='width:340px'  id='_wb_attr"+ab+A.instanceId+"' value="+X[ab]+"></td></tr>";
}ac+="</table></td></tr>";A.$featdialog=e.$('<div id="_wb_dialog'+A.mapInstanceId+'" title="'+e.gv.getLabel("MAPVIEWER_WB_PROPERTIES")+'" style="overflow:visible"><table width=100% cellSpacing=0 borderSpacing=0 style=\'font-size:13px\'>'+ac+"</table></div>");
A.$featdialog.dialog({position:{of:A.$oracleMapDiv,at:"center"},resizable:false,width:e.browser.touchSupported||e.gv.isWin8Touch?450:510,height:e.browser.touchSupported||e.gv.isWin8Touch?300:360,buttons:[{closeOnEscape:true,text:e.gv.getLabel("MAPVIEWER_WB_OK"),click:function(){for(var ae=0;
ae<U.length;ae++){var aj=document.getElementById("_wb_attr"+ae+A.instanceId).value;if(e.isNull(aj)||aj.length===0){alert(e.gv.getLabel("MAPVIEWER_9060")+" ["+U[ae]+"]");
return;}var ah=Y.getAttributeType(U[ae]);if(e.notNull(ah)&&ah!=="string"){var ad=isNaN(aj);if(ad===true){alert(e.gv.getLabel("MAPVIEWER_9059")+" ["+U[ae]+"]");
return;}}}var al=document.getElementById("_wb_attr0"+A.instanceId).value;var ag={};var ar=false;var ao=z.getAttributes();
var an=null;var ap=null;var am=null;if(Y.type===T.TYPE_PREDEFINED||Y.type===T.TYPE_JDBC){for(an in ao){ap=an.toUpperCase();
am=z.getAttributeValue(ap);for(var aq=0;aq<U.length;aq++){if(U[aq]===ap){am=document.getElementById("_wb_attr"+aq+A.instanceId).value;
break;}}ag[ap]=am;ar=true;}}else{for(an in ao){ap=an.toUpperCase();ag[ap]=z.getAttributeValue(ap);ar=true;
}}var af=new e.Feature(al,y);if(ar){af.attributes=ag;}if(e.notNull(z.parentLayer.changeManager)){var ai=e.edit.EditChangeEvent;
z.parentLayer.getUndoManager().startChangeBlock("detach feature element");var ak=z.parentLayer.changeManager.updateFeature(z.id,z,Z,ai.SPATIAL_UPDATE);
if(e.notNull(ak)){z.parentLayer.getUndoManager().addEdit({feature:z,changeManager:z.parentLayer.changeManager,editChangeEvent:ak,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"update feature element";},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.fire(e.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.addEditProperties();
},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.fire(e.event.LayerEvent.FEATURE_EDITED);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}ak=z.parentLayer.changeManager.addFeature(af.id,af);
if(e.notNull(ak)){z.parentLayer.getUndoManager().addEdit({changeManager:z.parentLayer.changeManager,editChangeEvent:ak,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"feature added";},undo:function(){this.changeManager.undo(this.editChangeEvent);
},redo:function(){this.changeManager.redo(this.editChangeEvent);}});}z.parentLayer.getUndoManager().endChangeBlock("detach feature element");
}else{z.parentLayer.addFeature(af);}z.setGeometry(Z);z.fire(e.event.LayerEvent.FEATURE_EDITED);z.deleteEditingProperties();
z.addEditProperties(true);e.$(this).dialog("close");}},{text:e.gv.getLabel("MAPVIEWER_WB_CANCEL"),click:function(){e.$(this).dialog("close");
}}],close:function(ad,ae){}});}};var G=function(){if(!t.editable){return;}if(z){var ai="<tr><td><table>";
var aa,ad;var R,ae,W;var x=[];var ag=[];R=-1;if(z.parentFeature){aa=z.parentFeature.getGeometry();ad=aa.getDimension();
if(aa.type==="OrientedPoint"){for(var Q=0;Q<ad;Q++){x.push(aa.getDimensionValue(Q));ag.push(aa.getOrientationValue(Q));
}}else{var O=z.id.indexOf("shapePoints");var U=z.id.substring(O+11);var Y=U.split("_");R=parseInt(Y[0]);
ae=parseInt(Y[1]);W=parseInt(Y[2]);var X=[];if(aa.type==="MultiPolygon"){X=aa.getOrdinates();}else{if(aa.type==="MultiLineString"){X=[aa.getOrdinates()];
}else{if(aa.type==="Polygon"){X=[aa.getOrdinates()];}else{if(aa.type==="LineString"){X=[[aa.getOrdinates()]];
}}}}for(var af=0;af<ad;af++){x.push(X[R][ae][W*ad+af]);}}}else{aa=z.getGeometry();ad=aa.getDimension();
if(aa.type==="Point"){for(var Z=0;Z<ad;Z++){x.push(aa.getDimensionValue(Z));}}else{var y=B;var V=y.location.left;
var ac=y.location.top;var ab=z.parentLayer.parentMap.getScreenPointLocation(V,ac);var P=z.parentLayer.parentMap.getScreenPointLocation(V-5,ac-5);
var T=ab.coordinates[0]-P.coordinates[0];var S=P.coordinates[1]-ab.coordinates[1];var K=Math.sqrt((T*T)+(S*S));
R=e.util.GeomUtil.findGeometryElement(aa,ab.coordinates[0],ab.coordinates[1],K);if(R!==-1){if(aa.type==="MultiPoint"){for(var aj=0;
aj<ad;aj++){x.push(aa.getOrdinates()[R][aj]);}}}}}for(var ah=0;ah<ad;ah++){var L=document.getElementById("_wb_dim"+ah+A.instanceId);
if(e.notNull(L)){L.outerHTML="";}ai+="<tr><td>"+e.gv.getLabel("MAPVIEWER_WB_DIMENSION")+" "+ah+"</td><td><input type='text' style='width:340px'  id='_wb_dim"+ah+A.instanceId+"' value="+x[ah]+"></td></tr>";
}if(ag.length>0){for(var N=0;N<ad;N++){var M=document.getElementById("_wb_orient"+N+A.instanceId);if(e.notNull(M)){M.outerHTML="";
}ai+="<tr><td>"+e.gv.getLabel("MAPVIEWER_WB_ORIENTATION")+" "+N+"</td><td><input type='text' style='width:340px'  id='_wb_orient"+N+A.instanceId+"' value="+ag[N]+"></td></tr>";
}}ai+="</table></td></tr>";A.$pointdialog=e.$('<div id="_wb_dialog'+A.mapInstanceId+'" title="'+e.gv.getLabel("MAPVIEWER_WB_GEOM_PROPERTIES")+'" style="overflow:visible"><table width=100% cellSpacing=0 borderSpacing=0 style=\'font-size:13px\'>'+ai+"</table></div>");
A.$pointdialog.dialog({position:{of:A.$oracleMapDiv,at:"center"},resizable:false,width:e.browser.touchSupported||e.gv.isWin8Touch?450:510,height:e.browser.touchSupported||e.gv.isWin8Touch?300:360,buttons:[{closeOnEscape:true,text:e.gv.getLabel("MAPVIEWER_WB_UPDATE"),click:function(){var ax=e.util.ValidationUtil.isNumber;
for(var ak=0;ak<x.length;ak++){if(!ax(document.getElementById("_wb_dim"+ak+A.instanceId).value)){alert(e.gv.getLabel("MAPVIEWER_9059")+" ["+e.gv.getLabel("MAPVIEWER_WB_DIMENSION")+":"+ak+"]");
return;}}for(var al=0;al<ag.length;al++){if(!ax(document.getElementById("_wb_orient"+al+A.instanceId).value)){alert(e.gv.getLabel("MAPVIEWER_9059")+" ["+e.gv.getLabel("MAPVIEWER_WB_ORIENTATION")+":"+al+"]");
return;}}var am=null;var az=null;var ao=null;var av=null;if(z.parentFeature){az=z.parentFeature;aa=z.parentFeature.getGeometry();
am=aa.clone(true);ad=aa.getDimension();if(aa.type==="OrientedPoint"){for(var aw=0;aw<ad;aw++){am.setDimensionValue(aw,parseFloat(document.getElementById("_wb_dim"+aw+A.instanceId).value));
am.setOrientationValue(aw,parseFloat(document.getElementById("_wb_orient"+aw+A.instanceId).value));}ao=az.screenPoints;
av={x:ao.x,y:ao.y,angle:ao.angle};ao.angle=-Math.atan2(am.getOrientationValue(1),am.getOrientationValue(0));
}else{var ay=am.getOrdinates();for(var au=0;au<ad;au++){if(aa.type==="MultiPolygon"){ay[R][ae][W*ad+au]=parseFloat(document.getElementById("_wb_dim"+au+A.instanceId).value);
}else{if(aa.type==="MultiLineString"){ay[ae][W*ad+au]=parseFloat(document.getElementById("_wb_dim"+au+A.instanceId).value);
}else{if(aa.type==="Polygon"){ay[ae][W*ad+au]=parseFloat(document.getElementById("_wb_dim"+au+A.instanceId).value);
}else{if(aa.type==="LineString"){ay[W*ad+au]=parseFloat(document.getElementById("_wb_dim"+au+A.instanceId).value);
}}}}}}}else{az=z;aa=z.getGeometry();am=aa.clone(true);ad=aa.getDimension();if(aa.type==="Point"){for(var at=0;
at<ad;at++){am.setDimensionValue(at,parseFloat(document.getElementById("_wb_dim"+at+A.instanceId).value));
}}else{if(R!==-1){if(aa.type==="MultiPoint"){var an=am.getOrdinates();for(var aq=0;aq<ad;aq++){an[R][aq]=parseFloat(document.getElementById("_wb_dim"+aq+A.instanceId).value);
}}}}}if(e.notNull(am)){if(e.notNull(az.parentLayer.changeManager)){var ap=e.edit.EditChangeEvent;var ar=az.parentLayer.changeManager.updateFeature(az.id,az,am,ap.SPATIAL_UPDATE);
if(e.notNull(ar)){az.parentLayer.getUndoManager().addEdit({feature:az,changeManager:az.parentLayer.changeManager,editChangeEvent:ar,screenPointsOld:av,screenPointNew:ao,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"point orientation change";},undo:function(){this.changeManager.undo(this.editChangeEvent);
if(this.feature.geo.type==="OrientedPoint"){this.feature.screenPoints=this.screenPointsOld;}this.feature.deleteEditingProperties();
this.feature.addEditProperties();},redo:function(){this.changeManager.redo(this.editChangeEvent);if(this.feature.geo.type==="OrientedPoint"){this.feature.screenPoints=this.screenPointsNew;
}this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}}az.setGeometry(am);if(az.geo.type==="OrientedPoint"){az.screenPoints=ao;
}az.deleteEditingProperties();az.addEditProperties();}e.$(this).dialog("close");}},{text:e.gv.getLabel("MAPVIEWER_WB_CANCEL"),click:function(){e.$(this).dialog("close");
}}],close:function(ak,al){}});}};if(e.notNull(z.parentFeature)){if(z.parentFeature.geo.type!=="OrientedPoint"){B.addMenuItem("DELETE",w);
}B.addMenuItem("PROPERTIES",G);}else{var F=z.geo.type;if(F==="MultiPolygon"||F==="MultiLineString"||F==="MultiPoint"||F==="MultiOrientedPoint"||F==="GeometryCollection"){B.addMenuItem("DELETE ELEMENT",D);
B.addMenuItem("DETACH ELEMENT",C);}if(F==="Point"||F==="OrientedPoint"||F==="MultiPoint"||F==="MultiOrientedPoint"){if(this.editable){B.addMenuItem("PROPERTIES",G);
}}}B.show=true;if(this.parentFeature){this.parentFeature.contextMenu=B;}};this.registerUpdate=function(x,w,y,z){if(e.isNull(x)||e.isNull(w)||e.isNull(y)){return;
}if(w===y){y.parentLayer.getUndoManager().addEdit({feature:y,changeManager:y.parentLayer.changeManager,editChangeEvent:x,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return z;},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}else{y.parentLayer.getUndoManager().addEdit({feature:w,changeManager:y.parentLayer.changeManager,editChangeEvent:x,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return z;},undo:function(){this.changeManager.undo(this.editChangeEvent);
},redo:function(){this.changeManager.redo(this.editChangeEvent);}});}};},init:function(){this.relatedFeature=[];
},startDrag:function(t,v){var u=this;if(e.gv.featureDragDisabled(u)){return;}var y=u.parentLayer.parentMap.$oracleMapDiv.offset();
u.startX=t.clientX+y.left;u.startY=t.clientY+y.top;u.lastX=t.clientX+y.left;u.lastY=t.clientY+y.top;if(u.parentLayer.parentMap.enableMapAction.drag){u.parentLayer.parentMap.enableMapAction.drag=false;
}else{u.lockedParMap=true;}this.dragging=true;if(e.notNull(u.parentFeature)&&v){var s=u.parentFeature;
s.relatedFeature=[];var x=s.featureEditingProperties;if(u.orientation){var w=s.featureEditingProperties.shapePoints[0][0][0];
u.centerX=w.screenPoints.x;u.centerY=w.screenPoints.y;u.posX=this.screenPoints.x;u.posY=this.screenPoints.y;
u.endDragOrietation=function(){var E=u.parentLayer;E.parentMap.enableMapAction.drag=true;var K=u.screenPoints.x-u.centerX;
var J=u.centerY-u.screenPoints.y;u.startX=null;u.startY=null;u.posX=null;u.posY=null;var A,D;var F=u.parentFeature;
if(F.tool){A=F.tool.currentPoint;D=new e.geometry.Point(A.getX(),A.getY(),A.srid,K,J);F.tool.currentPoint=D;
}else{A=F.geo;D=new e.geometry.Point(A.getX(),A.getY(),A.srid,K,J);if(A.dim>2){for(var L=2;L<A.dim;L++){var O=A.getOrientationValue(L);
var z=A.getDimensionValue(L);D.addDimension(z,O);}}var B=F.screenPoints;var M={x:B.x,y:B.y,angle:B.angle};
B.angle=-Math.atan2(J,K);if(e.notNull(F.parentLayer.changeManager)){var C=e.edit.EditChangeEvent;var G=F.parentLayer.changeManager.updateFeature(F.id,F,D,C.SPATIAL_UPDATE);
if(e.notNull(G)){F.parentLayer.getUndoManager().addEdit({feature:F,changeManager:F.parentLayer.changeManager,editChangeEvent:G,screenPointsOld:M,screenPointNew:B,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"point orientation change";},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.screenPoints=this.screenPointsOld;var P=new N(N.FEATURE_MOVED,this.feature);this.feature.fire(N.FEATURE_MOVED,P);
this.feature.deleteEditingProperties();this.feature.addEditProperties();},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.screenPoints=this.screenPointNew;var P=new N(N.FEATURE_MOVED,this.feature);this.feature.fire(N.FEATURE_MOVED,P);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}}F.setGeometry(D);F.screenPoints=B;
}u.dragging=false;if(E.labelsVisible()){E.parentMap.refreshVectorLayerLabels();}var N=e.event.LayerEvent;
var I=new N(N.FEATURE_MOVED,u);u.fire(I);};return;}else{if(u.pos){x.shapePoints[0][0][1].setVisible(false);
x.shapePoints[0][0][2].setVisible(false);return;}}this.calRelatedFeature(x,u);}else{}},calRelatedFeature:function(s,B){this.point_dragging=true;
var A=B.parentFeature;B.relatedFeature=[];var t,w,x,v,y,u,z;for(t=0,x=s.shapePoints.length;t<x;t++){for(w=0,v=s.shapePoints[t].length;
w<v;w++){y=s.shapePoints[t][w].length;while(y--){u=s.shapePoints[t][w];z=s.possiblePoints[t][w];if(u[y]===B){if(A.geo.type==="Polygon"||A.geo.type==="LineString"||A.geo.type==="MultiPolygon"||A.geo.type==="MultiLineString"){if(y!==0){B.relatedFeature.push(z[y-1]);
B.relatedFeature.push(u[y-1]);}else{if(A.geo.type==="Polygon"||A.geo.type==="MultiPolygon"){B.relatedFeature.push(z[u.length-1]);
B.relatedFeature.push(u[z.length-1]);}}B.relatedFeature.push(z[y]);if(y===u.length-1&&(A.geo.type==="Polygon"||A.geo.type==="MultiPolygon")){y=-1;
}else{if(y===u.length-1){return;}}B.relatedFeature.push(u[y+1]);return;}}}}}for(t=0,x=s.possiblePoints.length;
t<x;t++){for(w=0,v=s.possiblePoints[t].length;w<v;w++){y=s.possiblePoints[t][w].length;while(y--){u=s.shapePoints[t][w];
z=s.possiblePoints[t][w];if(z[y]==B){if(A.geo.type=="Polygon"||A.geo.type=="LineString"||A.geo.type==="MultiPolygon"||A.geo.type==="MultiLineString"){B.relatedFeature.push(y);
B.relatedFeature.push(u[y]);if(y==u.length-1){y=-1;}B.relatedFeature.push(u[y+1]);B.relatedFeature.push(w);
B.relatedFeature.push(t);return;}}}}}},featureDragging:function(B){this._activeIndex=this.parentLayer.parentMap.getCursorLocation().wraparoundMapIndex;
if(!this.dragging_flag){this.dragging_flag=this._activeIndex;if(e.isNull(this.dragging_flag)){this.dragging_flag=false;
}}var K;var y=this;if(!y.parentLayer){return;}if(e.gv.featureDragDisabled(y)){return;}var P=this.parentLayer.parentMap.getMapContext();
var D=P.getUniverse();var M=D.getZoomLevels()[P.getZoomLevel()];var u=e.event.LayerEvent;var C=B.pageX-y.lastX;
var A=B.pageY-y.lastY;var v=C*M.resolution;if(!this.mbrMaxX||!this.mbrMinX){var t=new e.geometry.Point(this.geo.getMBR().getMaxX(),this.geo.getMBR().getMaxY(),this.geo.srid);
var s=new e.geometry.Point(this.geo.getMBR().getMinX(),this.geo.getMBR().getMinY(),this.geo.srid);var x=this.parentLayer.parentMap.getACL(t,this.dragging_flag);
var w=this.parentLayer.parentMap.getACL(s,this.dragging_flag);this.mbrMaxX=x.getX();this.mbrMinX=w.getX();
}this.mbrMaxX=this.mbrMaxX+v;this.mbrMinX=this.mbrMinX+v;if(this.parentLayer.parentMap.wraparound&&!this.point_dragging&&(this.mbrMaxX>=this.parentLayer.parentMap.mapBBox[this.dragging_flag].maxX||this.mbrMinX<=this.parentLayer.parentMap.mapBBox[this.dragging_flag].minX)||this.parentLayer.parentMap.wraparound&&!(this.mbrMaxX<=this.parentLayer.parentMap.mapBBox[this.dragging_flag].maxX&&this.mbrMinX>=this.parentLayer.parentMap.mapBBox[this.dragging_flag].minX)){y.lastX=B.pageX;
y.lastY=B.pageY;return;}y.mouseLocX=B.pageX;y.mouseLocY=B.pageY;y.moving=true;if(y.orientation){y.posX=y.posX+C;
y.posY=y.posY+A;var N=Math.atan2(y.centerY-y.posY,y.posX-y.centerX);var E=y.parentFeature;var Q=E.geo;
if(E.tool){Q=E.tool.currentPoint;}var G=Q.getOrientationPoint(e.layer.EditableFeature.MARKER_SIZE+20,M,N);
y.setGeometry(G);var I=Q.getOrientationPoint(e.layer.EditableFeature.MARKER_SIZE/2,M,N);var F=Q.getOrientationPoint(e.layer.EditableFeature.MARKER_SIZE/2+20,M,N);
var z=new e.geometry.LineString([I.getX(),I.getY(),F.getX(),F.getY()],I.srid);E.featureEditingProperties.shapePoints[0][0][2].setGeometry(z);
var J=new e.event.LayerEvent(e.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,y.parentLayer);J.angle=N;
E.fire(u.FEATURE_ORIENTATION_CHANGING,J);}else{if(y.shapeGroup){var L=y.shapeGroup.length;for(K=0;K<L;
K++){y.shapeGroup[K].translate(C,A);}}else{if(y.scale&&(y.geo.type==="Point"||y.geo.type==="OrientedPoint")){C/=y.scale;
A/=y.scale;y.shape.translate(C,A);}else{if(e.notNull(y.shape)){if(y.parentLayer.parentMap.wraparound&&!this.point_dragging){for(K=0;
K<y.parentLayer.featureGroupArr.length;K++){y.parentLayer.featureGroupArr[K].translate(C,A);}}else{if(this.dragging_flag!==this._activeIndex&&this.parentLayer.parentMap.wraparound){return;
}y.shape.translate(C,A);}}}}}y.lastX=B.pageX;y.lastY=B.pageY;if(y.labelShape&&!y.ghostShape){y.labelShape.translate(C,A);
}var O=new u(u.FEATURE_MOVING,y);O.orgEvt=B;y.fire(u.FEATURE_MOVING,O);if(e.notNull(y.parentFeature)){y.parentFeature.fire(u.FEATURE_MOVING,O);
}if(!this.refresh_dragging&&y.parentLayer.parentMap.wraparound){y.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh();
}},endDrag:function(){this.mbrMaxX=null;this.mbrMinX=null;var A=this;var Q=A.parentLayer;if(e.isNull(Q)){return;
}if(e.gv.featureDragDisabled(A)){return;}this.dragging=false;if(!Q.parentMap.enableMapAction.drag){if(A.lockedParMap){Q.parentMap.enableMapAction.drag=false;
}else{Q.parentMap.enableMapAction.drag=true;}}var v,w;if(!A.moving){if(A.pos){v=A.parentFeature;w=v.featureEditingProperties;
w.shapePoints[1].setVisible(true);w.shapePoints[2].setVisible(true);}return;}A.moving=false;var F=A.startX-A.mouseLocX;
var E=A.startY-A.mouseLocY;if(F||E){this.deleteEditingProperties();}var O=Q.parentMap.getMapContext();
var G=O.getUniverse();var L=G.getZoomLevels()[O.getZoomLevel()];var J=A.getGeometry().clone(true);if(this.point_dragging&&this.dragging_flag!==this._activeIndex&&this.parentLayer.parentMap.wraparound){e.util.Logger.warning(0,"Point is out of bounding","");
this.point_dragging=false;}else{A.move(F,E,L);}A.startX=null;A.startY=null;var u=A.getGeometry().clone(true);
var I=A.editing;var s=A;if(e.notNull(A.parentFeature)&&A.parentFeature.geo.type==="OrientedPoint"){I=A.parentFeature.editing;
Q=A.parentFeature.parentLayer;s=A.parentFeature;J=A.parentFeature.getGeometry().clone(true);var P=u.getX();
var N=u.getY();u=A.parentFeature.getGeometry().clone(true);u.setPoint(P,N);}if(I&&e.notNull(Q.changeManager)){s.geo=J;
var t=e.edit.EditChangeEvent;var B=Q.changeManager.updateFeature(s.id,s,u,t.SPATIAL_UPDATE);if(e.notNull(B)){Q.getUndoManager().addEdit({feature:s,changeManager:Q.changeManager,editChangeEvent:B,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"feature move";},undo:function(){this.changeManager.undo(this.editChangeEvent);
var x=new z(z.FEATURE_MOVED,this.feature);this.feature.fire(z.FEATURE_MOVED,x);this.feature.deleteEditingProperties();
this.feature.addEditProperties();},redo:function(){this.changeManager.redo(this.editChangeEvent);var x=new z(z.FEATURE_MOVED,this.feature);
this.feature.fire(z.FEATURE_MOVED,x);this.feature.deleteEditingProperties();this.feature.addEditProperties();
}});}}if(Q.labelsVisible()){Q.parentMap.refreshVectorLayerLabels();}var z=e.event.LayerEvent;if(A.pos){v=A.parentFeature;
w=v.featureEditingProperties;w.shapePoints[0][0][1].move(F,E,L);w.shapePoints[0][0][1].shape.translate(-F,-E);
w.shapePoints[0][0][2].move(F,E,L);w.shapePoints[0][0][2].shape.translate(-F,-E);w.shapePoints[0][0][1].setVisible(true);
w.shapePoints[0][0][2].setVisible(true);var D=this.geo.getX();var C=this.geo.getY();if(v.tool){v.tool.currentPoint.setPoint(D,C);
}else{var R=v.geo;R.setPoint(D,C);var K={x:A.screenPoints.x,y:A.screenPoints.y,angle:v.screenPoints.angle};
v.setGeometry(R);v.screenPoints=K;}}var M=new z(z.FEATURE_MOVED,A);A.fire(z.FEATURE_MOVED,M);if(e.notNull(A.parentFeature)){A.parentFeature.fire(z.FEATURE_MOVED,M);
}this.addEditProperties(true);if(Q.parentMap.wraparound){this.refresh_dragging=false;Q.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh();
Q.parentMap.getLayerByName("ii_oracle_maps_internal_others").refresh();}return F&&E;},addEditProperties:function(){if(e.notNull(this.parentFeature)){return;
}var z=this.getGeometry();if(z.type!=="Polygon"&&z.type!=="LineString"&&z.type!=="MultiPolygon"&&z.type!=="Point"&&z.type!=="OrientedPoint"&&z.type!=="MultiLineString"&&z.type!=="MultiPoint"){return;
}var S=z.getDimension();if(z.type==="MultiPolygon"||z.type==="MultiLineString"||z.type==="MultiPoint"||z.type==="OrientedMultiPoint"||z.type==="GeometryCollection"||z.type==="Point"||z.type==="OrientedPoint"){this.addListener(e.event.MouseEvent.MOUSE_RIGHT_CLICK,this.showContextMenu);
}var Q=e.layer.EditableFeature;var G=this.parentLayer.parentMap.getMapContext().getUniverse();var W=this.parentLayer.parentMap.getDefaultFeatureLayer();
var s={};s.shapePoints=[];s.possiblePoints=[];this.featureEditingProperties=s;if(z.type=="OrientedPoint"){s.shapePoints[0]=[];
s.shapePoints[0][0]=[];var J=new e.geometry.Point(z.getX(),z.getY(),z.srid);var X=new e.layer.EditableFeature(this.id+"pos",J,{renderingStyle:Q.pointStyle});
X.addListener(e.event.MouseEvent.MOUSE_RIGHT_CLICK,X.showContextMenu);X.parentFeature=this;X.pos=true;
W.addFeature(X);s.shapePoints[0][0].push(X);var T=this.parentLayer.parentMap.getMapContext();G=T.getUniverse();
var R=G.getZoomLevels()[T.getZoomLevel()];J=z.getOrientationPoint(e.layer.EditableFeature.MARKER_SIZE+20,R);
var u=new e.layer.EditableFeature(this.id+"orien",J,{renderingStyle:Q.ORIENTATION_POINT_STYLE});u.parentFeature=this;
u.orientation=true;W.addFeature(u);s.shapePoints[0][0].push(u);var N=z.getOrientationPoint(e.layer.EditableFeature.MARKER_SIZE/2,R);
var M=z.getOrientationPoint(e.layer.EditableFeature.MARKER_SIZE/2+20,R);var D=new e.geometry.LineString([N.getX(),N.getY(),M.getX(),M.getY()],N.srid);
var U=new e.Feature(this.id+"orienline",D,{renderingStyle:Q.ORIENTATION_LINE_STYLE});U.parentFeature=this;
W.addFeature(U);s.shapePoints[0][0].push(U);}var I=[];if(z.type==="MultiPolygon"){I=z.getOrdinates();
}else{if(z.type==="MultiLineString"){I=[z.getOrdinates()];}else{if(z.type==="Polygon"){I=[z.getOrdinates()];
}else{if(z.type==="LineString"){I=[[z.getOrdinates()]];}else{return;}}}}for(var K=0,A=I.length;K<A;K++){var w=I[K];
if(!(w[0] instanceof Array)){w=[w[0]];}s.shapePoints[K]=[];s.possiblePoints[K]=[];for(var P=0;P<w.length;
P++){s.shapePoints[K][P]=[];s.possiblePoints[K][P]=[];var v=null;var t=null;var V=w[P];var L;for(var O=0;
O<V.length/S;O++){var F=V[O*S];var E=V[O*S+1];if(z.type==="LineString"||z.type==="MultiLineString"||O!==((V.length/S)-1)){L=new e.layer.EditableFeature(this.id+"shapePoints"+K+"_"+P+"_"+O,new e.geometry.Point(F,E,z.srid),{renderingStyle:Q.pointStyle});
L.parentFeature=this;L.ringIds=[K,P,O];L.addListener(e.event.LayerEvent.FEATURE_MOVING,L.shapePointMoving);
L.addListener(e.event.MouseEvent.MOUSE_RIGHT_CLICK,L.showContextMenu);L.addListener(e.event.LayerEvent.FEATURE_MOVED,L.shapePointMoved);
s.shapePoints[K][P].push(L);W.addFeature(L);}if(e.notNull(v)&&e.notNull(t)){var C=v+(F-v)/2;var B=t+(E-t)/2;
L=new e.layer.EditableFeature(this.id+"possiblePoints"+K+"_"+P+"_"+(O-1),new e.geometry.Point(C,B,z.srid),{renderingStyle:Q.possibleStyle});
L.parentFeature=this;L.ringIds=[K,P,O];L.addListener(e.event.LayerEvent.FEATURE_MOVING,L.possiblePointMoving);
L.addListener(e.event.LayerEvent.FEATURE_MOVED,L.possiblePointMoved);s.possiblePoints[K][P].push(L);W.addFeature(L);
}v=F;t=E;}}}this.addResizeHandles();this.calDistance();},addResizeHandles:function(ac){if(e.notNull(e.gv.showManipulator)&&e.gv.showManipulator===false){return;
}var P=this.getGeometry();var ai=P.getType();if(ai!=="Polygon"&&ai!=="MultiPolygon"&&ai!=="LineString"&&ai!=="MultiLineString"){return;
}var u=this.parentLayer.parentMap.getDefaultFeatureLayer();var ag=u.parentMap.getMapContext();var aq=ag.getUniverse();
var ah=aq.getZoomLevels()[ag.getZoomLevel()];var al=new e.style.Color({stroke:"#FF0080",strokeThickness:2,strokeOpacity:0.5});
var V=this.featureEditingProperties;var J=P.getMBR();var X=J.coordinates[0];var U=J.coordinates[1];var w=J.coordinates[2];
var t=J.coordinates[3];var F,an,S;if(!V.resizePoints){V.resizePoints=[];}else{if(ac){F=ac.target;var A=new this.graphics.oui.geom.Matrix();
var E=F.startX-F.mouseLocX;var D=F.startY-F.mouseLocY;var y=-E*ah.resolution;var v=D*ah.resolution*ah.stretchRatio;
var L=F.getGeometry().coordinates;var B=F.anchor;var s={x:L[0],y:L[1]};var af={x:s.x+y,y:s.y+v};if(F===V.rotateHandle){if(this.parentLayer.parentMap.wraparound){e.util.Logger.warning("MAPVIEWER_9010","OM.EditableFeature.startEditing","Not support rotation for wraparound");
}else{var R=Math.atan2(af.y-B.y,af.x-B.x);A.translate(B.x,B.y);A.rotate(R);A.translate(-B.x,-B.y);if(V.resizeMBR){V.resizeMBR.setVisible(false);
}if(V.resizePoints){for(an=0;an<V.resizePoints.length;an++){S=V.resizePoints[an];if(S){S.setVisible(false);
}}}}}else{var K=(af.x-B.x)/(w-X)*F.correction.x;var I=(af.y-B.y)/(t-U)*F.correction.y;if(F.id===this.id+"resizePointsN"||F.id===this.id+"resizePointsS"){K=ac.orgEvt.shiftKey?I:1;
}else{if(F.id===this.id+"resizePointsW"||F.id===this.id+"resizePointsE"){I=ac.orgEvt.shiftKey?K:1;}else{if(ac.orgEvt.shiftKey){K=Math.max(K,I);
I=K;}}}A.translate(B.x,B.y);A.scale(K,I);A.translate(-B.x,-B.y);}var G=e.util.GeomUtil.getTransformedGeometry(P,A);
if(!V.transitFeature){var C=new e.style.Line({stroke:"#8684F3",strokeThickness:3,strokeOpacity:0.5});
var M=new e.layer.EditableFeature(this.id+"transitFeature",G,{renderingStyle:C});M.parentFeature=this;
V.transitFeature=M;u.addFeature(M);}else{V.transitFeature.setGeometry(G);}var Q=G.getMBR();X=Q.coordinates[0];
U=Q.coordinates[1];w=Q.coordinates[2];t=Q.coordinates[3];}}var Y=X+((w-X)/2);var W=U+((t-U)/2);var N=["NW","N","NE","E","SE","S","SW","W"];
var aj=[X,Y,w,w,w,Y,X,X];var O=[t,t,t,W,U,U,U,W];var ak=[-1,1,1,1,1,1,-1,-1];var Z=[1,1,1,1,-1,-1,-1,1];
var x=[];for(an=0;an<aj.length;an++){x.push(aj[an]);x.push(O[an]);S=V.resizePoints[an];var ao=new e.geometry.Point(aj[an],O[an],P.srid);
if(!S){S=new e.layer.EditableFeature(this.id+"resizePoints"+N[an],ao,{renderingStyle:e.layer.EditableFeature.resizeHandleStyle});
S.parentFeature=this;S.correction={x:ak[an],y:Z[an]};S.addListener(e.event.LayerEvent.FEATURE_MOVING,S.resizePointMoving);
S.addListener(e.event.LayerEvent.FEATURE_MOVED,S.resizePointMoved);V.resizePoints.push(S);u.addFeature(S);
if(an<4){S.anchor={x:aj[an+4],y:O[an+4]};}else{S.anchor={x:aj[an-4],y:O[an-4]};}}else{if(S!==F){S.setGeometry(ao);
}}}x.push(aj[0]);x.push(O[0]);var z=new e.geometry.LineString(x,P.srid);if(!V.resizeMBR){var ae=new e.Feature(this.id+"resizePointsMBR",z,{renderingStyle:al});
var am=this.id+"resizePointsMBR";ae.parentFeature=this;V.resizeMBR=ae;var T=function(ar){if(ar.target.id===am){ar.target.sendBackward();
ar.evt.stopPropagation();}};ae.addListener(e.event.MouseEvent.MOUSE_DOWN,T);u.addFeature(ae);}else{V.resizeMBR.setGeometry(z);
}var ad=w+(20*ah.resolution);var ab=W;var ap=new e.geometry.Point(ad,ab,P.srid);if(!V.rotateHandle){var aa=new e.layer.EditableFeature(this.id+"rotateHandle",ap,{renderingStyle:e.layer.EditableFeature.rotateHandleStyle});
aa.parentFeature=this;aa.anchor={x:Y,y:W};aa.addListener(e.event.LayerEvent.FEATURE_MOVING,aa.resizePointMoving);
aa.addListener(e.event.LayerEvent.FEATURE_MOVED,aa.resizePointMoved);V.rotateHandle=aa;u.addFeature(aa);
}else{if(V.rotateHandle!==F){V.rotateHandle.setGeometry(ap);}}},calDistance:function(){var u=this.getGeometry();
var t=null;if(u.type==="Polygon"||u.type==="MultiLineString"){t=[u.coordinates];}else{if(u.type==="Polygon"){t=u.coordinates;
}else{t=[[u.coordinates]];}}var K=u.getDimension();var s=this.featureEditingProperties;for(var C=0,w=t.length;
C<w;C++){for(var B=0,v=t[C].length;B<v;B++){var G=t[C][B].length/K;if(u.type==="Polygon"||u.type==="MultiPolygon"){G--;
}for(var E=0;E<G;E++){var D=E+1;if(D===G&&(u.type==="Polygon"||u.type==="MultiPolygon")){D=0;}else{if(D===G){break;
}}var J=s.shapePoints[C][B][E].geo.getX();var I=s.shapePoints[C][B][E].geo.getY();var y=s.shapePoints[C][B][D].geo.getX();
var x=s.shapePoints[C][B][D].geo.getY();var L=this.parentLayer.parentMap.getMapContext();var A=L.getUniverse();
var F=A.getZoomLevels()[L.getZoomLevel()];var z=Math.pow(Math.pow((J-y)/F.resolution,2)+Math.pow((I-x)/F.resolution*F.stretchRatio,2),1/2);
s.possiblePoints[C][B][E].setVisible(z>=e.layer.EditableFeature.NEAREST_DISTANCE);}}}},startEditing:function(){if(this.dragging){return;
}if(e.notNull(this.parentFeature)){return;}var w=this.geo;if(w instanceof e.geometry.Circle||w instanceof e.geometry.Rectangle){return;
}var v=e.layer.EditableFeature;this.editing=true;if((w.type==="Point"||w.type==="MultiPoint")&&e.isNull(this.parentFeature)){this.normalStyle=this.renderingStyle;
if(this instanceof e.TextFeature){if(e.notNull(this.editRenderingStyle)){this.setRenderingStyle(this.editRenderingStyle);
}else{this.setRenderingStyle(v.textStyle);}}else{this.setRenderingStyle(v.pointStyle);}this.deleteEditingProperties();
this.addEditProperties(true);return;}else{if(w.type==="OrientedPoint"&&e.isNull(this.parentFeature)){if(this.tool){this.tool.currentPoint=this.geo.clone();
var s=this.tool;if(s.textFeature&&s.textFeature!==this){s.textFeature.parentLayer.deselectFeature(s.textFeature);
}var u=this.parentLayer.parentMap;e.tool.WhiteBoardTool.showDialog(u,this.tool,this);}this.remove();this.displayed=false;
this.deleteEditingProperties();this.addEditProperties(true);return;}else{if(w.type==="Polygon"||w.type==="LineString"||w.type==="MultiPolygon"||w.type==="MultiLineString"){this.deleteEditingProperties();
this.addEditProperties(true);var t=this.parentLayer.parentMap;t.on(e.event.MapEvent.I_MAP_CENTER_ZOOM,this.calDistance,this);
}else{e.util.Logger.alert("MAPVIEWER_9010","OM.EditableFeature.startEditing","");}}}},startDragging:function(){if(this.dragging){return;
}if(e.notNull(this.parentFeature)){return;}var u=this.geo;if(u instanceof e.geometry.Circle||u instanceof e.geometry.Rectangle){return;
}this.editing=true;if((u.type==="Point"||u.type==="MultiPoint")&&e.isNull(this.parentFeature)){this.normalStyle=this.renderingStyle;
this.deleteEditingProperties();this.addEditProperties(true);return;}else{if(u.type==="OrientedPoint"&&e.isNull(this.parentFeature)){if(this.tool){this.tool.currentPoint=this.geo.clone();
var s=this.tool;if(s.textFeature&&s.textFeature!==this){s.textFeature.parentLayer.deselectFeature(s.textFeature);
}var t=this.parentLayer.parentMap;e.tool.WhiteBoardTool.showDialog(t,this.tool,this);}this.remove();this.displayed=false;
this.deleteEditingProperties();this.addEditProperties(true);return;}else{e.util.Logger.alert("to be filed",e.EditableFeature.start);
}}},deleteEditingProperties:function(){if(e.isNull(this.parentFeature)){this.deleteListener(e.event.MouseEvent.MOUSE_RIGHT_CLICK,this.showContextMenu);
}var s=this.featureEditingProperties;var z=this.parentLayer.parentMap.getDefaultFeatureLayer();if(e.isNull(s)){return;
}var t,x,v,y,w,u,A;for(t=0,y=s.shapePoints.length;t<y;t++){w=s.shapePoints[t].length;for(x=0;x<w;x++){u=s.shapePoints[t][x].length;
for(v=0;v<u;v++){z.removeFeature(s.shapePoints[t][x][v]);}}}s.shapePoints=[];for(t=0,y=s.possiblePoints.length;
t<y;t++){w=s.possiblePoints[t].length;for(x=0;x<w;x++){u=s.possiblePoints[t][x].length;for(v=0;v<u;v++){z.removeFeature(s.possiblePoints[t][x][v]);
}}}s.possiblePoints=[];if(s.resizePoints){A=s.resizePoints.length;for(x=0;x<A;x++){z.removeFeature(s.resizePoints[x]);
}s.resizePoints=[];}if(s.resizeMBR){z.removeFeature(s.resizeMBR);s.resizeMBR=f;}if(s.transitFeature){z.removeFeature(s.transitFeature);
s.transitFeature=f;}if(s.rotateHandle){z.removeFeature(s.rotateHandle);s.rotateHandle=f;}if(z&&z.group){e.$("#"+z.group._id).unbind();
}this.featureEditingProperties=null;if(this.contextMenu&&this.contextMenu.show===true){this.contextMenu.removeRightClickMenu();
}},focusProperties:function(y){var x=this.featureEditingProperties;if(e.isNull(x)){if(e.notNull(this.parentFeature)){x=this.parentFeature.featureEditingProperties;
}if(e.isNull(x)){return;}}var t=0,w,s,z,u,v;if(this.isEditProperties(y,x)){t=x.resizePoints.length;for(w=0;
w<t;w++){x.resizePoints[w].bringToTop();}if(x.resizeMBR){x.resizeMBR.bringToTop();}}else{t=x.shapePoints.length;
for(s=0;s<t;s++){z=x.shapePoints[s].length;for(w=0;w<z;w++){u=x.shapePoints[s][w].length;for(v=0;v<u;
v++){x.shapePoints[s][w][v].bringToTop();}}}t=x.possiblePoints.length;for(s=0;s<t;s++){z=x.shapePoints[s].length;
for(w=0;w<z;w++){u=x.possiblePoints[s][w].length;for(v=0;v<u;v++){x.possiblePoints[s][w][v].bringToTop();
}}}}},isEditProperties:function(w,t){var x=w.id;var v=t;if(e.isNull(v)){return false;}if(v.resizePoints){var s=v.resizePoints.length;
for(var u=0;u<s;u++){if(v.resizePoints[u].id===x){return true;}}}if(v.resizeMBR){if(v.resizeMBR.id===x){return true;
}}return false;},shapePointMoved:function(s){if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}this.dragging=false;this.point_dragging=false;this.parentFeature.featurePointMoved(s,true);var t=new e.event.LayerEvent(e.event.LayerEvent.FEATURE_EDITED,this.parentFeature);
this.parentFeature.fire(e.event.LayerEvent.FEATURE_EDITED,t);},possiblePointMoved:function(s){if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}this.dragging=false;this.point_dragging=false;this.parentFeature.featurePointMoved(s,false);var t=new e.event.LayerEvent(e.event.LayerEvent.FEATURE_EDITED,this.parentFeature);
this.parentFeature.fire(e.event.LayerEvent.FEATURE_EDITED,t);},resizePointMoved:function(){this.mbrMaxX=null;
this.mbrMinX=null;if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}var w=this.parentFeature;var v=w.featureEditingProperties.transitFeature;var s=v.getGeometry().clone();
if(e.notNull(w.parentLayer.changeManager)){var u=e.edit.EditChangeEvent;var t=w.parentLayer.changeManager.updateFeature(w.id,w,s,u.SPATIAL_UPDATE);
if(e.notNull(t)){w.parentLayer.getUndoManager().addEdit({feature:w,changeManager:w.parentLayer.changeManager,editChangeEvent:t,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"feature transform";},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.fire(e.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.addEditProperties();
},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.fire(e.event.LayerEvent.FEATURE_EDITED);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}}w.setGeometry(v.getGeometry());
w.fire(e.event.LayerEvent.FEATURE_EDITED);w.deleteEditingProperties();w.addEditProperties(true);},digHole:function(){console.info("hole");
},deleteShapePoint:function(z){if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}var s=z.parentFeature;var ae=s.geo.dim;var R=s.featureEditingProperties;var u=z.parentLayer.parentMap.getDefaultFeatureLayer();
var O=null;var t=null;var A=null;var B=null;var Q=-1;var Y=0,Z=0;if(z.ringIds&&z.ringIds.length>2){Z=z.ringIds[0];
Y=z.ringIds[1];}var P=R.shapePoints[Z][Y];var C=R.possiblePoints[Z][Y];var ak,ac,ab,ah;if(s.geo.type==="Polygon"||s.geo.type==="LineString"||s.geo.type==="MultiPolygon"||s.geo.type==="MultiLineString"){Q=P.length;
if(Q<=2){e.util.Logger.alert("MAPVIEWER_9011","OM.EditableFeature.deleteShapePoint","");return;}if((s.geo.type==="Polygon"||s.geo.type==="MultiPolygon")&&Q<=3){e.util.Logger.alert("MAPVIEWER_9012","OM.EditableFeature.deleteShapePoint","");
return;}while(Q--){if(P[Q]===z){if(Q!==0&&Q!==(P.length-1)){O=C[Q-1];A=P[Q-1];t=C[Q];B=P[Q+1];ac=A.geo.getX()+(B.geo.getX()-A.geo.getX())/2;
ab=A.geo.getY()+(B.geo.getY()-A.geo.getY())/2;t.setGeometry(new e.geometry.Point(ac,ab,z.geo.srid));}else{if(s.geo.type==="Polygon"||s.geo.type==="MultiPolygon"){if(Q===0){O=C[C.length-1];
A=P[P.length-1];t=C[Q];B=P[Q+1];}else{if(Q===(P.length-1)){O=C[Q-1];A=P[Q-1];t=C[Q];B=P[0];}}ac=A.geo.getX()+(B.geo.getX()-A.geo.getX())/2;
ab=A.geo.getY()+(B.geo.getY()-A.geo.getY())/2;t.setGeometry(new e.geometry.Point(ac,ab,z.geo.srid));}else{if(s.geo.type==="LineString"||s.geo.type==="MultiLineString"){if(Q===0){t=C[Q];
u.removeFeature(t);C.splice(Q,1);}else{if(Q===(P.length-1)){O=C[Q-1];}}}}}break;}}}for(ak=0;ak<P.length;
ak++){if(P[ak]===z){P.splice(ak,1);u.removeFeature(z);break;}}if(O){for(ak=0;ak<C.length;ak++){if(C[ak]===O){C.splice(ak,1);
u.removeFeature(O);break;}}}var af=s.geo.getOrdinates();var V=[];for(ah=0;ah<R.shapePoints.length;ah++){V[ah]=[];
for(ak=0;ak<R.shapePoints[ah].length;ak++){V[ah][ak]=[];for(var ai=0;ai<R.shapePoints[ah][ak].length;
ai++){R.shapePoints[ah][ak][ai].id=s.id+"shapePoints"+ah+"_"+ak+"_"+ai;V[ah][ak].push(R.shapePoints[ah][ak][ai].geo.getX());
V[ah][ak].push(R.shapePoints[ah][ak][ai].geo.getY());if(ae>2){var ad=0;if(ai>=Q&&ah===Z&&ak===Y){ad++;
}for(var L=2;L<ae;L++){var aj=0;if(s.geo.type==="MultiPolygon"){aj=af[ah][ak][(ai+ad)*ae+L];}if(s.geo.type==="Polygon"){aj=af[ak][(ai+ad)*ae+L];
}else{if(s.geo.type==="LineString"){aj=af[(ai+ad)*ae+L];}else{if(s.geo.type==="MultiLineString"){aj=af[ak][(ai+ad)*ae+L];
}}}V[ah][ak].push(aj);}}}if(s.geo.type==="Polygon"||s.geo.type==="MultiPolygon"){V[ah][ak].push(R.shapePoints[ah][ak][0].geo.getX());
V[ah][ak].push(R.shapePoints[ah][ak][0].geo.getY());if(ae>2){for(var E=2;E<ae;E++){var S=0;if(s.geo.type==="MultiPolygon"){S=af[ah][ak][af[ah][ak].length-ae+E];
}else{S=af[ak][af[ak].length-ae+E];}V[ah][ak].push(S);}}}}}var F;if(s.geo.type==="Polygon"){F=new e.geometry.Polygon(V[0],s.geo.srid,ae);
}else{if(s.geo.type==="MultiPolygon"){F=new e.geometry.MultiPolygon(V,s.geo.srid,ae);}else{if(s.geo.type==="MultiLineString"){F=new e.geometry.MultiLineString(V[0],s.geo.srid,ae);
}else{if(s.geo.type==="LineString"){F=new e.geometry.LineString(V[0][0],s.geo.srid,ae);}}}}var am=F.clone();
var M=[];M.push(s);var ag={};ag[s.id]=am;if(s.parentLayer.hasSharedBoundary()){var W=s.parentLayer.parentMap.getScreenLocation(z.geo);
var G=s.parentLayer.parentMap.getScreenPointLocation(W.x-3,W.y-3);var w=z.geo.getX()-G.coordinates[0];
var v=G.coordinates[1]-z.geo.getY();var al=Math.sqrt((w*w)+(v*v));var aa=[z.geo.getX(),z.geo.getY()];
var N=e.edit.GeometrySegmentUtil.getLayerSegmentPoints(s.parentLayer,aa,al,false,false,false,false);if(e.notNull(N)){for(var ao=0;
ao<N.length;ao++){var D=N[ao].getFeature().id;if(D!==s.id){var an=N[ao].getFeature();var T=an.getGeometry().clone(true);
if(e.edit.GeometrySegmentUtil.removeVertexFromGeometry(T,N[ao])){M.push(N[ao].getFeature());ag[D]=T;}}}}}if(e.notNull(s.parentLayer.changeManager)){var J=e.edit.EditChangeEvent;
if(M.length>1){s.parentLayer.getUndoManager().startChangeBlock("feature point move");}for(var I=0;I<M.length;
I++){var K=M[I];if(e.isNull(ag[K.id])){continue;}var ap=s.parentLayer.changeManager.updateFeature(K.id,K,ag[K.id],J.SPATIAL_UPDATE);
if(e.notNull(ap)){s.registerUpdate(ap,K,s,"feature point delete");}}if(M.length>1){s.parentLayer.getUndoManager().endChangeBlock("feature point move");
}}for(var X=0;X<M.length;X++){var U=M[X];U.setGeometry(ag[U.id]);}for(ak=0;ak<C.length;ak++){C[ak].id=s.id+"possiblePoints"+ak;
}},featurePointMoving:function(F,v){this.refresh_dragging=true;this.activeIndex=this.parentLayer.parentMap.getCursorLocation().wraparoundMapIndex;
if(e.isNull(this.activeIndex)){this.activeIndex=0;}if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}var G=F.target.parentFeature;var w=G.parentLayer.parentMap;var u=new e.style.Line({stroke:"#8684F3",strokeThickness:5,strokeOpacity:0.5});
var t=F.target.graphics;var z=null;var A=null;if(G&&(G.geo.type==="Polygon"||G.geo.type==="LineString"||G.geo.type==="MultiPolygon"||G.geo.type==="MultiLineString")){if(v){if(F.target.relatedFeature.length<1){G.calRelatedFeature(G.featureEditingProperties,F.target);
}z=F.target.relatedFeature[1];A=F.target.relatedFeature[3];}else{if(F.target.relatedFeature.length<1){G.calRelatedFeature(G.featureEditingProperties,F.target);
}z=F.target.relatedFeature[1];A=F.target.relatedFeature[2];}var I=t.getLeftTop(z.parentLayer.group);var D=t.getLeftTop(w.draggableGroup);
var C=F.orgEvt.pageX-w.$oracleMapDiv.offset().left-I.x-D.x;var B=F.orgEvt.pageY-w.$oracleMapDiv.offset().top-I.y-D.y;
var E=z.parentLayer.group;var s;if(!G.editingLineBefore&&!G.editingLineAfter){if(z){s=e.util.GeomUtil.screenPointsXOffset(z.screenPoints.x,this.activeIndex,w.getMapContext());
G.editingLineBefore=t.drawPath([[s,z.screenPoints.y,C,B]],u,{group:E});G.editingLineBefore.setStrokeDashArray([10]);
z.bringToTop();}if(A){s=e.util.GeomUtil.screenPointsXOffset(A.screenPoints.x,this.activeIndex,w.getMapContext());
G.editingLineAfter=t.drawPath([[s,A.screenPoints.y,C,B]],u,{group:E});G.editingLineAfter.setStrokeDashArray([10]);
A.bringToTop();}F.target.bringToTop();}else{if(z){s=e.util.GeomUtil.screenPointsXOffset(z.screenPoints.x,this.activeIndex,w.getMapContext());
t.setPath(G.editingLineBefore,[[s,z.screenPoints.y,C,B]]);}if(A){s=e.util.GeomUtil.screenPointsXOffset(A.screenPoints.x,this.activeIndex,w.getMapContext());
t.setPath(G.editingLineAfter,[[s,A.screenPoints.y,C,B]]);}}}},featurePointMoved:function(z,aw){if(e.notNull(e.gv.allowFeaturePointsInteraction)&&e.gv.allowFeaturePointsInteraction===false){return;
}if(z.target.relatedFeature.length===0){return;}z.target.graphics.remove(this.editingLineBefore);this.editingLineBefore=null;
z.target.graphics.remove(this.editingLineAfter);this.editingLineAfter=null;var Q=z.target;var aF=Q.parentFeature;
var aK=false;if(e.notNull(aF)){var aJ=aF.pointToSnap;if(e.notNull(aJ)){Q.geo.setPoint(aJ[0],aJ[1]);aF.pointToSnap=null;
aK=true;}}var am=aF.geo.dim;var I=aF.featureEditingProperties;var Z=aF.parentLayer.parentMap.getDefaultFeatureLayer();
var ac=e.layer.EditableFeature;aF.parentLayer.removeFromRtree(Q);aF.parentLayer.addToRtree(Q);var aE=Z.parentMap.getMapContext();
var t=aE.getUniverse();var aP=t.getZoomLevels()[aE.getZoomLevel()];var X,W,ax,av,aq,ap,aW,ae,ab,ad,al,ak,aj,at;
var ay=null;var aC,N,aA;if(aw){if(aF.geo.type==="Polygon"||aF.geo.type==="LineString"||aF.geo.type==="MultiPolygon"||aF.geo.type==="MultiLineString"){var af=[];
if(aF.geo.type==="MultiPolygon"){af=aF.geo.getOrdinates();}else{if(aF.geo.type==="MultiLineString"){af=[aF.geo.getOrdinates()];
}else{if(aF.geo.type==="Polygon"){af=[aF.geo.getOrdinates()];}else{if(aF.geo.type==="LineString"){af=[[aF.geo.getOrdinates()]];
}}}}var O=aF.geo.getDimension();var aB=z.target.ringIds[0];var aX=z.target.ringIds[1];var B=z.target.ringIds[2];
ay=[af[aB][aX][B*O],af[aB][aX][B*O+1]];aC=aB;N=aX;aA=B;X=Q.geo.getX()+(z.target.relatedFeature[1].geo.getX()-Q.geo.getX())/2;
W=Q.geo.getY()+(z.target.relatedFeature[1].geo.getY()-Q.geo.getY())/2;z.target.relatedFeature[0].setGeometry(new e.geometry.Point(X,W,Q.geo.srid));
ax=Q.geo.getX();av=Q.geo.getY();aq=z.target.relatedFeature[1].geo.getX();ap=z.target.relatedFeature[1].geo.getY();
aW=Math.pow(Math.pow((ax-aq)/aP.resolution,2)+Math.pow((av-ap)/aP.resolution*aP.stretchRatio,2),1/2);
if(aW<e.layer.EditableFeature.NEAREST_DISTANCE){z.target.relatedFeature[0].setVisible(false);}else{z.target.relatedFeature[0].setVisible(true);
}if(z.target.relatedFeature[3]){X=Q.geo.getX()+(z.target.relatedFeature[3].geo.getX()-Q.geo.getX())/2;
W=Q.geo.getY()+(z.target.relatedFeature[3].geo.getY()-Q.geo.getY())/2;z.target.relatedFeature[2].setGeometry(new e.geometry.Point(X,W,Q.geo.srid));
aq=z.target.relatedFeature[3].geo.getX();ap=z.target.relatedFeature[3].geo.getY();aW=Math.pow(Math.pow((ax-aq)/aP.resolution,2)+Math.pow((av-ap)/aP.resolution*aP.stretchRatio,2),1/2);
if(aW<e.layer.EditableFeature.NEAREST_DISTANCE){z.target.relatedFeature[2].setVisible(false);}else{z.target.relatedFeature[2].setVisible(true);
}}}}else{if(aF.geo.type==="Polygon"||aF.geo.type==="LineString"||aF.geo.type==="MultiPolygon"||aF.geo.type==="MultiLineString"){var aT=z.target.relatedFeature[0];
var aO=z.target.relatedFeature[3];var aQ=z.target.relatedFeature[4];aC=aQ;N=aO;aA=aT;var S=e.event.LayerEvent;
I.shapePoints[aQ][aO].splice(aT+1,0,Q);Q.setRenderingStyle(ac.pointStyle);Q.addListener(S.FEATURE_MOVING,Q.possiblePointMoving);
Q.addListener(S.FEATURE_MOVING,Q.shapePointMoving);Q.deleteListener(S.FEATURE_MOVED,Q.possiblePointMoved);
Q.addListener(S.FEATURE_MOVED,Q.shapePointMoved);Q.addListener(e.event.MouseEvent.MOUSE_RIGHT_CLICK,Q.showContextMenu);
for(ae=0;ae<I.shapePoints[aQ][aO].length;ae++){I.shapePoints[aQ][aO][ae].id=aF.id+"shapePoints"+aQ+"_"+aO+"_"+ae;
}var aI=z.target.relatedFeature[1].geo.getX();var au=z.target.relatedFeature[1].geo.getY();var aH=z.target.relatedFeature[2].geo.getX();
var ar=z.target.relatedFeature[2].geo.getY();var ao=aI+(aH-aI)/2;var an=au+(ar-au)/2;ay=[ao,an];var u=z.target.relatedFeature[1].geo;
var aV=Q.geo;X=u.getX()+(aV.getX()-u.getX())/2;W=u.getY()+(aV.getY()-u.getY())/2;var w=new e.layer.EditableFeature(aF.id+"possiblePoints"+aQ+"_"+aO+"_"+aT,new e.geometry.Point(X,W,Q.geo.srid),{renderingStyle:ac.pointStyle});
w.parentFeature=aF;w.addListener(S.FEATURE_MOVING,w.possiblePointMoving);w.addListener(S.FEATURE_MOVED,w.possiblePointMoved);
Z.addFeature(w);I.possiblePoints[aQ][aO].splice(aT,1,w);ax=Q.geo.getX();av=Q.geo.getY();aq=z.target.relatedFeature[1].geo.getX();
ap=z.target.relatedFeature[1].geo.getY();aW=Math.pow(Math.pow((ax-aq)/aP.resolution,2)+Math.pow((av-ap)/aP.resolution*aP.stretchRatio,2),1/2);
if(aW<e.layer.EditableFeature.NEAREST_DISTANCE){w.setVisible(false);}else{w.setVisible(true);}X=Q.geo.getX()+(z.target.relatedFeature[2].geo.getX()-Q.geo.getX())/2;
W=Q.geo.getY()+(z.target.relatedFeature[2].geo.getY()-Q.geo.getY())/2;w=new e.layer.EditableFeature(aF.id+"possiblePoints"+aQ+"_"+aO+"_"+I.possiblePoints[aQ][aO].length,new e.geometry.Point(X,W,Q.geo.srid),{renderingStyle:ac.pointStyle});
w.parentFeature=aF;w.addListener(e.event.LayerEvent.FEATURE_MOVING,w.possiblePointMoving);w.addListener(e.event.LayerEvent.FEATURE_MOVED,w.possiblePointMoved);
Z.addFeature(w);I.possiblePoints[aQ][aO].splice(aT+1,0,w);aq=z.target.relatedFeature[2].geo.getX();ap=z.target.relatedFeature[2].geo.getY();
aW=Math.pow(Math.pow((ax-aq)/aP.resolution,2)+Math.pow((av-ap)/aP.resolution*aP.stretchRatio,2),1/2);
if(aW<e.layer.EditableFeature.NEAREST_DISTANCE){w.setVisible(false);}else{w.setVisible(true);}for(ab=0,al=I.possiblePoints.length;
ab<al;ab++){for(ae=0,ak=I.possiblePoints[ab].length;ae<ak;ae++){for(ad=0,aj=I.possiblePoints[ab][ae].length;
ad<aj;ad++){I.possiblePoints[ab][ae][ad].id=aF.id+"possiblePoints"+ab+"_"+ae+"_"+ad;I.possiblePoints[ab][ae][ad].setRenderingStyle(ac.possibleStyle);
}}}}}var aN=aF.geo.getOrdinates();var ai=[];for(ab=0,al=I.shapePoints.length;ab<al;ab++){ai[ab]=[];for(ae=0,ak=I.shapePoints[ab].length;
ae<ak;ae++){ai[ab][ae]=[];for(ad=0,at=I.shapePoints[ab][ae].length;ad<at;ad++){var aG=I.shapePoints[ab][ae][ad].geo;
ai[ab][ae].push(aG.getX());ai[ab][ae].push(aG.getY());if(am>2){var G=0;if(!aw&&ad>(aA+1)&&ab===aC&&ae===N){G--;
}for(var M=2;M<am;M++){var R=0;if(!aw&&ad===(aA+1)&&ab===aC&&ae===N){ai[ab][ae].push(0);}else{if(aF.geo.type==="MultiPolygon"){R=aN[ab][ae][(ad+G)*am+M];
}if(aF.geo.type==="Polygon"){R=aN[ae][(ad+G)*am+M];}else{if(aF.geo.type==="LineString"){R=aN[(ad+G)*am+M];
}else{if(aF.geo.type==="MultiLineString"){R=aN[ae][(ad+G)*am+M];}}}ai[ab][ae].push(R);}}}}if(aF.geo.type==="Polygon"||aF.geo.type==="MultiPolygon"){if(I.shapePoints[ab][ae] instanceof Array){var P=I.shapePoints[ab][ae][0].geo;
ai[ab][ae].push(P.getX());ai[ab][ae].push(P.getY());if(am>2){for(var J=2;J<am;J++){var T=0;if(aF.geo.type==="MultiPolygon"){T=aN[ab][ae][aN[ab][ae].length-am+J];
}else{T=aN[ae][aN[ae].length-am+J];}ai[ab][ae].push(T);}}}}}}var aU;if(aF.geo.type==="MultiPolygon"){aU=new e.geometry.MultiPolygon(ai,aF.geo.srid,am);
}if(aF.geo.type==="Polygon"){aU=new e.geometry.Polygon(ai[0],aF.geo.srid,am);}else{if(aF.geo.type==="LineString"){aU=new e.geometry.LineString(ai[0][0],aF.geo.srid,am);
}else{if(aF.geo.type==="MultiLineString"){aU=new e.geometry.MultiLineString(ai[0],aF.geo.srid,am);}}}var aM=aU.clone();
var az=[];az.push(aF);var ag={};ag[aF.id]=aM;if(aF.parentLayer.hasSharedBoundary()){var Y=aF.parentLayer.parentMap.getScreenLocation(Q.geo);
var U=aF.parentLayer.parentMap.getScreenPointLocation(Y.x-3,Y.y-3);var E=Q.geo.getX()-U.coordinates[0];
var D=U.coordinates[1]-Q.geo.getY();var v=Math.sqrt((E*E)+(D*D));var L=[ay[0],ay[1]];var C=e.edit.GeometrySegmentUtil.getLayerSegmentPoints(aF.parentLayer,L,v,false,false,false,false);
if(e.notNull(C)){for(var ah=0;ah<C.length;ah++){var V=C[ah].getFeature().id;if(V!==aF.id){var s=C[ah].getPointLocation();
var K=C[ah].getFeature();var aa=K.getGeometry().clone(true);if(s===2){C[ah].setPoint([Q.geo.getX(),Q.geo.getY()]);
if(e.edit.GeometrySegmentUtil.addVertexToGeometry(aa,C[ah])){az.push(C[ah].getFeature());ag[V]=aa;}}else{if(e.edit.GeometrySegmentUtil.moveGeometryVertex(aa,C[ah],[Q.geo.getX(),Q.geo.getY()])){az.push(C[ah].getFeature());
ag[V]=aa;}}}}}}if(e.notNull(aF.parentLayer.changeManager)){var aR=e.edit.EditChangeEvent;if(az.length>1){aF.parentLayer.getUndoManager().startChangeBlock("feature point move");
}for(var aD=0;aD<az.length;aD++){var F=az[aD];if(e.isNull(ag[F.id])){continue;}var A=aF.parentLayer.changeManager.updateFeature(F.id,F,ag[F.id],aR.SPATIAL_UPDATE);
if(e.notNull(A)){aF.registerUpdate(A,F,aF,"feature point move");}}if(az.length>1){aF.parentLayer.getUndoManager().endChangeBlock("feature point move");
}}aF.activeIdx=null;for(var aS=0;aS<az.length;aS++){var aL=az[aS];aL.setGeometry(ag[aL.id]);if(aF.parentLayer.parentMap.wraparound){aL.parentLayer.refresh();
aF.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh();}}if(e.notNull(Z)&&aK){Z.refresh();
}this.addResizeHandles();}});e.layer.EditableFeature.MARKER_SIZE=10;e.layer.EditableFeature.NEAREST_DISTANCE=35;
if(e.browser.touchSupported||e.gv.isWin8Touch){e.layer.EditableFeature.MARKER_SIZE=20;e.layer.EditableFeature.NEAREST_DISTANCE=50;
}e.layer.EditableFeature.POINT_BACKGROUND=new e.style.Marker({width:30,height:30,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:30,height:30},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1,fillOpacity:0,strokeOpacity:0}}]});
e.layer.EditableFeature.ORIENTEDPOINT_BACKGROUND=new e.style.Marker({width:70,height:70,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:70,height:70},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1,fillOpacity:0,strokeOpacity:0}}]});
e.layer.EditableFeature.ORIENTATION_POINT_STYLE=new e.style.Marker({styleName:"_orientationPointStyle",width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"circle",cx:e.layer.EditableFeature.MARKER_SIZE/2,cy:e.layer.EditableFeature.MARKER_SIZE/2},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});
e.layer.EditableFeature.ORIENTATION_LINE_STYLE=new e.style.Line({styleName:"_orientationLinetyle",stroke:"#0000ff",strokeThickness:1});
e.layer.EditableFeature.pointStyle=new e.style.Marker({width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});
e.layer.EditableFeature.possibleStyle=new e.style.Marker({width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1,fillOpacity:0.4,strokeOpacity:0.4}}]});
e.layer.EditableFeature.resizeHandleStyle=new e.style.Marker({width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#ff00ff",strokeThickness:1,fillOpacity:0.4,strokeOpacity:0.4}}]});
e.layer.EditableFeature.rotateHandleStyle=new e.style.Marker({width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"circle",cx:0,cy:0,width:e.layer.EditableFeature.MARKER_SIZE,height:e.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#ff00ff",strokeThickness:1,fillOpacity:0.4,strokeOpacity:0.4}}]});
e.layer.EditableFeature.bgPolyStyle=new e.style.Color({styleName:"polygonToolStyle",fillOpacity:0,fill:"#8D8DFF",stroke:"#C0C0C0",strokeThickness:15,strokeOpacity:0});
e.layer.EditableFeature.bgLineStyle=new e.style.Line({styleName:"polygonToolStyle",fillOpacity:0,fill:"#8D8DFF",stroke:"#C0C0C0",strokeThickness:15,strokeOpacity:0});
e.layer.EditableFeature.textStyle=new e.style.Text({styleName:"editableTextStyle",fill:"#000000",stroke:"#C0C0C0",fontFamily:"Arial",fontStyle:e.Text.FONTSTYLE_ITALIC});
e.layer.XMLMapLayer=e.layer.Layer.extend({setXMLRequest:function(s){this.xmlRequest=s;}});e.layer.OSMTileLayer=e.layer.TileLayer.extend({initialize:function b(t,s,u,v){b.base.call(this,t,{tileLayerConfig:e.layer.TileLayerConfig.CONFIG_OSM,getTileURL:function(x,w,K,C){var F=this.tileLayerConfig.bounds;
var B=this.tileLayerConfig.tileImageHeight;var J=this.tileLayerConfig.zoomLevels[x];var I=(F.getMaxY()-C.getMaxY())/J.resolution/B;
var E;var A;var G=null;if(e.isNull(s)){E=(w+I)%3;A="a";switch(E){case 1:A="b";break;case 2:A="c";}G="http://"+A+".tile.openstreetmap.org/"+x+"/"+w+"/"+I+".png";
}else{E=(w+I)%s.length;A=s[E];if(e.isNull(u)){G=A+"/"+x+"/"+w+"/"+I+".png";}else{G=A+"/"+x+"/"+w+"/"+I+"."+u;
}}if(e.notNull(v)){var D="?";for(var z in v){if(v.hasOwnProperty(z)){G=G+D+z+"="+v[z];D="&";}}}return G;
}});}});e.layer.Menu=e.Class.extend({initialize:function(v,w){var u=this;this.map=v;this.menuId="menu_0";
this.menuTableId="mvmenu_table_0";this.menuTableBodyId="mvmenu_table_body_0";this.show=false;this.location=w;
for(var t=0;t<this.map.decorationArray.length;t++){if(this.map.decorationArray[t]&&this.map.decorationArray[t].sblx=="menu_0"){this.map.removeMapDecoration(this.map.decorationArray[t]);
}}var s="<table id='"+this.menuTableId+"' cellpadding=0 cellspacing=0 style='width:0px'><tr><td style='border-width:0px;border-style:solid;border-color:black;background-color:white'><table width=100%><tbody id='"+this.menuTableBodyId+"'></tbody></table></td></tr></table>";
this.menu=new e.control.MapDecoration(s,{offsetX:w.left,offsetY:w.top},{draggable:true,panelOptions:{style:{"border-style":"solid","border-color":"#0000ff","border-width":"1px",backgroundColor:"#FDFDFD",filter:"alpha(Opacity=80)","-moz-opacity":"0.8",opacity:"0.8"}}});
this.menu.sblx="menu_0";this.map.addMapDecoration(this.menu);e.layer.Menu.count=e.layer.Menu.count+1;
this.removeRightClickMenu=function(){if(u.menu){if(u.show){u.map.removeMapDecoration(u.menu);u.map.deleteListener(e.event.MouseEvent.MOUSE_CLICK,u.removeRightClickMenu);
u.menu=null;u.show=false;}}};this.map.on(e.event.MouseEvent.MOUSE_CLICK,u.removeRightClickMenu);},addMenuItem:function(s,w){var v=document.getElementById(this.menuTableBodyId);
document.getElementById(this.menuTableId).style.width=(s.length*12)+"px";var u=document.createElement("tr");
v.appendChild(u);u.style.fontFamily="Arial, Helvetica, Geneva, sans-serif";u.style.fontSize="12px";u.style.cursor="pointer";
u.align="center";var y=document.createElement("td");y.innerHTML=s;u.appendChild(y);u.onmouseover=function(){this.style.backgroundColor="#336699";
this.style.color="#ffffff";};u.onmouseout=function(){this.style.backgroundColor="transparent";this.style.color="#000000";
};if(w){var x=function(z){z.stopPropagation();z.preventDefault();t.removeRightClickMenu();w();};var t=this;
if(!e.browser.touchSupported){e.$(u).mousedown(x);}else{e.$(u).bind("touchstart",x);}}}});e.layer.Menu.count=0;
e.layer.VectorLayerHeatMap=e.Class.extend({initialize:function(u,t){this.opacity=u&&u.opacity>0&&u.opacity<1?u.opacity:1;
if(e.browser.android&&e.browser.androidVersion<=4){this.opacity=1;}this.initColor(u.colorStops);this.vectorLayer=t;
this.maxValue=u.maxValue;this.minValue=u.minValue;this.loadingBoundaray=false;this.scale=u.sampleFactor;
this.smallCanvas=null;this.bigCanvas=null;var s=this;this.containerVectorLayer=u.containerVectorLayer;
if(this.containerVectorLayer&&e.isNull(this.containerVectorLayer.serverURL)){this.containerVectorLayer.serverURL=t.parentMap.mapviewerURL;
}if(this.containerVectorLayer&&!this.containerVectorLayer.dataLoaded&&!this.containerVectorLayer.loading&&!this.containerVectorLayer.usedInOverview){s.containerVectorLayer.parentMap=s.vectorLayer.parentMap;
s.loadingBoundaray=true;s.containerVectorLayer.dataBufferWindow=s.vectorLayer.dataBufferWindow;s.containerVectorLayer.getThemeData(null,function(){s.containerVectorLayer.loading=false;
s.loadingBoundaray=false;},function(){s.containerVectorLayer.loading=false;s.loadingBoundaray=false;});
}else{if(this.containerVectorLayer){s.loadingBoundaray=true;var v=function(){if(s.containerVectorLayer.dataLoaded){s.loadingBoundaray=false;
return;}else{setTimeout(v,100);}};v();}}},init:function(v,u,t,y,s){this.realWidth=v;this.realHeight=u;
this.width=v;this.height=u;if(this.scale>1){this.width=v/this.scale;this.height=u/this.scale;}this.width=this.width|0;
this.height=this.height|0;this.minX=t;this.minY=y;this.data=[];this.realMaxValue=Number.NEGATIVE_INFINITY;
this.realMinValue=Number.POSITIVE_INFINITY;var w=s/this.scale;this.radius=w>1?Math.floor(w):1;if(this.radius>50){this.radius=50;
}if(this.smallCanvas){var x=this.smallCanvas;if(x.width!==this.width||x.height!==this.height){this.smallCanvas=null;
}}this.sX=parseInt(t/this.scale);this.sY=parseInt(y/this.scale);},addData:function(s,z,w){if(!this.data[s]){this.data[s]=[];
}if(!this.data[s][z]){this.data[s][z]={num:0,value:0};}var v=this.data[s][z].num;if(this.isValued){var u=(this.data[s][z].value*v+w)/(v+1);
this.data[s][z]={num:v+1,value:u};if(u>this.realMaxValue){this.realMaxValue=u;}if(u<this.realMinValue){this.realMinValue=u;
}}else{var t=this.data[s][z].value+w;this.data[s][z]={num:v+1,value:t};if(t>this.realMaxValue){this.realMaxValue=t;
}if(t<this.realMinValue){this.realMinValue=t;}}},drawHeatMap:function(w){this.numClass=this.origNum;this.max=this.realMaxValue;
this.min=this.realMinValue;if(e.notNull(this.maxValue)){this.max=this.maxValue;if(this.maxValue<this.realMaxValue){this.numClass--;
}}if(e.notNull(this.minValue)){this.min=this.minValue;if(this.minValue>this.realMinValue){this.numClass--;
}}if(this.numClass<=0){this.numClass=1;}this.step=(this.max-this.min)/this.numClass;var s=this.drawShrunkenMap();
var t=document.createElement("canvas");t.width=this.realWidth;t.height=this.realHeight;var u=t.getContext("2d");
if(!e.browser.android||e.browser.androidVersion>4){this.clip(u);}if(this.scale>1){var v=Math.round(this.scale/2);
u.drawImage(s,0,0,this.width,this.height,0-v,0-v,this.realWidth-this.scale/2,this.realHeight-this.scale/2);
}else{u.drawImage(s,0,0,this.width,this.height,0,0,this.realWidth,this.realHeight);}w(t);},initColor:function(u){var v=document.createElement("canvas");
v.width="1";v.height="256";var t=v.getContext("2d");var x=t.createLinearGradient(0,0,1,256);var s=u.length;
for(var w=0;w<s;w++){x.addColorStop(w/s,u[w]);}t.fillStyle=x;t.fillRect(0,0,1,256);this.colorData=t.getImageData(0,0,1,256).data;
this.origNum=s;},drawShrunkenMap:function(){var u=this.smallCanvas;if(!u){u=document.createElement("canvas");
u.width=this.width;u.height=this.height;this.smallCanvas=u;}var s=u.getContext("2d");s.clearRect(0,0,u.width,u.height);
if(e.util.Logger.DEBUG){console.time("computingHeatMap");}if(this.isValued){this.metricHeatMap3(u,s);
}else{this.classicalHeatMap(s);}var t=s.getImageData(0,0,this.width,this.height);var y=t.data;var w=y.length;
for(var v=3;v<w;v+=4){var x=y[v];if(x!==0){var z=x*4;y[v-3]=this.colorData[z];y[v-2]=this.colorData[z+1];
y[v-1]=this.colorData[z+2];y[v]=this.opacity*255;}}if(e.util.Logger.DEBUG){console.timeEnd("computingHeatMap");
}t.data=y;s.putImageData(t,0,0);return u;},classicalHeatMap:function(t){for(var w=0;w<this.width;w++){for(var v=0;
v<this.height;v++){var s=w+this.sX,A=v+this.sY;if(this.data[s]&&this.data[s][A]){var u=this.data[s][A].value/this.max;
var z=t.createRadialGradient(w,v,0,w,v,this.radius);z.addColorStop(0,"rgba(0,0,0,"+u+")");z.addColorStop(1,"rgba(0,0,0,0)");
t.fillStyle=z;t.beginPath();t.arc(w,v,this.radius,0,Math.PI*2,true);t.closePath();t.fill();}}}},metricHeatMap:function(K){var s=this.radius;
if(s<3){s=3;}var G=document.createElement("canvas");G.width=s*2;G.height=s*2;var J=G.getContext("2d");
for(var z=0;z<this.width;z++){for(var v=0;v<this.height;v++){var I=z+this.sX,E=v+this.sY;if(this.data[I]&&this.data[I][E]){var B=this.data[I][E].value/this.max;
var F=J.createRadialGradient(s,s,0,s,s,s);F.addColorStop(0,"rgba(0,0,0,"+B+")");F.addColorStop(1,"rgba(0,0,0,0)");
J.fillStyle=F;J.beginPath();J.arc(s,s,s,0,Math.PI*2,true);J.closePath();J.fill();var w=J.getImageData(0,0,s*2,s*2);
var D=w.data;var t=K.getImageData(z-s,v-s,s*2,s*2);var C=t.data;for(var u=3,A=D.length;u<A;u+=4){C[u]=Math.max(D[u],C[u]);
}t.data=C;K.putImageData(t,z-s,v-s);J.clearRect(0,0,G.width,G.height);}}}},metricHeatMap2:function(v,I){var E=this.radius;
if(E<3){E=3;}var s=document.createElement("canvas");var F=E*2;s.width=F;s.height=F;var w=s.getContext("2d");
var G=I.getImageData(0,0,v.width,v.height);var M=G.data;var A=v.width;for(var K=0;K<this.width;K++){for(var J=0;
J<this.height;J++){var C=K+this.sX,B=J+this.sY;if(this.data[C]&&this.data[C][B]){var u=this.data[C][B].value/this.max;
var t=w.createRadialGradient(E,E,0,E,E,E);t.addColorStop(0,"rgba(0,0,0,"+u+")");t.addColorStop(1,"rgba(0,0,0,0)");
w.fillStyle=t;w.beginPath();w.arc(E,E,E,0,Math.PI*2,true);w.closePath();w.fill();var z=w.getImageData(0,0,E*2,E*2);
var L=z.data;for(B=0;B<F;B++){for(C=0;C<F;C++){var D=((J-E+B)*A+(K-E+C))*4;if(D<0){continue;}M[D+3]=Math.max(L[(B*F+C)*4+3],M[D+3]);
}}w.clearRect(0,0,F,F);}}}G.data=M;I.putImageData(G,0,0);},metricHeatMap3:function(v,I){var E=this.radius;
if(E<3){E=3;}var s=document.createElement("canvas");var F=E*2;s.width=F;s.height=F;var w=s.getContext("2d");
var G=I.getImageData(0,0,v.width,v.height);var M=G.data;var A=v.width;var t=w.createRadialGradient(E,E,0,E,E,E);
t.addColorStop(0,"rgba(0,0,0,1)");t.addColorStop(1,"rgba(0,0,0,0)");w.fillStyle=t;w.beginPath();w.arc(E,E,E,0,Math.PI*2,true);
w.closePath();w.fill();var z=w.getImageData(0,0,E*2,E*2);var L=z.data;for(var K=0;K<this.width;K++){for(var J=0;
J<this.height;J++){var C=K+this.sX,B=J+this.sY;if(this.data[C]&&this.data[C][B]){var u=this.data[C][B].value/this.max;
if(u>1){u=1;}for(B=0;B<F;B++){for(C=0;C<F;C++){var D=((J-E+B)*A+(K-E+C))*4;if(D<0){continue;}M[D+3]=Math.max(parseInt(L[(B*F+C)*4+3]*u),M[D+3]);
}}}}}G.data=M;I.putImageData(G,0,0);},clip:function(t){if(!this.containerVectorLayer){this.clipByBounds(t);
return;}var v=this.vectorLayer.parentMap.getMapContext().getTransform();var E=this.containerVectorLayer.size();
if(E===0){this.clipByBounds(t);return;}t.beginPath();for(var y=0;y<E;y++){var x=this.containerVectorLayer.featureArray[y].getGeometry();
var C=x.getMBR();var B=this.vectorLayer.dataBufferWindow;if(e.notNull(C)&&(C.maxX<B.x||C.maxY<B.y||C.minX>B.x+B.w||C.minY>B.y+B.h)){continue;
}var z,D,w,u,s;if(x.type==="Polygon"){z=x.coordinates.slice(0);for(w=0;w<1;w++){D=z[w].slice(0);D=v.transformHeatMapSegment(D,1,x.dim,this.minX,this.minY,1);
if(!D){continue;}u=D.length;if(u<6){continue;}t.moveTo(D[0],D[1]);for(s=2;s<u;s+=2){t.lineTo(D[s],D[s+1]);
}}}else{if(x.type==="MultiPolygon"){z=x.coordinates.slice(0);var A=z.length;for(w=0;w<A;w++){D=z[w][0].slice(0);
D=v.transformHeatMapSegment(D,1,x.dim,this.minX,this.minY,1);if(!D){continue;}u=D.length;if(u<6){continue;
}t.moveTo(D[0],D[1]);for(s=2;s<u;s+=2){t.lineTo(D[s],D[s+1]);}}}}}t.closePath();t.clip();},clipByBounds:function(t){var s=this.vectorLayer.parentMap.getMapContext();
var v=s.getTransform();var u=s.getUniverse().getMapBounds();var w=u.coordinates.slice(0);w=v.transformHeatMapSegment(w,1,2,this.minX,this.minY,1);
if(w.length<4){return;}t.beginPath();t.moveTo(w[0],w[1]);t.lineTo(w[0],w[3]);t.lineTo(w[2],w[3]);t.lineTo(w[2],w[1]);
t.closePath();t.clip();},getPixelValue:function(t){if(t>this.max&&e.notNull(this.maxValue)){t=this.max;
}if(t<this.min&&e.notNull(this.minValue)){t=this.min;}var s=parseInt((t-this.min)/this.step);var u=parseInt(s*255/this.numClass)*4;
return{r:this.colorData[u],g:this.colorData[u+1],b:this.colorData[u+2]};},getRadius:function(s,u){var t=(this.max-this.min)/3;
return s+parseInt((u-this.min)/t);},calculate:function(J,G,E,B){if(B<3){B=3;}B=this.getRadius(B,J[G][E].value);
for(var w=-B;w<=B;w++){var F=E+w;if(F<0){continue;}var z=Math.sqrt(B*B-w*w);var t=Math.floor(G-z),s=Math.ceil(G+z);
t=t<0?0:t;for(var u=t;u<=s;u++){if(!J[u]){J[u]=[];}if(G!=u||E!=F){var D=Math.sqrt((u-G)*(u-G)+w*w);if(D>B){continue;
}var A=J[G][E].num*Math.sqrt((B-D)/B);var I=J[G][E].value*Math.sqrt((B-D)/B);if(J[u][F]){var C=J[u][F].num+A;
if(I>J[u][F].value){J[u][F]={num:C,value:I};}}else{J[u][F]={num:A,value:I};}}}}}});e.layer.TomTomTileLayer=e.layer.BuiltinExternalTileLayer.extend({initialize:function b(w,v){b.base.call(this,w);
if(typeof tomtom!=="undefined"){e.layer.TomTomTileLayer.LOADING=true;e.layer.TomTomTileLayer.LOADED=true;
}if(typeof tomtom==="undefined"){e.layer.TomTomTileLayer.LOADING=false;e.layer.TomTomTileLayer.LOADED=false;
if(v&&v.libURL){this.libURL=v.libURL;if(this.libURL.indexOf("/",this.libURL.length-1)===-1){this.libURL=this.libURL+"/";
}}else{this.libURL=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/tomtom/";
}var x=this;e.util.LoadFileUtil.LoadCss(this.libURL+"css/tomtom.map.min.css");var u=setInterval(function(){if(e.util.LoadFileUtil.CssLoaded){clearInterval(u);
e.util.LoadFileUtil.LoadJs(x.libURL+"js/leaflet.js");}},100);var t=setInterval(function(){if(e.util.LoadFileUtil.JsLoaded){clearInterval(t);
e.layer.TomTomTileLayer.LOADING=true;e.util.LoadFileUtil.LoadJs(x.libURL+"js/tomtom.map.js",true);}},100);
var s=setInterval(function(){if(e.util.LoadFileUtil.JsLoadedTwice){clearInterval(s);e.layer.TomTomTileLayer.LOADED=true;
tomtom.setImagePath(x.libURL+"images/");}},100);}if(v&&v.APIKey){this.key=v.APIKey;}else{e.util.Logger.alert("MAPVIEWER_9004","OM.layer.TomTomTileLayer",null);
}if(v&&v.displayTraffic){this.displayTraffic=v.displayTraffic;}else{this.displayTraffic=false;}this.tileLayerConfig=e.layer.TileLayerConfig.CONFIG_TOMTOM;
this.maxWidth=1600;this.maxHeight=980;},init:function(){var x=null;var u=null;var s=this;var w=this.container;
var t=function(){if(!s.parentMap){return;}var A=s.parentMap.getMapContext();var y=A.getCenterPoint();
var z=function(E){var B=y.getX();var F=y.getY();if(E){B=E.getX();F=E.getY();}if(B!==null&&F!==null){x=[F,B];
}u=A.getZoomLevel();if(s.map){return;}var C={domNode:w,apiKey:s.key,cookie:false,center:x,zoom:u+3,displayTraffic:s.displayTraffic,inertia:false,fadeAnimation:false};
s.map=new tomtom.Map(C);s.map.invalidateSize();var D=function(){var I=e.event;var G=new I.MapEvent(I.LayerEvent.FINISH_LOAD,s);
G.mapContext=A;s.fire(I.LayerEvent.FINISH_LOAD,G);};s.map.on("load",D);};y.transform(8307,function(B){z(B);
});};var v=h.setInterval(function(){if(e.layer.TomTomTileLayer.LOADED){clearInterval(v);t();s.resize();
}},100);s.parentMap.on(e.event.MapEvent.MAP_RESIZED,s.resize,s);},setCenterAndZoomlevel:function(){if(this.map){var u=this.parentMap.getMapContext();
var v=u.getZoomLevel();var s=this;var t=function(){var x=e.event;var w=new x.MapEvent(x.LayerEvent.FINISH_LOAD,s);
w.mapContext=u;s.fire(x.LayerEvent.FINISH_LOAD,w);};u.getCenterPoint().transform(8307,function(w){s.map.setView([w.getY(),w.getX()],v+3,true);
t();});}},resize:function(){if(e.notNull(this.map)){this.map.invalidateSize();}},pan:function(){if(this.map){if(!e.browser.msie){this.setCenterAndZoomlevel();
}if(e.browser.msie){this.setCenterAndZoomlevel();}}},clone:function(s){if(!s){s=this.name+"_clone";}this.cloneLayer=new e.layer.TomTomTileLayer(s,{APIKey:this.key,libURL:this.libURL});
return this.cloneLayer;},getStaticMapURL:function(z,E){var J;var G;var I;var F;var u=new e.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMinX(),this.parentMap.getMapWindowBoundingBox().getMinY(),3785);
var t=new e.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMaxX(),this.parentMap.getMapWindowBoundingBox().getMaxY(),3785);
u.transform(8307,function(w){J=w.getX();G=w.getY();});t.transform(8307,function(w){I=w.getX();F=w.getY();
});var A="https://api.tomtom.com/lbs/map/3/wms/?";var M="key="+this.key;var x="version=1.1.1";var v="request=GetMap";
var s="bbox="+J+","+G+","+I+","+F;var L="srs=EPSG:4326";var C="width="+z;var B="height="+E;var y="layers=basic";
var D="format=image/png";var K="&";A=A+M+K+x+K+v+K+s+K+L+K+C+K+B+K+y+K+"styles="+K+D;return A;}});e.layer.TomTomTileLayer.LOADING=false;
e.layer.TomTomTileLayer.LOADED=false;e.layer.LocationBoxTileLayer=e.layer.TileLayer.extend({initialize:function b(t,s){b.base.call(this,t,{tileLayerConfig:e.layer.TileLayerConfig.CONFIG_LOCATIONBOX,getTileURL:function(y,w,u){var v=(s&&s.mapType)?s.mapType:"TYPE_NORMAL";
var x=(s&&s.format)?s.format:"PNG";return"http://www.locationbox.com.tr/locationbox/services?Key="+s.key+"&Cmd=GetTile&X="+w+"&Y="+u+"&Format="+x+"&ZoomLevel="+(y+4)+"&MapType="+v;
}});}});e.layer.MultiFeature=e.Class.extend({initialize:function(s){this.fList=s;},add:function(s){if(this.fList){this.fList.push(s);
}else{this.fList=[s];}},createFeature:function(w,t){var s=this.fList.length;var v=this.fList[0].geo;var u=new e.Feature(w,v,{renderingStyle:t});
u.setMarkerText(s+"");return u;}});e.layer.VectorLayerMultiFeature=e.Class.extend({initialize:function(s){this.vectorLayer=s;
this.mfList=[];this.group=s.parentMap.graphics.createGroup();s.group.appendChild(this.group);var t=this;
s.parentMap.graphics.attachEventListener(e.event.MouseEvent.MOUSE_LEAVE,function(){t.clear();},this.group);
},checkLocation:function(){var x=this.vectorLayer.featureArray;for(var v=0,w=x.length;v<w-1;v++){if(this.vectorLayer.mapping&&!x[v].mapping&&!this.vectorLayer.nsdp.fullDisplay){continue;
}if(x[v].multi||!x[v].geo||x[v].geo.type!==e.GeomTypes.POINT){continue;}var t=x[v].geo.coordinates[0],z=x[v].geo.coordinates[1];
var A=null;for(var u=v+1;u<w;u++){if(this.vectorLayer.mapping&&!x[u].mapping&&!this.vectorLayer.nsdp.fullDisplay){continue;
}if(x[u].multi||!x[u].geo||x[u].geo.type!==e.GeomTypes.POINT){continue;}var s=x[u].geo.coordinates[0],y=x[u].geo.coordinates[1];
if(t===s&&z===y){if(A){A.add(x[u]);}else{A=new e.layer.MultiFeature([x[v],x[u]]);}x[v].multi=x[u].multi=true;
}}if(A){this.mfList.push(A);}}},display:function(){var x=this;var u=function(z,A){return function(){A.graphics.attachEventListener(e.event.MouseEvent.MOUSE_ENTER,function(){x.showFeatures(z.fList,A.screenPoints);
},A.shape);}();};var t=function(z){return function(){var B=z.target,A=B.mf;if(A.open){x.clear();}else{x.showFeatures(A.fList,B.screenPoints);
A.open=true;}}();};for(var w=0,s=this.mfList.length;w<s;w++){var v=this.mfList[w];v.open=false;var y=v.createFeature("_mul"+w,this.vectorLayer.mfMarker);
y.mf=v;y.group=this.vectorLayer.realGroup;y.screenTransformObj=this.vectorLayer.parentMap.getMapContext().getTransform();
y.graphics=this.vectorLayer.parentMap.graphics;y.parentLayer=this.vectorLayer;y.displayFeature([this.vectorLayer.mfMarker]);
if(!e.browser.touchSupported){u(v,y);}else{y.addListener(e.event.MouseEvent.MOUSE_CLICK,t,y.shape);}}},showFeatures:function(s,u){var A=s.length;
if(A<2){return;}var E=this.vectorLayer.parentMap.graphics;this.clear();var G=Math.PI*2/A;var I=this.algorith1;
if(G<Math.PI/5){I=this.algorith2;G=Math.PI/5;}this.group.applyStyle({opacity:1});this.lineGroup=E.createGroup();
this.markerGroup=E.createGroup();this.markerGroup.applyStyle({cursor:this.vectorLayer.mouseCursor});this.group.appendChild(this.lineGroup);
this.group.appendChild(this.markerGroup);if(!this.group.parentNode){this.vectorLayer.group.appendChild(this.group);
E.sendToBottom(this.group);}var t=function(L,M){return function(){M.vectorLayer.showInfoWindow(L,L.getGeometry());
M.clear();E.clearToolTips();return;};};for(var z=0;z<A;z++){var J=G*z+Math.PI/2;var y=I(z);var D=Math.cos(J)*y.r1+u.x;
var w=-Math.sin(J)*y.r1+u.y;var B=Math.cos(J)*y.r2+u.x;var v=-Math.sin(J)*y.r2+u.y;var F=s[z];E.drawPath([[D,w,B,v]],{stroke:"#003286",strokeThickness:1},{group:this.lineGroup});
F.screenPoints={x:B,y:v};F.parentLayer=this.vectorLayer;var C=this.vectorLayer.getFeatureStyles(F);C.draw(F,this.vectorLayer.parentMap.getMapContext(),{group:this.markerGroup,type:F.geo.type,screenPoints:{x:B,y:v}});
F.displayed=true;F.applyToolTip();if(e.browser.touchSupported){E.attachEventListener(e.event.MouseEvent.TOUCH_TAP,t(F,this),F.shape);
}else{E.attachEventListener(e.event.MouseEvent.MOUSE_CLICK,t(F,this),F.shape);}}var K=I(z).r2*2;var x=E.drawEllipse({cx:u.x,cy:u.y,width:K,height:K},{fill:"#ffffff",fillOpacity:0},{group:this.group});
E.sendToBottom(x);},algorith1:function(){return{r1:15,r2:30};},algorith2:function(s){return{r1:15,r2:30+s*3};
},clear:function(){for(var t=0,s=this.mfList.length;t<s;t++){this.mfList[t].open=false;}this.vectorLayer.parentMap.graphics.clearGroup(this.group);
},destroy:function(){for(var s=this.mfList.length-1;s>=0;s--){var t=this.mfList[s];t.shape=null;t.screenPoints=null;
t.parentLayer=null;t.graphics=null;this.mfList.pop();}this.vectorLayer.parentMap.graphics.clearGroup(this.group);
}});e.layer.KMLParser=e.Class.extend({initialize:function(s){this.vLayer=s;this.minX=Number.POSITIVE_INFINITY;
this.minY=Number.POSITIVE_INFINITY;this.maxX=Number.NEGATIVE_INFINITY;this.maxY=Number.NEGATIVE_INFINITY;
},parse:function(w,A){var y=0;var B=8307;var x=this.vLayer;x.featureArray=[];var s=this;w.find("Placemark").each(function(){var G=e.$(this);
var E="KML"+y;var M=s.parseExtendedData(G);var D=G.find("name").text();var R=G.find("addresss").text();
var L=G.find("phoneNumber").text();if(e.notNull(D)&&D!==""){M.name=D;}if(e.notNull(R)&&R!==""){M.address=R;
}if(e.notNull(L)&&L!==""){M.phone=L;}var N=G.find("gx\\:Track, Track");for(var I=0,J=N.length;I<J;I++){var F=s.parseTrack(e.$(N[I]),E,M);
if(F.length>0){x.addFeatures(F);y++;}}var K=G.find("MultiGeometry");var P;if(K.length>0){var S=[];var O;
var Q=[];K.children().each(function(){var U=s.parseSimpleGeometry(e.$(this));if(U){S.push(U);Q.push(U.getOrdinates());
if(!O){O=U.getType();}else{if(O!==U.getType()){O="GeometryCollection";}}}});if(S.length>1){if(O=="GeometryCollection"){P=new e.geometry.GeometryCollection(S,B);
}else{if(O=="Point"){P=new e.geometry.MultiPoint(Q,B);}else{if(O=="LineString"){P=new e.geometry.MultiLineString(Q,B);
}else{if(O=="Polygon"){P=new e.geometry.MultiPolygon(Q,B);}}}}P.dimension=S[0].dimension;}}else{P=s.parseSimpleGeometry(G);
}if(P){var T=new e.Feature(E,P,{attributes:M});x.featureArray.push(T);y++;}});x.dataLoaded=true;if(!x.featureArray||x.featureArray.length===0){return false;
}var C=e.event;var u=function(E){var D=new C.LayerEvent(C.LayerEvent.FEATURES_LOADED,x);D.mapContext=x.parentMap.getMapContext();
x.fire(C.LayerEvent.FEATURES_LOADED,D);A(E);};var t=x.parentMap.getMapContext().getUniverse().getSRID();
if(B!==t){var z=new e.geometry.Rectangle(this.minX,this.minY,this.maxX,this.maxY,B);z.transform(t,function(D){var E=[D.getMinX(),D.getMinY(),D.getMaxX(),D.getMaxY()];
u(E);});return true;}else{var v=[this.minX,this.minY,this.maxX,this.maxY];u(v);return true;}},parseSimpleGeometry:function(w){var B=w.find("coordinates");
var z,u;var I=8307;if(B.length>0){z=B.parent()[0].nodeName;if(z=="LinearRing"){u=w.find("outerBoundaryIs").find("coordinates").text();
if(e.notNull(u)&&u!==""){var G=this.parseCoordinates(u);u=w.find("innerBoundaryIs").find("coordinates").text();
var E=[G.coords];if(e.notNull(u)&&u!==""){var v=this.parseCoordinates(u);E.push(v.coords);}var D=new e.geometry.Polygon(E,I);
D.dimension=G.dimension;return D;}}else{u=B.text();if(z=="Point"){var t=u.split(",");var C=Number(t[0]);
var A=Number(t[1]);var F=new e.geometry.Point(C,A,I);if(C<this.minX){this.minX=C;}if(C>this.maxX){this.maxX=C;
}if(A<this.minY){this.minY=A;}if(A>this.maxY){this.maxY=A;}return F;}else{if(z=="LineString"){var s=this.parseCoordinates(u);
var J=new e.geometry.LineString(s.coords,I);J.dimension=s.dimension;return J;}}}}return null;},parseCoordinates:function(w){var v=w.trim().split(/\s+/g)[0].split(",").length;
var u=w.trim().split(/\s+|,/g);for(var t=0,s=u.length;t<s;t++){u[t]=Number(u[t]);if(t%v===0){if(u[t]<this.minX){this.minX=u[t];
}if(u[t]>this.maxX){this.maxX=u[t];}}else{if(t%v===1){if(u[t]<this.minY){this.minY=u[t];}if(u[t]>this.maxY){this.maxY=u[t];
}}}}return{coords:u,dimension:v};},parseTrack:function(F,E,G){var t=F.find("when");var O=F.find("gx\\:coord, coord");
var N=8307;var J,s,u;if(t.length>0&&O.length>0&&t.length==O.length){var K=[];var w=[];for(var L=0,M=t.length;
L<M;L++){var z=e.$(O[L]).text();var v=z.trim().split(" ");J=v.length;var B=Number(v[0]),A=Number(v[1]);
var I=new e.geometry.Point(B,A,N);if(B<this.minX){this.minX=B;}if(B>this.maxX){this.maxX=B;}if(A<this.minY){this.minY=A;
}if(A>this.maxY){this.maxY=A;}s={when:e.$(t[L]).text()};for(u in G){if(G[u] instanceof Array&&G[u].length>L){s[u]=G[u][L];
}}w.push(new e.Feature(E+"_"+L,I,{attributes:s}));Array.prototype.push.apply(K,v);}if(M>1){var C=new e.geometry.LineString(K,N);
C.dimension=J;var D={};for(u in G){if(!G[u] instanceof Array){s[D]=G[D];}}w.splice(0,0,new e.Feature(E+"_"+L,C,{}));
}return w;}},parseExtendedData:function(t){var y={};var u=t.find("ExtendedData").find("Data");var v,x,s,z,B;
for(v=0,x=u.length;v<x;v++){s=e.$(u[v]);z=s.attr("name");var A=s.find("displayName").text();B=s.find("value").text();
if(e.notNull(A)&&A!==""){y[A]=B;}else{y[z]=B;}}u=t.find("ExtendedData").find("SimpleData");for(v=0,x=u.length;
v<x;v++){s=e.$(u[v]);z=s.attr("name");B=s.find("value").text();y[z]=B;}u=t.find("ExtendedData").find("gx\\:SimpleArrayData, SimpleArrayData");
var w=function(){B.push(e.$(this).text());};for(v=0,x=u.length;v<x;v++){s=e.$(u[v]);z=s.attr("name");
B=[];s.children().each(w);y[z]=B;}return y;}});e.layer.GeoJSONParser=e.Class.extend({initialize:function(s){this.layer=s;
this.count=0;},parse:function(u,z,s){var x=!u||u.mds_error||u.error;if(x){var y=x.message;var t=x.details;
if(t){y+=" [details]:"+t;}this.layer.dataLoaded=false;e.util.Logger.severe("MAPVIEWER_9007","OM.layer.VectorLayer.getThemeData",y);
s();return;}this.layer.getDataRequest=null;this.parseSRID(u);this.parselayerLevelStyle(u);this.parseEditParameters(u);
this.parseFeatures(u);var w=this;var v=function(){if(w.count===0){w.layer.dataLoaded=true;var B=e.event;
var A=new B.LayerEvent(B.LayerEvent.FEATURES_LOADED,w.layer);A.mapContext=w.layer.parentMap.getMapContext();
w.layer.fire(B.LayerEvent.FEATURES_LOADED,A);z(w.bbox);u=null;}else{setTimeout(v,100);}};v();},parseSRID:function(s){this.srid=s.srs;
if(!this.srid&&s.crs&&s.crs.type==="name"&&s.crs.properties&&s.crs.properties.name){this.srid=e.util.GeomUtil.parseCRSName(s.crs.properties.name);
}if(e.isNull(this.srid)){this.srid=8307;}},parseBBox:function(v){this.bbox=v.bbox;if(this.bbox){var x=new e.geometry.Rectangle(this.bbox[0],this.bbox[1],this.bbox[2],this.bbox[3],this.srid);
if(this.bbox.length>4){var t=parseInt(this.bbox.length/2);x=new e.geometry.Rectangle(this.bbox[0],this.bbox[1],this.bbox[t],this.bbox[t+1],this.srid);
}var s=this.layer.parentMap.getMapContext().getUniverse().getSRID();if(this.srid!==s){var u=new e.geometry.LineString([x.getMinX(),x.getMinY(),x.getMaxX(),x.getMaxY()],this.srid);
var w=this;u.transform(s,function(y){var z=y.coordinates;w.layer.mbr=new e.geometry.Rectangle(z[0],z[1],z[2],z[3],w.srid);
w.bbox=[z[0],z[1],z[2],z[3]];if(s===505050){w.layer.mbr=null;w.bbox=null;}});}else{this.layer.mbr=x;}}},parselayerLevelStyle:function(s){if(!this.layer.renderingStyle&&s.renderStyle){this.layer.setRenderingStyle({dataSource:this.layer.dataSource,name:s.renderStyle,url:this.layer.serverURL});
}if(!this.layer.hoverStyle&&s.hoverStyle){this.layer.setHoverStyle({dataSource:this.layer.dataSource,name:s.hoverStyle,url:this.layer.serverURL});
}if(!this.layer.selectionStyle&&s.selectStyle){this.layer.setSelectStyle({dataSource:this.layer.dataSource,name:s.selectStyle,url:this.layer.serverURL});
}if(!this.layer.labelingStyle&&s.labelStyle){this.layer.setLabelingStyle({dataSource:this.layer.dataSource,name:s.labelStyle,url:this.layer.serverURL});
}},parseEditParameters:function(t){if(e.notNull(t.not_null_attr_names)){this.layer.notNullAttributes=t.not_null_attr_names;
}else{this.layer.notNullAttributes=[];}if(e.isNull(t.edit_properties)){return;}if(e.isNull(this.layer.keyColumn)){this.keyColumn=t.edit_properties.id_attr;
if(e.notNull(this.keyColumn)){this.layer.keyColumn=this.keyColumn.toUpperCase();}}this.baseTable=t.edit_properties.base_table;
if(e.notNull(this.baseTable)){this.layer.baseTable=this.baseTable.toUpperCase();}else{this.layer.baseTable=null;
}if(e.isNull(this.layer.geometryColumn)){this.spatialAttr=t.edit_properties.spatial_attr;if(e.notNull(this.spatialAttr)){this.layer.geometryColumn=this.spatialAttr.toUpperCase();
}}this.spatialType=t.edit_properties.spatial_type;if(e.notNull(this.spatialType)){this.layer.spatialType=this.spatialType;
}else{this.layer.spatialType="geometry";}this.workspace=t.edit_properties.workspace;if(e.notNull(this.workspace)){this.layer.workspace=this.workspace.toUpperCase();
}else{this.layer.workspace="LIVE";}var v=t.attr_names;var u=t.attr_types;this.layer.attributeTypes={};
if(e.notNull(v)&&e.notNull(u)&&v.length===u.length){for(var s=0;s<v.length;s++){var w=v[s].toUpperCase();
this.layer.attributeTypes[w]=u[s];}}},parseFeatures:function(C){var u=C.features;var A=u.length;var y={};
this.layer.featureArray=[];this.layer.mapping=false;this.layer.attrNames=C.attr_names;this.layer.columnMap=C.columnMap;
var t=this;var z=function(F){if(!y[F]){y[F]=F;t.count++;e.style.StyleStore.getServerSideStyle(t.layer.dataSource,F,{url:t.layer.serverURL,callback:function(G){if(G instanceof e.style.HeatMap&&!t.layer.renderingStyle){t.layer.renderingStyle=G;
}t.count--;}});}};for(var x=0;x<A;x++){try{var E=u[x];var B=E.geometry;if(e.isNull(B)||e.$.isEmptyObject(B)){continue;
}if(this.layer.type===e.layer.VectorLayer.TYPE_DATAPACK){B=e.util.GeomUtil.parseGeoJson(B);}var s=(typeof E._id!=="undefined")?E._id:x;
B.srid=this.srid;var D=new e.Feature(s,B,{attributes:E.properties});if(e.notNull(this.layer.columnMap)){D.columnMap=this.layer.columnMap;
}D.srid=this.srid;if(this.layer.doFilter(D)){continue;}D.labelBox=E.label_box;if(this.layer.type!==e.layer.VectorLayer.TYPE_DATAPACK){if(E.styles&&E.styles.rendering&&E.styles.rendering.style){if(E.styles&&E.styles.rendering&&E.styles.rendering.columns){D.columns=E.styles.rendering.columns;
}var v=E.styles.rendering.style;D.styleName=v;z(v);}if(E.styles&&E.styles.labeling&&E.styles.labeling.style){if(E.styles&&E.styles.labeling&&E.styles.labeling.columns){D.labelColumn=E.styles.labeling.columns[0];
}D.labelStyleName=E.styles.labeling.style;z(D.labelStyleName);}}this.layer.featureArray.push(D);}catch(w){e.util.Logger.warning("MAPVIEWER_9101","OM.layer.GeoJsonParser.parseFeatures",w.message+" (Feature id: "+s+")");
continue;}}}});e.layer.GeoRSSParser=e.Class.extend({initialize:function(s){this.vLayer=s;},parse:function(z,C){var D=8307;
var A=this.vLayer;var x=Number.POSITIVE_INFINITY;var w=Number.POSITIVE_INFINITY;var t=Number.NEGATIVE_INFINITY;
var s=Number.NEGATIVE_INFINITY;A.featureArray=[];var v=A.parentMap.getMapContext().getUniverse().getSRID();
e.$(z).find("entry").each(function(){var S=e.$(this);var Q=S.find("title").text();var O=S.find("link").attr("href");
var I=S.find("id").text();var J=S.find("updated").text();var L=S.find("content").text();var M=S.find("summary").text();
var G=S.find("georss\\:point").text();if(G===""){G=S.find("point").text();}if(e.notNull(G)&&G!==""){var F=G.split(" ");
var P=Number(F[1]);var N=Number(F[0]);var R=new e.geometry.Point(P,N,D);var K={};if(e.notNull(Q)){K._LABEL_=Q;
}if(e.notNull(O)){K.link="<a href='"+O+"' target='_blank'>link</a>";}if(e.notNull(J)){K.updated=J;}if(e.notNull(L)){K.content=L;
}if(e.notNull(M)){K.summary=M;}var T=new e.Feature(I,R,{attributes:K});if(P<x){x=P;}if(P>t){t=P;}if(N<w){w=N;
}if(N>s){s=N;}A.featureArray.push(T);}});A.dataLoaded=true;if(!A.featureArray||A.featureArray.length===0){return false;
}var E=e.event;var u=function(G){var F=new E.LayerEvent(E.LayerEvent.FEATURES_LOADED,A);F.mapContext=A.parentMap.getMapContext();
A.fire(E.LayerEvent.FEATURES_LOADED,F);C(G);};if(D!==v){var B=new e.geometry.Rectangle(x,w,t,s,D);B.transform(v,function(F){var G=[F.getMinX(),F.getMinY(),F.getMaxX(),F.getMaxY()];
u(G);});return true;}else{var y=[x,w,t,s];u(y);return true;}}});e.layer.DynamicTileLayer=e.layer.TileLayer.extend({initialize:function b(s,u,v){var t;
b.base.call(this,s,t=function(){var w=e.$.extend(true,{},u);if(e.notNull(v)&&(Object.prototype.toString.call(v)==="[object Object]")){try{w.serverMapRequest=v;
if(e.isNull(w.dataSource)){if(e.notNull(v.dataSource)){w.dataSource=v.dataSource;}else{if(e.notNull(v.datasource)){w.dataSource=v.datasource;
}else{e.util.Logger.warning("","datasource not specifed.");}}}if(e.isNull(w.tileServerURL)){if(e.notNull(v.baseURL)){w.tileServerURL=v.baseURL+"/omserver";
}else{e.util.Logger.warning("","tile server URL not specified.");}}}catch(x){e.util.Logger.warning("MAPVIEWER_9082","OM.layer.DynamicTileLayer.initialize");
}}if(e.isNull(w.isWMSTileLayer)){w.isDynamicTileLayer=true;}return w;}());}});e.layer.WMSTileLayer=e.layer.DynamicTileLayer.extend({initialize:function b(t,s){var u;
b.base.call(this,t,u=function(){s.isWMSTileLayer=true;return s;}());}});e.visualfilter.VisualFilter=e.Class.extend({initialize:function(){}});
e.visualfilter.DropShadow=e.visualfilter.VisualFilter.extend({initialize:function(s){this.type="DROPSHADOW";
this.angle=s&&e.notNull(s.angle)?s.angle:45;this.color=s&&e.notNull(s.color)?s.color:null;this.knockout=s&&e.notNull(s.knockout)?s.knockout:null;
this.offset=s&&e.notNull(s.offset)?s.offset:2;this.opacity=s&&e.notNull(s.opacity)?s.opacity:0.5;this.radius=s&&e.notNull(s.radius)?s.radius:2;
this.applyToLayer=s&&e.notNull(s.applyToLayer)?s.applyToLayer:true;}});e.visualfilter.Glow=e.visualfilter.VisualFilter.extend({initialize:function(s){this.type="GLOW";
this.color=s&&e.notNull(s.color)?s.color:null;this.strength=s&&e.notNull(s.strength)?s.strength:3;this.applyToLayer=s&&e.notNull(s.applyToLayer)?s.applyToLayer:true;
}});e.infowindow.InfoWindow=e.Class.extend({initialize:function(u,w){this.minX=0;this.minY=0;this.maxX=0;
this.maxY=0;var t=u.getMapContext();this.width=t.getDeviceWidth();this.height=t.getDeviceHeight();this.parentMap=u;
this.wininfo=null;this.$div=e.$("<div style='position:absolute;width:0px;height:0px;z-index:3000'></div>");
this.parentMap.$infoWinLayerDIV.append(this.$div);this.div=this.$div[0];this.infoWindows=new Array(0);
this.$infoWindow=null;this.enablePropagation=false;this.clearInterval=false;this.mouseOver=false;this.id=w;
this.idPrefix="omv2_ifw_";var s=e.event.MapEvent;u.addListener(s.I_MAP_DRAGGING,this.panEventAction);
u.addListener(s.MAP_BEFORE_REFRESH,this.refreshEventAction);u.addListener(s.I_MAP_CENTER_ZOOM,this.zoomEventAction);
u.addListener(s.MAP_RESIZED,this.resizeEventAction);u.addListener(s.MAP_DESTROY,this.destroyEventAction);
u.addListener(s.MAP_CLEAN,this.refreshEventAction);var v=this;v.infoStopPropagation=function(x){e.event.EventSource.stopEvents[x.type]=true;
};v.infoMouseMove=function(x){v.mouseOnInfoWindow=true;if(v.div){v.div.style.zIndex=3002;}v.infoStopPropagation(x);
};v.infoMouseOver=function(x){v.mouseOnInfoWindow=true;if(v.div){v.div.style.zIndex=3001;}v.infoStopPropagation(x);
};v.infoMouseOut=function(x){v.mouseOnInfoWindow=false;if(v.div){v.div.style.zIndex=3000;}v.infoStopPropagation(x);
};this.$div.bind("mousemove",v.infoMouseMove);this.$div.bind("mouseover",v.infoMouseOver);this.$div.bind("mouseout",v.infoMouseOut);
this.$div.bind("touchmove touchend mousewheel mousedown mouseover mouseout click keyup keydown keypress dblclick",this.infoStopPropagation);
},init:function(s){s=s?s:{};if(s.ellipsis===false){this.ellipsis=false;}else{this.ellipsis=true;}this.infoWidth=parseInt(s.width);
this.infoHeight=parseInt(s.height);this.background=s.background?s.background:"#F5F5F9";this.title_string=s.title?s.title:"";
this.closeButtonStyle=null;this.tailStyle=null;if(s.infoWindowStyle){if(typeof(s.infoWindowStyle)=="string"){this.infoWindowStyle={};
this.infoWindowStyle=this.toJsonCss(s.infoWindowStyle);}else{this.infoWindowStyle=s.infoWindowStyle;}if(this.infoWindowStyle["background-color"]){this.infoWindowStyle.background=this.infoWindowStyle["background-color"];
}this.background=this.infoWindowStyle.background;if(!this.infoWindowStyle||!this.infoWindowStyle.background){this.infoWindowStyle.background="#F5F5F9";
this.background="#F5F5F9";}}else{this.infoWindowStyle={};}if(s.titleStyle){if(typeof(s.titleStyle)=="string"){this.titleStyle={};
this.titleStyle=this.toJsonCss(s.titleStyle);}else{this.titleStyle=s.titleStyle;}}else{this.titleStyle={};
}if(s.contentStyle){if(typeof(s.contentStyle)=="string"){this.contentStyle={};this.contentStyle=this.toJsonCss(s.contentStyle);
}else{this.contentStyle=s.contentStyle;}}else{this.contentStyle={};}if(s.tailStyle){this.tailStyle=s.tailStyle;
}else{this.tailStyle={};}if(s.closeButtonStyle){this.closeButtonStyle=s.closeButtonStyle;}this.infoWinId=this.idPrefix+s.id+"_";
this.clearInterval=false;this.typeId=s.typeId?s.typeId:this.parentMap.mapInstanceId+"_1";this.$infoWindow=e.$("<div class='omv2_infoWindow_info' id=\""+this.infoWinId+'"></div>');
this.$container=e.$("<div></div>");},showTabInfoWindow:function(E,L,u){var y=this;y.init(u);var D=y.parentMap.getScreenLocation(E);
for(var J=0;J<y.infoWindows.length;J++){if(y.infoWinId&&y.infoWindows[J].nid==y.infoWinId){y.deleteInfoWindow(y.infoWindows[J]);
return;}if(y.typeId&&y.infoWindows[J].typeId==y.typeId){y.deleteInfoWindow(y.infoWindows[J]);}}if(!y.infoWidth){y.infoWidth=150;
}if(!y.infoHeight){y.infoHeight=50;}y.getPageDirection();y.$infoWindow.css({background:"none repeat scroll 0 0 "+y.background,width:y.infoWidth,height:y.infoHeight});
y.$infoWindow.css(y.infoWindowStyle);y.$container.css({position:"absolute",width:y.infoWidth-5,height:y.infoHeight-3,left:"6px","z-index":"2"});
y.div.appendChild(y.$infoWindow[0]);y.createCloseButtonDiv();var I=e.$("<img class='omv2_l_arrow_info' src='"+e.gv.resourcePath()+"overflow_left_ena.png'></img>");
var z=e.$("<img class='omv2_r_arrow_info' src='"+e.gv.resourcePath()+"overflow_right_ena.png'></img>");
if(!y.pageDirection){z.css({right:"0px",top:"14px"});I.css({left:"12px",top:"14px"});z.bind("click touchstart",function(){I.css({visibility:"visible"});
B.css({right:parseInt(B.css("right"))-60});if(parseInt(B.css("right"))<=-(L.length-1)*60){z.css({visibility:"hidden"});
}}).mouseover(function(){e.$(this)[0].src=e.gv.resourcePath()+"overflow_right_ovr.png";}).mouseout(function(){e.$(this)[0].src=e.gv.resourcePath()+"overflow_right_ena.png";
});I.bind("click touchstart",function(){z.css({visibility:"visible"});B.css({right:parseInt(B.css("right"))+60});
if(parseInt(B.css("right"))>=0){I.css({visibility:"hidden"});z.css({visibility:"visible"});}}).mouseover(function(){e.$(this)[0].src=e.gv.resourcePath()+"overflow_left_ovr.png";
}).mouseout(function(){e.$(this)[0].src=e.gv.resourcePath()+"overflow_left_ena.png";});}else{z.css({right:"10px",top:"14px"});
I.css({left:"0px",top:"14px"});z.bind("click touchstart",function(){I.css({visibility:"visible"});B.css({left:parseInt(B.css("left"))-60});
if(parseInt(B.css("left"))<=-(L.length-1)*60){z.css({visibility:"hidden"});}}).mouseover(function(){e.$(this)[0].src=e.gv.resourcePath()+"overflow_right_ovr.png";
}).mouseout(function(){e.$(this)[0].src=e.gv.resourcePath()+"overflow_right_ena.png";});I.bind("click touchstart",function(){z.css({visibility:"visible"});
B.css({left:parseInt(B.css("left"))+60});if(parseInt(B.css("left"))>=0){I.css({visibility:"hidden"});
z.css({visibility:"visible"});}}).mouseover(function(){e.$(this)[0].src=e.gv.resourcePath()+"overflow_left_ovr.png";
}).mouseout(function(){e.$(this)[0].src=e.gv.resourcePath()+"overflow_left_ena.png";});}var s=this.infoWinId+"tabs";
var M=this.infoWinId+"tab_";var F=this.infoWinId+"subTab_";var G=e.$("<div class='omv2_tabDiv_info'></div>");
var B=e.$("<div class='omv2_tab_info' id='"+s+"'></div>");var C;var A;var x;if(L.length===0){C=e.$("<div class='omv2_tab_select_info' name='#tab'>sample</div>");
C.data("ts","sample");B[0].appendChild(C[0]);}else{for(J=0;J<L.length;J++){var t;if(J===0){t="omv2_tab_select_info";
}else{t="omv2_tab_unselect_info";}if(!y.pageDirection){A=e.$("<div id='"+F+J+"' class='"+t+"' style='text-align:right;text-indent:6px;right:"+60*J+"px' name='#tab"+J+"'>"+L[J].title+"</div>");
}else{A=e.$("<div id='"+F+J+"' class='"+t+"' style='left:"+60*J+"px' name='#tab"+J+"'>"+L[J].title+"</div>");
}A.data("ts",L[J].title);if(!e.browser.touchSupported){y.tipLengthAdjust(A,60);}B[0].appendChild(A[0]);
}}if(!y.pageDirection){B.css({right:"0px"});}y.createTip(B.find("div"));var K=this.infoWinId+"content";
var v=e.$("<div id='"+K+"' class='omv2_defaultContent_info'></div>");if(L.length===0){x=e.$("<div id='"+M+"' style='margin-top:5px;'> <h2>tab sample</h2>  </div>");
v[0].appendChild(x[0]);}else{for(J=0;J<L.length;J++){if(!y.pageDirection){x=e.$("<div id='"+M+J+"' style='text-align:right;margin-top:5px;'> "+L[J].content+"  </div>");
}else{x=e.$("<div id='"+M+J+"' style='margin-top:5px;'> "+L[J].content+"  </div>");}v[0].appendChild(x[0]);
}}y.createGeneralDiv();y.$infoWindow[0].appendChild(z[0]);y.$infoWindow[0].appendChild(I[0]);y.infoWindows.push(y.$infoWindow);
y.$infoWindow.nid=y.infoWinId;y.$infoWindow.typeId=y.typeId;y.$infoWindow.winX=D.x;y.$infoWindow.winY=D.y;
G[0].appendChild(B[0]);y.$container[0].appendChild(G[0]);y.$container[0].appendChild(v[0]);y.$infoWindow[0].appendChild(y.$container[0]);
for(J=0;J<L.length;J++){y.touchscroll("subtab"+J);}y.touchscroll("content");G.css({width:y.$infoWindow.width()-38});
if(!y.pageDirection){G.css({right:"12px"});}else{G.css({left:"8px"});}if(L.length*60<y.$infoWindow.width()){I.css({visibility:"hidden"});
z.css({visibility:"hidden"});}else{I.css({visibility:"hidden"});}v.css({position:"absolute",top:G.height(),height:y.infoHeight-G.height(),width:y.$infoWindow.width()-12,overflow:"auto"});
v.css(y.contentStyle);if(v.find("a").length>0){v.find("a").bind("touchstart",function(){h.location.href=v.find("a").attr("href");
});}var w=y.checkInfoWindowOverLayer(y,y.$infoWindow,D);if(!y.pageDirection){y.$infoWindow.css({left:w.x+y.$infoWindow.width(),top:w.y,visibility:"visible"});
}else{y.$infoWindow.css({left:w.x,top:w.y,visibility:"visible"});}y.tabControl();e.$("#tabs").find("div").mouseover(function(){e.$(this).css({cursor:"pointer"});
});v.mouseover(function(){e.$(this).css({cursor:"default"});});if(e.notNull(u)&&e.notNull(u.activeIndex)){e.$("#tabs div[name=#tab"+(u.activeIndex-1)+"]").click();
for(J=0;J<(u.activeIndex-1);J++){}}},showInfoWindow:function(w,y,A){var u=this;u.init(A);if(y.wraparoundMapIndex){y=u.parentMap.getACL(y,y.wraparoundMapIndex);
}u.screenLoc=u.parentMap.getScreenLocation(y);for(var t=0;t<u.infoWindows.length;t++){if(u.infoWinId&&u.infoWindows[t].nid==u.infoWinId){u.deleteInfoWindow(u.infoWindows[t]);
}else{if(u.typeId&&u.infoWindows[t].typeId==u.typeId){u.deleteInfoWindow(u.infoWindows[t]);}}}u.getPageDirection();
u.infoWindows.push(u.$infoWindow);u.$infoWindow.nid=u.infoWinId;u.$infoWindow.typeId=u.typeId;u.$infoWindow.winX=u.screenLoc.x;
u.$infoWindow.winY=u.screenLoc.y;u.createCloseButtonDiv();var z=u.initCss(w);var x=z[0];var s=z[1];u.calculatePosition(x,s,u.screenLoc,A);
var v=setInterval(function(){if(u.$closeButton&&x&&s){clearInterval(v);u.titleContentCloseAdjust(x,s,u.$closeButton);
}},10);},initCss:function(w){var x=this.infoWinId+"content";var u=this;var v=this.infoWinId+"title";var t=e.$("<div id='"+v+"' class='omv2_defaultTitle_info'>"+u.title_string.replace(/[ ]/g,"&nbsp;")+"</div>");
var s=e.$("<div id='"+x+"' class='omv2_defaultContent_info'>"+w+"</div>");u.$infoWindow.css({width:u.infoWidth,height:u.infoHeight});
u.$infoWindow.css(u.infoWindowStyle);u.$container.css({position:"absolute",width:u.infoWidth-5,height:u.infoHeight-3,"z-index":"2"});
u.div.appendChild(u.$infoWindow[0]);if(!u.pageDirection){t.css({right:"5px","text-align":"right"});}else{t.css({left:"5px"});
}u.$container[0].appendChild(t[0]);u.$container[0].appendChild(s[0]);u.$infoWindow[0].appendChild(u.$container[0]);
s.css({top:parseInt(t.height())+2,height:"",width:""});if(u.infoWidth){if(u.title_string!==""){s.css({width:u.$infoWindow.width()-10});
}else{s.css({width:u.$infoWindow.width()-20});}}if(u.infoHeight){if(u.title_string!==""){s.css({height:u.$infoWindow.height()-t.height()-3});
}else{s.css({height:u.$infoWindow.height()-3});}}s.css(u.contentStyle);if(s.find("a").length>0){s.find("a").bind("touchstart",function(){h.location.href=s.find("a").attr("href");
});}u.touchscroll("content");if(!u.pageDirection){s.css({right:"5px"});}else{s.css({left:"5px","margin-right":"5px"});
}t.data("ts",t.html());if(u.titleStyle.width&&!e.browser.touchSupported){u.tipLengthAdjust(t,parseInt(u.titleStyle.width)-20);
}if(u.$infoWindow.width()>1){t.width(u.$infoWindow.width()-20);}t.css(u.titleStyle);u.touchscroll("title");
s.mouseover(function(){e.$(this).css({cursor:"default"});});t.mouseover(function(){e.$(this).css({cursor:"default"});
});if(u.title_string===""){t.width("0px");t.height("0px");}return[t,s];},infoResize:function(y,u,w,t){var x=this;
var v=x.height-w.y;var s=x.width-w.x;if(x.$infoWindow.height()>v-20&&x.$infoWindow.height()>w.y-20&&((parseInt(x.$infoWindow.css("top"))+x.$infoWindow.height()>x.height)||parseInt(x.$infoWindow.css("top"))<0)||x.$infoWindow.width()>s-20&&x.$infoWindow.width()>w.x-20){x.infoDomResize(y,u,w);
if(x.$infoWindow.height()>v-20&&x.$infoWindow.height()>w.y-20&&((parseInt(x.$infoWindow.css("top"))+x.$infoWindow.height()>x.height)||parseInt(x.$infoWindow.css("top"))<0)){if(v>=w.y){if(parseInt(x.$infoWindow.css("top"))<0){u.height(v-60);
if(e.browser.firefox&&x.title_string!==""){u.width(u.width()+45);}else{u.width(u.width()+25);}if(x.title_string!==""){x.$infoWindow.width(u.width()+11);
}else{x.$infoWindow.width(u.width()+20);}x.$infoWindow.height(v+5-60);}else{u.height(v);if(e.browser.firefox&&x.title_string!==""){u.width(u.width()+45);
}else{u.width(u.width()+25);}if(x.title_string!==""){x.$infoWindow.width(u.width()+11);}else{x.$infoWindow.width(u.width()+20);
}x.$infoWindow.height(v+5);}}else{if(v<50){u.height(w.y-60);if(e.browser.firefox&&x.title_string!==""){u.width(u.width()+45);
}else{u.width(u.width()+25);}if(x.title_string!==""){x.$infoWindow.width(u.width()+11);}else{x.$infoWindow.width(u.width()+20);
}x.$infoWindow.height(w.y+5-60);}else{u.height(w.y);if(e.browser.firefox&&x.title_string!==""){u.width(u.width()+45);
}else{u.width(u.width()+25);}if(x.title_string!==""){x.$infoWindow.width(u.width()+11);}else{x.$infoWindow.width(u.width()+20);
}x.$infoWindow.height(w.y+5);}}}if(x.$infoWindow.width()>s-20&&x.$infoWindow.width()>w.x-20){if(s>=w.x){u.width(s-40);
x.$infoWindow.width(s-40+20);}else{u.width(w.x-40);x.$infoWindow.width(w.x-40+20);}}if(y.height()+u.height()-x.$infoWindow.height()>=5){x.$infoWindow.height(y.height()+u.height()+5);
}if(t&&e.notNull(t.title)){if(y.width()>x.$infoWindow.width()-20){y.width(x.$infoWindow.width()-20);}if(!e.browser.touchSupported){x.tipLengthAdjust(y,parseInt(x.$infoWindow.width())-19);
}}if(x.$infoWindow.height()<30){x.checkMinHeightInfowindow(y,u);}x.adjustInfowindowLayout(x,w);x.clearInterval=true;
}},infoDomResize:function(v,s,t){var u=this;if(s.width()>u.$infoWindow.width()){u.$infoWindow.width(s.width()+20);
u.$infoWindow[0].removeChild(u.$hideDiv[0]);u.$infoWindow[0].removeChild(u.$fadeDiv[0]);u.$infoWindow[0].removeChild(u.$vancantDiv[0]);
u.createGeneralDiv();u.adjustInfowindowLayout(u,t);u.clearInterval=true;}if(s.height()>u.$infoWindow.height()-v.height()){if(v.height()===0){s.css({width:u.$infoWindow.width()-19});
s.height(s.height());u.$infoWindow.height(s.height()+parseInt(v.css("top"))+2);}else{s.css({width:u.$infoWindow.width()-11});
u.$infoWindow.height(s.height()+v.height()+parseInt(v.css("top"))+2);}if(u.$infoWindow.height()<30){u.checkMinHeightInfowindow(v,s);
}u.$infoWindow[0].removeChild(u.$hideDiv[0]);u.$infoWindow[0].removeChild(u.$fadeDiv[0]);u.$infoWindow[0].removeChild(u.$vancantDiv[0]);
u.createGeneralDiv();u.adjustInfowindowLayout(u,t);u.clearInterval=true;}},setInfoSize:function(u,s){var t=this;
if(t.infoWidth){if(u.width()>t.$infoWindow.width()-20){u.width(t.$infoWindow.width()-20);}if(t.title_string!==""){if(s.width()>t.$infoWindow.width()-10){s.width(t.$infoWindow.width()-10);
}}else{if(s.width()>t.$infoWindow.width()-20){s.width(t.$infoWindow.width()-20);}}if(!e.browser.touchSupported&&(e.isNull(t.titleStyle.width)||t.titleStyle.width>=t.infoWidth||t.titleStyle.width==="")){t.tipLengthAdjust(u,parseInt(t.$infoWindow.width())-20);
}}else{if(u.width()+6>s.width()){u.width(u.width()+6);if(u.width()>1.5*s.width()&&t.ellipsis){u.width(1.5*s.width());
}t.$infoWindow.width(u.width()+20);if(!t.contentStyle.width){s.width(u.width());}}else{if(t.title_string!==""){t.$infoWindow.width(s.width()+11);
}else{t.$infoWindow.width(s.width()+20);}if(!t.titleStyle.width&&t.title_string!==""){u.width(s.width()-10);
}}if(t.$infoWindow.width()<120){t.checkMinWidthInfowindow(u,s);}if(!e.browser.touchSupported){t.tipLengthAdjust(u,parseInt(t.$infoWindow.width())-18);
}}if(t.infoHeight){if(u.height()>t.$infoWindow.height()-2){u.height(t.$infoWindow.height());}if(s.height()>t.infoHeight-parseInt(u.height())){s.height(t.infoHeight-parseInt(u.height())-3);
}s.css({top:parseInt(u.height())+2});}else{t.$infoWindow.height(s.height()+u.height()+parseInt(u.css("top"))+2);
if(t.$infoWindow.height()<30){t.checkMinHeightInfowindow(u,s);}s.css({top:parseInt(u.height())+2});}},checkMinWidthInfowindow:function(u,s){var t=this;
t.$infoWindow.width("120px");if(t.title_string!==""){u.width("100px");s.width("110px");}else{s.width("100px");
}},checkMinHeightInfowindow:function(u,s){var t=this;t.$infoWindow.height("30px");s.height(30-parseInt(u.height())-3);
},calculatePosition:function(y,u,t,A){var w=this;w.setInfoSize(y,u);w.createGeneralDiv();w.t_h=y.height();
if((e.browser.chrome||e.browser.touchSupported)&&u.find("img").length===0&&w.$infoWindow.width()-u.width()<6){u.width(u.width()-1);
}var x=0;if((!w.infoHeight||!w.infoWidth)){if(e.isNull(w.contentStyle.width)||e.isNull(w.contentStyle.height)){var z=setInterval(function(){if(w.$infoWindow.width()<=121){w.checkMinWidthInfowindow(y,u);
}else{if(!w.infoWidth){u.width("");}}if(w.$infoWindow.height()<=30){w.checkMinHeightInfowindow(y,u);}else{if(!w.infoHeight){u.height("");
}}if((e.browser.chrome||e.browser.touchSupported)&&u.find("img").length===0&&w.$infoWindow.width()-u.width()<6){u.width(u.width()-1);
}x++;if(x>20){clearInterval(z);}w.infoDomResize(y,u,t);w.infoResize(y,u,t,A);if(w.clearInterval){clearInterval(z);
if(w.title_string!==""){y.width(w.$infoWindow.width()-20);y.html(y.data("ts"));if(!e.browser.touchSupported){w.tipLengthAdjust(y,parseInt(w.$infoWindow.width())-19);
}}}if(w.title_string!==""&&y.width()>u.width()){u.width(y.width());}w.$infoWindow.css({visibility:"visible"});
},100);}}var s=0;var v=setInterval(function(){s++;w.infoResize(y,u,t,A);if(s>20||w.clearInterval){clearInterval(v);
if(u.find("img").length!==0){u.height(w.$infoWindow.height()-y.height()-3);}}},100);if(e.browser.chrome&&u.find("img").length){u.find("img").load(function(){u.width(e.$("#content").children().first().width()+25);
w.infoDomResize(y,u,t);});}w.adjustInfowindowLayout(w,t);if(!w.infoHeight||!w.infoWidth){if((e.isNull(w.contentStyle.width)||e.isNull(w.contentStyle.height))){w.$infoWindow.css({visibility:"hidden"});
}}w.createTip(y);},adjustInfowindowLayout:function(u,t){var s=u.checkInfoWindowOverLayer(u,u.$infoWindow,t);
if(!u.pageDirection){u.$infoWindow.css({left:s.x+u.$infoWindow.width(),top:s.y,visibility:"visible"});
}else{u.$infoWindow.css({left:s.x,top:s.y,visibility:"visible"});}},titleContentCloseAdjust:function(y,s,t){var B;
var w=this;if(y.width()>s.width()){B=y.width();}else{B=s.width();}if(s.width()==w.$infoWindow.width()-10){B=y.width();
}var A=parseInt(t.width());var u=parseInt(t.height());var z;var x;if(this.closeButtonStyle){z=parseInt(this.closeButtonStyle.xOffset);
x=parseInt(this.closeButtonStyle.yOffset);}else{z=0;x=0;}if(!z){z=0;}if(!x){x=0;}if((w.$infoWindow.width()-B)<(t.width()+parseInt(t.css("right")))){if(this.pageDirection){t.css({right:w.$infoWindow.width()-B-6-t.width()});
}else{t.css({left:w.$infoWindow.width()-B-6-t.width()});}}if(w.$infoWindow.width()-B-6-t.width()<0){if(this.pageDirection){t.css({right:"0"});
}else{t.css({left:"0"});}}if((w.$infoWindow.width()-B)<=(t.width())){t.width(w.$infoWindow.width()-B-6);
}else{if((w.$infoWindow.width()-B)<21){if(this.pageDirection){t.css({right:"0"});}else{t.css({left:"0"});
}t.width("14px");}}if((t.height()+parseInt(t.css("top")))>w.$infoWindow.height()){t.css({top:w.$infoWindow.height()-t.height()});
}if(t.height()>w.$infoWindow.height()-parseInt(t.css("top"))){t.height(w.$infoWindow.height()-parseInt(t.css("top")));
}if(t.height()>w.$infoWindow.height()){t.css({top:"0"});t.height(w.$infoWindow.height());}if((A+z)<w.$infoWindow.width()-B){if(this.pageDirection){t.css({right:z+"px"});
}else{t.css({left:z+"px"});}t.width(A);}if((A+z)>=w.$infoWindow.width()-B&&A<w.$infoWindow.width()-B){if(this.pageDirection){t.css({right:(w.$infoWindow.width()-B-A-6)+"px"});
}else{t.css({left:(w.$infoWindow.width()-B-A-6)+"px"});}t.width(A);}if((u+x)<w.$infoWindow.height()){t.css({top:x+"px"});
t.height(u);}if((u+x)>=w.$infoWindow.height()&&u<w.$infoWindow.height()){t.css({top:(w.$infoWindow.height()-u-6)+"px"});
t.height(u);}if(w.$infoWindow.width()-s.width()<=11){if((A+z)<w.$infoWindow.width()-y.width()-5){if(this.pageDirection){t.css({right:z+"px"});
}else{t.css({left:z+"px"});}t.width(A);}else{if((A+z)>=w.$infoWindow.width()-y.width()-5&&A<w.$infoWindow.width()-y.width()-5){if(this.pageDirection){t.css({right:(w.$infoWindow.width()-y.width()-5-A)+"px"});
}else{t.css({left:(w.$infoWindow.width()-y.width()-5-A)+"px"});}t.width(A);}else{if(this.pageDirection){t.css({right:"0px"});
}else{t.css({left:"0px"});}t.width("14px");}}if((u+x)<y.height()){t.css({top:x+"px"});t.height(u);}else{if((u+x)>=y.height()&&u<y.height()){t.css({top:(y.height()-u)+"px"});
t.height(u);}else{t.css({top:"0px"});t.height("14px");}}}if(!w.infoHeight&&!w.infoWidth&&!w.contentStyle.width&&!w.contentStyle.height&&!w.titleStyle.width&&!w.titleStyle.height){if(this.pageDirection){t.css({right:"0px"});
}else{t.css({left:"0px"});}t.width("14px");t.css({top:"0px"});t.height("14px");}},tipLengthAdjust:function(t,u){var y;
if(t.attr("class")!="omv2_defaultTitle_info"){y=e.$("<div class='omv2_temp_info' >"+t.html()+"</div>");
this.$infoWindow[0].appendChild(y[0]);if(y.width()>u){for(var w=y.html().length-1;w>-1;w--){var x=y.html();
if(y.width()<u){t.html(y.html().substring(0,y.html().length-3)+"...");break;}y.html(x.substring(0,w));
}}}else{y=e.$("<div class='omv2_temp_info' >"+t.text()+"</div>");y.css({"font-size":"16px","font-family":"Tahoma","font-weight":"bold"});
if(this.titleStyle["font-size"]){y.css({"font-size":this.titleStyle["font-size"]});}if(this.titleStyle["font-family"]){y.css({"font-family":this.titleStyle["font-family"]});
}if(this.titleStyle["font-weight"]){y.css({"font-weight":this.titleStyle["font-weight"]});}this.$infoWindow[0].appendChild(y[0]);
if(y.width()>u){y.html("...");for(var v=0;v<t.text().length;v++){if(y.width()>u){t.html(y.text());break;
}y.html(t.text().substring(0,v)+"...");}}}},createCloseButtonDiv:function(){var s=this;if(this.closeButtonStyle&&this.closeButtonStyle.mouseOutButton&&this.closeButtonStyle.mouseOutButton.src){s.$closeButton=e.$("<img class='omv2_closeButton_info' src='"+this.closeButtonStyle.mouseOutButton.src+"'></img>");
}else{s.$closeButton=e.$("<img class='omv2_closeButton_info' src='"+e.gv.resourcePath()+"close_en.png'></img>");
}if(!this.pageDirection){s.$closeButton.css({left:"0"});if(this.closeButtonStyle&&this.closeButtonStyle.xOffset){s.$closeButton.css({left:this.closeButtonStyle.xOffset});
}if(this.closeButtonStyle&&this.closeButtonStyle.yOffset){s.$closeButton.css({top:this.closeButtonStyle.yOffset});
}}else{s.$closeButton.css({right:"0"});if(this.closeButtonStyle&&this.closeButtonStyle.xOffset){s.$closeButton.css({right:this.closeButtonStyle.xOffset});
}if(this.closeButtonStyle&&this.closeButtonStyle.yOffset){s.$closeButton.css({top:this.closeButtonStyle.yOffset});
}}if(e.browser.touchSupported){s.$closeButton.bind("touchstart",function(){s.deleteInfoWindow(s.infoWindows[0]);
return false;});}s.$closeButton.click(function(){s.deleteInfoWindow(s.infoWindows[0]);return false;}).mouseover(function(){if(s.closeButtonStyle&&s.closeButtonStyle.mouseOverButton&&s.closeButtonStyle.mouseOverButton.src){e.$(this)[0].src=s.closeButtonStyle.mouseOverButton.src;
}else{e.$(this)[0].src=e.gv.resourcePath()+"close_ov.png";}}).mouseout(function(){if(s.closeButtonStyle&&s.closeButtonStyle.mouseOutButton&&s.closeButtonStyle.mouseOutButton.src){e.$(this)[0].src=s.closeButtonStyle.mouseOutButton.src;
}else{e.$(this)[0].src=e.gv.resourcePath()+"close_en.png";}});if(this.closeButtonStyle&&this.closeButtonStyle.width){s.$closeButton.width(this.closeButtonStyle.width);
}if(this.closeButtonStyle&&this.closeButtonStyle.height){s.$closeButton.height(this.closeButtonStyle.height);
}this.$infoWindow[0].appendChild(s.$closeButton[0]);},createGeneralDiv:function(){var t=this;var w=e.$("<div class='omv2_tail_info'></div>");
var v=e.$("<div></div>");var u=e.$("<div style='position:absolute;overflow:hidden;border:0px solid black;'></div>");
var s=e.$("<div style='z-index:3001;position:absolute;background:"+this.background+"'></div>");v.css({position:"absolute",background:this.background,"z-index":"1","border-radius":"5px 5px 5px 5px"});
if(!this.infoWindowStyle||!this.infoWindowStyle.border){v.css({width:"1px"});}else{v.css({width:(parseInt(this.infoWindowStyle.border.split(" ")[0])+1)+"px"});
}w.width("25px");w.height("25px");if(t.$infoWindow.height()<60){w.width("15px");w.height("15px");}if(this.tailStyle){w.css(this.tailStyle);
if(this.tailStyle.offset!==""){w.width(this.tailStyle.offset);w.height(this.tailStyle.offset);}}if(1.414*w.width()>t.$infoWindow.width()){w.width(t.$infoWindow.width());
w.height(w.width());}if(1.414*w.height()>t.$infoWindow.height()){w.height((t.$infoWindow.height()-25)*0.707);
w.width(w.height());}if(w.width()>130||w.height()>130){w.width("130px");w.height("130px");}u.width(parseInt(w.width())*0.707+3);
u.height(parseInt(w.height())*1.414+3);u[0].appendChild(w[0]);t.$infoWindow[0].appendChild(s[0]);t.$infoWindow[0].appendChild(u[0]);
t.$infoWindow[0].appendChild(v[0]);this.$tail=w;this.$hideDiv=u;this.$fadeDiv=v;this.$vancantDiv=s;},createTip:function(s){var u=e.$("<span class='omv2_tip_info'></span>");
this.$infoWindow[0].appendChild(u[0]);var t;var w;var v;s.mouseover(function(){var y=this;t=false;var x;
if(s.parent().attr("class")=="omv2_tab_info"){x=e.$(y).position().left+parseInt(s.parent().css("left"))+30;
}else{x=e.$(y).position().left+30;}w=setTimeout(function(){t=true;},1000);v=setInterval(function(){if(t){if(e.$(y).data("ts")){u.html(e.$(y).data("ts").replace(/[ ]/g,"&nbsp;"));
}else{u.html(e.$(y).data("ts").replace(/[ ]/g,"&nbsp;"));}u.css({display:"block",left:x});}},100);if(e.$(this)[0].id!="current"&&s.parent().attr("class")=="omv2_tab_info"){e.$(this).css({background:"#2F4F4F",color:"#9cd9fe"});
}}).mouseout(function(){t=false;clearTimeout(w);clearInterval(v);u.css({display:"none"});if(e.$(this)[0].id!="current"&&s.parent().attr("class")=="omv2_tab_info"){e.$(this).css({background:"#2F4F4F",color:"#e9f6fe"});
}});},panEventAction:function(y){var v=y.target.infoLayer;if(v.$div){var s=parseInt(v.$infoWindow[0].style.left);
var u=parseInt(v.$infoWindow[0].style.top);var x=isNaN(u)?0:u;var w=isNaN(s)?0:s;v.$infoWindow.css({left:w+y.xOffset,top:x+y.yOffset});
v.screenLoc.x=v.screenLoc.x+y.xOffset;v.screenLoc.y=v.screenLoc.y+y.yOffset;}},refreshEventAction:function(s){var t=s.target.infoLayer;
t.deleteInfoWindow();},zoomEventAction:function(s){var t=s.target.infoLayer;t.closeInfoWindows();},destroyEventAction:function(s){var t=s.target.infoLayer;
if(e.isNotNull(t)){t.destroy();}},resizeEventAction:function(t){var u=t.target.infoLayer;u.closeInfoWindows();
var s=u.parentMap.getMapContext();u.width=s.getDeviceWidth();u.height=s.getDeviceHeight();},deleteInfoWindow:function(t){var s=0;
for(s=0;s<this.infoWindows.length;s++){if(this.infoWindows[s]==t){this.infoWindows.splice(s,1);}}this.$div.off("mouseover mouseout mousedown mouseup click touchend","**");
this.$div.empty();this.mouseOnInfoWindow=false;},closeInfoWindows:function(){for(var t=0,s=this.infoWindows.length;
t<s;t++){this.deleteInfoWindow(this.infoWindows[t]);}},checkInfoWindowOverLayer:function(z,t,s){if(!this.tailStyle||!this.tailStyle.border){this.tailStyle.border="1px solid #c3d0df";
}var A=t.width();var v=t.height();var u=z.width;var x=z.height;var D=s.x;var C=s.y;var B=true;var y=true;
if(D>u/2){B=false;}if(C<x/2){y=false;}if(y){if(v<=80){this.$hideDiv.css({bottom:v/10+"px"});}else{this.$hideDiv.css({bottom:"25px"});
}C=C+parseInt(this.$hideDiv.css("bottom"))-v+this.$hideDiv.height()/2-1;}else{if(v<=80){this.$hideDiv.css({top:v/7.5+"px"});
}else{this.$hideDiv.css({top:"25px"});}C=C-parseInt(this.$hideDiv.css("top"))-this.$hideDiv.height()/2-1;
}if(B){this.$tail.css({right:-this.$hideDiv.width()*0.707,top:this.$tail.width()*0.2});this.$hideDiv.css({left:-this.$hideDiv.width()+1});
this.$vancantDiv.height(v-10);this.$vancantDiv.css({left:"0px",width:"3px",top:"5px"});D=D+this.$tail.width()*0.707-2;
t.css({"box-shadow":"5px 5px 5px rgba(0,0,0,0.5)"});this.$tail.css({"box-shadow":"3px 3px 3px rgba(0,0,0,0.5)"});
}else{if(this.pageDirection){this.$tail.css({left:-this.$hideDiv.width()*0.707,top:this.$tail.width()*0.2});
}else{this.$tail.css({right:this.$hideDiv.width()*0.707/2,top:this.$tail.width()*0.2});}this.$hideDiv.css({right:-this.$hideDiv.width()+1});
this.$vancantDiv.height(v-10);this.$vancantDiv.css({right:"0px",width:"3px",top:"5px"});D=D-A-this.$tail.width()*0.707;
t.css({"box-shadow":"-5px 5px 5px rgba(0,0,0,0.5)"});this.$tail.css({"box-shadow":"3px 3px 3px rgba(0,0,0,0.5)"});
}if(x>(s.y+v+20)||(s.y-v-20)>0){if((x-C-v)<0&&B){this.$hideDiv.width(parseInt(this.$tail.height())*1.414+3);
this.$hideDiv.height(parseInt(this.$tail.width())*0.707+3);if(this.pageDirection){this.$tail.css({top:-this.$hideDiv.height()*0.707,left:this.$tail.width()*0.2});
}else{this.$tail.css({top:-this.$hideDiv.height()*0.707,right:this.$tail.width()*0.2});}this.$hideDiv.css({bottom:-this.$hideDiv.height()+1});
this.$vancantDiv.width(A-10);this.$vancantDiv.css({bottom:"0px",height:"3px",left:"5px",top:""});if(v<=80){C=C-this.$hideDiv.height()-v/10-this.$hideDiv.width()/2+1;
}else{C=C-this.$hideDiv.height()-25-this.$hideDiv.width()/2+1;}this.$hideDiv.css({left:"20px"});D=D-20-this.$hideDiv.width()/2-this.$hideDiv.width()/2+2;
t.css({"box-shadow":"5px -5px 5px rgba(0,0,0,0.5)"});this.$tail.css({"box-shadow":"3px -3px 3px rgba(0,0,0,0.5)"});
}else{if((x-C-v)<0&&!B){this.$hideDiv.width(parseInt(this.$tail.height())*1.414+3);this.$hideDiv.height(parseInt(this.$tail.width())*0.707+3);
this.$tail.css({top:-this.$hideDiv.height()*0.707,left:this.$tail.width()*0.2});this.$hideDiv.css({bottom:-this.$hideDiv.height()+1});
this.$vancantDiv.width(A-10);this.$vancantDiv.css({bottom:"0px",height:"3px",right:"5px",top:""});if(v<=80){C=C-this.$hideDiv.height()-v/10-this.$hideDiv.width()/2+1;
}else{C=C-this.$hideDiv.height()-25-this.$hideDiv.width()/2+1;}this.$hideDiv.css({right:"20px"});D=D+this.$hideDiv.width()/2+this.$hideDiv.width()/2+20;
t.css({"box-shadow":"-5px -5px 5px rgba(0,0,0,0.5)"});this.$tail.css({"box-shadow":"-3px 3px 3px rgba(0,0,0,0.5)"});
}else{if(C<0&&B){this.$hideDiv.width(parseInt(this.$tail.height())*1.414+3);this.$hideDiv.height(parseInt(this.$tail.width())*0.707+3);
if(this.pageDirection){this.$tail.css({top:this.$tail.width()*0.28,left:this.$tail.width()*0.2});}else{this.$tail.css({top:this.$tail.width()*0.28,right:this.$tail.width()*0.2});
}this.$hideDiv.css({top:-this.$hideDiv.height()+1});this.$vancantDiv.width(A-10);this.$vancantDiv.css({top:"0px",height:"3px",left:"5px",bottom:""});
if(v<=80){C=C+v/7.5+this.$hideDiv.height()+this.$hideDiv.width()/2+1-5;}else{C=C+25+this.$hideDiv.height()+this.$hideDiv.width()/2+1-5;
}this.$hideDiv.css({left:"20px"});D=D-20-this.$hideDiv.width()/2-this.$hideDiv.width()/2+2;t.css({"box-shadow":"5px 5px 5px rgba(0,0,0,0.5)"});
this.$tail.css({"box-shadow":"3px -3px 3px rgba(0,0,0,0.5)"});}else{if(C<0&&!B){this.$hideDiv.width(parseInt(this.$tail.height())*1.414+3);
this.$hideDiv.height(parseInt(this.$tail.width())*0.707+3);this.$tail.css({top:this.$tail.width()*0.28,left:this.$tail.width()*0.2});
this.$hideDiv.css({top:-this.$hideDiv.height()+1});this.$vancantDiv.width(A-10);this.$vancantDiv.css({top:"0px",height:"3px",right:"5px",bottom:""});
if(v<=80){C=C+v/7.5+this.$hideDiv.height()+this.$hideDiv.width()/2+1-6;}else{C=C+25+this.$hideDiv.height()+this.$hideDiv.width()/2+1-6;
}this.$hideDiv.css({right:"20px"});D=D+this.$hideDiv.width()/2+this.$hideDiv.width()/2+20;t.css({"box-shadow":"-5px 5px 5px rgba(0,0,0,0.5)"});
this.$tail.css({"box-shadow":"-3px 3px 3px rgba(0,0,0,0.5)"});}}}}if(u<D+A){}if(D<0){}}return{x:D,y:C};
},destroy:function(){if(e.isNull(this.$div)){return;}this.deleteInfoWindow();this.$div.unbind("mousewheel mousedown mouseup mouseover mouseout click keyup keydown keypress",this.infoStopPropagation);
this.$div.unbind("mousemove",this.infoMouseMove);this.$div.unbind("mouseover",this.infoMouseOver);this.$div.unbind("mouseout",this.infoMouseOut);
this.infoStopPropagation=null;this.infoMouseMove=null;this.infoMouseOver=null;this.infoMouseOut=null;
e.$(this.infoTip).empty();this.infoTip=null;this.div=null;this.$div=null;this.infoWindows=null;this.wininfo=null;
},getPageDirection:function(){var v=document.createElement("table");var t=document.createElement("tr");
var s=document.createElement("td");var x=document.createElement("td");var u=document.createElement("tbody");
v.cellSpacing=0;v.cellPadding=0;s.innerHTML="fsdfsds";x.innerHTML="p";u.appendChild(t);v.appendChild(u);
t.appendChild(s);t.appendChild(x);this.div.appendChild(v);var w=s.offsetLeft;if(w===0){this.pageDirection=true;
}else{this.pageDirection=false;}this.div.removeChild(v);},touchscroll:function(u){var t;var s;if(e.browser.touchSupported){document.getElementById(u).addEventListener("touchstart",function(v){t=v.targetTouches[0].pageX;
s=v.targetTouches[0].pageY;},false);document.getElementById(u).addEventListener("touchmove",function(x){x.preventDefault();
var w=(t-x.targetTouches[0].pageX),v=(s-x.targetTouches[0].pageY);this.scrollLeft+=w;this.scrollTop+=v;
},false);}},tabControl:function(){function s(){e.$("#content > div").hide();e.$("#tabs div").attr("id","");
e.$("#tabs div").removeClass("omv2_tab_select_info");e.$("#tabs div").addClass("omv2_tab_unselect_info");
e.$("#tabs div").css({color:e.$("#tabs div:first").css("color")});}(function(){e.$("#content > div").hide();
e.$("#tabs div:first").attr("id","current");e.$("#content > div:first").fadeIn();e.$("#tabs div").bind("click touchstart",function(t){t.preventDefault();
if(e.$(this).attr("id")=="current"){return;}else{s();e.$(this).attr("id","current");e.$(e.$(this).attr("name")).fadeIn();
e.$(this).removeClass("omv2_tab_unselect_info");e.$(this).addClass("omv2_tab_select_info");}});})();},toJsonCss:function(u){var t={};
var w=u.split(";");for(var v=0;v<w.length;v++){var s=w[v].split(":");t[s[0]]=s[1];}return t;},deleteInfoWindows:function(){if(this.infoWindows&&this.infoWindows.length>0){this.infoWindows.pop();
}this.$div.off("mouseover mouseout mousedown mouseup click touchend","**");this.$div.empty();this.mouseOnInfoWindow=false;
},deleteInfoWindowById:function(v){var u="infowin_"+v;var s=this.infoWindows.length;for(var t=0;t<s;t++){if(this.infoWinId&&this.infoWindows[t].nid==u){this.deleteInfoWindow(this.infoWindows[t]);
return;}}}});e.infowindow.MVInfoWindowTab=function(t,s){this.title=t;this.content=s;};e.infowindow.MVInfoWindowTab.prototype.getTitle=function(){return this.title;
};e.infowindow.MVInfoWindowTab.prototype.getContent=function(){return this.content;};e.tool.Tool=e.Class.extend({mixin:e.event.EventSource,initialize:function(s){this._$container=s.$oracleMapDiv;
this._geometry=null;this._graphic=s.graphics;this._map=s;this._toolShape=null;this._group=null;this._style=new e.style.Line({stroke:"#000000",strokeThickness:1});
this._style.fill=s.graphics.oui.NO_PAINT;this.toolFeature=null;this.featureStyle=this._style;this.status=e.tool.Tool.STOPPED;
},start:function(){e.util.Logger.info("MAPVIEWER_9036","OM.tool.Tool.start","");},clear:function(){e.util.Logger.info("MAPVIEWER_9037","OM.tool.Tool.clear","");
},clear_base:function(){if(this._group){this._graphic.remove(this._group);this._group=null;}this._toolShape=null;
this.status=e.tool.Tool.STOPPED;if(this.toolFeature){if(this.toolFeature.deleteEditingProperties){this.toolFeature.deleteEditingProperties();
}var s=this._map.getToolFeatureLayer();if(e.isNotNull(s)){s.removeFeature(this.toolFeature);}this.toolFeature=null;
var u=e.event.ToolEvent;var t=new u(u.TOOL_CLEAR,this);this.fire(t.type,t);}},getStatus:function(){return this.status;
},getGeometry:function(){return this._geometry;},setDrawingStyle:function(s){if(!s){return this;}this._style=s.clone();
if(e.isNull(s.fill)){this._style.fill=this._map.graphics.oui.NO_PAINT;}return this;},setStyle:function(s){this.featureStyle=s.clone();
if(this.toolFeature){this.toolFeature.setRenderingStyle(this.featureStyle);}return this;}});e.tool.Tool.STOPPED=0;
e.tool.Tool.STARTED=1;e.tool.Tool.FINISHED=3;e.tool.CircleTool=e.tool.Tool.extend({initialize:function b(u){b.base.call(this,u);
this._radius=0;this._geoCenter=null;this._toPntOfCircle=null;var s=this;var w=e.event.ToolEvent;var t=null;
var v=null;this.begin=function(A){if(s.status!=e.tool.Tool.STARTED){return;}s._geoCenter=s._map.getCursorLocation();
v=A.pageX;var D=A.pageX-s._$container.offset().left;var B=A.pageY-s._$container.offset().top;var x=s._graphic.getLeftTop(s._map.draggableGroup);
var z=x.x;var C=x.y;var y={cx:D-z,cy:B-C,width:1,height:1};t={x:D,y:B};s._style.fill=s._graphic.oui.NO_PAINT;
if(!s._toolShape){s._toolShape=s._graphic.drawEllipse(y,s._style,{group:s._group});}else{s._graphic.setEllipse(s._toolShape,y);
}e.$(document).bind("mousemove",s.drawShape);if(e.browser.touchSupported){s._$container.bind("touchmove",s.drawShape_touch);
}A=new w(w.TOOL_START,s);s.fire(A.type,A);};this.begin_touch=function(z){var y=e.util.DomUtil;var x=y.getTouchCount(z);
if(x>1){return;}var A=y.getTouchesPosition(z);z.pageX=A.x;z.pageY=A.y;s.begin(z);};this.drawShape=function(A){if(s.status!=e.tool.Tool.STARTED){return;
}var D=A.pageX-s._$container.offset().left;var B=A.pageY-s._$container.offset().top;if(D<=0||B<0||D>s._map.getMapContext().getDeviceWidth()||B>s._map.getMapContext().getDeviceHeight()){s.finish();
}var C=Math.round(Math.sqrt((D-t.x)*(D-t.x)+(B-t.y)*(B-t.y)));var y=s._map.getMapContext().getUniverse().getZoomLevels()[s._map.getMapContext().getZoomLevel()].resolution;
s._radius=C*y;s._toPntOfCircle=s._map.getScreenPointLocation(D,B);var x={width:C*2,height:C*2};s._graphic.setEllipse(s._toolShape,x);
var z=new w(w.CIRCLE_DRAG,s);s.fire(z.type,z);};this.drawShape_touch=function(z){var y=e.util.DomUtil;
var x=y.getTouchCount(z);if(x>1){return;}var A=y.getTouchesPosition(z);z.pageX=A.x;z.pageY=A.y;s.drawShape(z);
};this.finish=function(x){s._map.enableMapAction.drag=true;s._map.enableMapAction.mouse=true;t=null;s._$container.unbind("mousedown",s.begin);
if(s.drawShape){e.$(document).unbind("mousemove",s.drawShape);}s._$container.unbind("mouseup",s.finish);
if(e.browser.touchSupported){s._$container.unbind("touchstart",s.begin_touch);s._$container.unbind("touchmove",s.drawShape_touch);
s._$container.unbind("touchend",s.finish);}s._graphic.remove(s._toolShape);s.status=e.tool.Tool.FINISHED;
v=null;if(s._geoCenter){s._geometry=new e.geometry.Circle(s._geoCenter.getX(),s._geoCenter.getY(),s._radius,s._geoCenter.srid);
s.toolFeature=new e.Feature("circleTool"+new Date().getTime(),s._geometry,{renderingStyle:s.featureStyle});
s._map.getToolFeatureLayer().addFeature(s.toolFeature);s._geoCenter=null;x=new w(w.TOOL_END,s);s.fire(x.type,x);
}};},start:function(){var t=e.event.ToolEvent;this._radius=0;this._geoCenter=null;this.clear();this._map.enableMapAction.drag=false;
this._map.enableMapAction.mouse=false;if(!this._group){this._group=this._graphic.createGroup();this._graphic.addGroup(this._group,this._map.draggableGroup);
}this._$container.bind("mousedown",this.begin);this._$container.bind("mouseup",this.finish);if(e.browser.touchSupported){this._$container.bind("touchstart",this.begin_touch);
this._$container.bind("touchend",this.finish);}this.status=e.tool.Tool.STARTED;var s=new t(t.TOOL_START,this);
this.fire(s.type,s);return this;},clear:function(){this.finish();this.clear_base();},getCenter:function(){return this._geoCenter;
},getRadius:function(s,u){if(!s){return null;}var t=[];if(this._geoCenter){t.push(this._geoCenter.getX());
t.push(this._geoCenter.getY());}else{if(this._geometry){t.push(this._geometry.centerX);t.push(this._geometry.centerY);
}}t.push(this._toPntOfCircle.getX());t.push(this._toPntOfCircle.getY());var v=null;if(this._geoCenter){v=new e.geometry.LineString(t,this._geoCenter.srid);
}else{if(this._geometry){v=new e.geometry.LineString(t,this._geometry.srid);}}if(v){return e.util.GeomUtil.getLength(v,u,{unit:s,transformToGeodetic:true});
}else{return null;}},getDrawingRadius:function(){return this._radius;}});e.tool.RectangleTool=e.tool.Tool.extend({initialize:function b(v){b.base.call(this,v);
this.allowZeroSize=false;var t=this;var y=e.event.ToolEvent;var x={};var u=null;var s=null;var w=null;
this.begin=function(B){if(t.status!=e.tool.Tool.STARTED){return;}s=t._map.getCursorLocation();w=B.pageX;
var D=B.pageX-t._$container.offset().left;var C=B.pageY-t._$container.offset().top;x={x:D,y:C};var z=t._graphic.getLeftTop(t._map.draggableGroup);
var A={x:D-z.x,y:C-z.y,width:1,height:1};if(e.isNull(t._style.fill)){t._style.fill=t._graphic.oui.NO_PAINT;
}if(!t._toolShape){t._toolShape=t._graphic.drawRectangle(A,t._style,{group:t._group});}else{t._graphic.setRectangle(t._toolShape,A);
}e.$(document).bind("mousemove",t.drawShape);if(e.browser.touchSupported){t._$container.bind("touchmove",t.drawShape_touch);
}};this.begin_touch=function(B){var A=e.util.DomUtil;var z=A.getTouchCount(B);if(z>1){return;}var C=A.getTouchesPosition(B);
B.pageX=C.x;B.pageY=C.y;t.begin(B);};this.drawShape=function(C){if(t.status!=e.tool.Tool.STARTED){return;
}var A=x.x;var F=x.y;var E=C.pageX-t._$container.offset().left;var D=C.pageY-t._$container.offset().top;
if(E<=0||D<0||E>t._map.getMapContext().getDeviceWidth()||D>t._map.getMapContext().getDeviceHeight()){t.finish();
}var z=t._graphic.getLeftTop(t._map.draggableGroup);var B={width:Math.abs(E-A),height:Math.abs(D-F),x:A<E?A-z.x:E-z.x,y:F<D?F-z.y:D-z.y};
t._graphic.setRectangle(t._toolShape,B);C=new y(y.RECTANGLE_DRAG,t);t.fire(C.type,C);};this.drawShape_touch=function(B){var A=e.util.DomUtil;
var z=A.getTouchCount(B);if(z>1){return;}var C=A.getTouchesPosition(B);B.pageX=C.x;B.pageY=C.y;t.drawShape(B);
};this.finish=function(C){t._map.enableMapAction.drag=true;t._map.enableMapAction.mouse=true;e.gv.featureDrag=true;
e.gv.allowFeaturePointsInteraction=true;t._$container.unbind("mousedown",t.begin);if(t.drawShape){e.$(document).unbind("mousemove",t.drawShape);
}t._$container.unbind("mouseup",t.finish);if(e.browser.touchSupported){t._$container.unbind("touchstart",t.begin_touch);
t._$container.unbind("touchmove",t.drawShape_touch);t._$container.unbind("touchend",t.finish);}t._graphic.remove(t._toolShape);
w=null;t.status=e.tool.Tool.FINISHED;if(s){u=t._map.getCursorLocation();var A=(s.getX()==u.getX())||(s.getY()==u.getY());
if(A&&!t.allowZeroSize){t._geometry=null;s=null;e.util.Logger.alert("MAPVIEWER_9045","OM.tool.RectangleTool.finish","");
t.start();return;}var z=[s.getX(),s.getY(),u.getX(),u.getY()];var B=0;if(z[0]>z[2]){B=z[0];z[0]=z[2];
z[2]=B;}if(z[1]>z[3]){B=z[1];z[1]=z[3];z[3]=B;}t._geometry=new e.geometry.Rectangle(z[0],z[1],z[2],z[3],u.srid);
t.toolFeature=new e.Feature("rectangleTool"+new Date().getTime(),t._geometry,{renderingStyle:t.featureStyle});
t._map.getToolFeatureLayer().addFeature(t.toolFeature);s=null;C=new y(y.TOOL_END,t);t.fire(C.type,C);
}};},setZeroSizeAllowed:function(s){this.allowZeroSize=s;},start:function(){var t=e.event.ToolEvent;this.clear();
this._map.enableMapAction.drag=false;this._map.enableMapAction.mouse=false;if(!this._group){this._group=this._graphic.createGroup();
this._graphic.addGroup(this._group,this._map.draggableGroup);}this._$container.bind("mousedown",this.begin);
this._$container.bind("mouseup",this.finish);if(e.browser.touchSupported){this._$container.bind("touchstart",this.begin_touch);
this._$container.bind("touchend",this.finish);}this.status=e.tool.Tool.STARTED;e.gv.featureDrag=false;
e.gv.allowFeaturePointsInteraction=false;var s=new t(t.TOOL_START,this);this.fire(s.type,s);return this;
},clear:function(){this.finish();this.clear_base();}});e.tool.DistanceTool=e.tool.Tool.extend({initialize:function b(v,s){b.base.call(this,v);
this._tool=new e.tool.RedlineTool(v,e.tool.RedlineTool.TYPE_LINESTRING,{continuousMode:false});this.unit="kilometer";
if(s&&s.unit){this.unit=s.unit;}this.transformToGeodetic=true;if(s&&s.transformToGeodetic===false){this.transformToGeodetic=s.transformToGeodetic;
}if(s&&s.dataSource){this.dataSource=s.dataSource;}this._map=v;this._distanceInfo=null;this._subTotalDis=0;
this._lastSubTotalDis=0;this.segmentsDisArray=[];var u=this;var t=e.event.ToolEvent;this.newPoint=function(){var w=u._tool;
if(w._points.length>1){var z=[];var y=null;for(var x=0;x<w._points.length;x++){y=w._points[x].geo;z.push(y.getX());
z.push(y.getY());}u.calTotalDistance(new e.geometry.LineString(z,u._map.getMapContext().getUniverse().srid));
}};this.drawing=function(z){var y=u._map.getMapContext().getUniverse().srid;if(e.$("#sub_tr_"+1)){e.$("#sub_tr_"+1).show();
}u._distanceInfo.setVisible(true);var A=u._map.getAbsoluteCursorLocation();if(e.isNotNull(z.loc)){A=z.loc;
}var x=u._tool._points[u._tool._points.length-1].geo;var w=e.util.GeomUtil.getLength(new e.geometry.LineString([A.getX(),A.getY(),x.getX(),x.getY()],u._map.getMapContext().getUniverse().srid),null,{unit:u.unit,transformToGeodetic:u.transformToGeodetic,dataSource:u.dataSource,toServerTranform:false});
w=Math.round(w*100)/100;e.$("#distance_total_"+1).text(Math.round((u._subTotalDis+w)*100)/100+u.getUnitLabel(u.unit));
e.$("#distance_sub_"+1).text(w+u.getUnitLabel(u.unit));};this.finish=function(){if(u.status!=e.tool.Tool.STARTED){return;
}u.status=e.tool.Tool.FINISHED;u.calTotalDistance(u._tool.toolFeature.geo);u._tool.finish();var w=new t(t.TOOL_END,u);
u.fire(w.type,w);u._tool.toolFeature.on(e.event.LayerEvent.FEATURE_EDITED,u.edit,u._tool.toolFeature);
};this.edit=function(){u.calSegmentsDistance(u._tool.toolFeature.geo);};this._tool.on(t.REDLINE_POINT_CREATE,u.newPoint);
this._tool.on(t.REDLINE_DRAW,u.drawing);this._tool.on(t.TOOL_END,u.finish);this._tool.on(t.REDLINE_EDITED,u.edit);
},start:function(){this.clear();this._distanceInfo=new e.control.MapDecoration("<table style='width:100%;border:0'> <tr><td align='right'>"+e.gv.getLabel("MAPVIEWER_SB_TOTAL_DISTANCE").replace(/[ ]/g,"&nbsp;")+":</td><td align='left'><span id='distance_total_"+1+"'>0"+this.getUnitLabel(this.unit)+"</span></td></tr><tr id='sub_tr_"+1+"'><td align='right'>"+e.gv.getLabel("MAPVIEWER_SB_SUB_DISTANCE").replace(/[ ]/g,"&nbsp;")+":</td><td align='left'><span id='distance_sub_"+1+"'>0"+this.getUnitLabel(this.unit)+"</span></td></tr></table>",{left:0.5,top:0.7},{draggable:true,panelOptions:{style:{"border-style":"solid","border-color":"#0000ff","border-width":"1px",backgroundColor:"#FDFDFD",filter:"alpha(Opacity=80)","-moz-opacity":"0.8",opacity:"0.8"}}});
this._map.addMapDecoration(this._distanceInfo);this._distanceInfo.setVisible(false);this._tool.start();
this.status=e.tool.Tool.STARTED;var s=new e.event.ToolEvent(e.event.ToolEvent.TOOL_START,this);this.fire(s.type,s);
return this;},clear:function(){if(this._distanceInfo){this._distanceInfo.setVisible(false);this._map.removeMapDecoration(this._distanceInfo);
this._distanceInfo=null;}this._subTotalDis=0;this.segmentsDisArray=[];this._tool.clear();},getGeometry:function(){return this._tool.getGeometry();
},getSegmentsArray:function(){return this.segmentsDisArray;},getTotalDistance:function(){return Math.round(this._subTotalDis*100)/100;
},calTotalDistance:function(u){var s=this;var t=function(w){if(w!==0){s._subTotalDis=w;s._distanceInfo.setVisible(true);
e.$("#distance_total_"+1).text(Math.round(s._subTotalDis*100)/100+s.getUnitLabel(s.unit));if(s.segmentsDisArray.length&&s.status!=e.tool.Tool.FINISHED){s.segmentsDisArray.push(Math.round((s._subTotalDis-s._lastSubTotalDis)*100)/100);
}if(s.segmentsDisArray.length===0){s.segmentsDisArray.push(Math.round(s._subTotalDis*100)/100);}if(e.$("#sub_tr_"+1)){e.$("#sub_tr_"+1).hide();
}s._lastSubTotalDis=w;var v=e.event.ToolEvent;var x=new v(v.DISTANCE_UPDATE,s);x.point=u.getLastPoint();
s.fire(x.type,x);}};if(s.transformToGeodetic){u.transform(8307,function(v){if(v.coordinates.length>=4){e.util.GeomUtil.getLength(v,t,{unit:s.unit,transformToGeodetic:s.transformToGeodetic,dataSource:s.dataSource});
}});}else{if(u.coordinates.length>=4){e.util.GeomUtil.getLength(u,t,{unit:s.unit,transformToGeodetic:s.transformToGeodetic,dataSource:s.dataSource});
}}},calSegmentsDistance:function(z){var x=this;x.segmentsDisArray=[];var t=[];var v=0;var y=[];var s=function(B,A){if(B!==0){x.segmentsDisArray[A]=Math.round(B*100)/100;
}};if(x.transformToGeodetic){z.transform(8307,function(B){for(var A=0;A<B.getOrdinates().length/2-1;A++){y[A]=s;
t[A]=new e.geometry.LineString([B.getOrdinates()[A*2],B.getOrdinates()[A*2+1],B.getOrdinates()[A*2+2],B.getOrdinates()[A*2+3]],B.srid);
if(t[A].coordinates.length>=4){e.util.GeomUtil.getLength(t[A],y[A],{idx:A,unit:x.unit,transformToGeodetic:x.transformToGeodetic,dataSource:x.dataSource});
}}});}else{for(var u=0;u<z.getOrdinates().length/2-1;u++){y[u]=s;t[u]=new e.geometry.LineString([z.getOrdinates()[u*2],z.getOrdinates()[u*2+1],z.getOrdinates()[u*2+2],z.getOrdinates()[u*2+3]],z.srid);
if(t[u].coordinates.length>=4){e.util.GeomUtil.getLength(t[u],y[u],{idx:u,unit:x.unit,transformToGeodetic:x.transformToGeodetic,dataSource:x.dataSource});
}}}var w=setInterval(function(){if(x.segmentsDisArray.length==z.getOrdinates().length/2-1){for(var A=0;
A<x.segmentsDisArray.length;A++){v=v+x.segmentsDisArray[A];}x._distanceInfo.setVisible(true);x._subTotalDis=v;
e.$("#distance_total_"+1).text(Math.round(x._subTotalDis*100)/100+x.getUnitLabel(x.unit));if(e.$("#sub_tr_"+1)){e.$("#sub_tr_"+1).hide();
}var B=e.event.ToolEvent;var C=new B(B.DISTANCE_UPDATE,x);C.point=z.getLastPoint();x.fire(C.type,C);clearInterval(w);
}},100);},getUnitLabel:function(s){if(!s){s=this.unit;}if(s){s=s.toUpperCase();if(s==="KILOMETER"||s==="KM"){return e.gv.getLabel("MAPVIEWER_SB_KILOMETERS");
}else{if(s==="METER"||s==="M"){return e.gv.getLabel("MAPVIEWER_SB_METERS");}else{if(s==="MILE"){return e.gv.getLabel("MAPVIEWER_SB_MILES");
}else{if(s==="FOOT"){return e.gv.getLabel("MAPVIEWER_SB_FEET");}else{if(s==="CENTIMETER"||s==="CM"){return e.gv.getLabel("MAPVIEWER_SB_CENTIMETER");
}else{if(s==="YARD"){return e.gv.getLabel("MAPVIEWER_SB_YARD");}else{return s;}}}}}}}else{return"KM";
}},setDrawingStyle:function(s){if(!s){return this;}if(this._tool){this._tool.setDrawingStyle(s);}},setStyle:function(s){if(this._tool){this._tool.setStyle({type:e.tool.DistanceTool.TYPE_LINESTRING,style:s});
}}});e.tool.DistanceTool.TYPE_POINT=1;e.tool.DistanceTool.TYPE_LINESTRING=2;e.tool.RedlineTool=e.tool.Tool.extend({initialize:function b(s,w,A){b.base.call(this,s);
var y=this;this.activeMapIndex=null;this.finishMode=e.tool.RedlineTool.FINISH_ON_CLICK;this.simplified=true;
if(A){if(e.notNull(A.simplified)){this.simplified=A.simplified;}if(e.notNull(A.finishMode)){this.finishMode=A.finishMode;
}}this.start_move_line_mode=false;this._geoType=(w&&typeof w=="number")?w:e.tool.RedlineTool.TYPE_POLYGON;
this._pointStyle=new e.style.Marker({width:10,height:10,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});
this._pointEndHoverStyle=new e.style.Marker({width:15,height:15,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:15,height:15},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});
this.featurePointStyle=this._pointStyle;this.featureStyle=this._style;this.featurePolygonStyle=this._style;
this._nextPointId=0;y._nextLineId=0;this._points=[];this._continuousPoints=[];this._screenPoints=[];this._lines=[];
this._shapeGroup=null;this._editFlag=true;var u=null;var v=null;var t=null;var z=null;this.dragging=false;
var x=e.event.ToolEvent;this.snapPoint=null;this.mouseDown=function(B){if(B.button===0){u=B.pageX;y.dragging=true;
if(y._group){y._group.bringToFront();}if(y._geoType!==e.tool.RedlineTool.TYPE_POINT){y._map.enableMapAction.drag=false;
}}B.stopPropagation();};this.nextPoint=function(G,C){if(y.status!=e.tool.Tool.STARTED){return;}var E=e.util.ValidationUtil.isNumber;
if(e.notNull(G)&&e.notNull(C)&&E(G)&&E(C)){var F=e.MapContext(y._map);var I=F.getUniverse();var D=I.srid;
var B=new e.geometry.Point(G,C,D);y.addVertex(null,B);}};this.mouseUp=function(G){if(G.button===2){var I=new x(e.event.ToolEvent.MOUSE_RIGHT_CLICK,y);
y.fire(I.type,I);return;}if(y.status==e.tool.Tool.STOPPED||y.status==e.tool.Tool.FINISHED){return;}var F=y._graphic.getLeftTop(y._map.draggableGroup);
var K=G.pageX-y._$container.offset().left-F.x;var J=G.pageY-y._$container.offset().top-F.y;if(y._continuousPoints.length>0){var B;
if(y.simplified){B=e.util.GeomUtil.simplify(y._continuousPoints,3);}else{B=y._continuousPoints;}y._continuousPoints=[];
y._screenPoints=[];y._map.getUndoManager().startChangeBlock();for(var E=1;E<B.length;E++){var D=B[E];
if(D){y.addVertex(null,D);}}y.endBlock=y._map.getUndoManager().endChangeBlock();}y.dragging=false;if(e.notNull(y.snapPoint)&&y.snapPoint.length===2){y._map.mLocX=y.snapPoint[0];
y._map.mLocY=y.snapPoint[1];}if(G.isRedo||(G.pageX==u&&G.pageX!=z)){y.addVertex(null,{x:y._map.mLocX,y:y._map.mLocY});
}z=G.pageX;var C=(y.finishMode===e.tool.RedlineTool.FINISH_ON_RELEASE);if(y.done(G,C)){return;}};this.done=function(B,C){if(y.clicktofinish||C){y.finishAndCleanUp(B);
return true;}return false;};this.finishAndCleanUp=function(B){B.preventDefault();y.finish();y.finishFeature=null;
y.clicktofinish=null;v=null;t=null;y.dragging=false;};this.mouseMove=function(I){y.snapPoint=null;if(e.isNotNull(y.finishFeature)){var L=y._map.getScreenLocation(y.finishFeature.getGeometry());
var E=5;var D=y._map.getScreenLocation(y._map.getAbsoluteCursorLocation());if(Math.abs(D.x-L.x)<=E&&Math.abs(D.y-L.y)<=E){var B;
switch(y._geoType){case e.tool.RedlineTool.TYPE_POINT:B=1;break;case e.tool.RedlineTool.TYPE_LINESTRING:B=2;
break;case e.tool.RedlineTool.TYPE_POLYGON:B=3;break;}if(y._points.length>(B-1)){y.finishFeature.bringToTop();
if(e.isNotNull(y.finishFeature.movedOut)){y.finishFeature.setRenderingStyle(y._pointEndHoverStyle);y.clicktofinish=true;
if(y._geoType==e.tool.RedlineTool.TYPE_LINESTRING){y.setPath(y._shapeGroup,[[0,0,0,0]],y._style);var M=new x(x.REDLINE_DRAW,y);
M.loc=y.finishFeature.getGeometry();y.fire(M.type,M);return;}}}}else{y.clicktofinish=false;y.finishFeature.setRenderingStyle(y._pointStyle);
y.finishFeature.bringToTop();y.finishFeature.movedOut=true;}}if(y.status==e.tool.Tool.STOPPED||y.status==e.tool.Tool.FINISHED){return;
}if(e.isNull(y.clicktofinish)||y.clicktofinish===false){var J=new x(e.event.ToolEvent.SNAP_POINT,y);y.fire(J.type,J);
}if(y._geoType!=e.tool.RedlineTool.TYPE_POINT){var F=y._graphic.getLeftTop(y._map.draggableGroup);var N=I.pageX-y._$container.offset().left-F.x;
var K=I.pageY-y._$container.offset().top-F.y;if(y.dragging){y._screenPoints.push(N);y._screenPoints.push(K);
var C=y._map.getAbsoluteCursorLocation();var G=new e.Feature("_rlcpt"+y._continuousPoints.length,C,{renderingStyle:y._pointStyle});
G.x=y._map.mLocX;G.y=y._map.mLocY;y._continuousPoints.push(G);if(y._continuousPoints.length>1){if(!y._shapeGroup){y._shapeGroup=y.drawLine([y._continuousPoints],y._style,{group:y._group});
}else{y.setPath(y._shapeGroup,[y._screenPoints],y._style);}}else{y.addVertex(null,{x:y._map.mLocX,y:y._map.mLocY});
}}else{if(v&&t){if(!y._shapeGroup){if(y._zoom){var O=y._map.getScreenLocation(y._points[y._points.length-1].geo);
v=O[0];t=O[1];y._zoom=false;}y._shapeGroup=y.drawLine([[v,t,N,K]],y._style,{group:y._group});}else{y.setPath(y._shapeGroup,[[v,t,N,K]],y._style);
}I=new x(x.REDLINE_DRAW,y);y.fire(I.type,I);}}}};this.addVertex=function(G,T,N){var M=e.MapContext(y._map);
var S=y._points;var D=y._lines;var B=y._map.getToolFeatureLayer();var O;if(typeof G!=="number"||G<0||G>S.length){G=S.length;
}if(T instanceof e.geometry.Point){var U=e.MapContext(y._map);O=U.getUniverse();var L=O.srid;if(L!=T.srid){T=T.transform(L);
}T.wraparoundMapIndex=M.getBaseWholeMapIndex();}else{T=y._map.getScreenPointLocation(T.x,T.y);}if(!y.activeMapIndex){y.activeMapIndex=T.wraparoundMapIndex;
}if(T.wraparoundMapIndex!==y.activeMapIndex){return;}if(T.wraparoundMapIndex){T=y._map.getACL(T,T.wraparoundMapIndex);
}var P;if(S.length===0||y._geoType!==e.tool.RedlineTool.TYPE_POINT){var E=new e.Feature("RedlinePoints"+y._nextPointId++,T,{renderingStyle:y._pointStyle});
E.activeIdx=y.activeIdx;S.splice(G,0,E);B.addFeature(E);switch(y._geoType){case e.tool.RedlineTool.TYPE_POINT:y.finish();
break;case e.tool.RedlineTool.TYPE_LINESTRING:if(S.length>1){y.finishFeature=E;}break;case e.tool.RedlineTool.TYPE_POLYGON:if(S.length==1){y.finishFeature=E;
}else{if(e.isNotNull(y.finishFeature)){y.finishFeature.bringToTop();}}break;}var K=false;var R;var J;
var I;if(S[G-1]){R=S[G-1].getGeometry();J=new e.geometry.LineString([R.getX(),R.getY(),T.getX(),T.getY()],R.srid);
I=new e.Feature("RedlineLines"+y._nextLineId++,J,{renderingStyle:y._style});I.activeIdx=y.activeIdx;D.splice(G,0,I);
B.addFeature(I);K=true;}if(S[G+1]){R=S[G+1].getGeometry();J=new e.geometry.LineString([T.getX(),T.getY(),R.getX(),R.getY()],R.srid);
I=new e.Feature("RedlineLines"+y._nextLineId++,J,{renderingStyle:y._style});if(K){B.removeFeature(D[G-1]);
D.splice(G-1,1);}D.splice(G,0,I);B.addFeature(I);}}else{P=S[0].getGeometry();S[0].setGeometry(T);y.finishFeature=S[0];
y.finishFeature.movedOut=null;}if(!N&&y._geoType!==e.tool.RedlineTool.TYPE_POINT){var C=y._map.getUndoManager().addEdit({index:G,vertex:T,prevVertex:P,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"Redline tool point ("+this.x+","+this.y+")";
},undo:function(){if(this.prevVertex){y.addVertex(this.index,this.prevVertex,true);}else{y.removeVertex(this.index,true);
}},redo:function(){y.addVertex(this.index,this.vertex,true);}});if(e.isNull(y.startBlock)){y.startBlock=C;
}y.endBlock=C;}if(G==(S.length-1)){y.removeShapeGroup(y);y._shapeGroup=null;var Q=y._map.getScreenLocation(T);
var V=y._graphic.getLeftTop(y._map.draggableGroup);v=Q.x-V.x;t=Q.y-V.y;}var F=new x(x.REDLINE_POINT_CREATE,y);
y.fire(F.type,F);};this.removeVertex=function(I,L){var Q=y._points;if(I<0||I>=Q.length){return;}var D=y._lines;
var B=y._map.getToolFeatureLayer();var U;var G=1;var O=Q[I-1];var S=Q[I+1];if(O&&S){G=2;var P=O.getGeometry();
var E=S.getGeometry();var J=new e.geometry.LineString([P.getX(),P.getY(),E.getX(),E.getY()],P.srid);U=new e.Feature("RedlineLines"+y._nextLineId++,J,{renderingStyle:y._style});
B.addFeature(U);}var K=Q.splice(I,1)[0];B.removeFeature(K);var T=K.getGeometry();var M;if(U){M=D.splice(Math.max(0,I-1),G,U);
}else{M=D.splice(Math.max(0,I-1),G);}for(var R=0;R<M.length;R++){B.removeFeature(M[R]);}if(!L&&y._geoType!==e.tool.RedlineTool.TYPE_POINT){var C=y._map.getUndoManager().addEdit({index:I,vertex:T,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"Redline tool point ("+this.x+","+this.y+")";
},undo:function(){y.addVertex(this.index,this.vertex,true);},redo:function(){y.removeVertex(this.index,true);
}});if(e.isNull(y.startBlock)){y.startBlock=C;}y.endBlock=C;}if(I==Q.length){y.removeShapeGroup(y);y._shapeGroup=null;
v=null;t=null;if(O){var N=y._map.getScreenLocation(O.getGeometry());var V=y._graphic.getLeftTop(y._map.draggableGroup);
v=N.x-V.x;t=N.y-V.y;}}var F=new x(x.REDLINE_POINT_REMOVE,y);y.fire(F.type,F);};this.newShapePoint=function(B,F,E,D,C){this.addVertex(null,y._map.getScreenPointLocation(B,F,true));
};this.zoomAction=function(){y.finish();};this.finish=function(){if(y.status!=e.tool.Tool.STARTED){return;
}if(e.isNotNull(this.startBlock)&&e.isNotNull(this.endBlock)){y._map.getUndoManager().trimEdits(this.startBlock,this.endBlock+1);
this.startBlock=f;this.endBlock=f;}var I=y._map.getToolFeatureLayer();y._map.deleteListener(e.event.MapEvent.MAP_BEFORE_ZOOM,y.zoomAction,y);
var B=true;if(!e.browser.touchSupported&&!e.gv.isWin8Touch){B=false;}y._$container.unbind("mousemove",y.mouseMove);
y._$container.unbind("mouseup",y.mouseUp);y._$container.unbind("mousedown",y.mouseDown);if(e.gv.isWin8Touch){y._$container[0].removeEventListener("MSPointerUp",y.mouseUp);
y._$container[0].removeEventListener("MSPointerDown",y.mouseDown);}if(e.browser.touchSupported){y._$container.unbind("touchstart",y.touchStart);
y._$container.unbind("touchmove",y.touchMove);y._$container.unbind("touchend",y.touchEnd);}if(B){e.Hammer(y._$container[0]).off("hold",y.finishAndCleanUp);
}y.removeShapeGroup(y);if(y._points.length===0){y.status=e.tool.Tool.FINISHED;y._map.enableMapAction.dbclick=true;
y._map.enableMapAction.mouse=true;y._map.enableMapAction.drag=true;return;}var J=[];var D;for(D=0;D<y._points.length;
D++){if(D>0&&y._points[D].getGeometry().getX()==y._points[D-1].getGeometry().getX()&&y._points[D].getGeometry().getY()==y._points[D-1].getGeometry().getY()){}else{J.push(y._points[D].getGeometry().getX());
J.push(y._points[D].getGeometry().getY());}I.removeFeature(y._points[D]);}for(D=0;D<y._lines.length;D++){I.removeFeature(y._lines[D]);
}var G=null;var F;var E;switch(y._geoType){case e.tool.RedlineTool.TYPE_POINT:E=J;y._geometry=new e.geometry.Point(E[E.length-2],J[J.length-1],y._points[0].getGeometry().srid);
G=y.featurePointStyle;break;case e.tool.RedlineTool.TYPE_LINESTRING:if(y._points.length<2){y.status=e.tool.Tool.FINISHED;
e.util.Logger.warning("MAPVIEWER_9011","OM.tool.RedlineTool.finish","");y._map.moveflag=false;F=new x(x.TOOL_END,y);
y.fire(F.type,F);y._map.enableMapAction.dbclick=true;y._map.enableMapAction.mouse=true;y._map.enableMapAction.drag=true;
return;}E=J;y._geometry=new e.geometry.LineString(E,y._points[0].getGeometry().srid);G=y.featureStyle;
break;case e.tool.RedlineTool.TYPE_POLYGON:if(y._points.length<3){y.status=e.tool.Tool.FINISHED;e.util.Logger.warning("MAPVIEWER_9012","OM.tool.RedlineTool.finish","");
y._map.moveflag=false;F=new x(x.TOOL_END,y);y.fire(F.type,F);y._map.enableMapAction.dbclick=true;y._map.enableMapAction.mouse=true;
y._map.enableMapAction.drag=true;return;}var C=y._points[0].getGeometry();J.push(C.getX());J.push(C.getY());
E=J;y._geometry=new e.geometry.Polygon(E,C.srid);G=y.featurePolygonStyle;break;}y.end();y.status=e.tool.Tool.FINISHED;
F=new x(x.TOOL_END,y);y.fire(F.type,F);y._map.enableMapAction.dbclick=true;y._map.enableMapAction.mouse=true;
y._map.enableMapAction.drag=true;};this.touchStart=function(D){var C=e.util.DomUtil;var B=C.getTouchCount(D);
if(B==1){D.button=0;var E=C.getTouchesPosition(D);y.touchPos=E;D.pageX=E.x;D.pageY=E.y;}else{if(B==2){D.button=2;
}else{return;}}y.mouseDown(D);};this.touchMove=function(){y.touchPos=null;};this.touchEnd=function(B){if(y.touchPos){B.pageX=y.touchPos.x;
B.pageY=y.touchPos.y;y.mouseUp(B);}};},start:function(){var t=e.event.ToolEvent;this.clear();this._map.enableMapAction.dbclick=false;
this._map.enableMapAction.mouse=false;if(!this._group){this._group=this._graphic.createGroup();this._graphic.addGroup(this._group,this._map.draggableGroup);
}this.domainArea={};this.activeIdx=null;this._points=[];this._lines=[];this._map.on(e.event.MapEvent.MAP_BEFORE_ZOOM,this.zoomAction,this);
var s=true;if(!e.browser.touchSupported&&!e.gv.isWin8Touch){s=false;}this._$container.bind("mouseup",this.mouseUp);
this._$container.bind("mousedown",this.mouseDown);this._$container.bind("mousemove",this.mouseMove);if(e.gv.isWin8Touch){this._$container[0].addEventListener("MSPointerUp",this.mouseUp);
this._$container[0].addEventListener("MSPointerDown",this.mouseDown);}if(e.browser.touchSupported){this._$container.bind("touchstart",this.touchStart);
this._$container.bind("touchmove",this.touchMove);this._$container.bind("touchend",this.touchEnd);}if(s){e.Hammer(this._$container[0]).on("hold",this.finishAndCleanUp);
}this.status=e.tool.Tool.STARTED;this.fire(t.type,t);return this;},end:function(){var t=null;switch(this._geoType){case e.tool.RedlineTool.TYPE_POINT:t=this.featurePointStyle;
break;case e.tool.RedlineTool.TYPE_LINESTRING:t=this.featureStyle;break;case e.tool.RedlineTool.TYPE_POLYGON:t=this.featurePolygonStyle;
break;}var u=this._map.getToolFeatureLayer();this.toolFeature=new e.Feature("RedlineTool"+u.featureArray.length,this._geometry,{renderingStyle:t});
this._map.getToolFeatureLayer();u.enableFeatureEditing(true);u.addFeature(this.toolFeature);var s=function(){this._geometry=this.toolFeature.geo;
var w=new e.event.ToolEvent(e.event.ToolEvent.REDLINE_EDITED,this);this.fire(w.type,w);};var v=function(){this._geometry=this.toolFeature.geo;
var w=new e.event.ToolEvent(e.event.ToolEvent.REDLINE_EDITED,this);this.fire(w.type,w);};this.toolFeature.on(e.event.LayerEvent.FEATURE_MOVED,v,this);
this.toolFeature.on(e.event.LayerEvent.FEATURE_EDITED,s,this);},clear:function(){this.finish();this._pointStyle=new e.style.Marker({width:10,height:10,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});
this.clear_base();},getGeometryType:function(){return this._geoType;},getGeometry:function(){return this._geometry;
},setDrawingStyle:function(t){if(!t){return this;}var s=e.tool.RedlineTool;if(t.type===s.TYPE_POINT){this._pointStyle=t.style.clone();
}if(t.type===s.TYPE_LINESTRING||t.type===s.TYPE_POLYGON){this._style=t.style.clone();}return this;},drawLine:function(z,w,u){var y=[];
if(w&&w.styleType=="Line"){e.style.Style.calculateStyleSize(w,this._map.getMapContext());var x=w.stylelist;
var t=x.length;for(var v=0;v<t;v++){var s=x[v];if(!s.stroke){continue;}y.push(this._graphic.drawPath(z,s,u));
}}else{u={group:this._group,id:"lstr"};if(!w.stroke){w.stroke=w.fill?w.fill:"#000000";}w.fill=null;y.push(this._graphic.drawPath(z,w,u));
}return y;},setPath:function(v,x,u){var s=v.length;e.style.Style.calculateStyleSize(u,this._map.getMapContext());
var w=u.stylelist;for(var t=0;t<s;t++){this._graphic.setPath(this._shapeGroup[t],x,w[t]);}},removeShapeGroup:function(t){if(t&&t._shapeGroup){var s=t._shapeGroup.length;
for(var u=0;u<s;u++){t._graphic.remove(t._shapeGroup[u]);}t._shapeGroup.length=0;t._shapeGroup=null;}},setStyle:function(s){if(s.type==e.tool.RedlineTool.TYPE_POINT){this.featurePointStyle=s.style.clone();
if(this.toolFeature&&this._geoType==e.tool.RedlineTool.TYPE_POINT){this.toolFeature.setRenderingStyle(this.featurePointStyle);
}}if(s.type==e.tool.RedlineTool.TYPE_LINESTRING){this.featureStyle=s.style.clone();if(this.toolFeature&&this._geoType==e.tool.RedlineTool.TYPE_LINESTRING){this.toolFeature.setRenderingStyle(this.featureStyle);
}}if(s.type==e.tool.RedlineTool.TYPE_POLYGON){this.featurePolygonStyle=s.style.clone();if(this.toolFeature&&this._geoType==e.tool.RedlineTool.TYPE_POLYGON){this.toolFeature.setRenderingStyle(this.featurePolygonStyle);
}}return this;}});e.tool.RedlineTool.TYPE_POINT=1;e.tool.RedlineTool.TYPE_LINESTRING=2;e.tool.RedlineTool.TYPE_POLYGON=3;
e.tool.RedlineTool.FINISH_ON_CLICK=1;e.tool.RedlineTool.FINISH_ON_RELEASE=2;e.tool.MarqueeZoomTool=e.tool.RectangleTool.extend({initialize:function b(u,v){b.base.call(this,u);
var t=this;this.mode=v?v:e.tool.MarqueeZoomTool.PROMPT;this.setStyle(new e.style.Color({stroke:"#00FF00",fill:"#FF0000",strokeThickness:1,fillOpacity:0.5}));
this.setDrawingStyle(new e.style.Color({stroke:"#00FF00",fill:"#FF0000",strokeThickness:1,fillOpacity:0.5}));
var s=function(){var z=t.getGeometry();var y=function(A){t.clear();if(A){t._map.zoomToExtent(z);t.status=e.tool.Tool.FINISHED;
}};var w=function(){y(false);u.deleteListener(e.event.MouseEvent.MOUSE_CLICK,w);};var x=function(){y(true);
u.deleteListener(e.event.MouseEvent.MOUSE_CLICK,w);};if(t.mode!=e.tool.MarqueeZoomTool.PROMPT){y(true);
}else{t.toolFeature.on(e.event.MouseEvent.MOUSE_CLICK,x);u.on(e.event.MouseEvent.MOUSE_CLICK,w);}if(t.mode==e.tool.MarqueeZoomTool.CONTINUOUS){t.start();
}};this.on(e.event.ToolEvent.TOOL_END,s);},setMode:function(s){this.mode=s;}});e.tool.MarqueeZoomTool.ONE_TIME=1;
e.tool.MarqueeZoomTool.CONTINUOUS=2;e.tool.MarqueeZoomTool.PROMPT=3;e.tool.ButtonGroup=e.Class.extend({initialize:function(s){this.butGroupId=s;
this.buttonArray=[];},createHTML:function(){var u="<table><tbody><tr>";var s=this.buttonArray.length;
for(var t=0;t<s;t++){u+="<td>";u+=this.buttonArray[t].createHTML();u+="</td>";}u+="</tr></tbody></table>";
return u;},addButton:function(s){s.parent=this;this.buttonArray.push(s);},removeButton:function(u){var s=this.buttonArray.length;
for(var t=0;t<s;t++){if(this.buttonArray[t]==u){this.buttonArray.splice(t,1);u.parent=null;}}},attachEvents:function(){var s=this.buttonArray.length;
for(var t=0;t<s;t++){this.buttonArray[t].attachEvents();}},setDownButton:function(t){var s=this.buttonArray.length;
for(var v=0;v<s;v++){var u=this.buttonArray[v];if(u==t){u.setStatus(true);}else{u.setStatus(false);}}}});
e.tool.ImageButton=e.Class.extend({initialize:function b(t,s){this.btID=t;if(s){this.btIcon=s.buttonEnableIcon;
this.btOverIcon=s.buttonOverIcon;this.btDownIcon=s.buttonDownIcon;this.btDisableIcon=s.buttonDisableIcon;
this.tip=s.toolTip;this.width=s.width;this.height=s.height;}this.status=s&&s.status?s.status:e.tool.ImageButton.STATUS_UP;
},createHTML:function(){var s='<a href="javascript:void(0)" style="vertical-align:bottom"';s+=e.isNull(this.tip)?">":' title="'+this.tip+'">';
s+='<img id="'+this.btID+'" src='+this.btIcon+" border=0></a>";return s;},attachEvents:function(){this.$icon=e.$("#"+this.btID);
if(this.status==e.tool.ImageButton.STATUS_DOWN){this.$icon.attr("src",this.btDownIcon);this.$icon[0].down=true;
}if(this.attched){return;}this.attched=true;var s=this;e.$(this.$icon).hover(function(t){if(s.btOverIcon&&!this.down){s.$icon.attr("src",s.btOverIcon);
}else{}},function(t){if(s.btOverIcon&&!this.down){s.$icon.attr("src",s.btIcon);}else{}}).mousedown(function(t){if(s.btDownIcon){s.$icon.attr("src",s.btDownIcon);
}}).click(function(t){if(s.parent instanceof e.tool.ButtonGroup){if(!this.down){this.down=true;s.parent.setDownButton(s);
}}else{s.setStatus(!this.down);}});},setStatus:function(s){if(s){this.$icon.attr("src",this.btDownIcon);
this.$icon[0].down=true;this.status=e.tool.ImageButton.STATUS_DOWN;}else{this.$icon.attr("src",this.btIcon);
this.$icon[0].down=false;this.status=e.tool.ImageButton.STATUS_UP;}}});e.tool.ImageButton.STATUS_DOWN="DOWN";
e.tool.ImageButton.STATUS_UP="UP";e.control.MapDecoration=e.Class.extend({mixin:e.event.EventSource,initialize:function b(t,s){this.dragDiv=false;
this._randomId=""+this.s4()+this.s4();this.id="decorationDiv_"+this._randomId;this.visible=true;this.collapsible=false;
this.minimized=false;this.title="";if(e.isNull(this.isHtml)){this.isHtml=false;}this.bfinit=true;this.cleaned=false;
this.X=0;this.Y=0;this.restoredWidth=0;this.restoredHeight=0;this.anchored=false;this.relativePosition=false;
this.draggable=false;this.inAnimation=false;this.minOffset=10;if(t&&t.substr||typeof(t)){this.isHtml=true;
this.content=t;}if(s){this.mapType=s.mapType;this.draggable=s.draggable?s.draggable:false;if(e.isNull(s.draggable)){this.draggable=true;
}this.X=0;this.Y=0;this.left=e.notNull(s.offsetX)?s.offsetX:20;this.top=e.notNull(s.offsetY)?s.offsetY:20;
this.isPanel=true;this.width=s.width?s.width:0;this.height=s.height?s.height:0;this.title=s.title?s.title:"";
this.collapsible=s.collapsible?s.collapsible:false;this.titleStyle=s.titleStyle?s.titleStyle:null;this.contentStyle=s.contentStyle?s.contentStyle:null;
if(s.anchorPosition){this.anchorPosition=parseInt(s.anchorPosition);this.anchored=true;}if(e.notNull(s.enableAnimation)){this.enableAnimation=s.enableAnimation;
}}},display:function(u){var w=this.map||u;var s=this.graphics=w.graphics;var t=w.getMapContext();this.parentMapWidth=t.getDeviceWidth();
this.parentMapHeight=t.getDeviceHeight();if(this.isHtml){this.container=this.isInternal?w.$topLayerDIV:w.$fixedLayerDIV;
this.generateHtmlDecoration();this.setDraggable(this.draggable);this.delegate("mousedown",function(x){e.event.EventSource.stopEvents[x.type]=true;
});this.delegate("dblclick",function(x){e.event.EventSource.stopEvents[x.type]=true;});}else{this.container=w.fixedGroup;
this.defaultGroup=s.createGroup();s.addGroup(this.defaultGroup,this.container);this.delegate("dblclick",function(x){x.stopPropagation();
x.preventDefault();});this.delegate("mousedown",function(x){x.stopPropagation();x.preventDefault();});
this.delegate("mouseup",function(x){x.stopPropagation();x.preventDefault();});}this.map.on(e.event.MapEvent.MAP_RESIZED,this.resize,this);
if(!e.isNull(this.anchorPosition)&&this.anchored===true){this.setAnchorPosition(this.anchorPosition);
}if(this.relativePosition&&!this.draggable){this.map.addListener(e.event.MapEvent.MAP_RESIZED,this.setPosition,this);
}if(this.graphics&&this.defaultGroup&&!this.visible){this.graphics.setVisible(this.defaultGroup,this.visible);
}var v=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.DISPLAYED,this);this.fire(e.event.MapDecorationEvent.DISPLAYED,v);
},remove:function(){if(this.relativePosition){this.map.deleteListener(e.event.MapEvent.MAP_RESIZED,this.setPosition,this);
}this.unDelegate();if(this.isHtml&&this.$DecorationDiv){this.$DecorationDiv.unbind();if(this.map){this.map.$oracleMapDiv.unbind("mousemove",this.mapDiv_msmove);
this.map.$oracleMapDiv.unbind("touchmove",this.mapDiv_touchmove);this.map.$oracleMapDiv.unbind("touchend",this.mapDiv_touchend);
}this.$DecorationDiv.remove();if(this.$DecorationBtnDiv){this.$DecorationBtnDiv.remove();}}},clean:function(){if(this.unDelegate){this.unDelegate();
}if(this.isHtml){this.$DecorationDiv.remove();if(this.$DecorationBtnDiv){this.$DecorationBtnDiv.remove();
}}else{this.graphics.clearGroup(this.defaultGroup);}this.cleaned=true;},setPosition:function(s,x){if(s>=1){s=parseInt(s);
}if(x>=1){x=parseInt(x);}this.X=s||0;this.Y=x||0;if(this.map&&this.parentMapWidth){if(this.X<1&&this.X>0){this.X=this.X*this.parentMapWidth;
this.relativePosition=true;}if(this.Y<1&&this.Y>0){this.Y=this.Y*this.parentMapHeight;this.relativePosition=true;
}}if(this.defaultGroup&&this.graphics){this.graphics.setLeftTop(this.defaultGroup,this.X,this.Y);}else{if(this.isHtml&&e.notNull(this.$DecorationDiv)){this.$DecorationDiv.css({top:this.Y,left:this.X});
}else{if(this.isHtml&&this.type=="NavigationPanelBar"){var w=0;var t=this;var v;var u=function(){if(w>10){clearTimeout(v);
return;}if(this.type=="NavigationPanelBar"&&this.fullyInit===true&&e.notNull(this.$DecorationDiv)){this.X=s;
this.Y=x;this.$DecorationDiv.css({top:x,left:s});}else{w++;v=setTimeout(u.bind(t),50);}};u();}}}},getAnchorPosition:function(z){if(e.isNull(z)||isNaN(z)||z<1||z>6){return{left:0,top:0};
}var v=this.map.getMapContext();var y=e.isNull(this.anchorOffsetX)?0:this.anchorOffsetX;var x=e.isNull(this.anchorOffsetY)?0:this.anchorOffsetY;
var B=v.getDeviceWidth();var u=v.getDeviceHeight();var C=this.width;var A=this.height;var D;var t;if(e.browser.touchSupported){D=t=e.gv.decorationCollapseButtonSizeTouch;
}else{D=t=e.gv.decorationCollapseButtonSizeNoTouch;}var s={left:0,top:0};if(this.minOffset){y+=this.minOffset*2;
x+=this.minOffset;}if(this.minimized){C=0;A=0;y=this.minOffset;}if(this.map.decorationArray.length>1&&(z==4||z==5||z==6)&&this.type!="CopyRight"){for(var w=0;
w<this.map.decorationArray.length;w++){if(this.map.decorationArray[w].type==="CopyRight"){if(e.notNull(this.map.decorationArray[w].$DecorationDiv)){x+=this.map.decorationArray[w].$DecorationDiv.height();
}else{x+=15;}}}}switch(z){case 1:s.left=y+C;s.top=x;break;case 2:s.left=B*1/2+y*1/2;s.top=x;break;case 3:s.left=B-C-t-y;
s.top=x;break;case 4:s.left=y+C;s.top=u-D-x;break;case 5:s.left=B*1/2+y*1/2;s.top=u-D-x;break;case 6:s.left=B-C-t-y;
s.top=u-D-x;break;}return s;},getMainDecorationAnchorPosition:function(z){var v=this.map.getMapContext();
var y=e.isNull(this.anchorOffsetX)?0:this.anchorOffsetX;var x=e.isNull(this.anchorOffsetY)?0:this.anchorOffsetY;
var B=v.getDeviceWidth();var u=v.getDeviceHeight();var C=this.width;var A=this.height;var D;var t;if(e.browser.touchSupported){D=t=e.gv.decorationCollapseButtonSizeTouch;
}else{D=t=e.gv.decorationCollapseButtonSizeNoTouch;}var s={left:0,top:0};if(this.minimized){C=0;A=0;}else{if(this.collapsible){C=this.restoredWidth;
A=this.restoredHeight;}}if(this.minOffset){y+=this.minOffset;x+=this.minOffset;}if(this.map.decorationArray.length>1&&(z==4||z==5||z==6)&&this.type!="CopyRight"){for(var w=0;
w<this.map.decorationArray.length;w++){if(e.notNull(this.map.decorationArray[w].$DecorationDiv)){if(this.map.decorationArray[w].type==="CopyRight"){x+=this.map.decorationArray[w].$DecorationDiv.height();
}}}}switch(z){case 1:s.left=0+y;s.top=0+x;break;case 2:s.left=B*1/2-(C*1/2)+y;s.top=0+x;break;case 3:s.left=B-C-y;
s.top=0+x;break;case 4:s.left=0+y;s.top=u-A-x;break;case 5:s.left=B*1/2-(C*1/2)+y;s.top=u-A-x;break;case 6:s.left=B-C-y;
s.top=u-A-x;break;}return s;},setAnchorPosition:function(u){if(isNaN(u)){u=this.anchorPosition;}var t=u||this.anchorPosition;
this.anchorPosition=t;if(e.isNull(this.anchorOffsetX)){this.anchorOffset=0;}if(e.isNull(this.anchorOffsetY)){this.anchorOffsetY=0;
}if(e.isNull(this.map)){return;}var s=this.getMainDecorationAnchorPosition(t);if(this.$DecorationDiv||this.graphics){this.doSetAnchorPosition(s.left,s.top);
}this.anchored=true;},doSetAnchorPosition:function(s,u){this.X=s;this.Y=u;if(this.isHtml){if(this.collapsible){var t=this.getAnchorPosition(this.anchorPosition);
this.$DecorationBtnDiv.css("left",t.left);this.$DecorationBtnDiv.css("top",t.top);}this.$DecorationDiv.css("left",this.X);
this.$DecorationDiv.css("top",this.Y);}else{if(this.graphics){this.graphics.setLeftTop(this.defaultGroup,this.X,this.Y);
}}},setSize:function(t,s){if(!t||!s){return;}this.width=t;this.height=s;this.restoredWidth=t;this.restoredHeight=s;
if(this.isHtml){this.$DecorationDiv.width(this.width);this.$DecorationDiv.height(this.height);}},setDraggable:function(s){this.draggable=s;
},setVisible:function(s){this.visible=s;if(this.isHtml){if(e.isNull(this.$DecorationDiv)&&e.isNull(this.$DecorationBtnDiv)){return;
}else{if(s){this.$DecorationDiv.css("display","");if(e.notNull(this.$DecorationBtnDiv)){this.$DecorationBtnDiv.css("display","");
}}else{this.$DecorationDiv.css("display","none");if(e.notNull(this.$DecorationBtnDiv)){this.$DecorationBtnDiv.css("display","none");
}}}}else{if(this.graphics){this.graphics.setVisible(this.defaultGroup,s);}}},getHtmlElementId:function(){return this.id;
},s4:function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);},generateHtmlDecoration:function(){var z=this;
this.$DecorationDiv=e.$("<div onselectstart='return false'></div>");this.$DecorationDiv.attr("id",this.id);
if(e.isNull(this.type)){this.$DecorationDiv.css({"z-index":"200",position:"absolute",overflow:"auto"});
}else{this.$DecorationDiv.css({"z-index":"200",position:"absolute"});}if(!this.visible){this.$DecorationDiv.css("display","none");
}this.mapWidth=this.map.getMapContext().getDeviceWidth();this.mapHeight=this.map.getMapContext().getDeviceHeight();
if(this.collapsible){if(e.browser.touchSupported){this.btnW=this.btnH=e.gv.decorationCollapseButtonSizeTouch;
this.$DecorationBtnDiv=e.$("<div id='_DecorationBtnDiv'><img src='"+e.control.MapDecoration.getImage(this)+"' style='height:24px;width:24px'></div>");
}else{this.btnW=this.btnH=e.gv.decorationCollapseButtonSizeNoTouch;this.$DecorationBtnDiv=e.$("<div id='_DecorationBtnDiv'><img src='"+e.control.MapDecoration.getImage(this)+"' style='height:18px;width:18px'></div>");
}this.$DecorationBtnDiv.css({"z-index":"201",position:"absolute"});if(!this.visible){this.$DecorationBtnDiv.css("display","none");
}this.container.append(this.$DecorationBtnDiv);}this.container.append(this.$DecorationDiv);if(this.$DecorationBtnDiv){this.$DecorationBtnDiv.bind("mouseup mousedown",function(C){C.stopPropagation();
});}this.$DecorationDiv.bind("mouseup mousedown",function(C){C.stopPropagation();});if(this.type=="Magnifier"){this.$Content=e.$("<div class='defaultStyle_magni'></div>");
this.$hideDiv=e.$("<div class='hideStyle_magni'></div>");this.$hideDiv.css({width:this.width,height:this.height});
this.$Content.css({width:this.width,height:this.height});this.$DecorationDiv.append(this.$Content);this.$DecorationDiv.append(this.$hideDiv);
}if(this.type=="LayerControl"){this.$Content=e.$("<div class='defaultStyle_layerctrl'></div>");this.$Content.css({width:this.width});
this.$title=e.$("<div class='titleStyleBasic_layerctrl titleStyleEna_layerctrl'>"+e.gv.getLabel("MAPVIEWER_LC_TITLE")+"</div>");
this.$title.css({width:this.width-6,"font-size":this.title_font_size,"font-family":this.title_font_family});
this.$DecorationDiv.append(this.$title);this.$DecorationDiv.append(this.$Content);}if(this.type==="OverviewMap"){this.width=this.parentMapWidth*0.3;
this.height=this.parentMapHeight*0.3;this.$DecorationDiv.addClass("style_overviewMap");this.$DecorationDiv.width(Math.round(this.width));
this.$DecorationDiv.height(Math.round(this.height));this.$DecorationDiv.css({"border-style":"solid","border-color":"#000000","border-width":"1px"});
}if(this.type=="ToolBar"||this.mapType){var w=this.$Content=e.$("<div style='overflow:false'></div>");
var y=this.$realContent=e.$("<div>"+this.content+"</div>");var s=this.$tb_title=e.$("<div class='titleStyleEna_layerctrl'></div>");
s.css({height:"6px"});this.defaultStyle={"border-style":"solid","border-color":"#101418","border-width":"1px",padding:"0px","font-size":"16px",color:"#000000",backgroundColor:"#FDFDFD"};
if(this.contentStyle){y.css(this.contentStyle);}else{y.css(this.defaultStyle);}if(this.title){this.title=this.title.replace(/\ /g,"&nbsp;");
var t=this.$titleDiv=e.$("<div>"+this.title+"</div>");this.defaultTitleStyle={"border-style":"solid","border-color":"#391EA6","border-width":"1px",backgroundColor:"#0D0D0D","font-size":"18px","font-weight":"bold",color:"#FDFDFD"};
if(this.titleStyle){t.css(this.titleStyle);}else{t.css(this.defaultTitleStyle);}w.append(this.$titleDiv);
}w.append(y);if(this.type=="ToolBar"&&this.draggable){this.$DecorationDiv.append(s);}this.$DecorationDiv.append(w);
if(this.width){w.width(this.width);}if(this.height){w.height(this.height);}if(!this.width){this.width=this.$DecorationDiv.width();
}if(!this.height){this.height=this.$DecorationDiv.height();}}if(!this.type&&!this.mapType){var B=e.$('<table border="0" cellspacing="0">');
if(this.title){this.title=this.title.replace(/\ /g,"&nbsp;");var A=e.$("<tr></tr>");A.appendTo(B);var v=e.$("<td>"+this.title+"</td>");
v.appendTo(A);if(this.titleStyle){v.css(this.titleStyle);}else{v.addClass("defaultTitleStyle_noType");
}}var x=e.$("<tr></tr>");x.appendTo(B);var u=e.$("<td id='content_td'>"+this.content+"</td>");if(u.find("a").length>0){u.find("a").bind("touchstart",function(){h.location.href=u.find("a").attr("href");
});}u.appendTo(x);if(this.contentStyle){u.css(this.contentStyle);}else{u.addClass("defaultContentStyle_noType");
}this.$DecorationDiv.append(B);if(this.width){this.$DecorationDiv.width(this.width);B.width(this.width);
}if(this.height){this.$DecorationDiv.height(this.height);B.height(this.height);}if(!this.width){this.width=this.$DecorationDiv.width();
}if(!this.height){this.height=this.$DecorationDiv.height();}this.setPosition(this.left,this.top);this.anchored=false;
}if(this.collapsible){if(e.browser.touchSupported){this.$DecorationBtnDiv.bind("touchstart",function(C){if(z.type=="OverviewMap"){if(z.collapsible){if(z.minimized){z.restore();
}else{z.collapse();}}}else{if(!z.minimized){z.collapse();}else{z.restore();}}e.event.EventSource.stopEvents[C.type]=true;
});}this.$DecorationBtnDiv.mouseover(function(D){var C=D.target;C.src=z.minimized===false?z.getMinimizeIcon():z.getRestoreIcon();
e.event.EventSource.stopEvents[D.type]=true;}).mouseout(function(D){var C=D.target;C.src=e.control.MapDecoration.getImage(z);
e.event.EventSource.stopEvents[D.type]=true;}).click(function(C){if(z.type=="OverviewMap"){if(z.collapsible){if(z.minimized){z.restore();
}else{z.collapse();}}}else{if(!z.minimized){z.collapse();z.minimized=true;}else{z.restore();z.minimized=false;
}}e.event.EventSource.stopEvents[C.type]=true;});this.$DecorationBtnDiv.bind("dblclick mousemove mousedown",function(C){e.event.EventSource.stopEvents[C.type]=true;
});}if(this.type=="Magnifier"){if(this.width){this.$Content.width(this.width);}if(this.height){this.$Content.height(this.height);
}if(!this.width){this.width=this.$DecorationDiv.width();}if(!this.height){this.height=this.$DecorationDiv.height();
}}z=this;this.moveX=0;this.moveY=0;this.flag=false;if(this.type=="LayerControl"){this.$title.mousedown(function(C){z.mousedown(C);
}).mouseup(function(C){z.mouseup(C);e.event.EventSource.stopEvents[C.type]=true;}).dblclick(function(C){e.event.EventSource.stopEvents[C.type]=true;
}).mouseover(function(C){z.map.$oracleMapDiv.css("cursor","pointer");e.event.EventSource.stopEvents[C.type]=true;
}).mouseout(function(C){z.map.$oracleMapDiv.css("cursor","default");e.event.EventSource.stopEvents[C.type]=true;
});this.$title.bind("touchstart",function(C){C.preventDefault();z.touchstart(C);});this.$title.bind("touchend",function(C){C.stopPropagation();
C.preventDefault();z.touchend(C);});this.$Content.bind("touchmove touchstart touchend",function(C){C.stopPropagation();
C.preventDefault();});this.$DecorationDiv.bind("mousedown mouseup mouseover mouseout mousewheel click dblclick",function(C){z.fire(C.type,C);
e.event.EventSource.stopEvents[C.type]=true;});}if(e.isNull(this.type)||this.type==="Magnifier"||this.type==="ToolBar"){if(this.$tb_title){this.$tb_title.mouseover(function(){if(!z.dragging){e.$(this).removeClass("titleStyleEna_layerctrl");
e.$(this).removeClass("titleStyleDwn_layerctrl");e.$(this).addClass("titleStyleOvr_layerctrl");e.$(this).css("cursor","move");
}}).mouseout(function(){if(!z.dragging){e.$(this).removeClass("titleStyleOvr_layerctrl");e.$(this).removeClass("titleStyleDwn_layerctrl");
e.$(this).addClass("titleStyleEna_layerctrl");e.$(this).css("cursor","default");}}).mousedown(function(){e.$(this).removeClass("titleStyleOvr_layerctrl");
e.$(this).removeClass("titleStyleEna_layerctrl");e.$(this).addClass("titleStyleDwn_layerctrl");}).mouseup(function(){e.$(this).removeClass("titleStyleDwn_layerctrl");
e.$(this).removeClass("titleStyleEna_layerctrl");e.$(this).addClass("titleStyleOvr_layerctrl");});}this.$DecorationDiv.bind("touchend",function(D){var E=this.lastTouchTimeStamp;
var C=D.timeStamp;this.lastTouchTimeStamp=C;if(C-E<500){e.event.EventSource.stopEvents[D.type]=true;}});
this.$DecorationDiv.bind("touchstart",function(C){z.touchstart(C);});this.$DecorationDiv.mousedown(function(C){if(e.browser.chrome){if(C.offsetY>(e.$(this).height()-21)&&C.offsetY<e.$(this).height()){return;
}if(C.offsetX>(e.$(this).width()-21)){return;}}if(e.browser.msie){if(C.offsetY>(e.$(this).height()-17)&&C.offsetY<e.$(this).height()){return;
}if(C.offsetX>(e.$(this).width()-17)){return;}}e.$(this).css("cursor","default");if(z.draggable){e.$(this).css("cursor","move");
}z.mousedown(C);}).mouseup(function(C){e.$(this).css("cursor","default");z.map.moveflag=false;z.mouseup(C);
e.event.EventSource.stopEvents[C.type]=true;}).scroll(function(C){z.mouseup(C);e.event.EventSource.stopEvents[C.type]=true;
});this.$DecorationDiv.bind("dblclick mouseover mouseout mousewheel click keyup keydown keypress",function(C){e.event.EventSource.stopEvents[C.type]=true;
});}if(this.type!="OverviewMap"){e.$(document).mouseup(function(C){z.mouseup(C);});this.mapDiv_msmove=function(C){if(e.browser.msie&&h.event.button!=1){z.mouseup(C);
}z.mousemove(C);};this.mapDiv_touchmove=function(C){C.stopPropagation();C.preventDefault();z.touchmove(C);
};this.mapDiv_touchend=function(C){C.preventDefault();z.touchend(C);};this.map.$oracleMapDiv.mousemove(this.mapDiv_msmove);
this.map.$oracleMapDiv.bind("touchmove",this.mapDiv_touchmove);this.map.$oracleMapDiv.bind("touchend",this.mapDiv_touchend);
}if(e.isNull(this.type)&&this.map._decoration[this.type]){this.map._decoration[this.type].$DecorationDiv.append(this.$DecorationDiv);
}},resize:function(){this.moveX=(this.moveX+this.width/2)*this.map.getMapContext().getDeviceWidth()/this.mapWidth-this.width/2;
this.moveY=(this.moveY+this.height/2)*this.map.getMapContext().getDeviceHeight()/this.mapHeight-this.height/2;
this.mapWidth=this.map.getMapContext().getDeviceWidth();this.mapHeight=this.map.getMapContext().getDeviceHeight();
},mousedown:function(s){if(e.isNull(this.map)){return;}if(this.draggable){this.dragDiv=true;if(!this.map.enableMapAction.drag){return;
}this.dragging=true;this.map.enableMapAction.drag=false;this.startX=parseInt(s.clientX);this.startY=parseInt(s.clientY);
this.positionX=parseInt(this.$DecorationDiv.css("left"));this.positionY=parseInt(this.$DecorationDiv.css("top"));
this.dragStartFlag=true;e.event.EventSource.stopEvents[s.type]=true;}},mousemove:function(t){this.parentMapHeight=this.map.getMapContext().getDeviceHeight();
this.parentMapWidth=this.map.getMapContext().getDeviceWidth();this.height=this.$DecorationDiv.height();
if(this.type=="LayerControl"){this.height=this.$Dom.height();}if(!this.dragging){return;}if(this.dragStartFlag===true){var u=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.DRAG_START,this);
this.fire(e.event.MapDecorationEvent.DRAG_START,u);this.dragStartFlag=false;}this.moveX=this.positionX+t.clientX-this.startX;
this.moveY=this.positionY+t.clientY-this.startY;this.$DecorationDiv.css("left",this.moveX);this.$DecorationDiv.css("top",this.moveY);
this.top=this.moveY;var s=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.DRAG,this);this.fire(e.event.MapDecorationEvent.DRAG,s);
e.event.EventSource.stopEvents[t.type]=true;},mouseup:function(s){if(e.isNull(this.map)){return;}this.flag=false;
this.dragDiv=false;this.v_isDrag=false;if(this.dragging===true&&this.startX!==parseInt(s.clientX)&&this.startY!==parseInt(s.clientY)){var t=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.DRAG_END,this);
this.fire(e.event.MapDecorationEvent.DRAG_END,t);}if(this.dragging){this.dragStartFlag=false;this.dragging=false;
this.map.enableMapAction.drag=true;}},touchstart:function(u){if(e.isNull(this.map)){return;}if(this.draggable){this.dragDiv=true;
if(!this.map.enableMapAction.drag){return;}this.dragging=true;this.map.enableMapAction.drag=false;var s=e.util.DomUtil;
this.touchCount=s.getTouchCount(u);if(this.touchCount>2){return;}var t=[];if(this.touchCount==1){var v=s.getTouchesPosition(u);
t.push(v);}this.touchStartX=parseInt(t[0].x);this.touchStartY=parseInt(t[0].y);this.touchPositionX=parseInt(this.$DecorationDiv.css("left"));
this.touchPositionY=parseInt(this.$DecorationDiv.css("top"));this.dragStartFlag=true;}},touchmove:function(v){var s=e.util.DomUtil;
var u=[];if(this.touchCount==1){var x=s.getTouchesPosition(v);u.push(x);}if(!this.dragging){return;}if(this.dragStartFlag===true){var w=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.DRAG_START,this);
this.fire(e.event.MapDecorationEvent.DRAG_START,w);this.dragStartFlag=false;}this.touchMoveX=this.touchPositionX+u[0].x-this.touchStartX;
this.touchMoveY=this.touchPositionY+u[0].y-this.touchStartY;this.moveX=this.touchMoveX;this.moveY=this.touchMoveY;
this.$DecorationDiv.css("left",this.touchMoveX);this.$DecorationDiv.css("top",this.touchMoveY);var t=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.DRAG,this);
this.fire(e.event.MapDecorationEvent.DRAG,t);if(parseInt(this.$DecorationDiv.css("left"))<0){this.$DecorationDiv.css("left","0px");
this.touchend(v);}if(parseInt(this.$DecorationDiv.css("top"))<0){this.$DecorationDiv.css("top","0px");
this.touchend(v);}if((this.parentMapWidth-parseInt(this.$DecorationDiv.css("left")))<this.width){this.$DecorationDiv.css("left",this.parentMapWidth-this.width);
this.touchend(v);}if((this.parentMapHeight-parseInt(this.$DecorationDiv.css("top")))<this.height){this.$DecorationDiv.css("top",this.parentMapHeight-this.height);
this.touchend(v);}},touchend:function(u){if(e.isNull(this.map)){return;}this.flag=false;this.dragDiv=false;
var s=e.util.DomUtil;var t=[];if(this.touchCount==1){var w=s.getTouchesPosition(u);t.push(w);}if(this.dragging===true&&this.touchStartX!==parseInt(t[0].x)&&this.touchStartY!==parseInt(t[0].y)){var v=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.DRAG_END,this);
this.fire(e.event.MapDecorationEvent.DRAG_END,v);}if(this.dragging){this.dragStartFlag=false;this.dragging=false;
this.map.enableMapAction.drag=true;}this.map.touchStartLocs=[];},touchscroll:function(u){var t;var s;
if(e.browser.touchSupported){document.getElementById(u).addEventListener("touchstart",function(v){t=v.targetTouches[0].pageX;
s=v.targetTouches[0].pageY;v.stopPropagation();},false);document.getElementById(u).addEventListener("touchmove",function(x){x.preventDefault();
x.stopPropagation();var w=(t-x.targetTouches[0].pageX),v=(s-x.targetTouches[0].pageY);this.scrollLeft+=w;
this.scrollTop+=v;},false);}},delegate:function(s,t,x){var y;var u=(t instanceof Object)?true:false;if(this.isHtml){y=this.$DecorationDiv;
if(u&&e.notNull(x)){var z=t.attr("id")||"selector_"+Math.random().toString().replace(/\./,0);t.attr("id",z);
e.$(y).on(s,"#"+z,x);}else{e.$(y).on(s,t,x);}}else{y=this.defaultGroup;if(t&&typeof t==="function"){return this.delegate(s,y,t);
}var w=this.delegateListeners=this.delegateListeners||[];w[s]=w[s]||[];var v=x.id=x.id||"fn_"+Math.random().toString().replace(/\./,0);
var A;A=function(B){var C=B.target.getAncestors();for(var D=C.length-1;D>0;D--){if(u){if(C[D]===t){B.delegateTarget=C[D];
x.call(null,B);}}else{if(C[D].queryType&&C[D].queryType.indexOf("#"+t)!=-1){B.delegateTarget=C[D];x.call(null,B);
}}if(C[D]===B.currentTarget){return;}}};A.id=v;y.addEventListener(s,A);w[s].push(A);}return this;},unDelegate:function(t,u,z){var A;
t=t||"mouseover mouseout mousemove mousedown mouseup click dblclick";var v=(u instanceof Object)?true:false;
if(this.isHtml){A=this.$DecorationDiv;if(v){var B=u.attr("id");e.$(A).off(t,"#"+B,z);}else{e.$(A).off(t,u,z);
}}else{if(this.defaultGroup){A=this.defaultGroup;var y=this.delegateListeners;var s=t.split(" ");for(var w=0;
w<s.length;w++){var D=s[w];if(A.listeners&&A.listeners[D]){if(z){var C;for(var x=0;x<y[D].length;x++){if(y[D][x].id===z.id){C=y[D][x];
y[D].splice(x,1);break;}}A.removeEventListener(D,C);}else{A.listeners[D]=[];this.delegateListeners[D]=[];
}}}}}return this;},getRestoreIcon:function(){var s=this.anchorPosition||1;switch(s){case 1:return e.control.MapDecoration.BUTTON_RESTORE_TOP_LEFT;
case 2:return e.control.MapDecoration.BUTTON_RESTORE_TOP_LEFT;case 3:return e.control.MapDecoration.BUTTON_RESTORE_TOP_RIGHT;
case 4:return e.control.MapDecoration.BUTTON_RESTORE_LOWER_LEFT;case 5:return e.control.MapDecoration.BUTTON_RESTORE_LOWER_LEFT;
case 6:return e.control.MapDecoration.BUTTON_RESTORE_LOWER_RIGHT;}},getMinimizeIcon:function(){var s=this.anchorPosition||1;
switch(s){case 1:return e.control.MapDecoration.BUTTON_MINIMIZE_TOP_LEFT;case 2:return e.control.MapDecoration.BUTTON_MINIMIZE_TOP_LEFT;
case 3:return e.control.MapDecoration.BUTTON_MINIMIZE_TOP_RIGHT;case 4:return e.control.MapDecoration.BUTTON_MINIMIZE_LOWER_LEFT;
case 5:return e.control.MapDecoration.BUTTON_MINIMIZE_LOWER_LEFT;case 6:return e.control.MapDecoration.BUTTON_MINIMIZE_LOWER_RIGHT;
}},collapse:function(){if(this.inAnimation||this.minimized){return;}var t=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.BEFORE_COLLAPSE,this);
this.fire(t.type,t);if(this.enableAnimation){this.collapseAnimated();}else{this.collapseSimple();}var s=this.$DecorationBtnDiv.children("img");
if(s.attr("src")==this.getMinimizeIcon()){s.attr("src",this.getRestoreIcon());}else{if(s.attr("src")==this.getRestoreIcon()){s.attr("src",this.getMinimizeIcon());
}}},collapseAnimated:function(){this.inAnimation=true;var x=this.width;var v=this.height;this.restoredWidth=x;
this.restoredHeight=v;this.minimized=true;var s=this.getMainDecorationAnchorPosition(this.anchorPosition);
var u=this.getAnchorPosition(this.anchorPosition);if(e.isNull(s)){s={top:0,left:0};}var t={width:0,height:0,opacity:0,top:s.top,left:s.left};
var y=this;this.$DecorationDiv.animate(t,200,"swing",function w(){if(e.notNull(y.$DecorationBtnDiv)){y.$DecorationBtnDiv.css({left:u.left});
y.$DecorationBtnDiv.css({top:u.top});}y.inAnimation=false;var z=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.AFTER_COLLAPSE,y);
y.fire(z.type,z);});},collapseSimple:function(){this.inAnimation=true;var v=this.height;var x=this.width;
this.restoredWidth=x;this.restoredHeight=v;this.minimized=true;if(e.isNull(this.anchorPosition)){this.anchorPosition=6;
}var t=this.getMainDecorationAnchorPosition(this.anchorPosition);var u=this.getAnchorPosition(this.anchorPosition);
var w=0;var s=0;if(typeof u=="undefined"||typeof u.left=="undefined"||typeof u.top=="undefined"){u.left=0;
u.top=0;}if(e.notNull(this.$DecorationBtnDiv)){this.$DecorationBtnDiv.css({left:u.left});this.$DecorationBtnDiv.css({top:u.top});
}if(e.notNull(this.$DecorationDiv)){this.$DecorationDiv.css({left:t.left,top:t.top,width:w,height:s,opacity:0});
}this.inAnimation=false;var y=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.AFTER_COLLAPSE,this);
this.fire(y.type,y);},restore:function(){if(this.inAnimation||!this.minimized){return;}this.inAnimation=true;
var t=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.BEFORE_RESTORE,this);this.fire(t.type,t);
if(this.enableAnimation){this.restoreAnimated();}else{this.restoreSimple();}var s=this.$DecorationBtnDiv.children("img");
if(s.attr("src")==this.getRestoreIcon()){s.attr("src",this.getMinimizeIcon());}else{if(s.attr("src")==this.getMinimizeIcon()){s.attr("src",this.getRestoreIcon());
}}},restoreSimple:function a(){this.minimized=false;var u=this.getMainDecorationAnchorPosition(this.anchorPosition);
var x=this.getAnchorPosition(this.anchorPosition);var s=this.restoredHeight;var v=this.restoredWidth;
var t={width:v,height:s,opacity:1,top:u.top,left:u.left};if(e.notNull(this.$DecorationBtnDiv)){this.$DecorationBtnDiv.css({left:x.left,top:x.top});
}if(e.notNull(this.$DecorationDiv)){this.$DecorationDiv.css({width:t.width,height:t.height,opacity:t.opacity,top:t.top,left:t.left});
}this.inAnimation=false;var w=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.AFTER_RESTORE,this);
this.fire(w.type,w);},restoreAnimated:function r(){this.minimized=false;var v=this.getMainDecorationAnchorPosition(this.anchorPosition);
var x=this.getAnchorPosition(this.anchorPosition);var s=this.restoredHeight;var w=this.restoredWidth;
var u={width:w,height:s,opacity:1,top:v.top,left:v.left};var y=this;this.$DecorationDiv.animate(u,200,"swing",function t(){if(e.notNull(y.$DecorationBtnDiv)){y.$DecorationBtnDiv.css({left:x.left});
y.$DecorationBtnDiv.css({top:x.top});}y.inAnimation=false;var z=new e.event.MapDecorationEvent(e.event.MapDecorationEvent.AFTER_RESTORE,y);
y.fire(z.type,z);});},isVisible:function(){return this.visible;}});e.control.MapDecoration.POSITION_UPPER_LEFT=1;
e.control.MapDecoration.POSITION_UPPER_CENTER=2;e.control.MapDecoration.POSITION_UPPER_RIGHT=3;e.control.MapDecoration.POSITION_LOWER_LEFT=4;
e.control.MapDecoration.POSITION_LOWER_CENTER=5;e.control.MapDecoration.POSITION_LOWER_RIGHT=6;e.control.MapDecoration.setIconsPath=function(){var s=e.gv.resourcePath(),t=e.control.MapDecoration;
t.OVER_VIEW_ICON=s+"overviewicon.gif";t.BUTTON_MINIMIZE_LOWER_LEFT=s+"button_minimize_l.gif";t.BUTTON_RESTORE_LOWER_LEFT=s+"button_restore_l.gif";
t.BUTTON_MINIMIZE_LOWER_RIGHT=s+"button_minimize.gif";t.BUTTON_RESTORE_LOWER_RIGHT=s+"button_restore.gif";
t.BUTTON_MINIMIZE_TOP_LEFT=s+"button_restore.gif";t.BUTTON_RESTORE_TOP_LEFT=s+"button_minimize.gif";t.BUTTON_MINIMIZE_TOP_RIGHT=s+"button_restore_l.gif";
t.BUTTON_RESTORE_TOP_RIGHT=s+"button_minimize_l.gif";t.MAGNIFIER=s+"func_search_16_ena.png";t.TH_BG_S=s+"th_bg_s.png";
};e.control.MapDecoration.setIconsPath();e.control.MapDecoration.setCustomIcons=function(s){if(s){if(s.overview){e.control.MapDecoration.OVER_VIEW_ICON=s.overview;
}if(s.minimize){e.control.MapDecoration.BUTTON_MINIMIZE=s.minimize;}if(s.restore){e.control.MapDecoration.BUTTON_RESTORE=s.restore;
}if(s.magnifier){e.control.MapDecoration.MAGNIFIER=s.magnifier;}}};e.control.MapDecoration.getImage=function(s){if(s.type=="Magnifier"){return e.control.MapDecoration.MAGNIFIER;
}else{return e.control.MapDecoration.OVER_VIEW_ICON;}};e.control.NavigationPanelBar=e.control.MapDecoration.extend({initialize:function b(s){b.base.call(this,"no content",e.$.extend({},{anchorPosition:e.browser.touchSupported?e.control.MapDecoration.POSITION_LOWER_LEFT:e.control.MapDecoration.POSITION_UPPER_LEFT},s));
s=s?s:{};this.isInternal=true;this.type="NavigationPanelBar";this.style=e.control.NavigationPanelBar.STYLE_FULL;
if(e.notNull(s.infoTips)){this.infoTips=s.infoTips;}if(e.notNull(s.style)){this.style=parseInt(s.style);
}if(e.browser.touchSupported){this.style=e.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY;}if(e.isNull(s.offsetX)){this.left=this.getOffset().offsetX;
}if(e.isNull(s.offsetY)){this.top=this.getOffset().offsetY;}this.tipTimer=new e.util.TimerManager();this.centerCss={"margin-left":"auto","margin-right":"auto",display:"inline-block"};
this.borderAndBackgroundCss={"border-style":"solid","border-width":"1px","border-color":"#dddddd","border-radius":"2px","background-color":"#fefefe",opacity:"0.75"};
this.zoomInFont="\ue65c";this.zoomOutFont="\ue65d";this.defaultColor="#878c90";this.hoverColor="#85bbe7";
this.disabledColor="#c3c3c3";this.minOffset=10;this.fullyInit=false;},getButtons:function(s){if(e.isNull(this.buttons)){this.buttons=[{name:"up",img:"func_shuffleup_16_btn_ena.png",img_hov:"func_shuffleup_16_btn_hov.png",css:{top:"0px",left:"20px"}},{name:"right",img:"func_shuffleright_16_btn_ena.png",img_hov:"func_shuffleright_16_btn_hov.png",css:{right:"0px",top:"20px"}},{name:"down",img:"func_shuffledown_16_btn_ena.png",img_hov:"func_shuffledown_16_btn_hov.png",css:{bottom:"0px",left:"20px"}},{name:"left",img:"func_shuffleleft_16_btn_ena.png",img_hov:"func_shuffleleft_16_btn_hov.png",css:{left:"0px",top:"20px"}}];
}if(e.isNull(s)){return this.buttons;}else{return this.buttons[s];}},display:function j(u,t){j.base.call(this,u,t);
var s=this;var v=this.map;if(!v.displayed&&!v.getMapContext().getZoomLevel()){return;}s.$DecorationDiv.css({"text-align":"center"});
if(s.hasPanel()){s.$DecorationDiv.append(s.createPanHtml());}if(s.hasZoombar()||s.hasZoombtn()){s.$DecorationDiv.append(s.createZoomHtml());
}v.navigationPanelBar=s;s.width=s.$DecorationDiv.width();s.height=s.$DecorationDiv.height();s.setAnchorPosition(s.anchorPosition);
if(s.hasZoombar()){s.recenter=function(){s.updateBarByLevel();};v.on(e.event.MapEvent.I_MAP_CENTER_ZOOM,this.recenter,this);
s.recenter();}if(s.hasZoombtn()){s.updateIamge=function(){var x=s.map.getMapContext();var w=x.getUniverse().getZoomLevelNumber();
var y=x.getZoomLevel();if(y===0){e.util.DomUtil.setFontIcon(e.$(s.zoomOut).find("div"),s.zoomOutFont,s.disabledColor);
e.$(this.zoomOut).css("cursor","");}else{e.util.DomUtil.setFontIcon(e.$(s.zoomOut).find("div"),s.zoomOutFont,s.defaultColor);
e.$(this.zoomOut).css("cursor","pointer");}if(y===w-1){e.util.DomUtil.setFontIcon(e.$(s.zoomIn).find("div"),s.zoomInFont,s.disabledColor);
e.$(this.zoomIn).css("cursor","");}else{e.util.DomUtil.setFontIcon(e.$(s.zoomIn).find("div"),s.zoomInFont,s.defaultColor);
e.$(this.zoomIn).css("cursor","pointer");}};v.on(e.event.MapEvent.I_MAP_CENTER_ZOOM,s.updateIamge,this);
s.updateIamge();this.fullyInit=true;}},createPanHtml:function(){var B=this;var u={cursor:"pointer",position:"absolute",width:"16px",height:"16px"};
var z=e.$.extend({},B.borderAndBackgroundCss,{width:"56px",height:"56px",margin:5,position:"relative","border-radius":"28px",cursor:"pointer"});
var v=e.$("<div></div>").css(z);var A=this.getButtons();var w=this.map.getMapContext();var t=(w.getDeviceHeight()+w.getDeviceWidth())*0.25;
var s=this.map;for(var x=0;x<A.length;x++){var y=B.setBackground(e.$("<div></div>").css(u).css(A[x].css),A[x].img);
(function(){var C=A[x];var D=x;y.hover(function(){B.setBackground(e.$(this),C.img_hov);},function(){B.setBackground(e.$(this),C.img);
});y.click(function(){if(D===0){s.pan(0,t,true);}else{if(D===1){s.pan(-t,0,true);}else{if(D===2){s.pan(0,-t,true);
}else{if(D===3){s.pan(t,0,true);}}}}});})();v.append(y);}return v;},createZoomHtml:function(){var B=this;
var s=this.map;var u=e.$.extend({},B.borderAndBackgroundCss,{"border-radius":"2px 2px 2px 2px",cursor:"pointer"});
var z=e.browser.touchSupported?{width:"26px",height:"26px","background-position":"center",margin:"0px","text-align":"center","line-height":"26x"}:{width:"21px",height:"21px","background-position":"center",margin:"0px","text-align":"center","line-height":"21px"};
var t=this.centerCss;var v=e.$("<div></div>").css(t);var A=e.$("<div></div>").css(z);var y=e.$("<div></div>").css(z);
e.util.DomUtil.setFontIcon(y,B.zoomOutFont,B.defaultColor);e.util.DomUtil.setFontIcon(A,B.zoomInFont,B.defaultColor);
var w=e.$('<div id="zoomin_'+this._randomId+'"></div>').css(u).append(A);var x=e.$('<div id="zoomout_'+this._randomId+'"></div>').css(u).append(y);
B.zoomIn=w;B.zoomOut=x;if(e.browser.touchSupported){w.css({"margin-bottom":"5px"});}w.hover(function(){if(B.zoomdisabled(true)){return;
}e.util.DomUtil.setFontIcon(e.$(this).find("div"),B.zoomInFont,B.hoverColor);},function(){if(B.zoomdisabled(true)){return;
}e.util.DomUtil.setFontIcon(e.$(this).find("div"),B.zoomInFont,B.defaultColor);});w.on("touchstart click",function(){if(B.zoomdisabled(true)){return;
}s.zoomIn();});x.hover(function(){if(B.zoomdisabled()){return;}e.util.DomUtil.setFontIcon(e.$(this).find("div"),B.zoomOutFont,B.hoverColor);
},function(){if(B.zoomdisabled()){return;}e.util.DomUtil.setFontIcon(e.$(this).find("div"),B.zoomOutFont,B.defaultColor);
});x.on("touchstart click",function(){if(B.zoomdisabled()){return;}s.zoomOut();});if(B.hasZoombar()){v.on("mouseover",function(){B.tipTimer.schedule("tip",2000,function(){B.tipContainer.fadeOut();
});B.tipContainer.show();});}if(B.hasZoombtn()){v.append(w);}if(B.hasZoombar()){v.append(B.createBarHtml());
}if(B.hasZoombtn()){v.append(x);}B.zoomContainer=v;return v;},zoomdisabled:function(v){var t=this.map.getMapContext();
var u=t.getZoomLevel();var s=t.getUniverse().getZoomLevelNumber();if(v===true){return u===s-1;}else{return u===0;
}},createBarHtml:function(){var s=this;var x=e.$("<div></div>").css({position:"relative",top:0,left:0,bottom:0,right:0,height:"100px"});
var w=s.setBackground(e.$("<div></div>"),"func_zoomout_16_btn_ena.png").css({width:"16px",height:"12px","margin-left":"auto","margin-right":"auto","background-position":"center"});
var u=e.$("<div></div>").css({width:3,height:"98px",cursor:"pointer"}).css(this.centerCss).css(this.borderAndBackgroundCss);
var t=e.$("<div></div>").css({position:"absolute",cursor:"pointer",top:0,left:3,bottom:0,width:"16px",height:"12px"}).css(this.centerCss).css(this.borderAndBackgroundCss);
t.append(w);t.hover(function(){s.setBackground(e.$(this).find("div"),"func_zoomout_16_btn_hov.png");},function(){s.setBackground(e.$(this).find("div"),"func_zoomout_16_btn_ena.png");
});var v={};t.on("mousedown",function(y){v.dragging=true;v.startY=y.clientY;v.positionY=t.position().top;
});t.on("mouseup",function(){if(true===v.dragging){s.updateBar();}v.dragging=false;});t.on("mousemove",function(y){if(true===v.dragging){s.updateBarPos(v.positionY+y.clientY-v.startY);
}});u.on("mousedown",function(y){s.updateBarPos(y.offsetY);s.updateBar();});s.draggerBarContainer=t;x.append(u).append(t).append(s.createTips());
return x;},createTips:function(){var t=this;var z=t.map;var y=e.$("<div></div>").css({position:"absolute",top:0,left:"5px",display:"none"});
var v={position:"absolute","border-radius":"1px",left:"20px","z-index":1,"text-align":"left",cursor:"pointer"};
for(var w in this.infoTips){if(parseInt(w)<0){continue;}var x=e.$("<div></div>").css(v);x.attr("maplevel",w);
x.on("click",function(){t.map.setMapZoomLevel(e.$(this).attr("maplevel"));});x.hover(function(){e.$(this).parent().find(">div").css({"z-index":1,"font-weight":"normal"});
e.$(this).css({"z-index":2,"font-weight":"bold"});t.tipTimer.cancel("tip");},function(){e.$(this).parent().find(">div").css({"z-index":1,"font-weight":"normal"});
t.tipTimer.schedule("tip",2000,function(){t.tipContainer.fadeOut();});});x.on("mouseover",function(){return false;
});x.css({top:this.levelToTop(w)+"px"});var s=e.$("<div></div>").css({"line-height":"15px",position:"absolute",left:"15px"}).css(t.borderAndBackgroundCss).css({"border-left":""}).html(this.infoTips[w]);
var u=t.setBackground(e.$("<div></div>"),"arrow.png").css({width:"15px",height:"15px",position:"absolute",top:0,opacity:"0.85"});
x.append(u).append(s);y.append(x);}t.tipContainer=y;return y;},updateBarPos:function(u){var s=this.draggerBarContainer.height();
var t=this.draggerBarContainer.parent().height()-2;u=Math.max(0,Math.min(u,t-s));this.draggerBarContainer.css("top",u);
},levelToTop:function(x){var u=this.map.getMapContext();var t=u.getUniverse().getZoomLevelNumber();if(e.isNull(x)){x=u.getZoomLevel();
}x=Math.max(0,Math.min(x,t-1));var s=this.draggerBarContainer.height();var v=this.draggerBarContainer.parent().height()-2;
var w=(v-s)*(t-x-1)/(t-1);return w;},updateBar:function(){var u=this.map.getMapContext();var t=u.getUniverse().getZoomLevelNumber();
var s=this.draggerBarContainer.height();var v=this.draggerBarContainer.parent().height()-2;var w=this.draggerBarContainer.position().top;
this.updateBarByLevel(t-1-parseInt(w/(v-s)*(t-1)));},updateBarByLevel:function(y){var x=true;var u=this.map.getMapContext();
var t=u.getUniverse().getZoomLevelNumber();if(e.isNull(y)){y=u.getZoomLevel();x=false;}y=Math.max(0,Math.min(y,t-1));
var s=this.draggerBarContainer.height();var v=this.draggerBarContainer.parent().height()-2;var w=(v-s)*(t-y-1)/(t-1);
this.draggerBarContainer.css("top",w);if(x===true){this.map.setMapZoomLevel(y);}},setBackground:function(s,t){s.css({background:'url("'+e.gv.resourcePath()+"navicontrol/"+t+'") no-repeat',"background-position":"center"});
return s;},setZoomLevelInfoTips:function(s){this.infoTips=s;},setStyle:function(s){if(e.isNull(s)){return;
}if(e.notNull(s.position)){this.setPosition(s.position.left,s.position.top);}if(e.notNull(s.backgroundColor)){e.$.extend(this.borderAndBackgroundCss,{"background-color":s.backgroundColor});
}if(e.notNull(s.borderColor)){e.$.extend(this.borderAndBackgroundCss,{"border-color":s.borderColor});
}},remove:function q(){q.base.call(this);this.map.navigationPanelBar=null;this.map.deleteListener(e.event.MapEvent.I_MAP_CENTER_ZOOM,this.recenter,this);
},hasPanel:function(){switch(this.style){case e.control.NavigationPanelBar.STYLE_FULL:return true;case e.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return false;
case e.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return false;case e.control.NavigationPanelBar.STYLE_PAN_ONLY:return true;
}},hasZoombar:function(){switch(this.style){case e.control.NavigationPanelBar.STYLE_FULL:return true;
case e.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return true;case e.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return false;
case e.control.NavigationPanelBar.STYLE_PAN_ONLY:return false;}},hasZoombtn:function(){switch(this.style){case e.control.NavigationPanelBar.STYLE_FULL:return true;
case e.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return true;case e.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return true;
case e.control.NavigationPanelBar.STYLE_PAN_ONLY:return false;}},getOffset:function(){switch(this.style){case e.control.NavigationPanelBar.STYLE_FULL:return{offsetX:0,offsetY:0};
case e.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return{offsetX:10,offsetY:10};case e.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return{offsetX:0,offsetY:0};
case e.control.NavigationPanelBar.STYLE_PAN_ONLY:return{offsetX:0,offsetY:0};}}});e.control.NavigationPanelBar.STYLE_FULL=1;
e.control.NavigationPanelBar.STYLE_ZOOM_ONLY=2;e.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY=3;
e.control.NavigationPanelBar.STYLE_PAN_ONLY=4;e.control.NavigationPanelBar.ORIENTATION_VERTICAL=1;e.control.NavigationPanelBar.ORIENTATION_HORIZONTAL=2;
e.control.CopyRight=e.control.MapDecoration.extend({initialize:function b(s){b.base.call(this,"no content",e.$.extend({},{offsetX:0,offsetY:0},s));
this.isInternal=true;this.anchorPosition=e.control.MapDecoration.POSITION_LOWER_RIGHT;this.anchored=true;
this.fontSize=12;this.textValue="";this.type="CopyRight";this.minOffset=0;if(s){this.textValue=s.textValue?s.textValue:"";
this.anchorPosition=s.anchorPosition?s.anchorPosition:e.control.MapDecoration.POSITION_LOWER_CENTER;this.fontSize=s.fontSize?s.fontSize:12;
this.fontFamily=s.fontFamily?s.fontFamily:"Tahoma";this.fill=s.fontColor?s.fontColor:"black";}},setStyle:function(s){if(!s){return;
}if(s.fontSize){this.fontSize=s.fontSize;}if(s.fontFamily){this.fontFamily=s.fontFamily;}if(s.fontColor){this.fill=s.fontColor;
}},display:function j(t,s){j.base.call(this,t,s);this.$DecorationDiv.append(this.createHtml());this.width=this.$DecorationDiv.width();
this.height=this.$DecorationDiv.height();if(this.map){this.map.on(e.event.MapEvent.MAP_RESIZED,this.copyRightAfterMapResized,this);
}this.setAnchorPosition(this.anchorPosition);},copyRightAfterMapResized:function(){this.setAnchorPosition(this.anchorPosition);
},createHtml:function(){var s=this.createDiv();return s;},createDiv:function(){var s=e.$("<div></div>").css({"font-size":this.fontSize,"font-family":this.fontFamily,color:this.fill,"white-space":"nowrap"});
s.html(this.textValue);s.wrapInner('<span style="background-color: white; opacity:0.7"></span>');return s;
},remove:function q(){q.base.call(this);this.map.CopyRight=null;}});e.control.ScaleBar=e.control.MapDecoration.extend({initialize:function b(s){e.util.LoadFileUtil.LoadCss(e.gv.cssResourcePath()+"scalebar.css");
b.base.call(this);this.isInternal=true;this.anchored=true;this.anchorPosition=e.control.MapDecoration.POSITION_LOWER_LEFT;
this.format="BOTH";this.maxLength=100;this.transformToGeodetic=false;this.fontSize=12;this.fontColor="#000000";
this.fontWeight="bold";this.scaleBarColor="#000000";this.topScaleBarHost={};this.bottomScaleBarHost={};
this.type="ScaleBar";this.isHtml=true;if(s){this.format=s.format?s.format:"BOTH";this.anchorPosition=s.anchorPosition?s.anchorPosition:e.control.MapDecoration.POSITION_LOWER_LEFT;
if(e.isNotNull(s.style)){this.setStyle(s.style);}}},updateScale:function(){if(!this.map){return;}var s=this;
var t=function(v){var w=v.fpsLength;var y=v.metricLength;var x=v.fpsText;var u=v.metricText;if(s.format==="METRIC"){s.topScaleBarHost.length=y;
s.topScaleBarHost.text=u;}else{if(s.format==="IMPERIAL"){s.topScaleBarHost.length=w;s.topScaleBarHost.text=x;
}else{s.topScaleBarHost.length=w;s.topScaleBarHost.text=x;s.bottomScaleBarHost.length=y;s.bottomScaleBarHost.text=u;
}}s.renderDivLength();s.renderText();};this.decideScale(this.map,this.maxLength,t);},setStyle:function(s){if(e.isNull(s)){return;
}if(s.fontSize){this.fontSize=s.fontSize;}if(s.fontColor){this.fontColor=s.fontColor;}if(s.scaleBarColor){this.scaleBarColor=s.scaleBarColor;
}if(s.fontWeight){this.fontWeight=s.fontWeight;}if(s.boxShadow){this.boxShadow=s.boxShadow;}if(s.maxLength){this.maxLength=s.maxLength;
}this.updateScaleBarGroup();},setFormat:function(s){if(e.isNull(s)){return;}this.format=s;if(e.notNull(this.map)){this.updateScaleBarGroup();
}},display:function j(t,s){j.base.call(this,t,s);this.pageDirection=e.util.DomUtil.getPageDirection(this.map);
this.updateScaleBarGroup();},updateScaleBarGroup:function(){var s=this;var u=this.map;if(e.isNull(u)||!u.displayed){return;
}u.ScaleBar=this;s.shadowFilter=null;var t=function(w){var x=w.fpsLength;var A=w.metricLength;var z=w.fpsText;
var v=w.metricText;if(s.format==="METRIC"||s.format==="IMPERIAL"){if(s.format==="METRIC"){s.topScaleBarHost.length=A;
s.topScaleBarHost.text=v;}else{s.topScaleBarHost.length=x;s.topScaleBarHost.text=z;}s.createScaleBar();
}else{s.topScaleBarHost.length=x;s.topScaleBarHost.text=z;s.bottomScaleBarHost.length=A;s.bottomScaleBarHost.text=v;
s.createScaleBar();}var y=e.event.MapEvent;if(s.anchorPosition){s.setAnchorPosition();u.on(y.MAP_RESIZED,s.setAnchorPosition,s);
}u.on(y.I_MAP_CENTER_ZOOM,s.updateScale,s);u.on(y.MAP_RECENTERED,s.updateScale,s);};this.decideScale(u,this.maxLength,t);
},createScaleBar:function(){var s=false;if(this.$DecorationDiv.css("display")==="none"){this.$DecorationDiv.css("display","");
s=true;}this.$DecorationDiv.empty();this.$topTextBarDiv=e.$("<div class='omv2_scaleText' id='_topScaleBar'></div>");
this.$botTexBarDiv=e.$("<div class='omv2_scaleText' id='_botomScaleBar'></div>");this.$topScaleBar=e.$("<div class='omv2_scaleBar' id='_topScaleBar'></div>");
this.$bottomScaleBar=e.$("<div class='omv2_scaleBar' id='_botomScaleBar'></div>");this.$topScaleText=e.$(document.createElement("span"));
this.$bottomScaleText=e.$(document.createElement("span"));this.renderDivLength();this.renderText();this.$topTextBarDiv.append(this.$topScaleText);
this.$botTexBarDiv.append(this.$bottomScaleText);if(e.isNull(this.topScaleBarHost.length)){this.$topScaleBar.css({width:"0px",height:"0px",border:"0"});
}if(e.isNull(this.bottomScaleBarHost.length)){this.$bottomScaleBar.css({width:"0px",height:"0px",border:"0"});
}this.$DecorationDiv.append(this.$topTextBarDiv);var A=this.$topScaleText.height();var x=this.$topScaleText.width();
var u=Math.floor(A/2);this.$botTexBarDiv.css({left:"0px",top:A+"px"});this.$DecorationDiv.append(this.$botTexBarDiv);
var t=this.$bottomScaleText.width();var w=0;if(t>=x){w=t;}else{w=x;}this.$topScaleBar.css({left:w+"px",top:u+"px"});
this.$DecorationDiv.append(this.$topScaleBar);var y=(u+A);this.$bottomScaleBar.css({left:w+"px",top:y+"px"});
this.$DecorationDiv.append(this.$bottomScaleBar);this.$DecorationDiv.height(this.$topScaleText.height()+this.$bottomScaleText.height()+13);
this.width=this.$DecorationDiv.width()+this.maxLength;this.height=this.$DecorationDiv.height();if(s){this.$DecorationDiv.css("display","none");
}if(this.map._decoration[this.type]){this.map._decoration[this.type].$DecorationDiv.find("table").remove();
if(!this.map._decoration[this.type].contentStyle){this.map._decoration[this.type].$DecorationDiv.css({background:"white"});
}else{this.map._decoration[this.type].$DecorationDiv.css(this.map._decoration[this.type].contentStyle);
}var z=this;var v=z.map._decoration[this.type].$DecorationDiv.height();setTimeout(function(){z.$DecorationDiv.css({position:"absolute",top:v-z.height});
},100);this.map._decoration[this.type].$DecorationDiv.append(this.$DecorationDiv);this.$DecorationDiv.css({"z-index":"9999999999"});
}},renderDivLength:function(){this.$topScaleBar.width(this.topScaleBarHost.length);this.$bottomScaleBar.width(this.bottomScaleBarHost.length);
if(this.topScaleBarHost.length>=this.bottomScaleBarHost.length){this.$DecorationDiv.width(this.topScaleBarHost.length);
}else{this.$DecorationDiv.width(this.bottomScaleBarHost.length);}},renderText:function(){this.$topScaleText.css({"font-size":this.fontSize,color:this.fontColor,"font-weight":this.fontWeight});
this.$bottomScaleText.css({"font-size":this.fontSize,color:this.fontColor,"font-weight":this.fontWeight});
if(this.pageDirection){this.$topScaleText.text(this.topScaleBarHost.text);this.$bottomScaleText.text(this.bottomScaleBarHost.text);
}else{this.$topScaleText.text(this.topScaleBarHost.text.split(" ").reverse().join(" "));this.$bottomScaleText.text(this.bottomScaleBarHost.text.split(" ").reverse().join(" "));
}},round125:function(u){var s=u;if(s>1){var t=0;while(s>=10){s=s/10;t=t+1;}if(s>=5){s=5;}else{if(s>=2){s=2;
}else{s=1;}}while(t>0){s=s*10;t=t-1;}}return s;},decideScale:function(s,C,u){var v;var w;var B;var x;
var F=this;var y=function(){w=F.round125(v);if(w>=1000){var G=F.round125(v/1000);var K=v/1000;x=Math.round(F.maxLength*G/K);
B=G+" "+e.gv.getLabel("MAPVIEWER_SB_KILOMETERS");}else{x=Math.round(F.maxLength*w/v);B=w+" "+e.gv.getLabel("MAPVIEWER_SB_METERS");
}var L=v/1609.344;var J=v*3.28084;var O;var M;if(L>=1){var P=F.round125(L);O=Math.round(F.maxLength*P/L);
M=P+" "+e.gv.getLabel("MAPVIEWER_SB_MILES");}else{var N=F.round125(J);O=Math.round(F.maxLength*N/J);M=N+" "+e.gv.getLabel("MAPVIEWER_SB_FEET");
}var I={};I.fpsLength=O;I.metricLength=x;I.fpsText=M;I.metricText=B;return I;};var D=C/2;var A=s.getScreenPointLocation(s.getMapContext().getDeviceWidth()/2-D,s.getMapContext().getDeviceHeight()/2);
var z=s.getScreenPointLocation(s.getMapContext().getDeviceWidth()/2+D,s.getMapContext().getDeviceHeight()/2);
var E=new e.geometry.LineString([A.getX(),A.getY(),z.getX(),z.getY()],A.srid);var t=function(G){v=G;u(y());
};v=e.util.GeomUtil.getLength(E,t,{unit:"METER",transformToGeodetic:true});return;},remove:function q(){q.base.call(this);
var s=this.map;var t=e.event.MapEvent;if(this.anchored){s.deleteListener(t.MAP_RESIZED,this._setAnchorPosition,this);
}s.deleteListener(t.I_MAP_CENTER_ZOOM,this.updateScale,this);s.deleteListener(t.MAP_RECENTERED,this.updateScale,this);
this.map.ScaleBar=null;},getTopScaleValue:function(){return this.topScaleBarHost.text.split(" ")[0];},getBottomScaleValue:function(){if(this.format==="BOTH"){return this.bottomScaleBarHost.text.split(" ")[0];
}else{return"";}},getTopScaleUnit:function(){return this.topScaleBarHost.text.split(" ")[1];},getBottomScaleUnit:function(){if(this.format==="BOTH"){return this.bottomScaleBarHost.text.split(" ")[1];
}else{return"";}},getTopScaleBar:function(){var s=this.$topScaleBar.css({position:"relative",top:"0px",left:""});
return s;},getBottomScaleBar:function(){if(this.format==="BOTH"){var s=this.$bottomScaleBar.css({position:"relative",top:this.padding,left:""});
return s;}}});e.control.OverviewMap=e.control.MapDecoration.extend({initialize:function b(s){this.isInternal=true;
this.type="OverviewMap";this.isHtml=true;this.visible=true;this.mainmap=null;this.submap=null;this.layer=null;
this.rectangleFeature=null;this.overFeatureLayer=null;this.cursorStyleDragging=e.CursorTypes.POINTER;
this.cursorStyleDefault=e.CursorTypes.POINTER;this.scaleRatio=null;this.enableAnimation=false;this.rectangleStyle=s.rectStyle||new e.style.Color({strokeThickness:1,stroke:"#f0ff00",fill:"#ff0000",fillOpacity:0.3});
this.actionOnMainMap=false;this.actionOnSubMap=false;this.collapsible=true;this.minimized=false;if(s.anchorPosition){this.anchorPosition=parseInt(s.anchorPosition);
}else{this.anchorPosition=6;}this.minOffset=10;},display:function j(u,s){this.minimized=false;j.base.call(this,u,s);
this.overviewMapDIV=this.$DecorationDiv[0];var t=this;e.$(this.overviewMapDIV).mousewheel(function(w){w.stopPropagation();
});this.mainmap=this.map;this.submap=new e.Map(this.overviewMapDIV,{mapviewerURL:this.mainmap.mapviewerURL,over:true,wraparound:false});
this.setOverviewMapSize();this.submap.enableMapZoom(this.mainmap.zoomEnabled);if(!this.mainmap.displayed){return;
}var v=setInterval(function(){if(t.mainmap&&t.mainmap.displayed){clearInterval(v);t.map.changeOverView();
t.doinit();t.collapse();}else{if(e.isNull(t.mainmap)||(t.mainmap.graphics)){clearInterval(v);}}},50);
},doinit:function(){if(e.notNull(this.mainmap.overviewLayer)){this.layer=this.mainmap.overviewLayer.clone("over_"+this.mainmap.overviewLayer.name,true);
}if(this.layer){if(this.submap.getLayerByName(this.layer.name)){return;}this.submap.addLayer(this.layer);
}this.overFeatureLayer=this.submap.getDefaultFeatureLayer();var t=this.mainmap.getMapContext();var x=this.submap.getMapContextToken();
x.universe=t.getUniverse().clone();this.submap.setMapCenter(t.getCenterPoint().clone());this.submap.setMapZoomLevel(t.getZoomLevel()-this.calMapZoomDiff());
this.submap.enableMapAction.drag=false;this.submap.enableMapAction.click=false;this.submap.enableMapAction.dbclick=false;
this.submap.enableMapAction.mousewheel=false;var v=this;var u=function(){var z=v.mainmap.getMapWindowBoundingBox();
v.rectangleFeature=new e.layer.EditableFeature("overview_rectangle",z,{renderingStyle:v.rectangleStyle});
var y=e.event.LayerEvent;v.overFeatureLayer.addFeature(v.rectangleFeature);v.rectangleFeature.on(y.FEATURE_MOVED,v.endDragRect,v);
v.rectangleFeature.on(y.FEATURE_MOVING,v.draggingRect,v);v.overFeatureLayer.on(y.FEATURES_DISPLAYED,function(){this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault});
},v);if(z.getWidth()>=v.submap.getMapWindowBoundingBox().getWidth()){v.rectangleFeature.setVisible(false);
}};this.submap.on(e.event.MapEvent.MAP_INITIALIZED,u);this.submap.init();this.submap.showProgressBar(false);
var w=function(){if(v.layer&&(v.layer.layerType==e.LayerTypes.EXTERNAL)){v.setCenterAndZoomlevel();v.submap.refreshMap();
}else{v.setCenterAndZoomlevel();}this.endDragRect();};var s=function(){this.resize();this.setAnchorPosition(this.anchorPosition);
this.setRectangleFeature();this.endDragRect();};this.on(e.event.MapDecorationEvent.AFTER_RESTORE,w);this.mainmap.on(e.event.MapEvent.MAP_RESIZED,s,this);
},clean:function(){},resize:function p(){this.setOverviewMapSize();p.base.call(this);},setOverviewMapSize:function k(){var u=this.mainmap.getMapContext().getDeviceWindow();
var t=Math.round(u.w*0.3);var s=Math.round(u.h*0.3);var v=this.submap.getMapContextToken();v.deviceWindow.w=t;
v.deviceWindow.h=s;this.setSize(t,s);},draggingRect:function(){if(this.cursorStyleDragging){this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDragging});
}},endDragRect:function(){var t=this.rectangleFeature.geo.getCenter();var s=this.mainmap.getMapContext().getZoomLevel();
this.mainmap.setMapCenterAndZoomLevel(t,s);this.setRectangleFeature();this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault});
},remove:function q(){q.base.call(this);this.rectangleFeature=null;this.overFeatureLayer=null;this.layer=null;
if(this.submap){this.submap.destroyMap();}this.rectangleStyle=null;this.overviewMapDIV=null;this.mainmap=null;
this.submap=null;this.map=null;this._display=null;this.resize=null;this.refreshMainMap=null;this.endDragRect=null;
this.setRectangleFeature=null;this.styleChange=null;this.layerAdd=null;this.layerDel=null;},setRectangleFeature:function(){var u=this.mainmap.getMapWindowBoundingBox();
if(e.isNull(u)||e.isNull(this.submap.getMapWindowBoundingBox())){return;}if(u.getWidth()>=this.submap.getMapWindowBoundingBox().getWidth()&&!this.mainmap.wraparound){this.rectangleFeature.setVisible(false);
}else{if(!(u.getWidth()>=this.submap.getMapWindowBoundingBox().getWidth()&&this.mainmap.wraparound)){this.rectangleFeature.setGeometry(u);
}this.rectangleFeature.setVisible(true);if(this.mainmap.getMapZoomLevel()<3&&this.mainmap.wraparound){this.rectangleFeature.setVisible(false);
}}if(this.mainmap.wraparound){var t=this.mainmap.getMapContext().getUniverse().getZoomLevels();var v=this.mainmap.getMapZoomLevel();
var s=30/t[v].resolution;if(this.mainmap.getMapCenter().getX()<-160){this.mainmap.pan(s,0);}if(this.mainmap.getMapCenter().getX()>160){this.mainmap.pan(-s,0);
}}},styleChange:function(u){var s=u.affectLayer;if(this.layer&&("over_"+s.name==this.layer.name&&s.layerType==this.layer.layerType)){var t=u.newStyle;
if(t&&t.styleType=="HeatMap"&&t.containerVectorLayer){t=t.clone();t.containerVectorLayer=t.containerVectorLayer.clone("over_"+t.containerVectorLayer.name,true,true);
}this.layer.setRenderingStyle(t,u.attributes);}},nsdpMapped:function(w){var t=w.affectLayer;if(this.layer&&("over_"+t.name==this.layer.name&&t.layerType==this.layer.layerType)){this.layer.clearFeatureShapes();
this.layer.featureArray=[];var s=t.featureArray.length;for(var v=0;v<s;v++){var u=t.featureArray[v].clone();
this.layer.featureArray.push(u);}this.layer.redraw();}},layerAdd:function(){},layerDel:function(s){var t=s.affectedLayer;
if(t&&this.layer&&this.layer.name==("over_"+t.name)&&t.layerType==this.layer.layerType){if(this.layer.copyFeatures){this.mainmap.overviewLayer.deleteListener(e.event.LayerEvent.FEATURES_LOADED,this.layer.copyFeatures);
}this.submap.removeLayer(this.layer);this.mainmap.overviewLayer=null;this.layer=null;}},setCenterAndZoomlevel:function(){if(this.minimized){return;
}var s=this.mainmap.getMapContext();this.submap.setMapCenterAndZoomLevel(s.getCenterPoint(),s.getZoomLevel()-this.calMapZoomDiff());
this.setRectangleFeature();},calMapZoomDiff:function(){var t=null;var s=this.mainmap.getMapContext();
var w=s.getUniverse();if(this.scaleRatio>1){t=w.getZoomLevels()[s.getZoomLevel()].resolution*this.scaleRatio;
}else{var v=this.mainmap.getMapWindowBoundingBox().getWidth();t=v/(Math.round(s.getDeviceWidth()*0.3)/2);
}for(var u=0;u<s.getZoomLevel();u++){if(w.getZoomLevels()[u+1].resolution<=t&&w.getZoomLevels()[u].resolution>=t){return s.getZoomLevel()-u;
}}if(w.getZoomLevels()[0].resolution<t){return s.getZoomLevel();}},setOverviewMapOptions:function(t){if(t.scaleRatio&&t.scaleRatio>1){if(this.scaleRatio==t.scaleRatio){return;
}this.scaleRatio=t.scaleRatio;if(this.submap&&this.submap.displayed&&this.mainmap){this.submap.setMapZoomLevel(this.mainmap.getMapContext().getZoomLevel()-this.calMapZoomDiff());
}}if(t.overviewLayer){this.mainmap.overviewLayer=t.overviewLayer;if(this.submap&&this.submap.displayed){this.submap.removeLayer(this.layer);
this.layer=t.overviewLayer.clone("over_"+t.overviewLayer.name,true);this.submap.addLayer(this.layer);
}}if(t.panelOptions){var s=t.panelOptions;if(s.style){this.rectangleStyle=s.style;if(this.submap.displayed){this.rectangleFeature.setRenderingStyle(this.rectangleStyle);
}}if(e.notNull(s.draggingCursorStyle)){this.cursorStyleDragging=s.draggingCursorStyle;}if(e.notNull(s.defaultCursorStyle)){this.cursorStyleDefault=s.defaultCursorStyle;
if(this.rectangleFeature&&this.rectangleFeature.shape){this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault});
}}if(e.notNull(s.enableAnimation)){this.enableAnimation=s.enableAnimation;}}if(e.notNull(t.anchorPosition)){this.setAnchorPosition(t.anchorPosition);
}if(e.notNull(t.display)){this.setVisible(t.display);}if(e.notNull(t.collapse)){if(t.collapse){this.collapse();
}else{this.restore();}}},refreshMainMap:function(){var t=this;if(!t.actionOnMainMap){t.actionOnSubMap=true;
var s=t.submap.getMapContext();t.mainmap.setMapCenterAndZoomLevel(s.getCenterPoint(),s.getZoomLevel()+t.calMapZoomDiff());
t.actionOnSubMap=false;}t.setRectangleFeature();},getMapConfig:function(){if(!this.overviewTileLayer.config){e.util.Logger.warning("MAPVIEWER_9001","MVOverviewMap.getMapConfig");
}else{return this.overviewTileLayer.config;}},getZoomLevel:function(){return this.submap.getZoomLevel();
},errLoadLayer:function(){var s=this.mainmap.overviewLayer;this.layer=s.clone("over_"+s.name,true);this.submap.inited=false;
if(!this.submap.displayed){this.submap.addLayer(this.layer);this.submap.init();}},enableOverViewMapZoom:function(s){if(this.submap){this.submap.enableMapZoom(s);
}}});e.control.ToolButton=e.Class.extend({mixin:e.event.EventSource,initialize:function b(v,t,u){e.util.LoadFileUtil.LoadCss(e.gv.cssResourcePath()+"toolbar.css");
this.btID=v;this.btType=t;this.btName=u&&u.buttonName;this.btIcon=u&&u.buttonIcon;this.btSelectedIcon=u&&u.buttonSelectedIcon;
this.btState=e.control.ToolButton.UP;this.tip=u&&u.tooltip;this.parentToolBar=null;this.btDiv=document.createElement("div");
this.btDiv.id=this.btID;this.btImg=document.createElement("img");this.tipDiv=document.createElement("div");
this.width=u&&u.width;this.height=u&&u.height;var s=this;s.initButton();var w=function(){if(s.btType!=e.control.ToolButton.SEPARATOR){e.$(s.parentToolBar.toolBarDecorationDiv).css("cursor","pointer");
if(s.tip){s.parentToolBar.toolBarDecorationDiv.appendChild(s.tipDiv);s.tipDiv.innerHTML=s.tip;e.$(s.tipDiv).addClass("tip_toolbar");
var A={display:"inline",left:s.btDiv.parentNode.offsetLeft+5,top:s.btDiv.parentNode.offsetTop+30,"white-space":"nowrap"};
e.$(s.tipDiv).css(A);setTimeout(function(){e.$(s.tipDiv).css({display:"none"});},4000);}}else{e.$(s.parentToolBar.toolBarDecorationDiv).css("cursor","default");
}};var z=function(A){if(s.tip){e.$(s.tipDiv).css({display:"none"});}if((s.btType==e.control.ToolButton.COMMAND)&&(s.btState==e.control.ToolButton.DOWN)){s.reset();
}A.stopPropagation();};var y=function(A){var B=e.event.ToolbarEvent;var E=new e.event.ToolbarEvent(B.BUTTON_STATE_CHANGE,s);
E.btID=s.btID;s.fire(E.type,E);A.stopPropagation();if(s.btType==e.control.ToolButton.COMMAND){s.btImg.setAttribute("src",s.btSelectedIcon);
s.btState=e.control.ToolButton.DOWN;var F=new e.event.ToolbarEvent(B.BUTTON_DOWN,s);F.btID=s.btID;s.fire(F.type,F);
}else{if(s.btType==e.control.ToolButton.TOGGLE){if(s.btState==e.control.ToolButton.UP){s.btImg.setAttribute("src",s.btSelectedIcon);
s.btState=e.control.ToolButton.DOWN;var D=new e.event.ToolbarEvent(B.BUTTON_DOWN,s);D.btID=s.btID;s.fire(D.type,D);
}else{s.btImg.setAttribute("src",s.btIcon);s.btState=e.control.ToolButton.UP;var C=new e.event.ToolbarEvent(B.BUTTON_UP,s);
C.btID=s.btID;s.fire(C.type,C);}}}};var x=function(A){if((s.btType==e.control.ToolButton.COMMAND)&&(s.btState==e.control.ToolButton.DOWN)){s.reset();
}A.stopPropagation();};e.$(this.btImg).mouseover(w).mouseout(z).mousedown(y).mouseup(x);if(e.browser.touchSupported){e.$(this.btImg).bind("touchstart",function(A){A.preventDefault();
A.stopPropagation();y(A);});e.$(this.btImg).bind("touchend",function(A){A.preventDefault();A.stopPropagation();
x(A);});}},initButton:function(){this.btDiv.appendChild(this.btImg);e.$(this.tipDiv).css({display:"none"});
e.$(this.btDiv).addClass("btDiv_toolbar");if(this.btID.substring(this.btID.lastIndexOf("bt_")+3)=="clear"&&!e.control.ToolBar.ENABLECLEAR){e.$(this.btDiv).css({display:"none"});
}if(this.btType!=e.control.ToolButton.SEPARATOR){this.btImg.setAttribute("src",this.btIcon);if(this.width){this.btImg.setAttribute("width",this.width);
}if(this.height){this.btImg.setAttribute("height",this.height);}}},destroy:function(){e.$(this.btDiv).empty();
this.btDiv=null;this.btImg=null;this.tipDiv=null;},setToolTip:function(s){this.tip=s;},reset:function(t){if(this.tool&&t){this.tool.clear();
}if(this.btState==e.control.ToolButton.DOWN){this.btImg.setAttribute("src",this.btIcon);this.btState=e.control.ToolButton.UP;
if(this.tool&&(this.tool.getStatus()==e.tool.Tool.STARTED)){this.tool.clear();}var s=new e.event.ToolbarEvent(e.event.ToolbarEvent.BUTTON_UP,this);
s.btID=this.btID;this.fire(s.type,s);}}});e.control.ToolButton.COMMAND=0;e.control.ToolButton.TOGGLE=1;
e.control.ToolButton.SEPARATOR=2;e.control.ToolButton.UP=0;e.control.ToolButton.DOWN=1;e.control.ButtonGroup=e.Class.extend({initialize:function(){this.toolButtons=[];
this.toolBar=null;var s=this;this.onToolButtonStateChange=function(w){var v=w.btID;var t=false;if(v.substring(v.lastIndexOf("bt_")+3)=="clear"){t=true;
}if(s.toolButtons){for(var u in s.toolButtons){if(v!=u&&(s.toolButtons[u] instanceof e.control.ToolButton)){(s.toolButtons[u]).reset(t);
}}}};},add:function(s){this.toolButtons[s.btID]=s;s.group=this;s.on(e.event.ToolbarEvent.BUTTON_STATE_CHANGE,this.onToolButtonStateChange);
if(this.toolBar){this.toolBar.addButton(s);}}});e.control.ToolBar=e.control.MapDecoration.extend({initialize:function(y,u){if(u&&e.notNull(u.orientation)&&u.orientation==e.control.ToolBar.VERTICAL){this.direction=u.orientation;
}else{this.direction=e.control.ToolBar.HORIZONTAL;}if(u&&e.notNull(u.enableClear)){e.control.ToolBar.ENABLECLEAR=u.enableClear;
}else{e.control.ToolBar.ENABLECLEAR=true;}y=new Date().getTime();this.innerID=y;this.map=null;this.toolBarDecoration=null;
this.toolBarDecorationDiv=null;this.toolBarTB=null;this.left=0.35;this.top=0.05;var t=this;var s=e.gv.toolButtonW;
var v=e.gv.toolButtonH;if(e.browser.touchSupported){s=s*1.5;v=v*1.5;}this.addedBuiltInbts=u.builtInButtons;
this.enableBuiltInBts=[false,false,false,false,false,false];this.builtInBts=[];this.allToolBts=[];this.toBeAddedBts=[];
this.builtInButtonGroup=new e.control.ButtonGroup();this.buttonGroups=[this.builtInButtonGroup];this.toolBarDecoration=new e.control.MapDecoration('<div id="div_'+t.innerID+'" style="background: white;"></div>',{offsetX:this.left,offsetY:this.top,draggable:true,contentStyle:{"border-style":"solid","border-color":"#ffffff","border-width":"2px",backgroundColor:"#ffffff",filter:"alpha(Opacity=80)","-moz-opacity":"0.8",opacity:"1"}});
this.toolBarDecoration.type="ToolBar";this.toolBarDecoration.clean=function(){};this.builtInBtSelected=function(C){var z=C.btID;
if(z==y+"_bt_clear"){for(var w in t.allToolBts){if(t.allToolBts[w].tool){var B=t.allToolBts[w].btID;if((B==y+"_bt_redline"||B==y+"_bt_distance"||B==y+"_bt_circle"||B==y+"_bt_rectangle")){t.allToolBts[w].tool.clear();
}}}}else{if((z==y+"_bt_redline")||(z==y+"_bt_distance")||(z==y+"_bt_circle")||(z==y+"_bt_rectangle")||(z==y+"_bt_zoom")){for(var A=0;
A<t.builtInBts.length;A++){if(t.builtInBts[A].btID==z){t.builtInBts[A].tool.start();}}}}};this.builtInBtUnSelected=function(z){var w=null;
if(z.btID){w=t.allToolBts[z.btID];}else{if(z.target.bt){w=z.target.bt;}else{return;}}w.reset();};this.clearTools=function(){for(var w=0;
w<t.builtInBts.length;w++){t.builtInBts[w].reset();}};var x=function(){t.toolBarTB=document.createElement("Table");
t.toolBarTB.id="tb_"+t.innerID;t.toolBarTB.style.backgroundColor="rgb(242, 237, 242)";t.toolBarTB.cellSpacing=1;
t.toolBarTB.cellPadding=0;t.toolBarTB.style.border="0px solid #7F9DB9";t.toolBarTB.style.width="100%";
t.builtInBts.push(new e.control.ToolButton(y+"_bt_clear",e.control.ToolButton.COMMAND,{buttonIcon:e.gv.resourcePath()+"tbicons/clear.gif",buttonSelectedIcon:e.gv.resourcePath()+"tbicons/p_clear.gif",width:s,height:v,tooltip:e.gv.getLabel("MAPVIEWER_TB_TIP_CLEAR")}));
t.builtInBts.push(new e.control.ToolButton(y+"_bt_circle",e.control.ToolButton.TOGGLE,{buttonIcon:e.gv.resourcePath()+"tbicons/func_circleselect_16_ena.png",buttonSelectedIcon:e.gv.resourcePath()+"tbicons/func_circleselect_16_act.png",width:s,height:v,tooltip:e.gv.getLabel("MAPVIEWER_TB_TIP_CIRCLE"),buttonName:e.control.ToolBar.BUILTIN_CIRCLE}));
t.builtInBts.push(new e.control.ToolButton(y+"_bt_rectangle",e.control.ToolButton.TOGGLE,{buttonIcon:e.gv.resourcePath()+"tbicons/func_rectangleselect_16_ena.png",buttonSelectedIcon:e.gv.resourcePath()+"tbicons/func_rectangleselect_16_act.png",width:s,height:v,tooltip:e.gv.getLabel("MAPVIEWER_TB_TIP_RECTANGLE"),buttonName:e.control.ToolBar.BUILTIN_RECTANGLE}));
t.builtInBts.push(new e.control.ToolButton(y+"_bt_redline",e.control.ToolButton.TOGGLE,{buttonIcon:e.gv.resourcePath()+"tbicons/func_polyselect_16_ena.png",buttonSelectedIcon:e.gv.resourcePath()+"tbicons/func_polyselect_16_act.png",width:s,height:v,tooltip:e.gv.getLabel("MAPVIEWER_TB_TIP_REDLINE"),buttonName:e.control.ToolBar.BUILTIN_REDLINE}));
t.builtInBts.push(new e.control.ToolButton(y+"_bt_distance",e.control.ToolButton.TOGGLE,{buttonIcon:e.gv.resourcePath()+"tbicons/func_distance_11_ena.png",buttonSelectedIcon:e.gv.resourcePath()+"tbicons/func_distance_11_act.png",width:s,height:v,tooltip:e.gv.getLabel("MAPVIEWER_TB_TIP_DISTANCE"),buttonName:e.control.ToolBar.BUILTIN_DISTANCE}));
t.builtInBts.push(new e.control.ToolButton(y+"_bt_zoom",e.control.ToolButton.TOGGLE,{buttonIcon:e.gv.resourcePath()+"tbicons/zoom.gif",buttonSelectedIcon:e.gv.resourcePath()+"tbicons/p_zoom.gif",width:s,height:v,tooltip:e.gv.getLabel("MAPVIEWER_TB_TIP_ZOOM"),buttonName:e.control.ToolBar.BUILTIN_MARQUEE_ZOOM}));
for(var w=0;w<t.builtInBts.length;w++){t.builtInBts[w].on(e.event.ToolbarEvent.BUTTON_DOWN,t.builtInBtSelected);
t.builtInButtonGroup.add(t.builtInBts[w]);}}();},setPosition:function(u,t){this.left=u;this.top=t;if(this.toolBarDecoration.map){if(this.toolBarDecoration){this.toolBarDecoration.setPosition(this.left,this.top);
}}else{var v=this.toolBarDecoration;var s=function(){v.deleteListener(e.event.MapDecorationEvent.DISPLAYED,s);
v.setPosition(u,t);};v.on(e.event.MapDecorationEvent.DISPLAYED,s);}},setVisible:function(s){if(this.toolBarDecoration){this.toolBarDecoration.setVisible(s);
}},setDraggable:function(s){if(this.toolBarDecoration){this.toolBarDecoration.setDraggable(s);}},isVisible:function(){if(this.toolBarDecoration){return this.toolBarDecoration.isVisible();
}},initBuiltInTools:function(){var s=e.control.ToolBar;var u=e.event.ToolEvent;this.toolBarDecorationDiv=document.getElementById("div_"+this.innerID);
this.toolBarDecorationDiv.appendChild(this.toolBarTB);this.builtInBts[s.BUILTIN_CIRCLE].tool=new e.tool.CircleTool(this.map);
this.builtInBts[s.BUILTIN_CIRCLE].tool.bt=this.builtInBts[s.BUILTIN_CIRCLE];this.builtInBts[s.BUILTIN_CIRCLE].tool.on(u.TOOL_END,this.builtInBtUnSelected);
this.builtInBts[s.BUILTIN_RECTANGLE].tool=new e.tool.RectangleTool(this.map);this.builtInBts[s.BUILTIN_RECTANGLE].tool.bt=this.builtInBts[s.BUILTIN_RECTANGLE];
this.builtInBts[s.BUILTIN_RECTANGLE].tool.on(u.TOOL_END,this.builtInBtUnSelected);this.builtInBts[s.BUILTIN_REDLINE].tool=new e.tool.RedlineTool(this.map);
this.builtInBts[s.BUILTIN_REDLINE].tool.bt=this.builtInBts[s.BUILTIN_REDLINE];this.builtInBts[s.BUILTIN_REDLINE].tool.on(u.TOOL_END,this.builtInBtUnSelected);
this.builtInBts[s.BUILTIN_DISTANCE].tool=new e.tool.DistanceTool(this.map);this.builtInBts[s.BUILTIN_DISTANCE].tool.bt=this.builtInBts[s.BUILTIN_DISTANCE];
this.builtInBts[s.BUILTIN_DISTANCE].tool.on(u.TOOL_END,this.builtInBtUnSelected);this.builtInBts[s.BUILTIN_MARQUEE_ZOOM].tool=new e.tool.MarqueeZoomTool(this.map,e.tool.MarqueeZoomTool.ONE_TIME);
this.builtInBts[s.BUILTIN_MARQUEE_ZOOM].tool.bt=this.builtInBts[s.BUILTIN_MARQUEE_ZOOM];this.builtInBts[s.BUILTIN_MARQUEE_ZOOM].tool.on(u.TOOL_END,this.builtInBtUnSelected);
this.enableBuiltInButton(this.addedBuiltInbts);var v=this;var t=function(){for(var w=0;w<v.builtInBts.length;
w++){v.getBuiltInToolButton(w).reset();}};this.toolBarDecoration.$DecorationDiv.mousedown(t);if(e.browser.touchSupported){this.toolBarDecoration.$DecorationDiv.on("touchend",t);
}},enableBuiltInButton:function(v){for(var t=0;t<v.length;t++){if(v[t]==e.control.ToolBar.BUILTIN_ALL){for(var u=0;
u<this.enableBuiltInBts.length;u++){if(!this.enableBuiltInBts[u]){this.enableBuiltInBts[u]=true;}}break;
}else{if(v[t]<this.enableBuiltInBts.length&&v[t]>=0){this.enableBuiltInBts[0]=true;this.enableBuiltInBts[v[t]]=true;
}}}for(var s=0;s<this.builtInBts.length;s++){if(this.enableBuiltInBts[s]){this.addButton(this.builtInBts[s]);
}}},removeButton:function(x){if(!x){return;}for(var s=this.toBeAddedBts.length-1;s>=0;s--){if(this.toBeAddedBts[s]==x){this.toBeAddedBts.splice(s,1);
}}if(!this.map){return;}delete this.allToolBts[x.btID];if(x.group){delete x.group.toolButtons[x.btID];
x.group=null;}var v;if(this.direction==e.control.ToolBar.HORIZONTAL){var t=this.toolBarTB.firstChild.firstChild;
if(t.childNodes.length===0){return;}else{v=t.childNodes;for(var u=0;u<v.length;u++){if(v[u].id=="_td_"+x.btID){t.deleteCell(u);
}}}}else{if(this.toolBarTB.firstChild.childNodes.length===0){return;}else{v=this.toolBarTB.firstChild.childNodes;
for(var w=0;w<v.length;w++){if(v[w].id=="_tr_"+x.btID){this.toolBarTB.firstChild.deleteRow(w);}}}}},addButton:function(t){if(!this.map){this.toBeAddedBts.push(t);
return;}if(t.btType==e.control.ToolButton.SEPARATOR){if(this.direction==e.control.ToolBar.HORIZONTAL){t.btImg.setAttribute("src",e.gv.resourcePath()+"tbicons/bk_v.png");
}else{t.btImg.setAttribute("src",e.gv.resourcePath()+"tbicons/bk_h.png");}}var s=null;var u=null;if(this.direction==e.control.ToolBar.HORIZONTAL){if(this.toolBarTB.childNodes.length===0){s=this.toolBarTB.insertRow(0);
}else{s=this.toolBarTB.firstChild.firstChild;}u=s.insertCell(s.childNodes.length);u.id="_td_"+t.btID;
}else{if(this.toolBarTB.childNodes.length===0){s=this.toolBarTB.insertRow(0);}else{s=this.toolBarTB.insertRow(this.toolBarTB.firstChild.childNodes.length);
}s.id="_tr_"+t.btID;u=s.insertCell(0);}t.parentToolBar=this;u.appendChild(t.btDiv);this.allToolBts[t.btID]=t;
},initCustomBts:function(){for(var s=0;s<this.toBeAddedBts.length;s++){this.addButton(this.toBeAddedBts[s]);
}},getBuiltInTool:function(s){if(this.builtInBts[s]){return this.builtInBts[s].tool;}else{return null;
}},getBuiltInToolButton:function(s){if(this.builtInBts[s]){return this.builtInBts[s];}else{return null;
}},addSeparator:function(s){var t=new e.control.ToolButton(s,e.control.ToolButton.SEPARATOR);this.addButton(t);
},removeSeparator:function(t){for(var s=this.toBeAddedBts.length-1;s>=0;s--){if(this.toBeAddedBts[s].btID==t){this.removeButton(this.toBeAddedBts[s]);
break;}}},destroy:function(){this.map=null;this.toolBarDecoration=null;this.toolBarDecorationDiv=null;
this.allToolBts=null;for(var s=0;s<this.builtInBts&&this.builtInBts.length;s++){this.builtInBts[s].destroy();
this.builtInBts[s]=null;}this.builtInBts=null;this.DrawingButtonGroup=null;this.buttonGroups=null;this.buttonsToAdd=null;
}});e.control.ToolBar.VERTICAL=0;e.control.ToolBar.HORIZONTAL=1;e.control.ToolBar.ENABLECLEAR=true;e.control.ToolBar.BUILTIN_CLEAR=0;
e.control.ToolBar.BUILTIN_CIRCLE=1;e.control.ToolBar.BUILTIN_RECTANGLE=2;e.control.ToolBar.BUILTIN_REDLINE=3;
e.control.ToolBar.BUILTIN_DISTANCE=4;e.control.ToolBar.BUILTIN_MARQUEE_ZOOM=5;e.control.ToolBar.BUILTIN_ALL=6;
e.control.Magnifier=e.control.MapDecoration.extend({initialize:function b(s){b.base.call(this);this.isInternal=true;
this.draggable=true;this.collapsible=true;this.innerID=null;this.width=s.width?s.width:150;this.height=s.height?s.height:150;
this.zoomIncrement=s.zoomIncrement?s.zoomIncrement:1;this.anchorPosition=s.anchorPosition?s.anchorPosition:1;
if(s.collapsible===false){this.collapsible=false;}if(s.draggable===false){this.draggable=false;}this.left=s.offsetX?s.offsetX:20;
this.top=s.offsetY?s.offsetY:20;this.type="Magnifier";this.isHtml=true;this.mainmap=null;this.submap=null;
this.layer=null;this.overFeatureLayer=null;this.cursorStyleDragging=null;this.cursorStyleDefault=null;
this.scaleRatio=null;this.actionOnMainMap=false;this.actionOnSubMap=false;this.mapWidth=0;this.mapHeight=0;
this.zommLevel=0;},display:function j(t,s){j.base.call(this,t,s);this.MagnifierMapDIV=this.$Content;this.mainmap=this.map;
this.doinit();},centerAndZoomlevel:function(s){if(!this.actionOnSubMap){this.actionOnMainMap=true;this.setCenterAndZoomlevel(s);
this.actionOnMainMap=false;}},resize:function(){this.setAnchorPosition(this.anchorPosition);this.moveX=parseFloat(this.$DecorationDiv.css("left"),10);
this.moveY=parseFloat(this.$DecorationDiv.css("top"),10);this.moveX=(this.moveX+this.width/2)*this.mainmap.getMapContext().getDeviceWidth()/this.mapWidth-this.width/2;
this.moveY=(this.moveY+this.height/2)*this.mainmap.getMapContext().getDeviceHeight()/this.mapHeight-this.height/2;
this.$DecorationDiv.css({left:this.moveX});this.$DecorationDiv.css({top:this.moveY});this.submap.getMapContextToken().transform=null;
this.submap.getMapContext().getTransform();this.submap.graphics.setLeftTop(this.submap.draggableGroup,0,0);
this.refreshSubMap();this.mapWidth=this.mainmap.getMapContext().getDeviceWidth();this.mapHeight=this.mainmap.getMapContext().getDeviceHeight();
},refreshSubMap:function(){var A=this;var v=A.mainmap.getMapContext();var x=v.getDeviceWidth()/2-A.moveX-A.width/2;
var w=v.getDeviceHeight()/2-A.moveY-A.height/2;var t=v.getZoomLevel();var z=v.getUniverse().getZoomLevels()[t];
var B=x*z.resolution;var y=w*z.resolution*z.stretchRatio;var s=v.getCenterPoint();var u=new e.geometry.Point(s.getX()-B,s.getY()+y,s.getSRID());
var C=v.getUniverse().getZoomLevelNumber();if((t+A.zoomIncrement)>=C){A.submap.setMapCenterAndZoomLevel(u,C-1);
}else{A.submap.setMapCenterAndZoomLevel(u,t+A.zoomIncrement);}A.X=-B;A.Y=y;},remove:function(){this.overFeatureLayer=null;
this.layer=null;if(this.submap){this.submap.destroyMap();}this.MagnifierMapDIV=null;this.mainmap=null;
this.submap=null;this.map=null;this.display=null;this.centerAndZoomlevel=null;this.resize=null;this.refreshSubMap=null;
},doinit:function(){this.mainmap.on(e.event.MapEvent.MAP_RESIZED,this.resize,this);this.setAnchorPosition(this.anchorPosition,5,5);
this.submap=new e.Map(this.MagnifierMapDIV,{mapviewerURL:this.mainmap.mapviewerURL,magnifier:true});this.mapWidth=this.mainmap.getMapContext().getDeviceWidth();
this.mapHeight=this.mainmap.getMapContext().getDeviceHeight();this.zoomLevel=this.mainmap.getMapContext().getZoomLevel();
for(var G=0;G<this.mainmap.divLayers.length;G++){var y=this.mainmap.divLayers[G];var J=y.name;var I=y.clone("clone_"+J);
this.submap.addLayer(I);}for(var z=2;z<this.mainmap.svgLayers.length;z++){var E=this.mainmap.svgLayers[z];
var L=E.name;if(L!=="ii_oracle_maps_internal_editing"&&L!=="ii_oracle_maps_internal_others"){var w=E.clone("clone_"+L);
this.submap.addLayer(w);}}this.overFeatureLayer=this.submap.getDefaultFeatureLayer();var t=this.mapWidth/2-this.X-this.width/2;
var v=this.mapHeight/2-this.Y-this.height/2;var D=this.mainmap.getMapContext();var B=D.getZoomLevel();
var u=D.getUniverse().getZoomLevels()[B];var A=t*u.resolution;var s=v*u.resolution*u.stretchRatio;var K=D.getCenterPoint();
var C=new e.geometry.Point(K.getX()-A,K.getY()+s,K.getSRID());if((this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement)>=this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()){this.submap.setMapCenterAndZoomLevel(C,this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()-1);
}else{this.submap.setMapCenterAndZoomLevel(C,this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement);
}this.submap.enableMapAction.mouse=false;var F=this;this.flag=false;this.submap.init();this.submap.showProgressBar(false);
this.mapdown=false;if(!e.browser.touchSupported){this.map.$oracleMapDiv.mousedown(function(){F.mapdown=true;
});this.map.$oracleMapDiv.mouseup(function(){F.mapdown=false;});this.map.$oracleMapDiv.mousemove(function(M){if(F.mapdown){F.refreshSubMap(M);
}});this.$DecorationDiv.mousedown(function(){e.$(this).css("cursor","default");if(F.draggable){e.$(this).css("cursor","move");
}F.flag=true;F.map.$oracleMapDiv.mousemove(function(){if(F.flag){var S=F.mapWidth/2-F.moveX-F.width/2;
var R=F.mapHeight/2-F.moveY-F.height/2;var Q=F.mainmap.getMapContext();var O=Q.getZoomLevel();var M=Q.getUniverse().getZoomLevels()[O];
var U=S*M.resolution;var T=R*M.resolution*M.stretchRatio;var N=Q.getCenterPoint();var P=new e.geometry.Point(N.getX()-U,N.getY()+T,N.getSRID());
var V=Q.getUniverse().getZoomLevelNumber();if((O+F.zoomIncrement)>=V){F.submap.setMapCenterAndZoomLevel(P,V-1);
}else{F.submap.setMapCenterAndZoomLevel(P,O+F.zoomIncrement);}F.X=-U;F.Y=T;}});}).mouseup(function(){e.$(this).css("cursor","default");
});F.submap.$oracleMapDiv.mouseup(function(){F.flag=false;});}if(e.browser.touchSupported){this.$DecorationDiv.bind("touchstart",function(M){F.touchStart(M);
});this.map.$oracleMapDiv.bind("touchmove",function(M){F.touchMove(M);});this.$DecorationDiv.bind("touchend",function(M){F.touchEnd(M);
});}var x=e.event.MapEvent;this.mainmap.on(x.I_MAP_CENTER_ZOOM,this.refreshSubMap,this);this.mainmap.on(x.MAP_RECENTERED,this.refreshSubMap,this);
if(e.browser.touchSupported){this.map.$oracleMapDiv.bind("touchstart",function(){F.mapdown=true;});this.map.$oracleMapDiv.bind("touchmove",function(M){if(F.mapdown){F.refreshSubMap(M);
}});this.map.$oracleMapDiv.bind("touchend",function(){F.mapdown=false;});}},touchStart:function(){this.flag=true;
},touchMove:function(){if(this.flag){var y=this.mapWidth/2-this.touchMoveX-this.width/2;var x=this.mapHeight/2-this.touchMoveY-this.height/2;
this.submap.$oracleMapDiv.css("cursor","pointer");var w=this.mainmap.getMapContext();var u=w.getZoomLevel();
var s=w.getUniverse().getZoomLevels()[u];var A=y*s.resolution;var z=x*s.resolution*s.stretchRatio;var t=w.getCenterPoint();
var v=new e.geometry.Point(t.getX()-A,t.getY()+z,t.getSRID());if((this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement)>=this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()){this.submap.setMapCenterAndZoomLevel(v,this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()-1);
}else{this.submap.setMapCenterAndZoomLevel(v,this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement);
}this.X=-A;this.Y=z;}},touchEnd:function(){this.flag=false;},setCenterAndZoomlevel:function(){if(this.minimized){return;
}this.submap.setMapCenterAndZoomLevel(this.mainmap.getMapContext().getCenterPoint(),this.mainmap.getMapContext().getZoomLevel()+1);
this.setRectangleFeature();}});e.control.LayerControl=e.control.MapDecoration.extend({initialize:function b(s){b.base.call(this);
this.isInternal=true;this.draggable=true;this.collapsible=true;s=s?s:{};s.position=s.position?s.position:{};
this.left=s.offsetX?s.offsetX:20;this.top=s.offsetY?s.offsetY:20;s.contentStyle=s.contentStyle?s.contentStyle:{};
this.width=parseInt(s.contentStyle.minWidth)?parseInt(s.contentStyle.minWidth):150;this.minWidth=this.width;
this.maxHeight=parseInt(s.contentStyle.maxHeight)?parseInt(s.contentStyle.maxHeight):500;s.titleStyle=s.titleStyle?s.titleStyle:{};
this.title_font_size=s.titleStyle.font_size?s.titleStyle.font_size:11;this.title_font_family=s.titleStyle.font_family?s.titleStyle.font_family:"Tahoma";
this.content_font_size=s.contentStyle.font_size?s.contentStyle.font_size:11;this.content_font_family=s.contentStyle.font_family?s.contentStyle.font_family:"Tahoma";
this.anchorPosition=s.anchorPosition?s.anchorPosition:1;this.layerDeleteEnable=s.layerDeleteEnable?s.layerDeleteEnable:false;
if(s.collapsible===false){this.collapsible=false;}if(s.draggable===false){this.draggable=false;}this.type="LayerControl";
this.isHtml=true;this.mainmap=null;this.layer=null;},display:function j(t,s){j.base.call(this,t,s);this.panelDIV=this.$Content;
this.mainmap=this.map;this.doinit();},remove:function q(){q.base.call(this);if(this.map){this.map.$oracleMapDiv.unbind("mousemove",this.mapDiv_mousemove);
this.map.$oracleMapDiv.unbind("mouseup",this.mapDiv_mouseup);}this.map=null;this._display=null;this.resize=null;
if(this.document_mousemove){e.$(document).unbind("mousemove",this.document_mousemove);}if(this.document_mouseup){e.$(document).unbind("mouseup",this.document_mouseup);
}if(this.document_msup){e.$(document).unbind("mouseup",this.document_msup);}},resize:function(){this.setAnchorPosition(this.anchorPosition);
},doinit:function(){this.el=null;this.scrollTop=0;this.moveY=0;this.pY=0;this.aY=0;this.aftId="";this.preId="";
this.aftClass="";this.preClass="";this.aftStyleId="";this.preStyleId="";var z=this;this.ck1=false;this.ck2=false;
this.ck3=false;this.ck4=false;this.chkAll=true;var G=0;this.flag=false;this._width=z.width;this.v_isDrag=false;
this.offsetX=0;this.array=[];this._currentWidth=this.width;var Q={};z.currentWidth=this._currentWidth;
this.setAnchorPosition(this.anchorPosition,5,5);this.mapWidth=this.map.getMapContext().getDeviceWidth();
this.mapHeight=this.map.getMapContext().getDeviceHeight();this.map.on(e.event.MapEvent.MAP_RESIZED,this.resize,this);
var S=this.mainmap.typeArray.slice(3);if(this.mainmap.divLayers.length===0){S=this.mainmap.typeArray.slice(2);
}var O=S.length;for(var M=O-1;M>=1;M--){if(S[M-1]==S[M]){S.splice(M,1);}}var J=[];for(M=0,O=S.length;
M<O;M++){!RegExp(S[M],"g").test(J.join(","))&&(J.push(S[M]));}S=J;this.$Dom=e.$("<div id='content' class='outDom_layerctrl'></div>");
this.panelDIV.append(this.$Dom);this.touchscroll("content");this.list={};this.dataSource={};for(M=0;M<this.mainmap.svgLayers.length;
M++){var U=this.mainmap.svgLayers[M].name;var F=this.mainmap.getLayerByName(U).themeName;this.list[U]=F;
this.dataSource[U]=this.mainmap.getLayerByName(U).getDataSouce();}for(M=0;M<S.length;M++){if(this.mainmap.nameArray[S[M]].length===0){continue;
}var R;if(S[M]==="undefined"){R=true;for(var I=this.mainmap.nameArray[S[M]].length-1;I>=0;I--){if(this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][I])){if(this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][I]).name!=="ii_oracle_maps_internal_others"&&this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][I]).name!=="ii_oracle_maps_internal_editing"&&this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][I]).layerType==e.LayerTypes.VECTOR){R=false;
}}}}if(R){continue;}G++;var E=document.createElement("div");E.id="dom"+M;E.setAttribute("style","position:absolute");
E.setAttribute("style","padding-top:10px;padding-left:9px;height:20px;width:"+(this.width-9+2)+"px;background:#F5F5F9;border: 0px solid #C6CAD5");
var D=document.createElement("img");D.setAttribute("name",S[M]);D.setAttribute("type","checkbox");D.setAttribute("value",S[M]);
D.setAttribute("checked","true");D.src=e.gv.resourcePath()+"checkMark_readonly.png";D.setAttribute("style","padding-left:6px;display:'';");
var V=document.createElement("img");V.src=e.gv.resourcePath()+"zoomout.gif";V.alt=S[M];if(!e.browser.touchSupported){this.typeCheckBoxEvent(D,"click");
}if(e.browser.touchSupported){this.typeCheckBoxEvent(D,"touchstart");}var T=document.createElement("text");
T.id="typeText"+G;e.$(T).addClass("typeText_layerctrl");e.$(T).css({"font-size":this.content_font_size,"font-family":this.content_font_family});
var u;if(S[M]=="undefined"){u=document.createTextNode("vector layers");}else{u=document.createTextNode(S[M]);
}T.appendChild(u);if(!e.browser.touchSupported){Q[V.alt]=1;e.$(V).click(function(){if(Q[e.$(this)[0].alt]==1){e.$("img[name = "+this.alt+"]")[0].setAttribute("style","display:none");
e.$("."+this.alt).css({display:"none"});e.$(".style_"+this.alt).css({display:"none"});z.adjustSize();
this.src=e.gv.resourcePath()+"zoomin.gif";Q[e.$(this)[0].alt]=0;}else{e.$("img[name = "+this.alt+"]")[0].setAttribute("style","padding-left:3px;display:inline;");
e.$("."+this.alt).css({display:""});z.adjustSize();this.src=e.gv.resourcePath()+"zoomout.gif";Q[e.$(this)[0].alt]=1;
}});}E.appendChild(V);E.appendChild(D);E.appendChild(T);z.$Dom.append(E);e.$(E).height(e.$(T).height()+7);
for(var K=this.mainmap.nameArray[S[M]].length-1;K>=0;K--){if(!this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][K])){continue;
}if(this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][K]).ignoreLayerControl){continue;}if(this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][K]).name=="ii_oracle_maps_internal_editing"){continue;
}if(this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][K]).name=="ii_oracle_maps_internal_others"){continue;
}if(this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][K]).layerType!=e.LayerTypes.VECTOR){continue;
}var B=document.createElement("div");B.id="item"+G+K;B.className="item "+S[M];B.setAttribute("style","display:'';padding-left:20px;height:20px;width:"+(this.width-20+2)+"px;background:#F5F5F9;border-top:0px solid white");
B.setAttribute("draggable","false");B.setAttribute("z-index","999999");if(this.layerDeleteEnable){var x=document.createElement("img");
x.setAttribute("style","display:none;margin-left:-10px;padding-top:6px;width:12px;height:12px");x.src=e.gv.resourcePath()+"cross.png";
x.setAttribute("value",this.mainmap.nameArray[S[M]][K]);x.setAttribute("name","deletebutton_layercontrol");
e.$(x).bind("click touchstart",function(){z.mainmap.removeLayer(z.mainmap.getLayerByName(e.$(this).attr("value")));
});e.$(x).bind("mouseover",function(W){W.stopPropagation();e.$(this)[0].src=e.gv.resourcePath()+"delete_ena.png";
if(z.layerDeleteEnable){e.$(this).css({display:""});}e.$(this).css({cursor:"pointer"});});e.$(x).bind("mouseout",function(){e.$(this)[0].src=e.gv.resourcePath()+"cross.png";
});B.appendChild(x);}var s=document.createElement("img");s.setAttribute("name","item_"+S[M]);s.setAttribute("type","checkbox");
s.setAttribute("value",this.mainmap.nameArray[S[M]][K]);s.className=this.mainmap.nameArray[S[M]][K];s.setAttribute("checked","true");
s.setAttribute("style","padding-left:6px;padding-top:6px");s.src=e.gv.resourcePath()+"checkMark_readonly.png";
e.$(s).mouseover(function(W){if(z.layerDeleteEnable){e.$(this).prev().css({display:""});}W.stopPropagation();
}).mousedown(function(W){W.stopPropagation();});if(!e.browser.touchSupported){this.itemCheckBoxEvent(s,"click");
if(!this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][K]).visible){e.$(s).click();}}if(e.browser.touchSupported){this.itemCheckBoxEvent(s,"touchstart");
if(!this.mainmap.getLayerByName(this.mainmap.nameArray[S[M]][K]).visible){e.$(s).trigger("touchstart");
}}var w=document.createElement("text");w.id="itemText"+G+K;e.$(w).addClass("itemText_layerctrl");e.$(w).css({"font-size":this.content_font_size,"font-family":this.content_font_family});
var P=document.createTextNode(this.mainmap.nameArray[S[M]][K]);w.appendChild(P);B.appendChild(s);B.appendChild(w);
var N="";if(!e.browser.touchSupported){e.$(w).mouseover(function(W){e.$(this).css({cursor:"pointer","font-weight":"600"});
if(z.layerDeleteEnable){e.$(this).prev().prev().css({display:""});}W.stopPropagation();}).bind("mouseout",function(W){e.$(this).css({cursor:"default","font-weight":"normal"});
if(z.layerDeleteEnable){e.$(this).prev().prev().css({display:"none"});}W.stopPropagation();}).bind("mousedown",function(W){W.stopPropagation();
});}if(e.browser.touchSupported){e.$(w).bind("touchend",function(W){e.$(this).css({cursor:"default","font-weight":"normal"});
if(z.layerDeleteEnable){e.$(this).prev().prev().css({display:"none"});}W.stopPropagation();});e.$(w).bind("touchstart",function(W){W.stopPropagation();
});}if(!e.browser.touchSupported){var v=1;var t;e.$(w).click(function(){if(v==1){if(e.$("#style"+e.$(this).attr("id")).css("display")=="none"){e.$("#style"+e.$(this).attr("id")).css({display:""});
t=this;z.getThemeStyle(t);z.adjustSize();}else{e.$("#style"+e.$(this).attr("id")).css({display:"none"});
z.adjustSize();}v=0;}else{if(e.$("#style"+e.$(this).attr("id")).css("display")=="block"||e.$("#style"+e.$(this).attr("id")).css("display")===""){e.$("#style"+e.$(this).attr("id")).css({display:"none"});
z.adjustSize();}else{e.$("#style"+e.$(this).attr("id")).css({display:""});t=this;z.getThemeStyle(t);z.adjustSize();
}v=1;}});}if(e.browser.touchSupported){z.touchEvent(V,w);}var A=document.createElement("div");A.id="styleitemText"+G+K;
A.setAttribute("style","display:none;padding-left:40px;height:20;width:"+(this.width-40+2)+"px;background:#ECF9FF;border-top:0px solid white;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;");
A.className="style style_"+S[M]+" style_"+this.mainmap.nameArray[S[M]][K];var L=document.createElement("text");
L.id="styleTextitemText"+G+K;e.$(L).addClass("styleText_layerctrl");e.$(L).css({"font-size":this.content_font_size,"font-family":this.content_font_family});
var y=document.createTextNode(N);V=document.createElement("img");V.id="imgitemText"+G+K;V.setAttribute("style","width:18px;height:18px;");
V.setAttribute("value",this.mainmap.nameArray[S[M]][K]);A.appendChild(V);L.appendChild(y);A.appendChild(L);
z.$Dom.append(B);z.$Dom.append(A);e.$(B).height(e.$(w).height()+10);e.$(A).mouseover(function(){e.$(this).css({cursor:"default"});
});}if(!e.browser.touchSupported){e.$("#dom"+(M)).mouseover(function(){e.$(this).css({cursor:"default"});
if(z.flag){e.$(this).css({background:"#B8DFFD","border-bottom":"2px solid black",opacity:"1",cursor:"n-resize"});
}}).mouseout(function(){e.$(this).css({background:"#ECF9FF","border-bottom":"0px solid black","border-top":"0px solid black",opacity:"1"});
}).bind("mouseup",function(W){if(z.flag&&e.$(this).find("img[alt]").attr("src").indexOf("zoomin")>0){e.$(this).find("img[alt]").click();
}if(z.touchFlag&&e.$(this).find("img[alt]").attr("src").indexOf("zoomin")>0){e.$(this).find("img[alt]").trigger("touchstart");
}z.itemMoveEventOnTypeDiv(W,this);if(e.browser.touchSupported){z.flag=false;z.touchFlag=false;z.ff=false;
}});}if(e.browser.touchSupported){e.$("#dom"+(M)).bind("touchstart",function(W){if(z.flag&&e.$(this).find("img[alt]").attr("src").indexOf("zoomin")>0){e.$(this).find("img[alt]").click();
}if(z.touchFlag&&e.$(this).find("img[alt]").attr("src").indexOf("zoomin")>0){e.$(this).find("img[alt]").trigger("touchstart");
}z.itemMoveEventOnTypeDiv(W,this);if(e.browser.touchSupported){z.flag=false;z.touchFlag=false;z.ff=false;
}});}if(!e.browser.touchSupported){e.$("div[id^='item']").each(function(){e.$(this)[0].onmousedown=function(W){if(W.which==3){alert("right click event!");
}else{e.$("div[id^='item']").each(function(){e.$(this).css({background:"#ECF9FF"});});e.$(this).css({background:"gray"});
z.scrollTop=e.$(z.$Dom)[0].scrollTop;z.flag=true;z.preId=this.id;z.preStyleId="styleitemText"+this.id.substring(4);
z.preClass=e.$(this).attr("class");var X=arguments[0]||h.event;z.pY=X.clientY;z.cloneDiv(W);}};});}z.touchFlag=false;
z.ff=false;e.$("div[id^='item']").bind("touchstart",function(){if(!z.touchFlag){var W=e.util.DomUtil;
var X=[];var Y=W.getTouchesPosition(event);X.push(Y);z.flag=true;z.preId=this.id;z.preStyleId="styleitemText"+this.id.substring(4);
z.preClass=e.$(this).attr("class");z.pY=X[0].y;z.pX=X[0].x;z.touchFlag=true;e.$(this).css({background:"#B8DFFD"});
}}).bind("touchend",function(){if(z.touchFlag){z.ff=true;}else{z.ff=false;}e.$("div[id^='item']").css({background:"#ECF9FF"});
});if(!e.browser.touchSupported){e.$("div[id^='item']").click(function(){e.$(this).css({background:"#B8DFFD",cursor:"n-resize"});
}).mouseover(function(){if(z.layerDeleteEnable){e.$(e.$(this).find("img")[0]).css({display:""});}e.$(this).css({background:"#B8DFFD"});
if(z.flag){e.$(this).css({"border-bottom":"2px solid black",opacity:"1"});}e.$(this).css({cursor:"n-resize"});
}).mouseout(function(){if(z.layerDeleteEnable){e.$(e.$(this).find("img")[0]).css({display:"none"});}e.$(this).css({background:"#ECF9FF","border-top":"0px solid white","border-bottom":"0px solid white"});
if(z.flag){e.$("#"+z.preId).css({background:"gray"});}else{if(e.$(this)[0].id==z.preId){z.preId="";}e.$("div[id^='item']").each(function(){e.$(this).css({background:"#ECF9FF"});
});}}).bind("mouseup",function(W){z.itemMoveEventOnItemDiv(W,this);});}}if(e.browser.touchSupported){e.$("div[id^='item']").bind("touchstart",function(W){z.itemMoveEventOnItemDiv(W,this);
});}if(this.$Dom.height()>this.maxHeight){this.$Dom.height(this.maxHeight);}else{}var C=document.createElement("div");
C.id="v_drag";if(e.browser.touchSupported){C.setAttribute("style","cursor: e-resize;z-index:5000000;position:absolute;top:0px;left:"+(parseInt(this.width)-10)+"px;height:"+this.$title.height()+"px;width:12px;background:#E0E0E0;border:0px solid gray");
}else{C.setAttribute("style","cursor: e-resize;z-index:5000000;position:absolute;top:0px;left:"+this.width+"px;height:"+this.$title.height()+"px;width:2px;background:#E0E0E0;border:0px solid gray");
}this.panelDIV[0].appendChild(C);this.mouseEvent();e.$("img[class][type='checkbox'][checked='true']").each(function(){z.array.push(e.$(this).attr("value"));
});z.array=[];this.height=this.$Dom.height();this.setAnchorPosition(this.anchorPosition,5,5);this.panelDIV.height(this.$Dom.height());
},typeCheckBoxEvent:function(s,t){var v=this;var u=true;e.$(s).mouseover(function(){e.$(this).css({cursor:"default"});
});e.$(s).bind(t,function(){if(e.$(this)[0].getAttribute("checked")=="false"){u=false;}if(u){v.chkAll=false;
e.$(this)[0].setAttribute("checked","false");e.$(this)[0].src=e.gv.resourcePath()+"checkMark_NS_readonly.png";
e.$("img[name = item_"+this.name+"]").attr("src",e.gv.resourcePath()+"checkMark_NS_readonly.png");e.$("img[name = item_"+this.name+"]").each(function(){e.$(this)[0].setAttribute("checked","false");
v.map.getLayerByName(e.$(this).attr("value")).setVisible(false);});u=false;}else{v.chkAll=true;e.$(this)[0].setAttribute("checked","true");
e.$(this)[0].src=e.gv.resourcePath()+"checkMark_readonly.png";e.$("img[name = item_"+this.name+"]").attr("src",e.gv.resourcePath()+"checkMark_readonly.png");
e.$("img[name = item_"+this.name+"]").each(function(){e.$(this)[0].setAttribute("checked","true");v.map.getLayerByName(e.$(this).attr("value")).setVisible(true);
});u=true;}});},itemCheckBoxEvent:function(s,u){var v=this;var t=true;e.$(s).mouseover(function(){e.$(this).css({cursor:"default"});
});e.$(s).bind(u,function(w){w.stopPropagation();if(e.$(this)[0].getAttribute("checked")=="true"){t=true;
}else{t=false;}var x;var y=0;if(t){e.$("img[name = "+this.name+"]").each(function(){if(e.$(this)[0].getAttribute("checked")=="true"){y+=1;
}});e.$(this)[0].setAttribute("checked","false");x=this.name.substr(5);e.$(this)[0].src=e.gv.resourcePath()+"checkMark_NS_readonly.png";
if(y<2){e.$("img[name = "+x+"]")[0].src=e.gv.resourcePath()+"checkMark_NS_readonly.png";}v.map.getLayerByName(e.$(this).attr("value")).setVisible(false);
}else{e.$(this)[0].setAttribute("checked","true");x=this.name.substr(5);e.$(this)[0].src=e.gv.resourcePath()+"checkMark_readonly.png";
e.$("img[name = "+x+"]")[0].src=e.gv.resourcePath()+"checkMark_readonly.png";v.map.getLayerByName(e.$(this).attr("value")).setVisible(true);
}});},typeDivEvent:function(){},itemDivEvent:function(){},mouseEvent:function(){var s=this;e.$("#v_drag").mousedown(function(t){s.v_isDrag=true;
s.offsetX=t.clientX;}).mouseup(function(){s.v_isDrag=false;s._currentWidth=s._width;s.currentWidth=s._currentWidth;
});this.panelDIV.mouseup(function(){s.v_isDrag=false;s._currentWidth=s._width;s.currentWidth=s._currentWidth;
});this.document_mouseup=function(){s.v_isDrag=false;s._currentWidth=s._width;s.currentWidth=s._currentWidth;
};e.$(document).mouseup(this.document_mouseup);e.$("#v_drag").mouseout(function(){s.$title.removeClass("titleStyleDwn_layerctrl");
s.$title.removeClass("titleStyleOvr_layerctrl");s.$title.addClass("titleStyleEna_layerctrl");});s.mapDiv_mousemove=function(t){if(s.v_isDrag){t=h.event?h.event:t;
s._width=(t.clientX-s.offsetX)+s._currentWidth;if(s._width>=s.minWidth){e.$("#content div").width(s._width-9+2);
e.$(".item").width(s._width-20+2);e.$(".style").width(s._width-49+9+2);s.panelDIV.width(s._width);e.$("#v_drag")[0].style.left=s._width+"px";
s.$title.width(s._width-6);}else{s._width=s.minWidth;}}};s.mapDiv_mouseup=function(){s.v_isDrag=false;
s._currentWidth=s._width;s.currentWidth=s._currentWidth;};this.map.$oracleMapDiv.mousemove(s.mapDiv_mousemove);
this.map.$oracleMapDiv.mouseup(s.mapDiv_mouseup);this.$title.mouseup(function(t){t.stopPropagation();
s.v_isDrag=false;s._currentWidth=s._width;s.currentWidth=s._currentWidth;e.$(this).removeClass("titleStyleEna_layerctrl");
e.$(this).removeClass("titleStyleDwn_layerctrl");e.$(this).addClass("titleStyleOvr_layerctrl");s.flag=false;
e.$("div[id^='item']").each(function(){e.$(this).css({background:"#ECF9FF"});});if(s.el){s.container[0].removeChild(s.el);
s.el=null;}}).mouseover(function(){if(!s.draggable){e.$(this).css({cursor:"default"});}if(s.dragging){e.$(this).removeClass("titleStyleEna_layerctrl");
e.$(this).removeClass("titleStyleOvr_layerctrl");e.$(this).addClass("titleStyleDwn_layerctrl");}else{e.$(this).removeClass("titleStyleEna_layerctrl");
e.$(this).removeClass("titleStyleDwn_layerctrl");e.$(this).addClass("titleStyleOvr_layerctrl");}}).mousedown(function(){e.$(this).removeClass("titleStyleEna_layerctrl");
e.$(this).removeClass("titleStyleOvr_layerctrl");e.$(this).addClass("titleStyleDwn_layerctrl");}).mouseout(function(){if(s.dragging){e.$(this).removeClass("titleStyleEna_layerctrl");
e.$(this).removeClass("titleStyleOvr_layerctrl");e.$(this).addClass("titleStyleDwn_layerctrl");}else{e.$(this).removeClass("titleStyleDwn_layerctrl");
e.$(this).removeClass("titleStyleOvr_layerctrl");e.$(this).addClass("titleStyleEna_layerctrl");}});if(e.browser.touchSupported){e.$("#v_drag").bind("touchstart",function(v){s.v_isDrag=true;
var t=e.util.DomUtil;var u=[];var w=t.getTouchesPosition(v);u.push(w);s.offsetX=u[0].x;});e.$("#v_drag").bind("touchend",function(){s.v_isDrag=false;
s._currentWidth=s._width;s.currentWidth=s._currentWidth;});e.$("#v_drag").bind("touchmove",function(v){if(s.v_isDrag){var t=e.util.DomUtil;
var u=[];var w=t.getTouchesPosition(v);u.push(w);s._width=(u[0].x-s.offsetX)+s._currentWidth;if(s._width>s.minWidth){e.$("#content div").width(s._width-9+2);
e.$(".item").width(s._width-20+2);e.$(".style").width(s._width-49+9+2);s.panelDIV.width(s._width);e.$("#v_drag")[0].style.left=(s._width-10)+"px";
s.$title.width(s._width-6);}else{s._width=s.width;}}});this.$title.bind("touchend",function(t){t.stopPropagation();
s.v_isDrag=false;s._currentWidth=s._width;s.currentWidth=s._currentWidth;e.$(this).removeClass("titleStyleDwn_layerctrl");
e.$(this).removeClass("titleStyleOvr_layerctrl");e.$(this).addClass("titleStyleEna_layerctrl");}).bind("touchstart",function(){e.$(this).removeClass("titleStyleEna_layerctrl");
e.$(this).removeClass("titleStyleOvr_layerctrl");e.$(this).addClass("titleStyleDwn_layerctrl");});}},itemMoveEventOnTypeDiv:function(B,t){var A=this;
e.$("div[id^='item']").css({background:"#ECF9FF"});e.$(t).css({cursor:"default",background:"#ECF9FF","border-bottom":"0px solid black","border-top":"0px solid black",opacity:"1"});
if(A.flag){if(A.el){A.container[0].removeChild(A.el);A.el=null;}A.aftId=t.id;A.aftClass="item "+e.$(t).find("img[name]").attr("name");
A.aftStyleId="styleitemText"+t.id.substring(4);t.$preDiv=e.$("#"+A.preId);t.$aftDiv=e.$("#"+A.aftId);
t.$preStyleDiv=e.$("#"+A.preStyleId);t.$aftStyleDiv=e.$("#"+A.aftStyleId);t.$temp=t.$aftDiv.next();var v=t.$preDiv.attr("class");
v=v.substring(5);var w=e.$(".item."+v).length;if(w==1&&v==e.$(t).find("img[name]").attr("name")){A.flag=false;
return;}if(w==1){e.$("img[name="+v+"]").parent().find("img").css("display","none");}else{e.$("img[name="+v+"]").parent().find("img").css({display:"inline"});
}var s=e.$(".item."+e.$(t).find("img[name]").attr("name")).length;if(s===0){e.$("img[name="+e.$(t).find("img[name]").attr("name")+"]").parent().find("img").css({display:"inline"});
}t.$preDiv.insertAfter(t.$aftDiv);t.$preStyleDiv.insertAfter(t.$preDiv);t.$preDiv.attr("class",A.aftClass);
var C=t.$preStyleDiv.attr("class").split(" ");C[1]="style_"+e.$(t).find("img[name]").attr("name");var D=C[0]+" "+C[1]+" "+C[2];
t.$preStyleDiv.attr("class",D);A.aftClass=A.aftClass.replace(" ","_");if(A.layerDeleteEnable){e.$("#"+A.preId).children().eq(1).attr("name",A.aftClass);
}else{e.$("#"+A.preId).children().eq(0).attr("name",A.aftClass);}A.flag=false;e.$("img[class][type='checkbox']").each(function(){A.array.push(e.$(this).attr("value"));
});var u=A.array.length;for(var y=A.array.length-1;0<=y;y--){A.map.getLayerByName(A.array[y]).setZIndex(u+1-y);
}e.$("img[class][type='checkbox']").each(function(){if(e.$(this)[0].getAttribute("checked")=="false"){A.map.getLayerByName(e.$(this).attr("value")).setVisible(false);
}});A.array=[];var z=A.aftClass.substring(5);var x=A.preClass.substring(5);e.$("img[name = item_"+z+"]").each(function(){if(e.$(this)[0].getAttribute("checked")=="false"){A.ck2=true;
}e.$("img[name = "+z+"]")[0].src=e.gv.resourcePath()+"checkMark_readonly.png";});if(A.ck2){e.$("img[name = "+z+"]")[0].src=e.gv.resourcePath()+"checkMark_NS_readonly.png";
A.ck2=false;}A.ck4=false;e.$("img[name = item_"+x+"]").each(function(){if(e.$(this)[0].getAttribute("checked")=="false"){A.ck4=true;
}e.$("img[name ="+x+"]")[0].src=e.gv.resourcePath()+"checkMark_NS_readonly.png";});if(!A.ck4){e.$("img[name ="+x+"]")[0].src=e.gv.resourcePath()+"checkMark_readonly.png";
A.ck4=false;}}},itemMoveEventOnItemDiv:function(E,t){var B=this;if(!e.browser.touchSupported){B.ff=true;
}if(B.ff){e.$("div[id^='item']").css({background:"#ECF9FF"});e.$(t).css({background:"#B8DFFD",cursor:"n-resize"});
if(B.flag){e.$(t).css({"border-top":"0px solid white","border-bottom":"0px solid white"});if(B.el){B.container[0].removeChild(B.el);
B.el=null;}B.aftId=t.id;B.aftClass=e.$(t).attr("class");B.aftStyleId="styleitemText"+t.id.substring(4);
var D;if(!e.browser.touchSupported){D=arguments[0]||h.event;}t.$preDiv=e.$("#"+B.preId);t.$aftDiv=e.$("#"+B.aftId);
var v=t.$preDiv.attr("class");v=v.substring(5);var w=e.$(".item."+v).length;if(w==1){e.$("img[name="+v+"]").parent().find("img").css("display","none");
}else{e.$("img[name="+v+"]").parent().find("img").css({display:"inline"});}var s=e.$(".item."+B.aftClass.substring(5)).length;
if(s!==0){e.$("img[name="+B.aftClass.substring(5)+"]").parent().find("img").css({display:"inline"});}t.$preStyleDiv=e.$("#"+B.preStyleId);
t.$aftStyleDiv=e.$("#"+B.aftStyleId);if(t.$preDiv[0]!=t.$aftDiv[0]){if(e.browser.touchSupported){var C=e.util.DomUtil;
var F=[];var A=C.getTouchesPosition(event);F.push(A);B.aY=F[0].y;}else{B.aY=D.clientY;}B.moveY=B.aY-B.pY;
t.$temp=t.$aftDiv.next();t.$temp1=t.$preDiv.next();if(B.preId!=B.aftId){if(B.moveY>0){if(!t.$aftDiv[0].nextSibling&&t.$aftDiv[0].previousSibling!=t.$preDiv[0]){t.$tt=e.$(t.$aftDiv[0].previousSibling);
t.$aftDiv.insertBefore(t.$preDiv);t.$preDiv.insertAfter(t.$tt);t.$preStyleDiv.insertAfter(t.$preDiv);
t.$aftStyleDiv.insertAfter(t.$aftDiv);B.changeClassName(t);t.$preDiv.attr("class",B.aftClass);B.aftClass=B.aftClass.replace(" ","_");
if(B.layerDeleteEnable){e.$("#"+B.preId).children().eq(1).attr("name",B.aftClass);}else{e.$("#"+B.preId).children().eq(0).attr("name",B.aftClass);
}}else{if(t.$preDiv.next().next()[0].id==t.$aftDiv[0].id){t.$preDiv.insertAfter(t.$aftDiv);t.$preStyleDiv.insertAfter(t.$preDiv);
t.$aftStyleDiv.insertAfter(t.$aftDiv);B.changeClassName(t);t.$preDiv.attr("class",B.aftClass);B.aftClass=B.aftClass.replace(" ","_");
if(B.layerDeleteEnable){e.$("#"+B.preId).children().eq(1).attr("name",B.aftClass);}else{e.$("#"+B.preId).children().eq(0).attr("name",B.aftClass);
}}else{t.$preDiv.insertAfter(t.$aftDiv);t.$preStyleDiv.insertAfter(t.$preDiv);t.$aftStyleDiv.insertAfter(t.$aftDiv);
B.changeClassName(t);t.$preDiv.attr("class",B.aftClass);B.aftClass=B.aftClass.replace(" ","_");if(B.layerDeleteEnable){e.$("#"+B.preId).children().eq(1).attr("name",B.aftClass);
}else{e.$("#"+B.preId).children().eq(0).attr("name",B.aftClass);}}}}if(B.moveY<0){if(!t.$aftDiv[0].previousSibling&&t.$aftDiv[0].nextSibling!=t.$preDiv[0]){t.$qq=e.$(t.$aftDiv[0].nextSibling);
t.$aftDiv.insertBefore(t.$preDiv);t.$preDiv.insertBefore(t.$qq);t.$preStyleDiv.insertAfter(t.$preDiv);
t.$aftStyleDiv.insertAfter(t.$aftDiv);B.changeClassName(t);t.$preDiv.attr("class",B.aftClass);B.aftClass=B.aftClass.replace(" ","_");
if(B.layerDeleteEnable){e.$("#"+B.preId).children().eq(1).attr("name",B.aftClass);}else{e.$("#"+B.preId).children().eq(0).attr("name",B.aftClass);
}}else{t.$preDiv.insertAfter(t.$aftDiv);t.$preStyleDiv.insertAfter(t.$preDiv);t.$aftStyleDiv.insertAfter(t.$aftDiv);
B.changeClassName(t);t.$preDiv.attr("class",B.aftClass);B.aftClass=B.aftClass.replace(" ","_");if(B.layerDeleteEnable){e.$("#"+B.preId).children().eq(1).attr("name",B.aftClass);
}else{e.$("#"+B.preId).children().eq(0).attr("name",B.aftClass);}}}}e.$("img[class][type='checkbox']").each(function(){B.array.push(e.$(this).attr("value"));
});var u=B.array.length;for(var x=B.array.length-1;0<=x;x--){B.map.getLayerByName(B.array[x]).setZIndex(u+1-x);
}e.$("img[class][type='checkbox']").each(function(){if(e.$(this)[0].getAttribute("checked")=="false"){B.map.getLayerByName(e.$(this).attr("value")).setVisible(false);
}});B.array=[];var z=e.$(t).attr("class").substring(5);var y=B.preClass.substring(5);e.$("img[name = item_"+z+"]").each(function(){if(e.$(this)[0].getAttribute("checked")=="false"){B.ck3=true;
}e.$("img[name ="+z+"]")[0].src=e.gv.resourcePath()+"checkMark_readonly.png";});if(B.ck3){e.$("img[name ="+z+"]")[0].src=e.gv.resourcePath()+"checkMark_NS_readonly.png";
B.ck3=false;}B.ck4=false;e.$("img[name = item_"+y+"]").each(function(){if(e.$(this)[0].getAttribute("checked")=="false"){B.ck4=true;
}e.$("img[name ="+y+"]")[0].src=e.gv.resourcePath()+"checkMark_NS_readonly.png";});if(!B.ck4){e.$("img[name ="+y+"]")[0].src=e.gv.resourcePath()+"checkMark_readonly.png";
B.ck4=false;}}}B.flag=false;B.touchFlag=false;if(e.browser.android){e.$(t).css({background:"#ECF9FF"});
}}},changeClassName:function(u){var s=u.$preStyleDiv.attr("class").split(" ");if(this.layerDeleteEnable){s[1]="style_"+e.$(e.$(u).find("img[name]")[1]).attr("name").slice(5);
}else{s[1]="style_"+e.$(u).find("img[name]").attr("name").slice(5);}var t=s[0]+" "+s[1]+" "+s[2];u.$preStyleDiv.attr("class",t);
},touchEvent:function(t,s){var v=this;var w=true;e.$(t).bind("touchstart",function(){if(w){e.$("img[name = "+this.alt+"]")[0].setAttribute("style","display:none");
e.$("."+this.alt).css({display:"none"});e.$(".style_"+this.alt).css({display:"none"});v.adjustSize();
this.src=e.gv.resourcePath()+"zoomin.gif";w=false;}else{e.$("img[name = "+this.alt+"]")[0].setAttribute("style","padding-left:3px;display:inline;");
e.$("."+this.alt).css({display:""});v.adjustSize();this.src=e.gv.resourcePath()+"zoomout.gif";w=true;
}});var u=true;e.$(s).bind("touchstart",function(x){x.stopPropagation();if(u){e.$("#style"+e.$(this).attr("id")).css({display:""});
var y=this;v.getThemeStyle(y);v.adjustSize();u=false;if(e.browser.android){v.panelDIV.height(v.$Dom.height());
}}else{e.$("#style"+e.$(this).attr("id")).css({display:"none"});v.adjustSize();u=true;if(e.browser.android){v.panelDIV.height(v.$Dom.height());
}}});},getThemeStyle:function(s){var t=this;e.util.HttpRequest.send("/mapviewer/omserver",{xml_request:'<non_map_request><get_theme_info data_source="'+t.dataSource[e.$(s).text()]+'" theme="'+t.list[e.$(s).text()]+'"/></non_map_request>'},function(v){if(e.$("#img"+e.$(s).attr("id"))[0]){var u=e.$(v).find("theme_style[label='false']").attr("name");
e.$("#styleText"+e.$(s).attr("id")).text(u);e.$("#img"+e.$(s).attr("id"))[0].src="/mapviewer/omserver?sty="+u+"&ds="+t.dataSource[e.$(s).text()];
if(t.map&&t.map.getLayerByName(e.$("#img"+e.$(s).attr("id")).attr("value")).customImg){e.$("#img"+e.$(s).attr("id"))[0].src=t.map.getLayerByName(e.$("#img"+e.$(s).attr("id")).attr("value")).customImg;
}if(t.map&&t.map.getLayerByName(e.$("#img"+e.$(s).attr("id")).attr("value")).getRenderingStyle()){e.$("#img"+e.$(s).attr("id"))[0].src=t.map.getLayerByName(e.$("#img"+e.$(s).attr("id")).attr("value")).getRenderingStyle().src;
}}},"xml");},cloneDiv:function(s){var y=this;var u=e.$("div[id^='item']");for(var w=0;w<u.length;w++){u[w].pos=y.getElementPos(u[w]);
u[w].size=y.getElementSize(u[w]);}var x=s||h.event;var v=x.target||x.srcElement;if(e.$(v).attr("name")=="deletebutton_layercontrol"){return;
}y.el=v.cloneNode(true);y.el.style.position="absolute";y.el.style.left=v.pos.x-7+"px";y.el.style.display="none";
y.el.style.width=v.size.width-20+"px";y.el.style.height=v.size.height+"px";y.el.style.border="1px solid #d4d4d4";
y.el.style.background="lightgray";y.el.style.opacity="1";y.el.style.color="red";this.container[0].appendChild(y.el);
this.document_mousemove=function(t){if(y.flag){t=t||h.event;var z=y.getMousePos(t);y.el.style.display="";
y.el.style.left=y.left;y.el.style.top=parseInt(z.y)-parseInt(y.map.$oracleMapDiv.parent()[0].offsetTop)-10+"px";
if(parseInt(y.el.style.top)<(y.top+y.$title.height())){y.el.style.top=y.top+y.$title.height()+"px";}if(parseInt(y.el.style.top)>(y.top+y.$Dom.height())-10){y.el.style.top=y.top+y.$Dom.height()-10+"px";
}y.aY=t.clientY;e.$(y.$Dom)[0].scrollTop=y.scrollTop+(y.aY-y.pY)*(e.$(y.$Dom)[0].scrollHeight/e.$(y.$Dom).height());
}};this.document_msup=function(){y.flag=false;e.$("div[id^='item']").each(function(){e.$(this).css({background:"#ECF9FF"});
});if(y.el){y.container[0].removeChild(y.el);y.el=null;}};e.$(document).mousemove(this.document_mousemove);
e.$(document).mouseup(this.document_msup);e.$(y.$Dom).mouseup(function(){y.flag=false;if(y.el){y.container[0].removeChild(y.el);
y.el=null;}}).mouseout(function(){y.map.$oracleMapDiv.css({cursor:"default"});});},adjustSize:function(){if(this.$Dom.height()>this.maxHeight+1){this.$Dom.height(this.maxHeight);
}this.panelDIV.height(this.$Dom.height());e.$("#v_drag").height(this.$title.height());},getMousePos:function(s){return{x:s.pageX||s.clientX+document.body.scrollLeft,y:s.pageY||s.clientY+document.body.scrollTop};
},getElementPos:function(s){return{x:s.offsetParent?s.offsetLeft+arguments.callee(s.offsetParent).x:s.offsetLeft,y:s.offsetParent?s.offsetTop+arguments.callee(s.offsetParent).y:s.offsetTop};
},getElementSize:function(s){return{width:s.offsetWidth,height:s.offsetHeight};}});e.control.MapTypeControl=e.control.MapDecoration.extend({initialize:function(y,x,w){this.map=y;
this.tileLayer=x;this.enableTypes=w?w.enableTypes:null;this.type=w?w.type:null;var u=this;this.addListener=function(){e.$("#div_type").bind("click touchend",function(B){var A=B.target;
A.style.backgroundImage="url('"+e.gv.resourcePath()+"button_bg_dwn.png')";A.style.color="#000000";A.style.borderColor="#e0e3e8 #606974 #606974 #e0e3e8";
if(u.tileLayer){u.tileLayer.setMapType(u.enableTypes[A.id]);var z=document.getElementById(u.type);if(u.type!=A.id){z.style.backgroundImage="url('"+e.gv.resourcePath()+"button_bg_ena.png')";
z.style.color="#003d5b";z.style.borderColor="#e0e3e8 #606974 #606974 #e0e3e8";}u.type=A.id;}}).mouseover(function(A){var z=A.target;
if(z.id!=u.type){z.style.backgroundImage="url('"+e.gv.resourcePath()+"button_bg_ovr.png')";z.style.color="#000000";
}}).mouseout(function(A){var z=A.target;if(z.id!=u.type){z.style.backgroundImage="url('"+e.gv.resourcePath()+"button_bg_ena.png')";
z.style.color="#003d5b";}});};if(!this.infoDecoration){var v="";var s=0;for(var t in this.enableTypes){if(this.enableTypes[t]){if(t==this.type){v=v+"<td><a class='selectedLinkStyle_mapTypeCtrl' id=\""+t+'" href="javascript:void(0);"> '+t+"</a></td>";
}else{v=v+"<td><a class='linkStyle_mapTypeCtrl' id=\""+t+'" href="javascript:void(0);"> '+t+"</a></td>";
}s+=60;}}if(s>0){this.infoDecoration=new e.control.MapDecoration('<div id="div_type" style="background: white;"><table width=100% cellspacing=0 cellpadding=0><tr>'+v+"</tr></table></div>",{mapType:"mapTypeControl",offsetX:10,offsetY:10,draggable:false,height:20,contentStyle:{"border-style":"solid","border-color":"#ffffff",border:"0px",backgroundColor:"#ffffff",filter:"alpha(Opacity=80)","-moz-opacity":"0.8"}});
this.infoDecoration.setAnchorPosition(3);this.map.addMapDecoration(this.infoDecoration);this.addListener();
}}},destroy:function(){if(this.infoDecoration){this.map.removeMapDecoration(this.infoDecoration);}}});
e.filter.Filter=e.Class.extend({initialize:function b(){this.filterMode=e.filter.Filter.CLIENT_SIDE;this.sql=null;
},setFilterMode:function(){this.filterMode=e.filter.Filter.CLIENT_SIDE;},evaluate:function(s){return this.invokeClient(s);
},invokeClient:function(){return false;}});e.filter.Filter.CLIENT_SIDE="client_side";e.filter.Equals=e.filter.Filter.extend({initialize:function b(s,t){b.base.call(this);
this.filterType="equalsFilter";this.filterAttribute=s?s.toUpperCase():"";this.filterValue=t;},invokeClient:function(s){if(s.attributes&&s.attributes[this.filterAttribute]){var t=s.attributes[this.filterAttribute];
if(!isNaN(t)&&!isNaN(this.filterValue)){return parseFloat(t)===parseFloat(this.filterValue);}return t===this.filterValue;
}else{return false;}}});e.filter.NotEquals=e.filter.Filter.extend({initialize:function b(s,t){b.base.call(this);
this.filterType="notEqualsFilter";this.equalsFilter=new e.filter.Equals(s,t);},invokeClient:function(s){return !this.equalsFilter.evaluate(s);
}});e.filter.Greater=e.filter.Filter.extend({initialize:function b(s,t){b.base.call(this);this.filterType="greaterFilter";
this.filterAttribute=s?s.toUpperCase():"";this.filterValue=t;},invokeClient:function(s){if(s.attributes&&s.attributes[this.filterAttribute]&&s.attributes[this.filterAttribute]>this.filterValue){return true;
}else{return false;}}});e.filter.GreaterEquals=e.filter.Filter.extend({initialize:function b(s,t){b.base.call(this);
this.filterType="greaterEqualsFilter";this.filterAttribute=s?s.toUpperCase():"";this.filterValue=t;},invokeClient:function(s){if(s.attributes&&s.attributes[this.filterAttribute]&&s.attributes[this.filterAttribute]>=this.filterValue){return true;
}else{return false;}}});e.filter.Less=e.filter.Filter.extend({initialize:function b(s,t){b.base.call(this);
this.filterType="lessFilter";this.filterAttribute=s?s.toUpperCase():"";this.filterValue=t;},invokeClient:function(s){if(s.attributes&&s.attributes[this.filterAttribute]&&s.attributes[this.filterAttribute]<this.filterValue){return true;
}else{return false;}}});e.filter.LessEquals=e.filter.Filter.extend({initialize:function b(s,t){b.base.call(this);
this.filterType="lessEqualsFilter";this.filterAttribute=s?s.toUpperCase():"";this.filterValue=t;},invokeClient:function(s){if(s.attributes&&s.attributes[this.filterAttribute]&&s.attributes[this.filterAttribute]<=this.filterValue){return true;
}else{return false;}}});e.filter.Between=e.filter.Filter.extend({initialize:function b(t,s,u){b.base.call(this);
this.filterType="betweenFilter";this.filterAttribute=t?t.toUpperCase():"";this.lowValue=parseFloat(s);
this.highValue=parseFloat(u);},invokeClient:function(s){if(s.attributes&&s.attributes[this.filterAttribute]&&parseFloat(s.attributes[this.filterAttribute])>=this.lowValue&&parseFloat(s.attributes[this.filterAttribute])<=this.highValue){return true;
}else{return false;}}});e.filter.Like=e.filter.Filter.extend({initialize:function b(s,t){b.base.call(this);
this.filterType="likeFilter";this.filterAttribute=s?s.toUpperCase():"";this.filterValue=t;},invokeClient:function(s){if(s.attributes&&s.attributes[this.filterAttribute]){return this.executeLikeReg(this.filterValue,s.attributes[this.filterAttribute]);
}else{return false;}},executeLikeReg:function(u,w){if(u===w){return true;}var v=""+u;var s=""+w;if(v.indexOf("_")!==-1){v=v.replace(/\_/g,".");
}if(v.indexOf("%")!==-1){v=v.replace(/\%/g,"[a-zA-Z0-9.@!#$^&*() \\s]+");}var t=new RegExp(v);if(e.notNull(s.match(t))&&s.match(t).length>0){return s.match(t)[0]===w;
}else{return false;}}});e.filter.InsidePolygon=e.filter.Filter.extend({initialize:function b(s){b.base.call(this);
this.filterType="InsidePolygonFilter";this.filterGeom=s;this.filterMBR=this.filterGeom.getMBR();},invokeClient:function(s){var u;
if(s.geo){if(s.geo.srid!==this.filterGeom.srid){var t=this;this.filterGeom.transform(s.geo.srid,function(w){t.filterGeom=w;
t.evaluate(s);});}else{var v=this.filterGeom.type;u=s.getGeometry().getMBR();if(v==="Rectangle"){if(u.getMinX()>=this.filterGeom.getMinX()&&u.getMaxX()<=this.filterGeom.getMaxX()&&u.getMinY()>=this.filterGeom.getMinY()&&u.getMaxY()<=this.filterGeom.getMaxY()){return true;
}}else{if(v==="Polygon"){if(u.getMinX()>=this.filterMBR.getMinX()&&u.getMaxX()<=this.filterMBR.getMaxX()&&u.getMinY()>=this.filterMBR.getMinY()&&u.getMaxY()<=this.filterMBR.getMaxY()){if(this._MBRInPolygon(u,this.filterGeom)){return true;
}else{if(this.geomInPolygon(s.geo,this.filterGeom)){return true;}}}}else{if(v==="MultiPolygon"){if(u.getMinX()>=this.filterMBR.getMinX()&&u.getMaxX()<=this.filterMBR.getMaxX()&&u.getMinY()>=this.filterMBR.getMinY()&&u.getMaxY()<=this.filterMBR.getMaxY()){if(this._MBRInPolygon(u,this.filterGeom)){return true;
}else{if(this.geomInPolygon(s.geo,this.filterGeom)){return true;}}}}}}return false;}}else{return false;
}},pointInsidePolygonRing:function(z,y,x){var v=[];var u=[];var B=x[0].length/2;for(var t=0;t<B;t++){v[t]=parseFloat(x[0][t*2]);
u[t]=parseFloat(x[0][t*2+1]);}var A,s,w=0;for(A=0,s=B-1;A<B;s=A++){if(((u[A]>y)!==(u[s]>y))&&(z<(v[s]-v[A])*(y-u[A])/(u[s]-u[A])+v[A])){w=!w;
}}return w;},pointInsideCircle:function(y,x,u){var w=u.centerX,v=u.centerY;var t=u.radius*u.radius;var s=(w-y)*(w-y)+(v-x)*(v-x);
var z=0;if(s<t){z=!z;}return z;},pointInPolygon:function(B,A,z){var y=z;var x=y.getType();var w=0;if(x==="Polygon"){if(y.circlePolygon){w=this.pointInsideCircle(B,A,y);
}else{w=this.pointInsidePolygonRing(B,A,y.coordinates);}}else{if(x==="MultiPolygon"){var t=y.coordinates;
var v=t.length;for(var u=0;u<v;u++){var s=this.pointInsidePolygonRing(B,A,t[u]);if(s){w=s;break;}}}}return w;
},geomInPolygon:function(s,w){var v,t,u;if(s.type==="Point"||s.type==="OrientedPoint"){v=s.coordinates;
if(this.pointInPolygon(v[0],v[1],this.filterGeom)){return true;}return false;}else{if(s.type==="MultiPoint"||s.type==="OrientedMultiPoint"){t=s.coordinates;
for(u=0;u<t.length;u++){v=t[u];if(!this.pointInPolygon(v[0],v[1],w)){return false;}}return true;}else{if(s.type==="Rectangle"){v=s.coordinates;
v.push(v[0],v[3],v[2],v[1]);if(!this._geomInPolygon(v,w)){return false;}return true;}else{if(s.type==="LineString"){v=s.coordinates;
if(!this._geomInPolygon(v,w)){return false;}return true;}else{if(s.type==="MultiLineString"){t=s.coordinates;
for(u=0;u<t.length;u++){v=t[u];if(!this._geomInPolygon(v,w)){return false;}}return true;}else{if(s.type==="Polygon"){v=s.coordinates[0];
if(!this._geomInPolygon(v,w)){return false;}return true;}else{if(s.type==="MultiPolygon"){t=s.coordinates;
for(u=0;u<t.length;u++){v=t[u][0];if(!this._geomInPolygon(v,w)){return false;}}return true;}}}}}}}return false;
},_geomInPolygon:function(w,x){var u=w.length/2;if(x.circlePolygon){return this._geomInPolygonCircle(w,x);
}for(var t=0,s=u-1;t<u;t++){if(!this.pointInPolygon(w[t*2],w[t*2+1],x)){return false;}var v={coordinates:[w[t*2],w[t*2+1],w[s*2],w[s*2+1]]};
if(this.segmentCrossPolygon(v,x)){return false;}}return true;},_geomInPolygonCircle:function(u,v){var t=u.length/2;
for(var s=0;s<t;s++){if(!this.pointInPolygon(u[s*2],u[s*2+1],v)){return false;}}return true;},_MBRInPolygon:function(s,t){return this.geomInPolygon(s,t);
},segmentCrossPolygon:function(t,s){if(!this.proxy){this.proxy=new e.filter.AnyInteract(this.filterGeom);
}return this.proxy.segmentCrossPolygon(t,s);}});e.filter.All=e.filter.Filter.extend({initialize:function b(s){b.base.call(this);
this.filterType="allFilter";this.filterArray=s;},invokeClient:function(t){for(var s=0;s<this.filterArray.length;
s++){if(this.filterArray[s].evaluate(t)===false){return false;}}return true;}});e.filter.And=e.filter.Filter.extend({initialize:function b(t,s){b.base.call(this);
this.filterType="andFilter";this.filter1=t;this.filter2=s;},invokeClient:function(v){var u=this.filter1.evaluate(v);
var t=this.filter2.evaluate(v);var s=!!(u&t);return s;}});e.filter.Any=e.filter.Filter.extend({initialize:function b(s){b.base.call(this);
this.filterType="anyFilter";this.filterArray=s;},invokeClient:function(t){for(var s=0;s<this.filterArray.length;
s++){if(this.filterArray[s].evaluate(t)===true){return true;}}return false;}});e.filter.In=e.filter.Any.extend({initialize:function b(t,s){var v=[];
if(Object.prototype.toString.call(s)!=="[object Array]"){s=[s];}for(var u=0;u<s.length;u++){v.push(new e.filter.Equals(t,s[u]));
}b.base.call(this,v);this.filterType="inFilter";}});e.filter.IsNotNull=e.filter.Filter.extend({initialize:function b(s){b.base.call(this);
this.filterType="isNotNullFilter";this.filterAttribute=s?s.toUpperCase():"";},invokeClient:function(s){if(e.notNull(s.attributes)&&e.notNull(s.attributes[this.filterAttribute])){return true;
}else{return false;}}});e.filter.IsNull=e.filter.Filter.extend({initialize:function b(s){b.base.call(this);
this.filterType="isNullFilter";this.filterAttribute=s?s.toUpperCase():"";},invokeClient:function(s){if(e.isNull(s.attributes)||e.isNull(s.attributes[this.filterAttribute])){return true;
}return false;}});e.filter.Not=e.filter.Filter.extend({initialize:function b(s){b.base.call(this);this.filterType="notFilter";
this.negateFilter=s;},invokeClient:function(s){return !this.negateFilter.evaluate(s);}});e.filter.Or=e.filter.Filter.extend({initialize:function b(t,s){b.base.call(this);
this.filterType="orFilter";this.filter1=t;this.filter2=s;},invokeClient:function(v){var u=this.filter1.evaluate(v);
var t=this.filter2.evaluate(v);var s=u||t;return s;}});e.filter.Xor=e.filter.Filter.extend({initialize:function b(t,s){b.base.call(this);
this.filterType="xorFilter";this.filter1=t;this.filter2=s;},invokeClient:function(v){var u=this.filter1.evaluate(v);
var t=this.filter2.evaluate(v);var s=!!(u^t);return s;}});e.filter.AnyInteract=e.filter.Filter.extend({initialize:function b(s){b.base.call(this);
this.filterType="AnyInteractFilter";this.filterGeom=s;this.filterMBR=this.filterGeom.getMBR();this.sqlStr=null;
},invokeClient:function(w){if(w.geo){if(w.geo.srid!==this.filterGeom.srid){var x=this;this.filterGeom.transform(w.geo.srid,function(z){var A=z.getMBR();
x.filterGeom=z;x.filterMBR=x.filterGeom.getMBR();var y=w.getGeometry().getMBR();if(y.getMinX()>A.getMinX()&&y.getMaxX()<A.getMaxX()&&y.getMinY()>A.getMinY()&&y.getMaxY()<A.getMaxY()){this._AnyInteractWithPolygon(w.geo,this.filterGeom);
}return false;});}else{var v=w.getGeometry();var u=v.getMBR();var s=v.type;var t=this.filterGeom.type;
if(e.isNull(u)){return false;}if(!(u.getMaxX()<this.filterMBR.getMinX()||u.getMinX()>this.filterMBR.getMaxX()||u.getMaxY()<this.filterMBR.getMinY()||u.getMinY()>this.filterMBR.getMaxY())){if(t==="Polygon"||t==="Rectangle"||t==="MultiPolygon"){return this._AnyInteractWithPolygon(v,this.filterGeom);
}else{if(s==="Polygon"||s==="Rectangle"||s==="MultiPolygon"){return this._AnyInteractWithPolygon(this.filterGeom,v);
}else{if((t==="LineString"||t==="MultiLineString")&&(s==="LineString"||s==="MultiLineString")){return this.isInteractLine(v,this.filterGeom);
}else{if((t==="LineString"||t==="MultiLineString")){return this.isPointOnLine(v,this.filterGeom);}else{if((s==="LineString"||s==="MultiLineString")){return this.isPointOnLine(this.filterGeom,v);
}else{return this.isSamePoints(this.filterGeom,v);}}}}}}return false;}}else{return false;}},_AnyInteractWithPolygon:function(t,s){if(this.intersectWithPolygon(t,s)){return true;
}if(this.hasPointsInPolygon(t,s)){return true;}return false;},intersectWithPolygon:function(C,D){var A=C.type;
var E,y,w,u,t,z,x;if(A==="Point"||A==="OrientedPoint"){return this.pointInPolygon(C.getX(),C.getY(),D);
}else{if(A==="MultiPoint"||A==="OrientedMultiPoint"){E=C.coordinates;for(u=0,y=E.length;u<y;u++){if(this.pointInPolygon(E[u][0],E[u][1],D)){return true;
}}return false;}else{if(A==="LineString"){E=C.coordinates;for(u=0,y=E.length/2;u<y-1;u++){w={coordinates:[E[u*2],E[u*2+1],E[(u+1)*2],E[(u+1)*2+1]]};
if(this.segmentCrossPolygon(w,D)){return true;}}return false;}else{if(A==="MultiLineString"){z=C.coordinates;
x=z.length;for(var v=0;v<x;v++){E=z[v];for(u=0,y=E.length/2;u<y-1;u++){w={coordinates:[E[u*2],E[u*2+1],E[(u+1)*2],E[(u+1)*2+1]]};
if(this.segmentCrossPolygon(w,D)){return true;}}}return false;}else{if(A==="Rectangle"){E=C.coordinates;
E.push(E[0],E[3],E[2],E[1]);y=E.length/2;for(u=0,t=y-1;u<y;t=u++){w={coordinates:[E[u*2],E[u*2+1],E[t*2],E[t*2+1]]};
if(this.segmentCrossPolygon(w,D)){return true;}}return false;}else{if(A==="Polygon"){E=C.coordinates[0];
y=E.length/2;for(u=0,t=y-1;u<y;t=u++){w={coordinates:[E[u*2],E[u*2+1],E[t*2],E[t*2+1]]};if(this.segmentCrossPolygon(w,D)){return true;
}}return false;}else{if(A==="MultiPolygon"){z=C.coordinates;x=z.length;for(var s=0;s<x;s++){E=z[s][0];
var B=E.length/2;for(u=0,t=B-1;u<B;t=u++){w={coordinates:[E[u*2],E[u*2+1],E[t*2],E[t*2+1]]};if(this.segmentCrossPolygon(w,D)){return true;
}}}return false;}}}}}}}return false;},segmentCrossPolygon:function(B,F){var s=F.coordinates;if(F.type=="Rectangle"){var E=F.coordinates;
var x=E[0];var w=E[1];var u=E[2];var t=E[3];var y=B.coordinates;if(y[0]>=x&&y[0]<=u&&y[1]>=w&&y[1]<=t||y[2]>=x&&y[2]<=u&&y[3]>=w&&y[3]<=t){return true;
}else{s=[[[x,w,u,w,u,t,x,t,x,w]]];}}if(F.type==="Polygon"){s=[s];}for(var v=0,C=s.length;v<C;v++){var G=s[v][0];
var I=G.length/2;for(var A=0,z=I-1;A<I;z=A++){var D={coordinates:[G[A*2],G[A*2+1],G[z*2],G[z*2+1]]};if(this.segmentsStraddle(B,D)){return true;
}}}return false;},segmentsStraddle:function(B,A){if(!this.rectangleScopeOverlap(B,A)){return false;}var w={x:B.coordinates[0]-A.coordinates[0],y:B.coordinates[1]-A.coordinates[1]};
var y={x:B.coordinates[2]-A.coordinates[0],y:B.coordinates[3]-A.coordinates[1]};var v={x:A.coordinates[2]-A.coordinates[0],y:A.coordinates[3]-A.coordinates[1]};
var x={x:A.coordinates[0]-B.coordinates[0],y:A.coordinates[1]-B.coordinates[1]};var z={x:A.coordinates[2]-B.coordinates[0],y:A.coordinates[3]-B.coordinates[1]};
var s={x:B.coordinates[2]-B.coordinates[0],y:B.coordinates[3]-B.coordinates[1]};var u=this.crossProduct(w,v)*this.crossProduct(v,y);
var t=this.crossProduct(x,s)*this.crossProduct(s,z);if(u>=0&&t>=0){return true;}else{return false;}},crossProduct:function(t,s){return Math.round((t.x*s.y-t.y*s.x)*100000)/100000;
},rectangleScopeOverlap:function(t,s){var u=function(B,A){var z={};if(B>=A){z.max=B;z.min=A;}else{z.max=A;
z.min=B;}return z;};var y=u(t.coordinates[0],t.coordinates[2]);var w=u(t.coordinates[1],t.coordinates[3]);
var x=u(s.coordinates[0],s.coordinates[2]);var v=u(s.coordinates[1],s.coordinates[3]);if(y.max<x.min||y.min>x.max||w.max<v.min||w.min>v.max){return false;
}return true;},hasPointsInPolygon:function(y,A){var x=y.type;var t,z,C,v,w,B,u;if(x==="Point"||x==="OrientedPoint"){return this.pointInPolygon(y.getX(),y.getY(),A);
}else{if(x==="MultiPoint"||x==="OrientedMultiPoint"){for(t=0,u=y.coordinates.length/2;t<u;t++){if(this.pointInPolygon(y.coordinates[t*2],y.coordinates[t*2+1],A)){return true;
}}return false;}else{if(y.type==="LineString"){for(t=0,C=y.coordinates.length/2;t<C;t++){if(this.pointInPolygon(y.coordinates[t*2],y.coordinates[t*2+1],A)){return true;
}}return false;}else{if(y.type==="MultiLineString"){for(v=0,w=y.coordinates.length;v<w;v++){B=y.coordinates[v];
for(t=0,C=B.length/2;t<C;t++){if(this.pointInPolygon(B[t*2],B[t*2+1],A)){return true;}}}return false;
}else{if(y.type==="Rectangle"){var s=y.coordinates;if(this.pointInPolygon(s[0],s[1],A)||this.pointInPolygon(s[2],s[3],A)||this.pointInPolygon(s[0],s[3],A)||this.pointInPolygon(s[2],s[1],A)){return true;
}else{return false;}}else{if(y.type==="Polygon"){for(t=0,z=y.coordinates[0].length/2;t<z;t++){if(this.pointInPolygon(y.coordinates[0][t*2],y.coordinates[0][t*2+1],A)){return true;
}}return false;}else{if(y.type==="MultiPolygon"){for(v=0,w=y.coordinates.length;v<w;v++){B=y.coordinates[v][0];
for(t=0,z=B.length/2;t<z;t++){if(this.pointInPolygon(B[t*2],B[t*2+1],A)){return true;}}}return false;
}}}}}}}},pointInPolygon:function(x,v,t){var w;var s;if(t.type==="Polygon"){w=t.coordinates[0];s=this._pointInPolygon(x,v,w);
}else{if(t.type=="Rectangle"){w=[t.getMinX(),t.getMinY(),t.getMaxX(),t.getMinY(),t.getMaxX(),t.getMaxY(),t.getMinX(),t.getMaxY(),t.getMinX(),t.getMinY()];
s=this._pointInPolygon(x,v,w);}else{if(t.type==="MultiPolygon"){var y=t.coordinates;for(var u=0;u<y.length;
u++){w=y[u][0];s=this._pointInPolygon(x,v,w);if(s){return true;}}}}}if(!s){return this.isPointOnLine({coordinates:[x,v],type:"Point"},t);
}else{return true;}},_pointInPolygon:function(v,u,B){var x=[];var w=[];var A=B.length/2;for(var t=0;t<A;
t++){x[t]=parseFloat(B[t*2]);w[t]=parseFloat(B[t*2+1]);}var z,s,y=0;for(z=0,s=A-1;z<A;s=z++){if(((w[z]>u)!==(w[s]>u))&&(v<(x[s]-x[z])*(u-w[z])/(w[s]-w[z])+x[z])){y=!y;
}}return y;},isInteractLine:function(t,s){var z=this.getSegments(t);var y=this.getSegments(s);for(var x=0,w=z.length;
x<w;x++){for(var v=0,u=y.length;v<u;v++){if(this.segmentsStraddle(z[x],y[v])){return true;}}}return false;
},getSegments:function(A){var y=A.type;var z=A.coordinates;var v=[];var t,w,u,x,s;if(y==="LineString"){for(t=0,w=z.length/2;
t<w-1;t++){v.push({coordinates:[z[t*2],z[t*2+1],z[(t+1)*2],z[(t+1)*2+1]]});}}else{if(y==="MultiLineString"){for(u=0,x=z.length;
u<x;u++){s=z[u];for(t=0,w=s.length/2;t<w-1;t++){v.push({coordinates:[s[t*2],s[t*2+1],s[(t+1)*2],s[(t+1)*2+1]]});
}}}else{if(y==="Polygon"){z=z[0];for(t=0,w=z.length/2;t<w-1;t++){v.push({coordinates:[z[t*2],z[t*2+1],z[(t+1)*2],z[(t+1)*2+1]]});
}}else{if(y==="MultiPolygon"){for(u=0,x=z.length;u<x;u++){s=z[u][0];for(t=0,w=s.length/2;t<w-1;t++){v.push({coordinates:[s[t*2],s[t*2+1],s[(t+1)*2],s[(t+1)*2+1]]});
}}}else{if(y==="Rectangle"){v.push({coordinates:[z[0],z[1],z[2],z[1]]});v.push({coordinates:[z[2],z[1],z[2],z[3]]});
v.push({coordinates:[z[2],z[3],z[0],z[3]]});v.push({coordinates:[z[0],z[3],z[0],z[1]]});}}}}}return v;
},isPointOnLine:function(s,t){var x=this.getSegments(t);var z=s.coordinates;if(s.type==="Point"||s.type==="OrientedPoint"){z=[z];
}for(var y=0,w=z.length;y<w;y++){for(var v=0,u=x.length;v<u;v++){if(this.isPointOnSegment(z[y][0],z[y][1],x[v])){return true;
}}}return false;},isPointOnSegment:function(t,z,v){var w=v.coordinates;var u={x:t-w[0],y:z-w[1]};var s={x:w[2]-w[0],y:w[3]-w[1]};
if(this.crossProduct(u,s)!==0){return false;}if(Math.min(w[0],w[2])<=t&&t<=Math.max(w[0],w[2])&&Math.min(w[1],w[3])<=z&&z<=Math.max(w[1],w[3])){return true;
}else{return false;}},isSamePoints:function(B,A){var v=B.coordinates;var u=A.coordinates;if(B.type==="Point"||B.type==="OrientedPoint"){v=[v];
}if(A.type==="Point"||A.type==="OrientedPoint"){u=[u];}for(var z=0,x=v.length;z<x;z++){for(var y=0,w=u.length;
y<w;y++){var t=v[z];var s=u[y];if(t[0]===s[0]&&t[1]===s[1]){return true;}}}return false;}});e.template.TemplateConfig=e.Class.extend({initialize:function(u,t){this.url="";
this.baseFolder="";var s={};if(t){this.config=t;return;}if(u&&u.indexOf("config.json",u.length-"config.json".length)!==-1){this.url=u;
this.baseFolder=u.substring(0,u.lastIndexOf("/")+1);e.$.ajax({url:u,async:false,dataType:"json",success:function(v){s=v;
}});}this.config=s;},vectorLayerList:function(){var s=this.config;var u=[];if(s.vectorLayers){for(var t=0;
t<s.vectorLayers.length;t++){u.push(s.vectorLayers[t].dn);}}return u;},initVectorLayerList:function(){},tileLayerList:function(){var s=this.config;
var u=[];if(s.tileLayers){for(var t=0;t<s.tileLayers.length;t++){u.push(s.tileLayers[t].dn);}}return u;
},styleList:function(){var t=this.config;var s=[];if(t.styles){for(var u=0;u<t.styles.length;u++){s.push(t.styles[u].dn);
}}return s;},getTileLayer:function(s){if(!this.config.vectorLayers){return null;}var z=this.getTileLayerConfig(s);
if(e.isNull(z)){return null;}var t=null;var y=z.vendor;if(y==="google"){t=new e.layer.GoogleTileLayer(s);
}else{if(y==="oracle"){t=new e.layer.ElocationTileLayer(s);}else{if(y==="nokia"){var w=z.key;var A=z.secondary_key;
var x=null;if(z.mapTypes){var v=z.mapTypes.split(",");x="";for(var u=0;u<v.length;u++){if(u>0){x+=";";
}x+="OM.layer.NokiaTileLayer.TYPE_"+v[u].toUpperCase();}}t=new e.layer.NokiaTileLayer(s,{key:w,appID:A,mapTyleList:x});
}else{if(y==="bing"){t=new e.layer.BingTileLayer(s,{key:z.key});}}}}return t;},getVectorLayer:function(t,u){if(!this.config.vectorLayers){return null;
}var s=this.getVectorLayerConfig(u);if(e.isNull(s)){return null;}var x=s.uri;if(this.baseFolder&&s.uri.indexOf("http")<0){x=this.baseFolder+s.uri;
}var y={type:e.layer.VectorLayer.TYPE_DATAPACK,url:x};var v=new e.layer.VectorLayer(t,{def:y});if(s.styles){var w=s.styles;
if(w.normal){v.setRenderingStyle(this.getStyle(w.normal));}if(w.selected){v.setSelectStyle(this.getStyle(w.selected));
}if(w.mouseOver){v.enableFeatureHover(true);v.setHoverStyle(this.getStyle(w.mouseOver));}}if(s.nsdp){v.setNSDP(s.nsdp);
}return v;},getStyle:function(M){var K=this.config;if(!K.styles){return null;}var z=K.styles;var J=null;
var F;for(var G=0;G<z.length;G++){if(z[G].dn===M){var x=z[G].type;switch(x){case"color":J=new e.style.Color(z[G].def);
break;case"marker":J=new e.style.Marker(z[G].def);break;case"linear-gradient":J=new e.style.LinearGradient(z[G].def);
break;case"pulse_animation":J=new e.style.PulseAnimation(z[G].def);break;case"color_animation":var v={};
if(z[G].beginColor){v.beginColor=this.getStyle(z[G].beginColor);}if(z[G].endColor){v.endColor=this.getStyle(z[G].endColor);
}if(z[G].duration){v.duration=z[G].duration;}if(z[G].movingDashLine){v.enableMovingDashLine=z[G].movingDashLine;
}J=new e.style.AnimationColor(v);break;case"line":J=new e.style.Line(z[G].def);break;case"text":J=new e.style.Text(z[G].def);
break;case"heat_map":var I=z[G].container;var D=z[G].dn+" "+I;var C=this.getVectorLayer(D,I);var s=z[G].def;
s.containerVectorLayer=C;J=new e.style.HeatMap(s);break;case"bar_chart":var u=z[G].barArr;var E=u.length;
var A=[];for(F=0;F<E;F++){A.push(new e.style.Bar(u[F].name,u[F].color));}var B=z[G].def;B.bars=A;J=new e.style.BarChart(B);
break;case"pie_chart":var L=z[G].pieArr;var y=L.length;var t=[];for(F=0;F<y;F++){t.push(new e.style.PieSlice(L[F].name,L[F].color));
}var w=z[G].def;w.pieSlices=t;J=new e.style.PieChart(w);break;}break;}}return J;},getConfig:function(){return this.config;
},setConfig:function(s){this.config=s;},initMap:function(u){var w=this.config;if(!w.init){return;}var t=w.init;
if(t.tileLayer){u.addLayer(this.getTileLayer(t.tileLayer));}else{if(t.customUniverse){var D=t.customUniverse;
var A=D.bounds;var B=new e.universe.Universe({srid:D.srid,bounds:new e.geometry.Rectangle(A[0],A[1],A[2],A[3],A[4]),numberOfZoomLevels:D.numberOfZoomLevels});
u.getMapContextToken().universe=B;}else{return;}}if(t.layers){u.removeAllFeatureLayers();var y=t.layers;
for(var z=0;z<y.length;z++){u.addLayer(this.getVectorLayer(y[z],y[z]));}}if(t.center){var x=t.center[0];
var v=t.center[1];var C=u.getMapContext().getUniverse().srid;var s=new e.geometry.Point(x,v,C);u.setMapCenter(s);
}if(t.zoomLevel){u.setMapZoomLevel(t.zoomLevel);}if(t.copyright){u.addMapDecoration(new e.control.CopyRight(t.copyright));
}if(t.navigation){u.addMapDecoration(new e.control.NavigationPanelBar(t.navigation));}},getVectorLayerConfig:function(s){var t=this.indexOfVectorLayer(s);
if(t===-1){return null;}else{return this.config.vectorLayers[t];}},getTileLayerConfig:function(s){var t=this.tileLayerList();
var u=t.indexOf(s);if(u===-1){return null;}return this.config.tileLayers[u];},indexOfVectorLayer:function(t){var s=this.vectorLayerList();
var v=s.indexOf(t);if(v===-1){var y=this.config.vectorLayers;for(var u=0;u<y.length;u++){var x=y[u];if(!x.cn){continue;
}var w=x.cn;v=w.indexOf(t);if(v!==-1){v=u;break;}}}return v;}});e.template.Template=e.Class.extend({initialize:function(s){this.name="default";
this.containerMap=null;if(s&&s.name){this.name=s.name;}this.config=null;if(s.url){this.config=new e.template.TemplateConfig(s.url);
}else{if(s.data){this.config=new e.template.TemplateConfig(null,s.data);}}},getConfig:function(){return this.config;
},setConfig:function(t){var s=new e.template.TemplateConfig(null);s.setConfig(t);this.config=s;},getVectorLayer:function(C,P,N){if(!this.config){return null;
}var z=this.config.getVectorLayer(C,P);if(e.isNull(z)){return null;}if(!(N&&(N instanceof Array)&&N.length>0)){return z;
}var s=this.config.getVectorLayerConfig(P);var w=s.uri;var O=null;e.$.ajax({url:w,async:false,dataType:"json",success:function(R){O=R;
}});if(e.isNull(O)){return null;}var u=O.features;var L=u.length;var y=O.attr_names;var M=O.srs;var x=[];
for(var J=0;J<L;J++){var B=u[J];find:for(var I=0;I<N.length;I++){var D=N[I].toUpperCase();for(var G=0;
G<y.length;G++){var F=y[G].toUpperCase();if(B.properties[F].toUpperCase()===D){var v=B.geometry;v.srid=M;
var E=(e.notNull(B._id))?B._id:J;var Q=e.geometry.Geometry.createGeometry(v,M);var t=new e.Feature(E,Q,{attributes:B.properties});
t.srid=M;t.label_box=B.label_box;x.push(t);break find;}}}}var A={type:e.layer.VectorLayer.TYPE_LOCAL,features:x};
var K=new e.layer.VectorLayer(C,{def:A});return K;},getTileLayer:function(s){if(!this.config){return null;
}return this.config.getTileLayer(s);},getStyle:function(s){if(!this.config){return null;}return this.config.getStyle(s);
},setupMapControls:function(t){try{this.config.initMap(t);t.template=this;this.containerMap=t;}catch(s){}},getVectorLayerNames:function(){return this.config.vectorLayerList();
},getTileLayerNames:function(){return this.config.tileLayerList();},getStyleNames:function(){return this.config.styleList();
},getChildLayerNames:function(t){if(!this.config){return null;}var u=[];var s=this.config.getVectorLayerConfig(t);
if(s!==null&&s.cl){u=s.cl;}return u;},getParentLayerNames:function(t){if(!this.config){return null;}var u=[];
var s=this.config.getVectorLayerConfig(t);if(s!==null&&s.pl){u=s.pl;}return u;},getChildLayer:function(C,s,u,A){if(!this.config){return null;
}var B=this.config.getVectorLayerConfig(s);if(e.isNull(B)||!B.cl){return null;}var z=B.cl;if(typeof u==="string"){var y=z.indexOf(u);
if(y===-1){var t=this.config.indexOfVectorLayer(u);if(t===-1){return null;}var x=false;for(var w=0;w<z.length;
w++){var v=this.config.indexOfVectorLayer(z[w]);if(t===v){x=true;break;}}if(x){return this.getVectorLayer(C,u,A);
}else{return null;}}else{return this.getVectorLayer(C,u,A);}}else{if(typeof u==="number"){if(u<0||u>=z.length){return null;
}else{return this.getVectorLayer(C,z[u],A);}}}return null;},switchTileLayer:function(u){var v=this.getTileLayerNames();
if(!v||!u){return;}var t=this.containerMap.getLayerByName(u);if(t){return;}var s=this.getTileLayer(u);
if(!s){e.util.Logger.warning("MAPVIEWER_9031","OM.template.Template",u);return;}if(t){this.containerMap.removeLayer(t);
}this.containerMap.addLayer(s);},destroy:function(){this.containerMap=null;}});(function(s){s.lbs.OutputAddress=s.Class.extend({initialize:function(t){this.id=t;
this.name=null;this.houseNumber=null;this.street=null;this.settlement=null;this.municipality=null;this.region=null;
this.country=null;this.postalCode=null;this.postalAddonCode=null;this.side=null;this.percent=null;this.edgeId=null;
}});})(e);(function(s){s.lbs.Match=s.Class.extend({initialize:function(u,t){this.id=u;this.sequence=t;
this.longitude=null;this.latitude=null;this.matchCode=null;this.errorMessage=null;this.matchVector=null;
this.srid=null;this.outputAddress=null;},getErrorMessage:function(){return this.errorMessage;},setErrorMessage:function(t){this.errorMessage=t;
},getId:function(){return this.id;},setId:function(t){this.id=t;},getLatitude:function(){return this.latitude;
},setLatitude:function(t){this.latitude=t;},getLongitude:function(){return this.longitude;},setLongitude:function(t){this.longitude=t;
},getMatchCode:function(){return this.matchCode;},setMatchCode:function(t){this.matchCode=t;},getMatchVector:function(){return this.matchVector;
},setMatchVector:function(t){this.matchVector=t;},getSequence:function(){return this.sequence;},setSequence:function(t){this.sequence=t;
},getOutputAddress:function(){return this.outputAddress;},setOutputAddress:function(t){this.outputAddress=t;
},getSrid:function(){return this.srid;},setSrid:function(t){this.srid=t;}});})(e);(function(s){s.lbs.GCResult=s.Class.extend({initialize:function(){this.MATCH_CODE1=1;
this.MATCH_CODE2=2;this.MATCH_CODE3=3;this.MATCH_CODE4=4;this.MATCH_CODE10=10;this.MATCH_CODE11=11;},getId:function(){},succeeded:function(){},getMatches:function(){}});
})(e);(function(t){t.lbs.DefaultGCResult=t.lbs.GCResult.extend({initialize:function s(v,u){s.base.call(this);
this.id=v;this.rawResponse=u;this.matchCount=0;this.matches=null;if(t.gv.proxyEnabled){this.parseResult();
}else{this.parseJsonResult();}},getId:function(){return this.id;},succeeded:function(){return this.matchCount>0;
},getMatches:function(){return this.matches;},parseJsonResult:function(){this.matchCount=0;this.matches=null;
var w=this.rawResponse;if(t.isNull(w)){return;}this.matchCount=w.length;if(this.matchCount<=0){return;
}this.matches=[];for(var v=0;v<this.matchCount;v++){var u={};u.longitude=w[v].x;u.latitude=w[v].y;u.matchCode=w[v].matchCode;
u.matchVector=w[v].matchVector;u.errorMessage=w[v].errorMessage;var x={};x.name="";x.houseNumber=w[v].houseNumber;
x.street=w[v].street;x.country=w[v].country;x.postalCode=w[v].postalCode;x.region=w[v].region;x.settlement=w[v].settlement;
x.municipality=w[v].municipality;x.side=w[v].side;x.percent=w[v].percent;x.edgeId=w[v].edgeId;u.outputAddress=x;
if(t.isNotNull(u)&&u.errorMessage!="not geocoded"){this.matches.push(u);}}},parseResult:function(){this.matchCount=0;
this.matches=null;var z=this.rawResponse;if(t.isNull(z)||z.length<7){return;}if(!this.id){this.id=t.lbs.MetaData.DefaultAddressId;
}var y='<geocode id="'+this.id+'"';var u=z.indexOf(y);y="</geocode>";var x=z.indexOf(y,u+7);z=z.substring(u,x);
if(u<0){return null;}var A=this.getAttribute(z,"match_count",0);this.matchCount=A;if(this.matchCount<=0){return;
}this.matches=[];for(var w=0;w<this.matchCount;w++){var v=this.parseMatch(this.id,w,z);if(t.isNotNull(v)){this.matches.push(v);
}}},getAttribute:function(x,v,z){var w=v+'="';var u=x.indexOf(w,z);var y=x.indexOf('"',u+w.length);return x.substring(u+w.length,y);
},parseMatch:function(w,x,A){var D='<match sequence="'+x+'"';var C=A.indexOf(D);if(C<0){return null;}var E=A.indexOf("</match>",C+7);
A=A.substring(C,E);var y=new t.lbs.Match(w,x);var u=Number(this.getAttribute(A,"longitude",0));var B=Number(this.getAttribute(A,"latitude",0));
y.setLongitude(u);y.setLatitude(B);y.setErrorMessage(this.getAttribute(A,"error_message",0));y.setMatchVector(this.getAttribute(A,"match_vector",0));
y.setSrid(this.getAttribute(A,"srid",0));var v=this.getAttribute(A,"match_code",0);y.setMatchCode(v);
var z=this.parseOutputAddress(w,A);y.setOutputAddress(z);return y;},parseOutputAddress:function(z,w){var v="<output_address";
var u=w.indexOf(v);if(u<0){return null;}var x=w.indexOf("/>",u+1);w=w.substring(u,x);var y=new t.lbs.OutputAddress(z);
y.name=this.getAttribute(w,"name",0);y.houseNumber=this.getAttribute(w,"house_number",0);y.street=this.getAttribute(w,"street",0);
y.settlement=this.getAttribute(w,"settlement",0);y.region=this.getAttribute(w,"region",0);y.municipality=this.getAttribute(w,"municipality",0);
y.country=this.getAttribute(w,"country",0);y.postalCode=this.getAttribute(w,"postal_code",0);y.postalAddonCode=this.getAttribute(w,"postal_addon_code",0);
y.side=this.getAttribute(w,"side",0);y.percent=this.getAttribute(w,"percent",0);y.edgeId=this.getAttribute(w,"edge_id",0);
return y;}});})(e);(function(s){s.lbs.MetaData=s.Class.extend({initialize:function(t){if(t){if(t.substr(t.length-1,1)=="/"){t=t.substr(0,t.length-1);
}this.baseURL=t;}else{this.baseURL="http://elocation.oracle.com";}this.mappingUrl=this.baseURL+"/mapviewer";
this.geocoderUrl=this.baseURL+"/geocoder/gcserver";this.elocationLbsUrl=this.baseURL+"/elocation/lbs";
},getElocationLbsUrl:function(){return this.elocationLbsUrl;},setElocationLbsUrl:function(t){this.elocationLbsUrl=t;
},getGeocoderUrl:function(){return this.geocoderUrl;},setGeocoderUrl:function(t){this.geocoderUrl=t;},getMappingUrl:function(){return this.mappingUrl;
},setMappingUrl:function(t){this.mappingUrl=t;},getRoutingUrl:function(){return this.routingUrl;},setRoutingUrl:function(t){this.routingUrl=t;
}});s.lbs.MetaData.DefaultAddressId="0";})(e);(function(s){s.lbs.Geocoder=s.Class.extend({initialize:function(t){this.metaData=t;
if(t&&t.getGeocoderUrl()&&s.gv.proxyEnabled){this.geocoderUrl=t.getGeocoderUrl();}if(t&&t.getGeocoderUrl()&&!s.gv.proxyEnabled){this.elocationLbsUrl=t.getElocationLbsUrl();
}},geocode:function(t,v){var u=this.wrapAddress2Xml(t);this.send_geocode(t.id,u,v);},parseJson:function(t){if(s.notNull(t)&&s.notNull(t.replace)){t=t.replace(/([{,])(?:\s*)([^:"{},]+)(?:\s*):/g,'$1"$2":');
return s.$.parseJSON(t);}return null;},batchGeoCode:function(A,w){var B="";for(var y=0;y<A.length;y++){var C=A[y];
B+=this.wrapAddress2Xml(C);}var u=this.wrapRequests(B);if(s.util.Logger.DEBUG){s.util.Logger.fine("gc batch request="+u);
}var z=function(L){var G=L;var F=s.lbs.Geocoder.STATUS_FAILED;var K=Array();for(var J=0;J<A.length;J++){var M=A[J];
var I=new s.lbs.DefaultGCResult(M.id,G);K.push(I);}F=s.lbs.Geocoder.STATUS_OK;if(s.util.Logger.DEBUG){s.util.Logger.fine("gc batch response="+G);
}if(s.notNull(w)){w(K,F);}};var x=this;MVXMLHttpRequest={};MVXMLHttpRequest.callBack=function(L,K){K=x.parseJson(K);
var F=s.lbs.Geocoder.STATUS_FAILED;var J=Array();for(var I=0;I<K.length;I++){if(K.length>1){if(s.notNull(K[I][0].x)){var G=new s.lbs.DefaultGCResult(A[I].id,K[I]);
J.push(G);}}}F=s.lbs.Geocoder.STATUS_OK;if(s.util.Logger.DEBUG){s.util.Logger.fine("gc batch response="+K);
}if(s.notNull(w)){w(J,F);}};var D=function(G,J,I){if(I==="abort"){return;}var F="URL: "+t;if(I){F+="\nError: "+I;
}if(G&&G.responseText){F+="\nResponse : "+G.responseText;}s.util.Logger.warning("MAPVIEWER_9014","OM.lbs.Geocoder.geocode",F);
};var E=s.util.HttpRequest;var v={xml_request:u,format:"xml"};var t;if(s.gv.proxyEnabled){t=this.geocoderUrl;
E.send(t,v,z,"text",D,true,true);}else{v.format="JSON";t=this.elocationLbsUrl;s.util.HttpRequest.sendAsScripts(t,v,MVXMLHttpRequest.callBack,"JSON",true);
}},reverseGeocode:function(u,x,w){var t=this.wrapLatLon2Xml(u,x);var v=s.lbs.MetaData.DefaultAddressId;
this.send_geocode(v,t,w);},reverseGeocodePoint:function(v,w){if(s.isNull(v)){return;}var u=this;var t=v.getSRID();
if(t===8307||t===4326){this.reverseGeocode(v.getX(),v.getY(),w);}else{v.transform(8307,function(x){u.reverseGeocode(x.getX(),x.getY(),w);
});}},send_geocode:function(u,A,x){var v=this.wrapRequests(A);var z=function(G){var E=G;var D=s.lbs.Geocoder.STATUS_FAILED;
var F=new s.lbs.DefaultGCResult(u,E);D=s.lbs.Geocoder.STATUS_OK;if(s.notNull(x)){x(F,D);}};var y=this;
MVXMLHttpRequest={};MVXMLHttpRequest.callBack=function(G,F){F=y.parseJson(F);var D=s.lbs.Geocoder.STATUS_FAILED;
var E=new s.lbs.DefaultGCResult(G,F);D=s.lbs.Geocoder.STATUS_OK;if(s.notNull(x)){x(E,D);}};var B=function(E,G,F){if(F==="abort"){return;
}var D="URL: "+t;if(F){D+="\nError: "+F;}if(E&&E.responseText){D+="\nResponse : "+E.responseText;}s.util.Logger.warning("MAPVIEWER_9014","OM.lbs.Geocoder.geocode",D);
};var C=s.util.HttpRequest;var w={xml_request:v,format:"xml"};var t;if(s.gv.proxyEnabled){t=this.geocoderUrl;
C.send(t,w,z,"text",B,true,true);}else{w.format="JSON";t=this.elocationLbsUrl;s.util.HttpRequest.sendAsScripts(t,w,MVXMLHttpRequest.callBack,"JSON",true);
}},wrapAddress2Xml:function(t){if(t instanceof s.lbs.Address){return t.toXmlString();}else{var u=new s.lbs.Address(t);
return u.toXmlString();}},wrapLatLon2Xml:function(v,u){var t="<input_location ";t+='longitude="'+v+'" ';
t+='latitude="'+u+'"';t+="/>";return t;},wrapRequests:function(t){var u='<?xml version="1.0" standalone="yes"?>\n';
u+='<geocode_request vendor="oracle">\n';u+="<address_list>\n";u+=t;u+="</address_list>\n";u+="</geocode_request>";
return u;}});s.lbs.Geocoder.MATCH_MODE_EXACT="EXACT";s.lbs.Geocoder.MATCH_MODE_RELAX_STREET_TYPE="RELAX_STREET_TYPE";
s.lbs.Geocoder.MATCH_MODE_RELAX_POI_NAME="RELAX_POI_NAME";s.lbs.Geocoder.MATCH_MODE_RELAX_HOUSE_NUMBER="RELAX_HOUSE_NUMBER";
s.lbs.Geocoder.MATCH_MODE_RELAX_BASE_NAME="RELAX_BASE_NAME";s.lbs.Geocoder.MATCH_MODE_RELAX_POSTAL_CODE="RELAX_POSTAL_CODE";
s.lbs.Geocoder.MATCH_MODE_RELAX_BUILTUP_AREA="RELAX_BUILTUP_AREA";s.lbs.Geocoder.MATCH_MODE_RELAX_ALL="RELAX_ALL";
s.lbs.Geocoder.MATCH_MODE_DEFAULT="RELAX_POSTAL_CODE";s.lbs.Geocoder.STATUS_FAILED=0;s.lbs.Geocoder.STATUS_OK=1;
})(e);(function(s){s.lbs.Address=s.Class.extend({initialize:function(t){this.id=s.lbs.MetaData.DefaultAddressId;
this.address="";this.country="US";this.matchMode=s.lbs.Geocoder.MATCH_MODE_DEFAULT;if(t){if(t.id){this.id=t.id;
}if(t.address){this.address=t.address;}if(t.country){this.country=t.country;}if(t.matchMode){this.matchMode=t.matchMode;
}}},toXmlString:function(){var v="";var t=this.address.split(",");v+='<input_location id="'+this.id+'"><input_address match_mode="'+this.matchMode+'"><unformatted country="'+this.country+'">';
for(var u=0;u<t.length;u++){v+='<address_line value ="'+t[u]+'"/>';}v+="</unformatted></input_address></input_location>";
return v;},getStreetLine:function(t){if(!t.houseNumber){if(t.street){return t.street;}else{return null;
}}var u=t.country;if(s.isNull(u)||"US"==u||"AD"==u||"AU"==u||"CA"==u||"FR"==u||"GB"==u||"IE"==u||"LU"==u||"MC"==u||"NZ"==u||"PR"==u){return t.houseNumber+" "+t.street;
}else{return t.street+" "+t.houseNumber;}},getLocalityLine:function(u){var x=u.country;var w=false;if(s.notNull(x)&&("AT"==x||"BE"==x||"DK"==x||"FI"==x||"FR"==x||"DE"==x||"IT"==x||"LI"==x||"LU"==x||"MC"==x||"NL"==x||"NO"==x||"PT"==x||"SM"==x||"ES"==x||"SE"==x||"CH"==x)){w=true;
}var v=false;if(s.isNull(x)||"US"==x||"AU"==x||"CA"==x){v=true;}var t="";if(u.settlement){t+=u.settlement;
}if(u.municipality&&u.municipality!=u.settlement){t+=(t.length>0?", ":"")+u.municipality;}if(v&&u.region){t+=(t.length>0?", ":"")+u.region;
}if(s.notNull(u.postalCode)){if(w){t=u.postalCode+" "+t;}else{t=t+" "+u.postalCode;}}if(t===""){return null;
}else{return t;}}});})(e);(function(t){t.lbs.GdfFormAddress=t.lbs.Address.extend({initialize:function s(u){s.base.call(this,u);
this.name="";this.street="";this.intersectingStreet="";this.builtupArea="";this.order8Area="";this.order2Area="";
this.order1Area="";this.postalCode="";this.postalAddonCode="";this.country="US";if(u){this.name=u.name;
this.street=u.street;this.intersectingStreet=u.intersectingStreet;this.builtupArea=u.builtupArea;this.order8Area=u.order8Area;
this.order2Area=u.order2Area;this.order1Area=u.order1Area;this.postalCode=u.postalCode;this.postalAddonCode=u.postalAddonCode;
if(u.country){this.country=u.country;}}},toXmlString:function(){var u="";u+='<input_location id="'+this.id+'"><input_address match_mode="'+this.matchMode+'"><gdf_form ';
if(this.name){u+='name ="'+this.name+'" ';}if(this.street){u+='street ="'+this.street+'" ';}if(this.intersectingStreet){u+='intersecting_street ="'+this.intersectingStreet+'" ';
}if(this.builtupArea){u+='builtup_area ="'+this.builtupArea+'" ';}if(this.order8Area){u+='order8_area ="'+this.order8Area+'" ';
}if(this.order2Area){u+='order2_area ="'+this.order2Area+'" ';}if(this.order1Area){u+='order1_area ="'+this.order1Area+'" ';
}if(this.country){u+='country ="'+this.country+'" ';}if(this.postalCode){u+='postal_code ="'+this.postalCode+'" ';
}if(this.postalAddonCode){u+='postal_addon_code ="'+this.postalAddonCode+'" ';}u+="/></input_address></input_location>";
return u;}});})(e);(function(t){t.lbs.GenFormAddress=t.lbs.Address.extend({initialize:function s(u){s.base.call(this,u);
this.name="";this.street="";this.intersectingStreet="";this.subArea="";this.city="";this.region="";this.postalCode="";
this.postalAddonCode="";this.country="US";if(u){this.name=u.name;this.street=u.street;this.intersectingStreet=u.intersectingStreet;
this.subArea=u.subArea;this.city=u.city;this.region=u.region;this.postalCode=u.postalCode;this.postalAddonCode=u.postalAddonCode;
if(u.country){this.country=u.country;}}},toXmlString:function(){var u="";u+='<input_location id="'+this.id+'"><input_address match_mode="'+this.matchMode+'"><gen_form ';
if(this.name){u+='name ="'+this.name+'" ';}if(this.street){u+='street ="'+this.street+'" ';}if(this.intersectingStreet){u+='intersecting_street ="'+this.intersectingStreet+'" ';
}if(this.subArea){u+='sub_area ="'+this.subArea+'" ';}if(this.city){u+='city ="'+this.city+'" ';}if(this.region){u+='region ="'+this.region+'" ';
}if(this.country){u+='country ="'+this.country+'" ';}if(this.postalCode){u+='postal_code ="'+this.postalCode+'" ';
}if(this.postalAddonCode){u+='postal_addon_code ="'+this.postalAddonCode+'" ';}u+="/></input_address></input_location>";
return u;}});})(e);(function(t){t.lbs.USForm1Address=t.lbs.Address.extend({initialize:function s(u){s.base.call(this,u);
this.name="";this.street="";this.intersectingStreet="";this.lastline="";if(u){this.name=u.name;this.street=u.street;
this.intersectingStreet=u.intersectingStreet;this.lastline=u.lastline;}},toXmlString:function(){var u="";
u+='<input_location id="'+this.id+'"><input_address match_mode="'+this.matchMode+'"><us_form1 ';if(this.name){u+='name ="'+this.name+'" ';
}if(this.street){u+='street ="'+this.street+'" ';}if(this.intersectingStreet){u+='intersecting_street ="'+this.intersectingStreet+'" ';
}if(this.lastline){u+='lastline ="'+this.lastline+'" ';}u+="/></input_address></input_location>";return u;
}});})(e);(function(t){t.lbs.USForm2Address=t.lbs.Address.extend({initialize:function s(u){s.base.call(this,u);
this.name="";this.street="";this.intersectingStreet="";this.city="";this.state="";this.zipCode="";if(u){this.name=u.name;
this.street=u.street;this.intersectingStreet=u.intersectingStreet;this.city=u.city;this.state=u.state;
this.zipCode=u.zipCode;}},toXmlString:function(){var u="";u+='<input_location id="'+this.id+'"><input_address match_mode="'+this.matchMode+'"><us_form2 ';
if(this.name){u+='name ="'+this.name+'" ';}if(this.street){u+='street ="'+this.street+'" ';}if(this.intersectingStreet){u+='intersecting_street ="'+this.intersectingStreet+'" ';
}if(this.city){u+='city ="'+this.city+'" ';}if(this.state){u+='state ="'+this.state+'" ';}if(this.zipCode){u+='zip_code ="'+this.zipCode+'" ';
}u+="/></input_address></input_location>";return u;}});})(e);(function(s){s.lbs.UnformatedAddress=s.lbs.Address.extend({initialize:function(t){this.id=s.lbs.MetaData.DefaultAddressId;
this.address="";this.country="US";this.matchMode="relax_street_type";if(t){if(t.id){this.id=t.id;}if(t.address){this.address=t.address;
}if(t.country){this.country=t.country;}if(t.matchMode){this.matchMode=t.matchMode;}}},toXmlString:function(){var v="";
var t=this.address.split(",");v+='<input_location id="'+this.id+'"><input_address match_mode="'+this.matchMode+'"><unformatted country="'+this.country+'">';
for(var u=0;u<t.length;u++){v+='<address_line value ="'+t[u]+'"/>';}v+="</unformatted></input_address></input_location>";
return v;}});})(e);e.edit.EditChangeEvent=e.Class.extend({initialize:function(s){var t=e.edit.EditChangeEvent;
this.eventType=t.NO_EVENT;this.updateType=t.NO_UPDATE;this.key=null;this.feature=null;this.currentChange=null;
this.oldChange=null;this.isNewFeature=false;this.isModifiedFeature=false;if(e.notNull(s)){if(e.notNull(s.eventType)){this.eventType=s.eventType;
}if(e.notNull(s.updateType)){this.updateType=s.updateType;}if(e.notNull(s.key)){this.key=s.key;}if(e.notNull(s.feature)){this.feature=s.feature;
}if(e.notNull(s.currentChange)){this.currentChange=s.currentChange;}if(e.notNull(s.oldChange)){this.oldChange=s.oldChange;
}if(e.notNull(s.isNewFeature)){this.isNewFeature=s.isNewFeature;}if(e.notNull(s.isModifiedFeature)){this.isModifiedFeature=s.isModifiedFeature;
}}},getEventType:function(){return this.eventType;},getUpdateType:function(){return this.updateType;},getKey:function(){return this.key;
},getFeature:function(){return this.feature;},getCurrentChange:function(){return this.currentChange;},getOldChange:function(){return this.oldChange;
},isNewFeature:function(){return this.isNewFeature;},isModifiedFeature:function(){return this.isModifiedFeature;
}});e.edit.EditChangeEvent.NO_EVENT=0;e.edit.EditChangeEvent.NEW_EVENT=1;e.edit.EditChangeEvent.UPDATE_EVENT=2;
e.edit.EditChangeEvent.REMOVE_EVENT=3;e.edit.EditChangeEvent.NO_UPDATE=0;e.edit.EditChangeEvent.SPATIAL_UPDATE=1;
e.edit.EditChangeEvent.ATTRIBUTE_UPDATE=2;e.edit.EditChangeManager=e.Class.extend({initialize:function(s){this.layer=e.notNull(s)?s.layer:null;
this.newFeatures={};this.removedFeatures={};this.modifiedFeatures={};this.updateChanges={};},addFeature:function(v,u){if(e.isNull(this.layer)||e.isNull(v)||e.isNull(u)){return null;
}this.layer.addFeature(u);this.newFeatures[v]=u;var t=e.edit.EditChangeEvent;var s=new e.edit.EditChangeEvent({eventType:t.NEW_EVENT,updateType:t.NO_UPDATE,key:v,feature:u,currentChange:u,oldChange:null,isNewFeature:true,isModifiedFeature:false});
return s;},removeFeature:function(x,w){if(e.isNull(this.layer)||e.isNull(x)||e.isNull(w)){return null;
}this.layer.removeFeature(w);var s=false;var t=false;if(e.notNull(this.newFeatures[x])){s=true;delete this.newFeatures[x];
}else{this.removedFeatures[x]=w;if(e.notNull(this.modifiedFeatures[x])){delete this.modifiedFeatures[x];
t=true;}}var v=e.edit.EditChangeEvent;var u=new e.edit.EditChangeEvent({eventType:v.REMOVE_EVENT,updateType:v.NO_UPDATE,key:x,feature:w,currentChange:null,oldChange:w,isNewFeature:s,isModifiedFeature:t});
return u;},updateFeature:function(E,G,x,F){if(e.isNull(this.layer)||e.isNull(E)){return null;}var C=null;
var v=e.edit.EditChangeEvent;if(F===v.SPATIAL_UPDATE){C=G.geo;G.geo=x;}else{if(F===v.ATTRIBUTE_UPDATE){C={};
if(e.notNull(x)){for(var A in x){if(x.hasOwnProperty(A)){C[A]=G.getAttributeValue(A);if(e.isNull(G.attributes)){G.attributes={};
}G.attributes[A]=x[A];}}}}else{return null;}}var w=false;var z=false;if(e.isNull(this.newFeatures[E])){if(e.notNull(this.modifiedFeatures[E])){z=true;
}this.modifiedFeatures[E]=G;}else{w=true;this.newFeatures[E]=G;}var B=new e.edit.EditChangeEvent({eventType:v.UPDATE_EVENT,updateType:F,key:E,feature:G,currentChange:x,oldChange:C,isNewFeature:w,isModifiedFeature:z});
if(w===false){var D=this.updateChanges[E];if(e.isNull(D)){D=[];this.updateChanges[E]=D;}D.push(B);}if(e.notNull(this.layer.rtree)&&F===v.SPATIAL_UPDATE){if(e.notNull(C)){var u=C.getMBR();
if(e.notNull(u)){var s={x:u.getMinX(),y:u.getMinY(),w:u.getWidth(),h:u.getHeight()};this.layer.rtree.remove(s,G);
delete this.layer.segmentRtree[G.id];}}if(e.notNull(x)){var y=x.getMBR();if(e.notNull(y)){var t={x:y.getMinX(),y:y.getMinY(),w:y.getWidth(),h:y.getHeight()};
this.layer.rtree.insert(t,G);}}}return B;},getNewFeatures:function(){var t=[];for(var s in this.newFeatures){if(this.newFeatures.hasOwnProperty(s)){t.push(this.newFeatures[s]);
}}return t;},getRemovedFeatures:function(){var t=[];for(var s in this.removedFeatures){if(this.removedFeatures.hasOwnProperty(s)){t.push(this.removedFeatures[s]);
}}return t;},getModifiedFeatures:function(){var t=[];for(var s in this.modifiedFeatures){if(this.modifiedFeatures.hasOwnProperty(s)){t.push(this.modifiedFeatures[s]);
}}return t;},hasChanges:function(){var s;for(s in this.newFeatures){if(this.newFeatures.hasOwnProperty(s)){return true;
}}for(s in this.removedFeatures){if(this.removedFeatures.hasOwnProperty(s)){return true;}}for(s in this.modifiedFeatures){if(this.modifiedFeatures.hasOwnProperty(s)){return true;
}}return false;},hasSpatialAttributeChanged:function(v){if(e.isNull(v)){return false;}if(e.isNull(this.modifiedFeatures[v])){return false;
}var w=this.updateChanges[v];if(e.isNull(w)){return false;}var u=e.edit.EditChangeEvent;var s=w.length;
for(var t=0;t<s;t++){if(w[t].getUpdateType()===u.SPATIAL_UPDATE){return true;}}return false;},getChangedAttributesOfModifiedFeature:function(A){if(e.isNull(A)){return null;
}if(e.isNull(this.modifiedFeatures[A])){return false;}var z=this.updateChanges[A];if(e.isNull(z)){return false;
}var y=[];var t=e.edit.EditChangeEvent;var w=z.length;for(var u=0;u<w;u++){if(z[u].getUpdateType()===t.ATTRIBUTE_UPDATE){var v=z[u].getCurrentChange();
if(e.isNull(v)){continue;}for(var x in v){if(v.hasOwnProperty(x)){var B=false;for(var s=0;s<y.length;
s++){if(y[s]==x){B=true;break;}}if(B===false){y.push(x);}}}}}return y;},undo:function(x){if(e.isNull(x)){return;
}var E=x.key;var u=x.eventType;var y=e.edit.EditChangeEvent;if(u===y.NEW_EVENT){this.layer.removeFeature(x.currentChange);
delete this.newFeatures[E];if(e.notNull(this.layer.rtree)&&e.notNull(x.currentChange.geo)){var B=x.currentChange.geo.getMBR();
if(e.notNull(B)){var t={x:B.getMinX(),y:B.getMinY(),w:B.getWidth(),h:B.getHeight()};this.layer.rtree.remove(t,x.currentChange);
delete this.layer.segmentRtree[x.currentChange.id];}}}else{if(u===y.UPDATE_EVENT){var G=x.updateType;
if(G===y.SPATIAL_UPDATE){if(e.isNull(x.feature)){return;}x.feature.setGeometry(x.oldChange);}else{if(G===y.ATTRIBUTE_UPDATE){if(e.notNull(x.oldChange)){for(var A in x.oldChange){if(x.oldChange.hasOwnProperty(A)){x.feature.attributes[A]=x.oldChange[A];
}}}}}if(x.isNewFeature===false){var C=this.updateChanges[E];if(e.notNull(C)&&C.length>0){C.pop();if(C.length===0){delete this.updateChanges[E];
}}if(x.isModifiedFeature===false){delete this.modifiedFeatures[E];}}if(e.notNull(this.layer.rtree)&&G===y.SPATIAL_UPDATE){if(e.notNull(x.currentChange)){var w=x.currentChange.getMBR();
if(e.notNull(w)){var s={x:w.getMinX(),y:w.getMinY(),w:w.getWidth(),h:w.getHeight()};this.layer.rtree.remove(s,x.feature);
delete this.layer.segmentRtree[x.feature.id];}}if(e.notNull(x.oldChange)){var z=x.oldChange.getMBR();
if(e.notNull(z)){var v={x:z.getMinX(),y:z.getMinY(),w:z.getWidth(),h:z.getHeight()};this.layer.rtree.insert(v,x.feature);
}}}}else{if(u===y.REMOVE_EVENT){this.layer.addFeature(x.oldChange);if(x.isNewFeature===false){delete this.removedFeatures[E];
if(x.isModifiedFeature===true){this.modifiedFeatures[E]=x.oldChange;}}else{this.newFeatures[E]=x.oldChange;
}if(e.notNull(this.layer.rtree)&&e.notNull(x.oldChange.geo)){var F=x.oldChange.geo.getMBR();if(e.notNull(F)){var D={x:F.getMinX(),y:F.getMinY(),w:F.getWidth(),h:F.getHeight()};
this.layer.rtree.insert(D,x.oldChange);}}}}}},redo:function(x){if(e.isNull(x)){return;}var E=x.key;var u=x.eventType;
var y=e.edit.EditChangeEvent;if(u===y.NEW_EVENT){this.layer.addFeature(x.currentChange);this.newFeatures[E]=x.currentChange;
if(e.notNull(this.layer.rtree)&&e.notNull(x.currentChange.geo)){var B=x.currentChange.geo.getMBR();if(e.notNull(B)){var t={x:B.getMinX(),y:B.getMinY(),w:B.getWidth(),h:B.getHeight()};
this.layer.rtree.insert(t,x.currentChange);}}}else{if(u===y.UPDATE_EVENT){var G=x.updateType;if(G===y.SPATIAL_UPDATE){if(e.isNull(x.feature)){return;
}x.feature.setGeometry(x.currentChange);}else{if(G===y.ATTRIBUTE_UPDATE){if(e.notNull(x.currentChange)){for(var A in x.currentChange){if(x.currentChange.hasOwnProperty(A)){x.feature.attributes[A]=x.currentChange[A];
}}}}}if(x.isNewFeature===false){var C=this.updateChanges[E];if(e.isNull(C)){C=[];this.updateChanges[E]=C;
}C.push(x);if(x.isModifiedFeature===false){this.modifiedFeatures[E]=x.feature;}}if(e.notNull(this.layer.rtree)&&G===y.SPATIAL_UPDATE){if(e.notNull(x.oldChange)){var w=x.oldChange.getMBR();
if(e.notNull(w)){var s={x:w.getMinX(),y:w.getMinY(),w:w.getWidth(),h:w.getHeight()};this.layer.rtree.remove(s,x.feature);
delete this.layer.segmentRtree[x.feature.id];}}if(e.notNull(x.currentChange)){var z=x.currentChange.getMBR();
if(e.notNull(z)){var v={x:z.getMinX(),y:z.getMinY(),w:z.getWidth(),h:z.getHeight()};this.layer.rtree.insert(v,x.feature);
}}}}else{if(u===y.REMOVE_EVENT){this.layer.removeFeature(x.oldChange);if(x.isNewFeature===false){this.removedFeatures[E]=x.oldChange;
if(x.isModifiedFeature===true){delete this.modifiedFeatures[E];}}else{delete this.newFeatures[E];}if(e.notNull(this.layer.rtree)&&e.notNull(x.oldChange.geo)){var F=x.oldChange.geo.getMBR();
if(e.notNull(F)){var D={x:F.getMinX(),y:F.getMinY(),w:F.getWidth(),h:F.getHeight()};this.layer.rtree.remove(D,x.oldChange);
delete this.layer.segmentRtree[x.oldChange.id];}}}}}},clearChanges:function(){this.newFeatures={};this.removedFeatures={};
this.modifiedFeatures={};this.updateChanges={};}});e.edit.GeometrySegment=e.Class.extend({initialize:function(t){var s=e.edit.GeometrySegment;
this.segIndex=-1;this.elemIndex=-1;this.subElemIndex=-1;this.segType=s.UNDEFINED_TYPE;if(e.notNull(t)){if(e.notNull(t.segIndex)){this.segIndex=t.segIndex;
}if(e.notNull(t.elemIndex)){this.elemIndex=t.elemIndex;}if(e.notNull(t.subElemIndex)){this.subElemIndex=t.subElemIndex;
}if(e.notNull(t.segType)){this.segType=t.segType;}}},getSegmentIndex:function(){return this.segIndex;
},setSegmentIndex:function(s){this.segIndex=s;},getElementIndex:function(){return this.elemIndex;},setElementIndex:function(s){this.elemIndex=s;
},getSubElementIndex:function(){return this.subElemIndex;},setSubElementIndex:function(s){this.subElemIndex=s;
},getSegmentType:function(){return this.segType;},setSegmentType:function(s){this.segType=s;}});e.edit.GeometrySegment.UNDEFINED_TYPE=0;
e.edit.GeometrySegment.POINT_TYPE=1;e.edit.GeometrySegment.LINE_TYPE=2;e.edit.GeometrySegment.RECTANGLE_TYPE=3;
e.edit.GeometrySegment.ARC_TYPE=4;e.edit.GeometrySegment.CIRCLE_TYPE=5;e.edit.GeometrySegmentPoint=e.Class.extend({initialize:function(t){var s=e.edit.GeometrySegmentPoint;
this.feature=null;this.segment=null;this.point=null;this.pointLocation=s.UNDEFSEG_POINT;if(e.notNull(t)){if(e.notNull(t.feature)){this.feature=t.feature;
}if(e.notNull(t.segment)){this.segment=t.segment;}if(e.notNull(t.point)){this.point=t.point;}if(e.notNull(t.pointLocation)){this.pointLocation=t.pointLocation;
}}},getFeature:function(){return this.feature;},setFeature:function(s){this.feature=s;},getGeometrySegment:function(){return this.segment;
},setGeometrySegment:function(s){this.segment=s;},getPoint:function(){return this.point;},setPoint:function(s){this.point=s;
},getPointLocation:function(){return this.pointLocation;},setPointLocation:function(s){this.pointLocation=s;
}});e.edit.GeometrySegmentPoint.UNDEFSEG_POINT=-1;e.edit.GeometrySegmentPoint.STARTSEG_POINT=0;e.edit.GeometrySegmentPoint.ENDSEG_POINT=1;
e.edit.GeometrySegmentPoint.MIDSEG_POINT=2;e.edit.GeometrySegmentUtil=e.edit.GeometrySegmentUtil||{};
e.edit.GeometrySegmentUtil.buildSegmentTree=function(Z){if(e.isNull(Z)){return null;}var K=Z.getGeometry();
if(e.isNull(K)){return null;}var G=new e.RTree(10);var am=K.getType();var F=e.edit.GeometrySegment;var N=K.getMBR();
if(e.isNull(N)){return null;}var aj={x:N.minX,y:N.minY,w:N.maxX-N.minX,h:N.maxY-N.minY};var t=K.getDimension();
switch(am){case"Point":case"OrientedPoint":case"Rectangle":var z=new e.edit.GeometrySegment();z.setElementIndex(0);
z.setSegmentIndex(0);z.setSubElementIndex(0);if(am==="Point"||am==="OrientedPoint"){z.setSegmentType(F.POINT_TYPE);
}else{z.setSegmentType(F.RECTANGLE_TYPE);}G.insert(aj,z);break;case"MultiPoint":case"OrientedMultiPoint":var ah=K.coordinates.length;
for(var y=0;y<ah;y++){var I={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};
if(am==="MultiPoint"){I=e.geometry.Geometry.getCoordsMBR(K.coordinates[y],t,I);}else{I=e.geometry.Geometry.getCoordsMBR([K.coordinates[y][0],K.coordinates[y][1]],t,I);
}var C=new e.edit.GeometrySegment();C.setElementIndex(y);C.setSegmentIndex(0);C.setSubElementIndex(0);
C.setSegmentType(F.POINT_TYPE);var al={x:I.minX,y:I.minY,w:I.maxX-I.minX,h:I.maxY-I.minY};G.insert(al,C);
}break;case"LineString":var E=K.coordinates.length;var O=0;for(var Q=0;Q<E-t;Q+=t){var U={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};
var S=new e.edit.GeometrySegment();S.setElementIndex(0);S.setSegmentIndex(O++);S.setSubElementIndex(0);
S.setSegmentType(F.LINE_TYPE);U.minX=Math.min(K.coordinates[Q],K.coordinates[Q+t]);U.maxX=Math.max(K.coordinates[Q],K.coordinates[Q+t]);
U.minY=Math.min(K.coordinates[Q+1],K.coordinates[Q+1+t]);U.maxY=Math.max(K.coordinates[Q+1],K.coordinates[Q+1+t]);
var M={x:U.minX,y:U.minY,w:U.maxX-U.minX,h:U.maxY-U.minY};G.insert(M,S);}break;case"MultiLineString":var ac=K.coordinates.length;
for(var aa=0;aa<ac;aa++){var T=K.coordinates[aa].length;var J=0;for(var ag=0;ag<T-t;ag+=t){var v={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};
var L=new e.edit.GeometrySegment();L.setElementIndex(aa);L.setSegmentIndex(J++);L.setSubElementIndex(0);
L.setSegmentType(F.LINE_TYPE);v.minX=Math.min(K.coordinates[aa][ag],K.coordinates[aa][ag+t]);v.maxX=Math.max(K.coordinates[aa][ag],K.coordinates[aa][ag+t]);
v.minY=Math.min(K.coordinates[aa][ag+1],K.coordinates[aa][ag+1+t]);v.maxY=Math.max(K.coordinates[aa][ag+1],K.coordinates[aa][ag+1+t]);
var af={x:v.minX,y:v.minY,w:v.maxX-v.minX,h:v.maxY-v.minY};G.insert(af,L);}}break;case"Polygon":var P=K.coordinates.length;
for(var W=0;W<P;W++){var ak=K.coordinates[W].length;var Y=0;for(var R=0;R<ak-t;R+=t){var B={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};
var ab=new e.edit.GeometrySegment();ab.setElementIndex(0);ab.setSegmentIndex(Y++);ab.setSubElementIndex(W);
ab.setSegmentType(F.LINE_TYPE);B.minX=Math.min(K.coordinates[W][R],K.coordinates[W][R+t]);B.maxX=Math.max(K.coordinates[W][R],K.coordinates[W][R+t]);
B.minY=Math.min(K.coordinates[W][R+1],K.coordinates[W][R+1+t]);B.maxY=Math.max(K.coordinates[W][R+1],K.coordinates[W][R+1+t]);
var ae={x:B.minX,y:B.minY,w:B.maxX-B.minX,h:B.maxY-B.minY};G.insert(ae,ab);}}break;case"MultiPolygon":var ai=K.coordinates.length;
for(var X=0;X<ai;X++){var x=K.coordinates[X].length;for(var A=0;A<x;A++){var V=K.coordinates[X][A].length;
var w=0;for(var ad=0;ad<V-t;ad+=t){var u={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};
var D=new e.edit.GeometrySegment();D.setElementIndex(X);D.setSegmentIndex(w++);D.setSubElementIndex(A);
D.setSegmentType(F.LINE_TYPE);u.minX=Math.min(K.coordinates[X][A][ad],K.coordinates[X][A][ad+t]);u.maxX=Math.max(K.coordinates[X][A][ad],K.coordinates[X][A][ad+t]);
u.minY=Math.min(K.coordinates[X][A][ad+1],K.coordinates[X][A][ad+1+t]);u.maxY=Math.max(K.coordinates[X][A][ad+1],K.coordinates[X][A][ad+1+t]);
var s={x:u.minX,y:u.minY,w:u.maxX-u.minX,h:u.maxY-u.minY};G.insert(s,D);}}}break;case"GeometryCollection":break;
default:break;}return G;};e.edit.GeometrySegmentUtil.getFeatureSegmentPoint=function(B,N,O,V,A,D,P,v){if(e.isNull(B)){return null;
}if(e.isNull(B.getGeometry())){return null;}var Z=null;if(e.isNull(N)){Z=e.edit.GeometrySegmentUtil.buildSegmentTree(B);
}else{Z=N;}if(e.isNull(Z)){return null;}var E={x:O[0]-V,y:O[1]-V,w:V*2,h:V*2};if(e.isNull(A)){A=false;
}if(e.isNull(v)){v=false;}if(e.isNull(P)){P=false;}if(e.isNull(D)){D=false;}var Q=Z.search(E);if(e.isNull(Q)||Q.length===0){return null;
}var L=e.edit.GeometrySegment;var T=e.edit.GeometrySegmentPoint;var x=null;var u=null;var C=null;var J;
var I;var w;var t=Number.MAX_VALUE;var M=B.getGeometry();var S=M.getDimension();for(var U=0;U<Q.length;
U++){var K=Q[U];if(K.getSegmentType()===L.POINT_TYPE){if(A===false){continue;}J=M.getX()-O[0];I=M.getY()-O[1];
w=Math.sqrt((J*J)+(I*I));if(w<=V){if(w<t){t=w;x=K;u=[M.getX(),M.getY()];C=T.STARTSEG_POINT;}}}else{if(K.getSegmentType()===L.LINE_TYPE){var G=K.getElementIndex();
var s=K.getSegmentIndex();var R=K.getSubElementIndex();var Y=0;var z=0;var X=0;var y=0;if(M.getType()==="Polygon"){Y=M.coordinates[R][s*S];
z=M.coordinates[R][(s*S)+1];X=M.coordinates[R][(s*S)+S];y=M.coordinates[R][(s*S)+S+1];}else{if(M.getType()==="MultiPolygon"){Y=M.coordinates[G][R][s*S];
z=M.coordinates[G][R][(s*S)+1];X=M.coordinates[G][R][(s*S)+S];y=M.coordinates[G][R][(s*S)+S+1];}else{if(M.getType()==="LineString"){Y=M.coordinates[s*S];
z=M.coordinates[(s*S)+1];X=M.coordinates[(s*S)+S];y=M.coordinates[(s*S)+S+1];}else{if(M.getType()==="MultiLineString"){Y=M.coordinates[G][s*S];
z=M.coordinates[G][(s*S)+1];X=M.coordinates[G][(s*S)+S];y=M.coordinates[G][(s*S)+S+1];}else{continue;
}}}}var W=e.util.GeomUtil.distanceToSegment(O[0],O[1],Y,z,X,y);if(e.notNull(W)&&W[0]<=V){t=W[0];x=K;C=Math.floor(W[1]);
if(C===0){u=[Y,z];}else{if(C===1){u=[X,y];}else{u=e.util.GeomUtil.getSegmentPoint(O[0],O[1],Y,z,X,y);
C=T.MIDSEG_POINT;if(e.notNull(u)){J=u[0]-Y;I=u[1]-z;if(Math.sqrt((J*J)+(I*I))<=V){u=[Y,z];C=T.STARTSEG_POINT;
}else{J=u[0]-X;I=u[1]-y;if(Math.sqrt((J*J)+(I*I))<=V){u=[X,y];C=T.ENDSEG_POINT;}}}}}}}else{if((K.getSegmentType()===L.ARC_TYPE&&v)||(K.getSegmentType()===L.CIRCLE_TYPE&&P)){}else{if(K.getSegmentType()===L.RECTANGLE_TYPE){if(D===false){continue;
}}}}}}if(e.isNull(x)){return null;}var F=new e.edit.GeometrySegmentPoint();F.feature=B;F.segment=x;F.point=u;
F.pointLocation=C;return F;};e.edit.GeometrySegmentUtil.getLayerSegmentPoint=function(K,C,I,u,x,D,t){if(e.isNull(K)||e.isNull(C)||e.isNull(I)){return null;
}var y={x:C[0]-I,y:C[1]-I,w:I*2,h:I*2};var v=K.searchFeatures(y);if(e.isNull(v)||v.length===0){return null;
}var s=Number.MAX_VALUE;var G=null;for(var F=0;F<v.length;F++){var J=K.segmentRtree[v[F].id];if(e.isNull(J)){J=e.edit.GeometrySegmentUtil.buildSegmentTree(v[F]);
if(e.isNull(J)){continue;}else{K.segmentRtree[v[F].id]=J;}}var E=e.edit.GeometrySegmentUtil.getFeatureSegmentPoint(v[F],J,C,I,u,t,D,x);
if(e.isNull(E)){continue;}var w=E.getPoint();if(w!==null){var A=C[0]-w[0];var z=C[1]-w[1];var B=Math.sqrt((A*A)+(z*z));
if(B<s){s=B;G=E;}}}return G;};e.edit.GeometrySegmentUtil.getLayerSegmentPoints=function(y,E,A,C,x,B,D){if(e.isNull(y)||e.isNull(E)||e.isNull(A)){return null;
}var s={x:E[0]-A,y:E[1]-A,w:A*2,h:A*2};var u=y.searchFeatures(s);if(e.isNull(u)||u.length===0){return null;
}var w=[];for(var v=0;v<u.length;v++){var t=y.segmentRtree[u[v].id];if(e.isNull(t)){t=e.edit.GeometrySegmentUtil.buildSegmentTree(u[v]);
if(e.isNull(t)){continue;}else{y.segmentRtree[u[v].id]=t;}}var z=e.edit.GeometrySegmentUtil.getFeatureSegmentPoint(u[v],t,E,A,C,x,B,D);
if(e.isNull(z)){continue;}w.push(z);}if(w.length===0){return null;}else{return w;}};e.edit.GeometrySegmentUtil.getFeatureSegmentPointsWithinBox=function(v,G,w){if(e.isNull(v)){return null;
}if(e.isNull(w)){return null;}if(e.isNull(v.getGeometry())){return null;}var P=null;if(e.isNull(G)){P=e.edit.GeometrySegmentUtil.buildSegmentTree(v);
}else{P=G;}if(e.isNull(P)){return null;}var I=P.search(w);if(e.isNull(I)||I.length===0){return null;}var D=e.edit.GeometrySegment;
var J=e.edit.GeometrySegmentPoint;var F=v.getGeometry();var K=F.getDimension();var E=[];var y={};var z=null;
for(var M=0;M<I.length;M++){var A=I[M];var x=A.getElementIndex();var s=A.getSegmentIndex();var L=A.getSubElementIndex();
if(A.getSegmentType()===D.LINE_TYPE){var O=0;var u=0;var N=0;var t=0;if(F.getType()==="Polygon"){O=F.coordinates[L][s*K];
u=F.coordinates[L][(s*K)+1];N=F.coordinates[L][(s*K)+K];t=F.coordinates[L][(s*K)+K+1];}else{if(F.getType()==="MultiPolygon"){O=F.coordinates[x][L][s*K];
u=F.coordinates[x][L][(s*K)+1];N=F.coordinates[x][L][(s*K)+K];t=F.coordinates[x][L][(s*K)+K+1];}else{if(F.getType()==="LineString"){O=F.coordinates[s*K];
u=F.coordinates[(s*K)+1];N=F.coordinates[(s*K)+K];t=F.coordinates[(s*K)+K+1];}else{if(F.getType()==="MultiLineString"){O=F.coordinates[x][s*K];
u=F.coordinates[x][(s*K)+1];N=F.coordinates[x][(s*K)+K];t=F.coordinates[x][(s*K)+K+1];}else{continue;
}}}}z=""+x+":"+(s-1)+":"+L+":"+J.ENDSEG_POINT;if(e.util.GeomUtil.pointInRect(O,u,w.x,w.y,w.x+w.w,w.y+w.h)){if(e.isNull(y[z])){var C=new e.edit.GeometrySegmentPoint();
C.feature=v;C.segment=A;C.point=[O,u];C.pointLocation=J.STARTSEG_POINT;E.push(C);y[""+x+":"+s+":"+L+":"+J.STARTSEG_POINT]="*";
}}z=""+x+":"+(s+1)+":"+L+":"+J.STARTSEG_POINT;if(e.util.GeomUtil.pointInRect(N,t,w.x,w.y,w.x+w.w,w.y+w.h)){if(e.isNull(y[z])){var B=new e.edit.GeometrySegmentPoint();
B.feature=v;B.segment=A;B.point=[N,t];B.pointLocation=J.ENDSEG_POINT;E.push(B);y[""+x+":"+s+":"+L+":"+J.ENDSEG_POINT]="*";
}}}}if(E.length===0){return null;}else{return E;}};e.edit.GeometrySegmentUtil.getLayerSegmentPointsWithinBox=function(A,s){if(e.isNull(A)||e.isNull(s)){return null;
}var v=A.searchFeatures(s);if(e.isNull(v)||v.length===0){return null;}var u={};for(var y=0;y<v.length;
y++){var z=[];var t=A.segmentRtree[v[y].id];if(e.isNull(t)){t=e.edit.GeometrySegmentUtil.buildSegmentTree(v[y]);
if(e.isNull(t)){continue;}else{A.segmentRtree[v[y].id]=t;}}var w=e.edit.GeometrySegmentUtil.getFeatureSegmentPointsWithinBox(v[y],t,s);
if(e.isNull(w)){continue;}for(var x=0;x<w.length;x++){z.push(w[x]);}u[v[y].id]=z;}var B=false;var C;for(C in u){if(u.hasOwnProperty(C)){B=true;
break;}}if(!B){return null;}else{return u;}};e.edit.GeometrySegmentUtil.removeVertexFromGeometry=function(E,w){if(e.isNull(E)||e.isNull(w)){return false;
}var D=E.getType();if(D==="Point"||D==="MultiPoint"||D==="OrientedPoint"){return false;}var x=E.getOrdinates();
if(e.isNull(x)){return false;}var A=w.getGeometrySegment();var G=w.getPoint();var C=w.getPointLocation();
if(e.isNull(A)||e.isNull(G)){return false;}var u=e.edit.GeometrySegment;var z=e.edit.GeometrySegmentPoint;
if(A.getSegmentType()!==u.LINE_TYPE||C===z.MIDSEG_POINT){return false;}var F=A.getElementIndex();var s=A.getSegmentIndex();
var v=A.getSubElementIndex();var y=E.getDimension();var B=s*y+C*y;var t=0;switch(D){case"LineString":t=x.length/y;
if(t<3){return false;}x.splice(B,y);break;case"MultiLineString":t=x[F].length/y;if(t<3){return false;
}x[F].splice(B,y);break;case"Polygon":t=x[v].length/y;if(t<5){return false;}x[v].splice(B,y);break;case"MultiPolygon":t=x[F][v].length/y;
if(t<5){return false;}x[F][v].splice(B,y);break;default:return false;}E.mbr=null;E.getMBR();return true;
};e.edit.GeometrySegmentUtil.addVertexToGeometry=function(B,w){if(e.isNull(B)||e.isNull(w)){return false;
}var G=B.getType();if(G==="Point"||G==="MultiPoint"||G==="OrientedPoint"){return false;}var C=B.getOrdinates();
if(e.isNull(C)){return false;}var s=w.getGeometrySegment();var D=w.getPoint();var u=w.getPointLocation();
if(e.isNull(s)||e.isNull(D)){return false;}var z=e.edit.GeometrySegment;var I=e.edit.GeometrySegmentPoint;
if(s.getSegmentType()!==z.LINE_TYPE||u!==I.MIDSEG_POINT){return false;}var v=s.getElementIndex();var t=s.getSegmentIndex();
var A=s.getSubElementIndex();var J=B.getDimension();var y=t*J;var L=0;switch(G){case"LineString":for(var E=0;
E<J;E++){if(E<2){C.splice(y+E+J,0,D[E]);}else{C.splice(y+E+J,0,L);}}break;case"MultiLineString":for(var K=0;
K<J;K++){if(K<2){C[v].splice(y+K+J,0,D[K]);}else{C[v].splice(y+K+J,0,L);}}break;case"Polygon":for(var x=0;
x<J;x++){if(x<2){C[A].splice(y+x+J,0,D[x]);}else{C[A].splice(y+x+J,0,L);}}break;case"MultiPolygon":for(var F=0;
F<J;F++){if(F<2){C[v][A].splice(y+F+J,0,D[F]);}else{C[v][A].splice(y+F+J,0,L);}}break;default:return false;
}B.mbr=null;B.getMBR();return true;};e.edit.GeometrySegmentUtil.moveGeometryVertex=function(E,w,t){if(e.isNull(E)||e.isNull(w)||e.isNull(t)){return false;
}var D=E.getType();if(D==="Point"||D==="MultiPoint"||D==="OrientedPoint"){return false;}var x=E.getOrdinates();
if(e.isNull(x)){return false;}var A=w.getGeometrySegment();var G=w.getPoint();var C=w.getPointLocation();
if(e.isNull(A)||e.isNull(G)){return false;}var u=e.edit.GeometrySegment;var z=e.edit.GeometrySegmentPoint;
if(A.getSegmentType()!==u.LINE_TYPE||C===z.MIDSEG_POINT){return false;}var F=A.getElementIndex();var s=A.getSegmentIndex();
var v=A.getSubElementIndex();var y=E.getDimension();var B=s*y+C*y;switch(D){case"LineString":x[B]=t[0];
x[B+1]=t[1];break;case"MultiLineString":x[F][B]=t[0];x[F][B+1]=t[1];break;case"Polygon":x[v][B]=t[0];
x[v][B+1]=t[1];break;case"MultiPolygon":x[F][v][B]=t[0];x[F][v][B+1]=t[1];break;default:return false;
}E.mbr=null;E.getMBR();return true;};e.edit.GeometrySegmentUtil.removeVertexesFromGeometry=function(P,B){if(e.isNull(P)||e.isNull(B)){return false;
}var T=P.getType();if(T==="Point"||T==="MultiPoint"||T==="OrientedPoint"){return false;}var Q=P.getOrdinates();
if(e.isNull(Q)){return false;}var V=P.getDimension();var A=false;var aa={};for(var W=0;W<B.length;W++){var v=B[W].getGeometrySegment();
var R=B[W].getPoint();var x=B[W].getPointLocation();if(e.isNull(v)||e.isNull(R)){continue;}var M=e.edit.GeometrySegment;
var U=e.edit.GeometrySegmentPoint;if(v.getSegmentType()!==M.LINE_TYPE||x===U.MIDSEG_POINT){continue;}var D=v.getElementIndex();
var w=v.getSegmentIndex();var N=v.getSubElementIndex();var L=w*V+x*V;var y=0;var z=0;switch(T){case"LineString":y=Q.length/V;
if((y-B.length)<2){break;}while(z!=V){Q[L+z]=Number.NaN;z++;}A=true;break;case"MultiLineString":while(z!=V){Q[D][L+z]=Number.NaN;
z++;aa[""+D]=true;}A=true;break;case"Polygon":while(z!=V){Q[N][L+z]=Number.NaN;z++;aa[""+N]=true;}A=true;
break;case"MultiPolygon":while(z!=V){Q[D][N][L+z]=Number.NaN;z++;aa[""+D+":"+N]=true;}A=true;break;default:return false;
}}if(!A){return false;}switch(T){case"LineString":var E=[];for(var I=0;I<Q.length;I++){if(!(isNaN(Q[I]))){E.push(Q[I]);
}}P.coordinates=E;break;case"MultiLineString":for(var O=0;O<Q.length;O++){if(e.isNull(aa[""+O])){continue;
}var C=[];for(var Y=0;Y<Q[O].length;Y++){if(!(isNaN(Q[O][Y]))){C.push(Q[O][Y]);}}Q[O]=C;}for(var ab=0;
ab<Q.length;ab++){if(Q[ab].length<2){Q.splice(ab,1);ab--;}}break;case"Polygon":for(var K=0;K<Q.length;
K++){if(e.isNull(aa[""+K])){continue;}var F=[];for(var X=0;X<Q[K].length;X++){if(!(isNaN(Q[K][X]))){F.push(Q[K][X]);
}}Q[K]=F;}for(var J=0;J<Q.length;J++){if(Q[J].length<4){if(J===0){return false;}Q.splice(J,1);J--;}}break;
case"MultiPolygon":for(var S=0;S<Q.length;S++){for(var t=0;t<Q[S].length;t++){if(e.isNull(aa[""+S+":"+t])){continue;
}var Z=[];for(var u=0;u<Q[S][t].length;u++){if(!(isNaN(Q[S][t][u]))){Z.push(Q[S][t][u]);}}Q[S][t]=Z;}}for(var s=0;
s<Q.length;s++){for(var G=0;G<Q[s].length;G++){if(Q[s][G].length<4){if(G===0){Q.splice(s,1);s--;break;
}else{Q[s].splice(G,1);G--;}}}}break;default:break;}P.mbr=null;P.getMBR();return true;};e.edit.GeometrySegmentUtil.breakLineGeometry=function(F,A){if(e.isNull(F)||e.isNull(A)){return false;
}var K=F.getType();if(K!=="LineString"&&K!=="MultiLineString"){return false;}var G=F.getOrdinates();if(e.isNull(G)){return false;
}var t=A.getGeometrySegment();var J=A.getPoint();var v=A.getPointLocation();if(e.isNull(t)||e.isNull(J)){return false;
}var E=e.edit.GeometrySegment;var L=e.edit.GeometrySegmentPoint;if(t.getSegmentType()!==E.LINE_TYPE){return false;
}var x=t.getElementIndex();var u=t.getSegmentIndex();var M=F.getDimension();var D=-1;if(v!==L.MIDSEG_POINT){D=u*M+v*M;
if(K==="LineString"){if(D===0||D===(G.length-M)){return false;}}else{if(D===0||D===(G[x].length-M)){return false;
}}}else{D=u*M+M;}var s=[];var z=[];var w=[];var I=null;if(K==="LineString"){I=G;}else{I=G[x];for(var P=0;
P<G.length;P++){if(P!==x){s.push(G[P]);}}}for(var N=0;N<D;N++){z.push(I[N]);}if(v!==L.MIDSEG_POINT){for(var B=0;
B<M;B++){z.push(I[D+B]);}for(var C=D;C<I.length;C++){w.push(I[C]);}}else{for(var O=0;O<M;O++){if(O<2){z.push(J[O]);
w.push(J[O]);}else{z.push(0);w.push(0);}}for(var y=D;y<I.length;y++){w.push(I[y]);}}s.push(z);s.push(w);
F.type="MultiLineString";F.coordinates=s;return true;};e.edit.GeometrySegmentUtil.splitPolygonGeometry=function(D,G,U){if(e.isNull(D)||e.isNull(G)||e.isNull(U)){return false;
}var ae=D.getType();if(ae!=="Polygon"&&ae!=="MultiPolygon"){return false;}var aa=G.length;if(aa===0||(aa%2)!==0){return false;
}if(G[0].getGeometrySegment().getElementIndex()!==G[aa-1].getGeometrySegment().getElementIndex()){return false;
}var ag;if(G.length>2){for(ag=1;ag<aa-1;ag+=2){if(G[ag].getSubElementIndex()!=G[ag+1].getSegment().getSubElementIndex()){return false;
}}}for(ag=0;ag<U.length;ag++){var Q=2;var E=U[ag];if(e.isNull(E)||((E.length/Q)<2)){return false;}}var s=D.getDimension();
var L=G[0].getGeometrySegment().getElementIndex();if(L===-1){return false;}var v=null;if(ae==="Polygon"){v=D.getOrdinates();
}else{v=D.getOrdinates()[L];}var K=G[0].getPointLocation();var Y=G[aa-1].getPointLocation();var ah=G[0].getGeometrySegment().getSegmentIndex();
var W=G[aa-1].getGeometrySegment().getSegmentIndex();var S=v[0].length-1;if(G[0].getPoint()[0]===G[aa-1].getPoint()[0]&&G[0].getPoint()[1]===G[aa-1].getPoint()[1]){return false;
}if(G.length>2){for(ag=1;ag<aa-2;ag+=2){if(G[ag].getPoint()[0]===G[ag+1].getPoint()[0]&&G[ag].getPoint()[1]==G[ag+1].getPoint()[1]){return false;
}}}var X=[];var J=e.edit.GeometrySegmentPoint;if(G.length===2){X.push(U[0]);X.push(U[0]);}else{return false;
}var F=false;var u=NaN;var t=NaN;var O,M,ac,ab,R,A,P,z;if(ah===W){F=true;O=G[0].getPoint();M=G[aa-1].getPoint();
ac=v[ah*s];ab=v[ah*s+1];R=O[0]-ac;A=O[1]-ab;u=Math.sqrt((R*R)+(A*A));P=M.getX()-ac;z=M.getY()-ab;t=Math.sqrt((P*P)+(z*z));
}var ad=[];var T=[];var N=-1;var I=-1;var C;var w=2;var af;if((ah<W)||(F&&u<t)){if(K===J.STARTSEG_POINT){N=ah*s;
}else{if(K===J.ENDSEG_POINT){N=(ah+1)*s;}else{N=(ah+1)*s;ad.push(G[0].getPoint()[0]);ad.push(G[0].getPoint()[1]);
}}if(Y===J.STARTSEG_POINT||Y===J.MIDSEG_POINT){I=W*s+s;}else{if(Y===J.ENDSEG_POINT){I=(W+1)*s+s;}}if(F&&K===J.MIDSEG_POINT&&Y===J.MIDSEG_POINT){I=N;
}for(ag=N;ag<I;ag+=s){ad.push(v[0][ag]);ad.push(v[0][ag+1]);}if(Y===J.MIDSEG_POINT){ad.push(G[aa-1].getPoint()[0]);
ad.push(G[aa-1].getPoint()[1]);}C=X[0];w=2;for(af=C.length-s;af>0;af-=w){ad.push(C[af-w]);ad.push(C[af-w+1]);
}if(Y===J.STARTSEG_POINT){N=W*s;}else{if(Y===J.ENDSEG_POINT){N=(W+1)*s;}else{N=(W+1)*s;T.push(G[aa-1].getPoint()[0]);
T.push(G[aa-1].getPoint()[1]);}}I=S+1;for(ag=N;ag<I;ag+=s){T.push(v[0][ag]);T.push(v[0][ag+1]);}N=s;if(K===J.STARTSEG_POINT||K===J.MIDSEG_POINT){I=ah*s+s;
}else{if(K===J.ENDSEG_POINT){I=(ah+1)*s+s;}}for(ag=N;ag<I;ag+=s){T.push(v[0][ag]);T.push(v[0][ag+1]);
}if(K===J.MIDSEG_POINT){T.push(G[0].getPoint()[0]);T.push(G[0].getPoint()[1]);}C=X[1];w=2;for(var V=s;
V<C.length;V+=w){T.push(C[V]);T.push(C[V+1]);}}else{if((ah>W)||(F&&u>t)){if(Y===J.STARTSEG_POINT){N=W*s;
}else{if(Y===J.ENDSEG_POINT){N=(W+1)*s;}else{N=(W+1)*s;ad.push(G[aa-1].getPoint()[0]);ad.push(G[aa-1].getPoint()[1]);
}}if(K===J.STARTSEG_POINT||K===J.MIDSEG_POINT){I=ah*s+s;}else{if(K===J.ENDSEG_POINT){I=(ah+1)*s+s;}}for(ag=N;
ag<I;ag+=s){ad.push(v[0][ag]);ad.push(v[0][ag+1]);}if(K===J.MIDSEG_POINT){ad.push(G[0].getPoint()[0]);
ad.push(G[0].getPoint()[1]);}C=X[0];w=2;for(af=s;af<C.length;af+=w){ad.push(C[af]);ad.push(C[af+1]);}if(K===J.STARTSEG_POINT){N=ah*s;
}else{if(K===J.ENDSEG_POINT){N=(ah+1)*s;}else{N=(ah+1)*s;T.push(G[0].getPoint()[0]);T.push(G[0].getPoint()[1]);
}}I=S+1;for(ag=N;ag<I;ag+=s){T.push(v[0][ag]);T.push(v[0][ag+1]);}N=s;if(Y===J.STARTSEG_POINT||Y===J.MIDSEG_POINT){I=W*s+s;
}else{if(Y===J.ENDSEG_POINT){I=(W+1)*s+s;}}for(ag=N;ag<I;ag+=s){T.push(v[0][ag]);T.push(v[0][ag+1]);}if(Y===J.MIDSEG_POINT){T.push(G[aa-1].getPoint()[0]);
T.push(G[aa-1].getPoint()[1]);}C=X[1];w=2;for(af=C.length-s;af>0;af-=w){T.push(C[af-w]);T.push(C[af-w+1]);
}}else{return false;}}var B=[];var Z=-1;if(ae==="Polygon"){Z=1;B[0]=[];B[1]=[];}else{Z=D.getOrdinates().length;
B=D.getOrdinates();}B[L]=[ad];B[Z]=[T];D.coordinates=B;D.type="MultiPolygon";D.mbr=null;D.getMBR();return true;
};e.tool.BreakLineTool=e.tool.RedlineTool.extend({initialize:function b(u,s){b.base.call(this,u,e.tool.RedlineTool.TYPE_POINT);
var t=this;this.lineFeature=s;this.lineElement=-1;this.firstLine=null;this.secondLine=null;this.snapFeature=null;
this.snapSegment=null;if(e.isNull(this.lineFeature)){e.util.Logger.alert("MAPVIEWER_9054","OM.tool.BreakLineTool.initialize","");
this.clear();return;}if(e.notNull(this.lineFeature)&&e.notNull(this.lineFeature.getGeometry())&&(this.lineFeature.getGeometry().getType()==="LineString"||this.lineFeature.getGeometry().getType()==="MultiLineString")){this.lineFeature.editable=false;
}else{e.util.Logger.alert("MAPVIEWER_9055","OM.tool.BreakLineTool.initialize","");this.lineFeature=null;
this.clear();}e.gv.featureDrag=false;e.gv.allowFeaturePointsInteraction=false;this.addListener(e.event.ToolEvent.TOOL_END,this.processPoint);
this.snapLayer=new e.layer.VectorLayer("snap_layer_"+Math.random(),{def:{type:e.layer.VectorLayer.TYPE_LOCAL}});
this.snapLayerStyle=new e.style.Marker({width:12,height:12,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#ff0000",strokeThickness:1}}]});
this.snapLayer.setRenderingStyle(this.snapLayerStyle);u.addLayer(this.snapLayer);this.addListener(e.event.ToolEvent.SNAP_POINT,function(){if(e.isNull(t.lineFeature)){return;
}if(e.notNull(t.snapFeature)){t.snapLayer.removeFeature(t.snapFeature);t.snapLayer.redraw();t.snapFeature=null;
}t.snapPoint=null;var K=t._map.getScreenPointLocation(t._map.mLocX,t._map.mLocY);if(e.notNull(K)){var A=t._map.getScreenPointLocation(t._map.mLocX-3,t._map.mLocY-3);
var F=K.coordinates[0]-A.coordinates[0];var D=A.coordinates[1]-K.coordinates[1];var y=Math.sqrt((F*F)+(D*D));
var O=[K.coordinates[0],K.coordinates[1]];var P=null;if(e.notNull(t.lineFeature.parentLayer)){P=t.lineFeature.parentLayer.segmentRtree[t.lineFeature.id];
if(e.isNull(P)){P=e.edit.GeometrySegmentUtil.buildSegmentTree(t.lineFeature);if(e.notNull(P)){t.lineFeature.parentLayer.segmentRtree[t.lineFeature.id]=P;
}}}var B=e.edit.GeometrySegmentUtil.getFeatureSegmentPoint(t.lineFeature,P,O,y,false,false,false,false);
t.snapSegment=null;if(e.notNull(B)){var v=B.getGeometrySegment();var x=B.getPointLocation();var M=e.edit.GeometrySegmentPoint;
var C=v.getElementIndex();var w=v.getSegmentIndex();var N=t.lineFeature.getGeometry().getDimension();
var L=t.lineFeature.getGeometry().getType();var J=t.lineFeature.getGeometry().getOrdinates();var G=-1;
if(x!==M.MIDSEG_POINT){G=w*N+x*N;if(L==="LineString"){if(G===0||G===(J.length-N)){return;}}else{if(G===0||G===(J[C].length-N)){return;
}}}t.snapSegment=B;var E=B.getPoint();var z=new e.geometry.Point(E[0],E[1],K.getSRID());var I=t._map.getScreenLocation(z);
t.snapPoint=[];t.snapPoint.push(I.x);t.snapPoint.push(I.y);t.snapFeature=new e.Feature("SnapPoint",z,{renderingStyle:t.snapLayerStyle});
t.snapLayer.addFeature(t.snapFeature);t.snapLayer.redraw();}}});},clear:function(){e.gv.featureDrag=true;
e.gv.allowFeaturePointsInteraction=true;if(e.notNull(this.snapFeature)){this.snapLayer.removeFeature(this.snapFeature);
this.snapLayer.redraw();this.snapFeature=null;}this.finish();this.clear_base();},processPoint:function(){this.lineElement=-1;
this.firstLine=null;this.secondLine=null;if(e.isNull(this.lineFeature)){this.start();return;}if(e.notNull(this._geometry)&&e.notNull(this.snapSegment)){var s=this.lineFeature.getGeometry().clone(true);
if(e.edit.GeometrySegmentUtil.breakLineGeometry(s,this.snapSegment)){this.lineElement=this.snapSegment.getElementIndex;
var v=s.getOrdinates().length;this.firstLine=s.getOrdinates()[v-2];this.secondLine=s.getOrdinates()[v-1];
if(e.notNull(this.lineFeature.parentLayer.changeManager)){var u=e.edit.EditChangeEvent;var t=this.lineFeature.parentLayer.changeManager.updateFeature(this.lineFeature.id,this.lineFeature,s,u.SPATIAL_UPDATE);
if(e.notNull(t)){this.lineFeature.parentLayer.getUndoManager().addEdit({feature:this.lineFeature,changeManager:this.lineFeature.parentLayer.changeManager,editChangeEvent:t,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"break line";},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}}this.lineFeature.editable=true;
this.lineFeature.deleteEditingProperties();this.lineFeature.addEditProperties();this.lineFeature.setGeometry(s);
}}var w=this._map.getToolFeatureLayer();w.removeFeature(this._points[0]);this.start();}});e.tool.RemoveVertexesTool=e.tool.RectangleTool.extend({initialize:function b(t,s){b.base.call(this,t);
this.selectedFeature=s;this.addListener(e.event.ToolEvent.TOOL_END,this.processRectangle);this.registerUpdate=function(u,v){if(e.isNull(u)||e.isNull(v)||e.isNull(this.selectedFeature)){return;
}if(v===this.selectedFeature){this.selectedFeature.parentLayer.getUndoManager().addEdit({feature:this.selectedFeature,changeManager:this.selectedFeature.parentLayer.changeManager,editChangeEvent:u,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"feature vertexes remove";},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}else{this.selectedFeature.parentLayer.getUndoManager().addEdit({feature:v,changeManager:this.selectedFeature.parentLayer.changeManager,editChangeEvent:u,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"feature vertexes remove";},undo:function(){this.changeManager.undo(this.editChangeEvent);
},redo:function(){this.changeManager.redo(this.editChangeEvent);}});}};},processRectangle:function(){if(e.notNull(this._geometry)){var v=[];
var w={};var s={x:this._geometry.getMinX(),y:this._geometry.getMinY(),w:this._geometry.getWidth(),h:this._geometry.getHeight()};
var u=e.edit.GeometrySegmentUtil.getLayerSegmentPointsWithinBox(this.selectedFeature.parentLayer,s);if(e.notNull(u)&&e.notNull(u[this.selectedFeature.id])){var E;
for(E in u){if(u.hasOwnProperty(E)){var A=u[E];if(e.notNull(A)&&A.length>0){if(E===this.selectedFeature.id||this.selectedFeature.parentLayer.hasSharedBoundary()){var y=A[0].getFeature().getGeometry().clone(true);
if(e.edit.GeometrySegmentUtil.removeVertexesFromGeometry(y,A)){v.push(A[0].getFeature());w[E]=y;}}}}}}if(e.notNull(this.selectedFeature.parentLayer.changeManager)){var z=e.edit.EditChangeEvent;
if(v.length>1){this.selectedFeature.parentLayer.getUndoManager().startChangeBlock("feature vertexes remove");
}for(var x=0;x<v.length;x++){var D=v[x];if(e.isNull(w[D.id])){continue;}var C=this.selectedFeature.parentLayer.changeManager.updateFeature(D.id,D,w[D.id],z.SPATIAL_UPDATE);
if(e.notNull(C)){this.registerUpdate(C,D);}}if(v.length>1){this.selectedFeature.parentLayer.getUndoManager().endChangeBlock("feature vertexes remove");
}}for(var t=0;t<v.length;t++){var B=v[t];B.setGeometry(w[B.id]);}this.selectedFeature.deleteEditingProperties();
this.selectedFeature.addEditProperties();}this._geometry=null;}});e.tool.SplitPolygonTool=e.tool.RedlineTool.extend({initialize:function b(u,s){b.base.call(this,u,e.tool.RedlineTool.TYPE_POINT);
var t=this;this.splitLineStyle=new e.style.Line({stroke:"#FF0000",strokeThickness:5,strokeOpacity:0.5});
this.splitLineStyle.fill=u.graphics.oui.NO_PAINT;this.snapFeature=null;this.snapSegmentPoint=null;this.splitPoints=[];
this.splitLines=[];this.currentSplitLine=[];this.shapeGroup=[];this.ghostShape=null;this.lastSubElem=-1;
this.isInAction=false;this.hasSplitLines=false;this.islastActionMoveTo=false;this.hasSplitLines=false;
this.lastPointWC=[];this.lastScreenPoint=[];if(e.isNull(s)){e.util.Logger.alert("MAPVIEWER_9054","OM.tool.SplitPolygonTool.initialize","");
this.clear();return;}this.polygonFeature=s;if(e.notNull(this.polygonFeature)&&(this.polygonFeature.getGeometry().getType()==="Polygon"||this.polygonFeature.getGeometry().getType()==="MultiPolygon")){this.polygonFeature.editable=false;
}else{e.util.Logger.alert("MAPVIEWER_9038","OM.tool.SplitPolygonTool.initialize","");this.polygonFeature=null;
this.clear();}e.gv.featureDrag=false;e.gv.allowFeaturePointsInteraction=false;this.addListener(e.event.ToolEvent.REDLINE_POINT_CREATE,this.processPoint);
this.snapLayer=new e.layer.VectorLayer("snap_layer_"+Math.random(),{def:{type:e.layer.VectorLayer.TYPE_LOCAL}});
this.snapLayerStyle=new e.style.Marker({width:12,height:12,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#ff0000",strokeThickness:1}}]});
this.snapLayer.setRenderingStyle(this.snapLayerStyle);u.addLayer(this.snapLayer);this.addListener(e.event.ToolEvent.SNAP_POINT,function(){if(e.isNull(t.polygonFeature)){return;
}if(e.notNull(t.snapFeature)){t.snapLayer.removeFeature(t.snapFeature);t.snapLayer.redraw();t.snapFeature=null;
}t.snapPoint=null;var I=t._map.getScreenPointLocation(t._map.mLocX,t._map.mLocY);if(e.notNull(I)){var D=t._map.getScreenPointLocation(t._map.mLocX-3,t._map.mLocY-3);
var K=I.coordinates[0]-D.coordinates[0];var J=D.coordinates[1]-I.coordinates[1];var z=Math.sqrt((K*K)+(J*J));
var y=[I.coordinates[0],I.coordinates[1]];var x=null;if(e.notNull(t.polygonFeature.parentLayer)){x=t.polygonFeature.parentLayer.segmentRtree[t.polygonFeature.id];
if(e.isNull(x)){x=e.edit.GeometrySegmentUtil.buildSegmentTree(t.polygonFeature);if(e.notNull(x)){t.polygonFeature.parentLayer.segmentRtree[t.polygonFeature.id]=x;
}}}var G=e.edit.GeometrySegmentUtil.getFeatureSegmentPoint(t.polygonFeature,x,y,z,false,false,false,false);
t.snapSegmentPoint=null;if(e.notNull(G)){var F=G.getGeometrySegment();var C=F.getSubElementIndex();var w=F.getSegmentIndex();
if(t.splitPoints.length===0){if(C!==0){return;}}else{if(t.splitPoints.length===1&&this.currentSplitLine.length===1&&this.splitLines.length===0&&t.splitPoints[0].getGeometrySegment().getSegmentIndex()===w){return;
}else{if(t.splitPoints.length>1){var B=t.splitPoints[t.splitPoints.length-1].getGeometrySegment().getSubElementIndex();
if((t.splitPoints.length%2)===0){if(B!==C){return;}}else{if(B===C){return;}}}}}t.snapSegmentPoint=G;var E=G.getPoint();
var A=new e.geometry.Point(E[0],E[1],I.getSRID());var v=t._map.getScreenLocation(A);t.snapPoint=[];t.snapPoint.push(v.x);
t.snapPoint.push(v.y);t.snapFeature=new e.Feature("SnapPoint",A,{renderingStyle:t.snapLayerStyle});t.snapLayer.addFeature(t.snapFeature);
t.snapLayer.redraw();}}if(e.notNull(t.ghostShape)){if(e.notNull(t.snapPoint)){t._graphic.setPath(t.ghostShape,[[t.lastScreenPoint[0],t.lastScreenPoint[1],t.snapPoint[0],t.snapPoint[1]]]);
}else{t._graphic.setPath(t.ghostShape,[[t.lastScreenPoint[0],t.lastScreenPoint[1],t._map.mLocX,t._map.mLocY]]);
}}});},reset:function(){if(e.notNull(this.snapFeature)){this.snapLayer.removeFeature(this.snapFeature);
this.snapLayer.redraw();this.snapFeature=null;}this.snapFeature=null;this.snapSegmentPoint=null;this.splitPoints=[];
this.splitLines=[];this.currentSplitLine=[];this.lastSubElem=-1;this.isInAction=false;this.hasSplitLines=false;
this.islastActionMoveTo=false;this.hasSplitLines=false;this.lastPointWC=[];this.lastScreenPoint=[];if(this.shapeGroup.length>0){for(var s=this.shapeGroup.length-1;
s>-1;s--){this._graphic.remove(this.shapeGroup[s]);}}this.shapeGroup=[];if(e.notNull(this.ghostShape)){this._graphic.remove(this.ghostShape);
}this.ghostShape=null;},clear:function(){e.gv.featureDrag=true;e.gv.allowFeaturePointsInteraction=true;
this.polygonFeature.editable=true;this.reset();this.finish();this.clear_base();},processPoint:function(){this.hasSplitLines=false;
if(this.splitPoints.length===0&&e.isNull(this.snapSegmentPoint)){return;}var v,u;var t,x;var C=this._geometry;
v=C.getX();u=C.getY();if(this.splitPoints.length===0){v=this.snapSegmentPoint.getPoint()[0];u=this.snapSegmentPoint.getPoint()[1];
this.isInAction=true;this.islastActionMoveTo=true;this.currentSplitLine=[];this.currentSplitLine.push(v);
this.currentSplitLine.push(u);this.splitPoints.push(this.snapSegmentPoint);this.lastPointWC=[v,u];x=new e.geometry.Point(v,u,C.getSRID());
t=this._map.getScreenLocation(x);this.lastScreenPoint=[t.x,t.y];this.ghostShape=this._graphic.drawPath([[t.x,t.y,t.x,t.y]],this.splitLineStyle,{group:this._group});
this.ghostShape.setStrokeDashArray([6]);}else{var E=true;if(this.splitPoints.length>1&&e.notNull(this.snapSegmentPoint)){if((this.splitPoints.length%2)===0){var w=this.splitPoints[this.splitPoints.length-1].getGeometrySegment().getSubElementIndex();
if(w==this.snapSegmentPoint.getGeometrySegment().getSubElementIndex()){E=false;}}}if(e.notNull(this.snapSegmentPoint)){v=this.snapSegmentPoint.getPoint()[0];
u=this.snapSegmentPoint.getPoint()[1];}x=new e.geometry.Point(v,u,C.getSRID());t=this._map.getScreenLocation(x);
this.lastScreenPoint=[t.x,t.y];if(E){this.islastActionMoveTo=false;this.currentSplitLine.push(v);this.currentSplitLine.push(u);
var s=[];for(var y=0;y<this.currentSplitLine.length;y+=2){x=new e.geometry.Point(this.currentSplitLine[y],this.currentSplitLine[y+1],C.getSRID());
t=this._map.getScreenLocation(x);s.push(t.x);s.push(t.y);if(e.isNull(this.shapeGroup[this.splitLines.length])){this.shapeGroup[this.splitLines.length]=this._graphic.drawPath([s],this.splitLineStyle,{group:this._group});
this.shapeGroup[this.splitLines.length].setStrokeDashArray([6]);}else{this._graphic.setPath(this.shapeGroup[this.splitLines.length],[s]);
}}}else{this.islastActionMoveTo=true;this.splitLines.push(this.currentSplitLine);this.currentSplitLine=[];
this.currentSplitLine.push(v);this.currentSplitLine.push(u);}if(e.notNull(this.snapSegmentPoint)){this.splitPoints.push(this.snapSegmentPoint);
if(this.splitPoints.length>1&&this.snapSegmentPoint.getGeometrySegment().getSubElementIndex()==this.splitPoints[0].getGeometrySegment().getSubElementIndex()){this.hasSplitLines=true;
this.splitLines.push(this.currentSplitLine);}}this.lastPointWC=[v,u];if(this.hasSplitLines){var A=this.polygonFeature.getGeometry().clone(true);
if(e.edit.GeometrySegmentUtil.splitPolygonGeometry(A,this.splitPoints,this.splitLines)){if(e.notNull(this.polygonFeature.parentLayer.changeManager)){var z=e.edit.EditChangeEvent;
var B=this.polygonFeature.parentLayer.changeManager.updateFeature(this.polygonFeature.id,this.polygonFeature,A,z.SPATIAL_UPDATE);
if(e.notNull(B)){this.polygonFeature.parentLayer.getUndoManager().addEdit({feature:this.polygonFeature,changeManager:this.polygonFeature.parentLayer.changeManager,editChangeEvent:B,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"split polygon";},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}}this.polygonFeature.deleteEditingProperties();
this.polygonFeature.addEditProperties();this.polygonFeature.setGeometry(A);}this.reset();}}var D=this._map.getToolFeatureLayer();
D.removeFeature(this._points[0]);}});e.tool.VoidPolygonTool=e.tool.RedlineTool.extend({initialize:function b(t,s){b.base.call(this,t,e.tool.RedlineTool.TYPE_POLYGON);
if(e.isNull(s)){e.util.Logger.alert("MAPVIEWER_9054","OM.tool.VoidPolygonTool.initialize","");this.clear();
return;}this.polygonFeature=s;this.polygonElement=-1;if(e.notNull(this.polygonFeature)&&(this.polygonFeature.getGeometry().getType()==="Polygon"||this.polygonFeature.getGeometry().getType()==="MultiPolygon")){this.polygonFeature.editable=false;
}else{e.util.Logger.alert("MAPVIEWER_9038","OM.tool.VoidPolygonTool.initialize","");this.polygonFeature=null;
this.clear();}},end:function(){this.polygonElement=-1;if(e.isNull(this._geometry)||e.isNull(this.polygonFeature)){return;
}var L=this._geometry;var E=L.getOrdinates()[0];var B=E[0];var I=E[1];var F=this.polygonFeature.getGeometry().getDimension();
if(this.polygonFeature.getGeometry().getType()==="Polygon"){this.polygonElement=0;}else{var A=this.polygonFeature.getGeometry();
var v=A.getOrdinates().length;for(var J=0;J<v;J++){var z=new e.geometry.Polygon(A.getOrdinates()[J][0],this.polygonFeature.getGeometry().getSRID(),F);
if(e.util.GeomUtil.poinInPolygonGeometry(z,B,I)){this.polygonElement=J;break;}}}if(this.polygonElement===-1){return;
}var K=e.util.GeomUtil.isClockwise(E);var u=this.polygonFeature.getGeometry().clone(true);var w=null;
if(this.polygonFeature.getGeometry().getType()==="Polygon"){w=u.getOrdinates();}else{w=u.getOrdinates()[this.polygonElement];
}var x=e.util.GeomUtil.isClockwise(w[0],F);var t=false;if(x&&K||!x&&!K){t=true;E=e.util.GeomUtil.reverseCoordinates(E);
}var C=[];if(F>2){for(var G=0;G<E.length;G+=2){C.push(E[G]);C.push(E[G+1]);for(var D=2;D<F;D++){C.push(0);
}}E=C;}w[w.length]=E;if(e.notNull(this.polygonFeature.parentLayer.changeManager)){var s=e.edit.EditChangeEvent;
var y=this.polygonFeature.parentLayer.changeManager.updateFeature(this.polygonFeature.id,this.polygonFeature,u,s.SPATIAL_UPDATE);
if(e.notNull(y)){this.polygonFeature.parentLayer.getUndoManager().addEdit({feature:this.polygonFeature,changeManager:this.polygonFeature.parentLayer.changeManager,editChangeEvent:y,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"add void polygon";},undo:function(){this.changeManager.undo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties();}});}}this.polygonFeature.editable=true;
this.polygonFeature.deleteEditingProperties();this.polygonFeature.addEditProperties();this.polygonFeature.setGeometry(u);
}});e.tool.WhiteBoardTool=e.tool.Tool.extend({initialize:function b(t){b.base.call(this,t);var F=t.mapInstanceId;
if(!t.$dialog){var G=e.tool.WhiteBoardTool;var B;if(e.browser.touchSupported||e.gv.isWin8Touch){B="<tr><td>"+e.gv.getLabel("MAPVIEWER_WB_TEXT")+"</td><td><input type='text' size='25' id='_wb_text"+F+"'></td><td>"+G.genSizes()+"</td></tr>";
t.$dialog=e.$('<div id="_wb_dialog'+t.mapInstanceId+'" title="'+e.gv.getLabel("MAPVIEWER_WB_TTILE")+'" style="overflow:visible"><table width=100%>'+B+"</table></div>");
}else{B="<tr><td><table><tr><td>"+e.gv.getLabel("MAPVIEWER_WB_TEXT")+"</td><td><input type='text' style='width:400px'  id='_wb_text"+F+"'></td></tr></table></td></tr>";
var y="<tr><td><table><tr><td>"+e.gv.getLabel("MAPVIEWER_WB_X",true)+"</td><td><input type='text' style='width:100px' value='1' id='_wb_orienx"+F+"'></td><td>&nbsp;&nbsp;"+e.gv.getLabel("MAPVIEWER_WB_Y",true)+"</td><td><input type='text' style='width:100px' value='0' id='_wb_orieny"+F+"'></td></tr></table></td></tr>";
t.weightBut=new e.tool.ImageButton("_wb_weight"+F,{toolTip:e.gv.getLabel("MAPVIEWER_WB_BOLD"),buttonEnableIcon:e.tool.WhiteBoardTool.img_bold_ena,buttonOverIcon:e.tool.WhiteBoardTool.img_bold_ovr,buttonDownIcon:e.tool.WhiteBoardTool.img_bold_dwn});
t.styleBut=new e.tool.ImageButton("_wb_style"+F,{toolTip:e.gv.getLabel("MAPVIEWER_WB_ITALIC"),buttonEnableIcon:e.tool.WhiteBoardTool.img_italic_ena,buttonOverIcon:e.tool.WhiteBoardTool.img_italic_ovr,buttonDownIcon:e.tool.WhiteBoardTool.img_italic_dwn});
t.hAlignGroup=new e.tool.ButtonGroup();var v=new e.tool.ImageButton("_wb_halign_left"+F,{toolTip:e.gv.getLabel("MAPVIEWER_WB_ALIGN_LEFT"),buttonEnableIcon:e.tool.WhiteBoardTool.img_leftalign_ena,buttonOverIcon:e.tool.WhiteBoardTool.img_leftalign_ovr,buttonDownIcon:e.tool.WhiteBoardTool.img_leftalign_dwn});
var J=new e.tool.ImageButton("_wb_halign_center"+F,{toolTip:e.gv.getLabel("MAPVIEWER_WB_ALIGN_CENTER"),buttonEnableIcon:e.tool.WhiteBoardTool.img_centeralign_ena,buttonOverIcon:e.tool.WhiteBoardTool.img_centeralign_ovr,buttonDownIcon:e.tool.WhiteBoardTool.img_centeralign_dwn,status:e.tool.ImageButton.STATUS_DOWN});
var A=new e.tool.ImageButton("_wb_halign_right"+F,{toolTip:e.gv.getLabel("MAPVIEWER_WB_ALIGN_RIGHT"),buttonEnableIcon:e.tool.WhiteBoardTool.img_rightalign_ena,buttonOverIcon:e.tool.WhiteBoardTool.img_rightalign_ovr,buttonDownIcon:e.tool.WhiteBoardTool.img_rightalign_dwn});
t.hAlignGroup.addButton(v);t.hAlignGroup.addButton(J);t.hAlignGroup.addButton(A);t.vAlignGroup=new e.tool.ButtonGroup();
var E=new e.tool.ImageButton("_wb_valign_bottom"+F,{toolTip:e.gv.getLabel("MAPVIEWER_WB_VALIGN_BOTTOM"),buttonEnableIcon:e.tool.WhiteBoardTool.img_bottomalign_ena,buttonOverIcon:e.tool.WhiteBoardTool.img_bottomalign_ovr,buttonDownIcon:e.tool.WhiteBoardTool.img_bottomalign_dwn});
var z=new e.tool.ImageButton("_wb_valign_center"+F,{toolTip:e.gv.getLabel("MAPVIEWER_WB_VALIGN_CENTER"),buttonEnableIcon:e.tool.WhiteBoardTool.img_centervalign_ena,buttonOverIcon:e.tool.WhiteBoardTool.img_centervalign_ovr,buttonDownIcon:e.tool.WhiteBoardTool.img_centervalign_dwn,status:e.tool.ImageButton.STATUS_DOWN});
var w=new e.tool.ImageButton("_wb_valign_top"+F,{toolTip:e.gv.getLabel("MAPVIEWER_WB_VALIGN_TOP"),buttonEnableIcon:e.tool.WhiteBoardTool.img_topalign_ena,buttonOverIcon:e.tool.WhiteBoardTool.img_topalign_ovr,buttonDownIcon:e.tool.WhiteBoardTool.img_topalign_dwn});
t.vAlignGroup.addButton(w);t.vAlignGroup.addButton(z);t.vAlignGroup.addButton(E);var x="<tr><td><table><tr><td>"+G.genColor(F)+"</td><td>";
x+=t.weightBut.createHTML()+"</td><td>"+t.styleBut.createHTML();x+="</td><td>"+t.hAlignGroup.createHTML()+"</td><td>"+t.vAlignGroup.createHTML()+"</td><td>";
x+=G.genFontFamily(F)+"</td><td>"+G.genSizes()+"</td></tr></table></td></tr>";t.$dialog=e.$('<div id="_wb_dialog'+t.mapInstanceId+'" title="'+e.gv.getLabel("MAPVIEWER_WB_TTILE")+'" style="overflow:visible"><table width=100% cellSpacing=0 borderSpacing=0 style=\'font-size:13px\'>'+B+y+x+"</table></div>");
}}var u=null;var I=null;var s=null;var D=null;var C=this;this.allTextFeatures=[];this.downEventAction=function(L){if(L.which===3){C.finish();
}else{if(L.type==="touchstart"){var K=e.util.DomUtil;if(K.getTouchCount(L)===1){var M=K.getTouchesPosition(L);
u=M.x;s=M.y;}else{return;}}else{u=L.pageX;s=L.pageY;}}};this.newShapePoint=function(Q){var W=C._map.getToolFeatureLayer();
if(W.focusFeature){return;}if(C.status===e.tool.Tool.STOPPED){return;}if(C._map.currentTool!==C){return;
}var T=null;var S=null;if(Q.type==="touchend"){var O=e.util.DomUtil;if(O.getTouchCount(Q)===1){var N=O.getChangedTouchesPosition(Q);
T=N[0].x;S=N[0].y;}else{return;}}else{T=Q.pageX;S=Q.pageY;}if(Math.abs(T-u)<2&&T!=I&&Math.abs(S-s)<2&&S!=D){var M=C._graphic.getLeftTop(C._map.draggableGroup);
var L=T-C._$container.offset().left-M.x;var K=S-C._$container.offset().top-M.y;var R=C._map.getCursorLocation();
C.currentPoint=null;e.tool.WhiteBoardTool.showDialog(t,C);var V=1;var U=0;if(!e.browser.touchSupported&&!e.gv.isWin8Touch){V=parseFloat(e.$("#_wb_orienx"+F).val());
U=parseFloat(e.$("#_wb_orieny"+F).val());if(isNaN(V)){V=1;}if(isNaN(U)){U=0;}}C.currentPoint=new e.geometry.Point(R.getX(),R.getY(),R.srid,V,U);
if(C.toolFeature){W.removeFeature(C.toolFeature);}if(C.textFeature){var P=C.textFeature;if(P.saved){if(P.editable){P.parentLayer.deselectFeature(P);
}else{if(P.old){P.setText(P.old.text);P.setRenderingStyle(P.old.style);}}P=null;C.textFeature=null;}else{W.removeFeature(P);
}}C.toolFeature=new e.Feature("_wb_point_"+(new Date()).getTime(),C.currentPoint,{renderingStyle:e.tool.WhiteBoardTool.pointStyle});
if(!e.browser.touchSupported&&!e.gv.isWin8Touch){C.toolFeature.addListener(e.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,function(Y){var Z=Y.angle;
var X=Z<=Math.PI/2&&Z>=-Math.PI/2?1:-1;var aa=Math.tan(Z)*X;e.$("#_wb_orienx"+F).val(X);e.$("#_wb_orieny"+F).val(aa);
});C.addEventLisenterButtons();}W.addFeature(C.toolFeature);W.selectFeature(C.toolFeature);C.toolFeature.tool=C;
}I=T;D=S;};},start:function(){var t=e.event.ToolEvent;this.clear();if(e.browser.touchSupported){this._$container.bind("touchstart",this.downEventAction);
this._$container.bind("touchend",this.newShapePoint);}else{this._$container.bind("mousedown",this.downEventAction);
this._$container.bind("click",this.newShapePoint);}this.status=e.tool.Tool.STARTED;this._map.currentTool=this;
var s=new t(t.TOOL_START,this);this.fire(s.type,s);return this;},clear:function(){this.clearAll();},finish:function(){this._$container.unbind("mousedown",this.downEventAction);
this._$container.unbind("click",this.newShapePoint);this._$container.unbind("touchstart",this.downEventAction);
this._$container.unbind("touchend",this.newShapePoint);var v=this._map.getToolFeatureLayer();if(this.toolFeature){v.removeFeature(this.toolFeature);
}this.toolFeature=null;if(this._map.$dialog.dialog("isOpen")){this._map.$dialog.dialog("close");}var s=this.allTextFeatures.length;
for(var u=0;u<s;u++){var t=this.allTextFeatures[u];t.enableEditing=null;}return this;},clearAll:function(){var v=this._map.getToolFeatureLayer();
var s=this.allTextFeatures.length;for(var u=s-1;u>=0;u--){var t=this.allTextFeatures.pop();v.removeFeature(t);
v.refresh();}},getTextStyle:function(){var v;if(!e.browser.touchSupported&&!e.gv.isWin8Touch){var w=this._map.mapInstanceId;
var t=e.$("#_wb_weight"+w)[0].down?"BOLD":"NORMAL";var x=e.$("#_wb_style"+w)[0].down?"ITALIC":"NORMAL";
var y=e.$("#_wb_valign_bottom"+w)[0].down?"BOTTOM":e.$("#_wb_valign_top"+w)[0].down?"TOP":"CENTERV";var s=e.$("#_wb_halign_left"+w)[0].down?"LFET":e.$("#_wb_halign_right"+w)[0].down?"RIGHT":"CENTER";
var u=e.tool.WhiteBoardTool;v={fontFamily:u.currentFontFamily,fontSize:u.currentSize,fill:u.currentColor,fontWeight:t,fontStyle:x,vAlign:y,hAlign:s};
}else{v={fontSize:e.tool.WhiteBoardTool.currentSize};}return new e.style.Text(v);},addText:function(s){var t=this._map.mapInstanceId;
var x=e.$("#_wb_text"+t).val();var w=this.getTextStyle();var v=this._map.getToolFeatureLayer();if(this.textFeature!==this.toolFeature){v.removeFeature(this.toolFeature);
}if(this.textFeature){var u=this.textFeature;if(!u.old){u.old={text:this.textFeature.getText(),style:this.textFeature.getRenderingStyle(),point:this.textFeature.getGeometry()};
}u.setText(x);u.setRenderingStyle(w);u.screenPoints=null;u.setGeometry(s);v.deselectFeature(u);}else{var y="_wb_textfeature_"+(new Date()).getTime();
this.toolFeature=new e.TextFeature(y,s,x,w);this.toolFeature.tool=this;v.addFeature(this.toolFeature);
}},addEventLisenterButtons:function(){this._map.hAlignGroup.attachEvents();this._map.vAlignGroup.attachEvents();
this._map.weightBut.attachEvents();this._map.styleBut.attachEvents();},getAllTextFeatures:function(){return this.allTextFeatures;
},saveToLS:function(t){if(!localStorage){e.util.Logger.alert("MAPVIEWER_9041","OM.tool.WhiteBoardTool.saveToLS");
return;}if(e.isNull(t)||t===""){return;}var w=this.getAllTextFeatures();var s=w?w.length:0;if(s===0){return;
}var v=[];for(var u=0;u<s;u++){v.push(w[u].toJSON());}localStorage[t]=JSON.stringify(v);}});e.tool.WhiteBoardTool.pointStyle=new e.style.Marker({width:20,height:20,vectorDef:[{shape:{type:"path",coords:[[0,7,0,13,10,13,10,20,20,10,10,0,10,7,0,7]],width:20,height:20},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});
e.tool.WhiteBoardTool.textFeatureIdSeq=0;e.tool.WhiteBoardTool.fontFamilyArray=new Array("Arial","Bookman Old Style","Courier New","Garamond","Lucida Console","Symbol","Tahoma","Times New Roman","Verdana");
e.tool.WhiteBoardTool.currentFontFamily="Arial";e.tool.WhiteBoardTool.genFontFamily=function(w){var u='<select id="_wb_fontfamily'+w+'" onchange="OM.tool.WhiteBoardTool.setFontFamily('+w+')">';
var v="";var s=e.tool.WhiteBoardTool.fontFamilyArray.length;for(var t=0;t<s;t++){if(e.tool.WhiteBoardTool.fontFamilyArray[t]==e.tool.WhiteBoardTool.currentFontFamily){v="selected=true";
}else{v="";}u+="<option "+v+' value="'+e.tool.WhiteBoardTool.fontFamilyArray[t]+'">'+e.tool.WhiteBoardTool.fontFamilyArray[t]+"</option>";
}u+="</select>";return u;};e.tool.WhiteBoardTool.setFontFamily=function(t){var s=e.$("#_wb_fontfamily"+t).val();
e.tool.WhiteBoardTool.currentFontFamily=s;};e.tool.WhiteBoardTool.addFont=function(t){var s=MVAnnotationTool.fontFamilyArray.length-1;
for(var u=0;u<s;u++){if(e.tool.WhiteBoardTool.fontFamilyArray[u]==t){return;}if(e.tool.WhiteBoardTool.fontFamilyArray[u]<t&&e.tool.WhiteBoardTool.fontFamilyArray[u+1]>t){e.tool.WhiteBoardTool.fontFamilyArray.splice(u+1,0,t);
return;}}e.tool.WhiteBoardTool.fontFamilyArray.push(t);};e.tool.WhiteBoardTool.removeFont=function(t){var s=e.tool.WhiteBoardTool.fontFamilyArray.length-1;
for(var u=0;u<s;u++){if(e.tool.WhiteBoardTool.fontFamilyArray[u]==t){e.tool.WhiteBoardTool.fontFamilyArray.splice(u,1);
return;}}};e.tool.WhiteBoardTool.genSizes=function(v){var t='<select id="_wb_fontsize'+v+'" onchange="OM.tool.WhiteBoardTool.setSize('+v+')">';
var u="";for(var s=5;s<50;s++){if(s==e.tool.WhiteBoardTool.currentSize){u="selected=true";}else{u="";
}t+="<option "+u+' value="'+s+'px">'+s+"px</option>";}t+="</select>";return t;};e.tool.WhiteBoardTool.setSize=function(t){var s=e.$("#_wb_fontsize"+t).val();
e.tool.WhiteBoardTool.currentSize=parseInt(s,10);};e.tool.WhiteBoardTool.genColor=function(u){var t=e.tool.WhiteBoardTool;
var s='<div id="_wb_color'+u+'" style="background: url(\''+t.color_picker_icon+"') ";s+="repeat scroll center center transparent; height: 16px;left: 4px;top: 4px;width: 16px;background-color: ";
s+=t.currentColor+'"></div>';return s;};e.tool.WhiteBoardTool.showDialog=function(v,t,s){var u=t._map.getToolFeatureLayer();
if(s){t.textFeature=s;s.addListener(e.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,function(z){var A=z.angle;
var w=A<=Math.PI/2&&A>=-Math.PI/2?1:-1;var B=Math.tan(A)*w;e.$("#_wb_orienx"+t._map.mapInstanceId).val(w);
e.$("#_wb_orieny"+t._map.mapInstanceId).val(B);});t.currentPoint=s.getGeometry().clone();if(t.textFeature!==t.toolFeature){u.removeFeature(t.toolFeature);
}}v.$dialog.dialog({position:{of:v.$oracleMapDiv,at:"center"},resizable:false,width:e.browser.touchSupported||e.gv.isWin8Touch?450:510,height:e.browser.touchSupported||e.gv.isWin8Touch?190:230,buttons:[{closeOnEscape:true,text:e.gv.getLabel("MAPVIEWER_WB_OK"),click:function(){if(s){var x=e.$("#_wb_text"+v.mapInstanceId).val();
s.setText(x);var w=t.getTextStyle();s.setRenderingStyle(w);s.screenPoints=null;s.setGeometry(t.currentPoint);
u.deselectFeature(s);s.old=null;t.toolFeature=null;t.textFeature=null;}else{t.addText(t.currentPoint);
t.toolFeature.tool=t;t.toolFeature.saved=true;t.allTextFeatures.push(t.toolFeature);t.toolFeature.old=null;
t.toolFeature=null;}e.$(this).dialog("close");}},{text:e.gv.getLabel("MAPVIEWER_WB_PREVIEW"),click:function(){t.addText(t.currentPoint);
}}],close:function(w,x){t.currentEditingFeature=null;if(t.toolFeature){u.removeFeature(t.toolFeature);
}if(s){if(s.old){s.setText(s.old.text);s.setRenderingStyle(s.old.style);s.setGeometry(s.old.point);}if(s.parentLayer){s.parentLayer.deselectFeature(s);
}}t.toolFeature=null;t.textFeature=null;}});if(!e.browser.touchSupported&&!e.gv.isWin8Touch){v.$dialog.parent().draggable("option","containment",v.$oracleMapDiv);
e.$("#_wb_color"+v.mapInstanceId).ColorPicker({color:"#000000",onShow:function(w){e.$(w).fadeIn(500);
return false;},onHide:function(w){e.$(w).fadeOut(500);return false;},onChange:function(w,y,x){e.$("#_wb_color"+v.mapInstanceId).css("backgroundColor","#"+y);
e.tool.WhiteBoardTool.currentColor="#"+y;},onSubmit:function(w,z,x,y){e.tool.WhiteBoardTool.currentColor="#"+z;
e.$(y).ColorPickerHide();}});}if(s){e.$("#_wb_text"+v.mapInstanceId).val(s.getText());}else{e.$("#_wb_text"+v.mapInstanceId).val("");
}};e.tool.WhiteBoardTool.currentSize=15;e.tool.WhiteBoardTool.currentColor="#000000";e.tool.WhiteBoardTool.setIconsPath=function(){var t=e.gv.resourcePath()+"txt/",s=e.tool.WhiteBoardTool;
s.color_picker_icon=t+"func_text_color_16_ena.png";s.img_bold_ena=t+"func_bold_16_ena.png";s.img_bold_ovr=t+"func_bold_16_hov.png";
s.img_bold_dwn=t+"func_bold_16_act.png";s.img_italic_ena=t+"func_italic_16_ena.png";s.img_italic_ovr=t+"func_italic_16_hov.png";
s.img_italic_dwn=t+"func_italic_16_act.png";s.img_leftalign_ena=t+"func_leftalign_16_ena.png";s.img_leftalign_ovr=t+"func_leftalign_16_hov.png";
s.img_leftalign_dwn=t+"func_leftalign_16_act.png";s.img_centeralign_ena=t+"func_centeralign_16_ena.png";
s.img_centeralign_ovr=t+"func_centeralign_16_hov.png";s.img_centeralign_dwn=t+"func_centeralign_16_act.png";
s.img_rightalign_ena=t+"func_rightalign_16_ena.png";s.img_rightalign_ovr=t+"func_rightalign_16_hov.png";
s.img_rightalign_dwn=t+"func_rightalign_16_act.png";s.img_bottomalign_ena=t+"bottomalignment_ena.png";
s.img_bottomalign_ovr=t+"bottomalignment_ovr.png";s.img_bottomalign_dwn=t+"bottomalignment_dwn.png";s.img_centervalign_ena=t+"centeralignment_ena.png";
s.img_centervalign_ovr=t+"centeralignment_ovr.png";s.img_centervalign_dwn=t+"centeralignment_dwn.png";
s.img_topalign_ena=t+"topalignment_ena.png";s.img_topalign_ovr=t+"topalignment_ovr.png";s.img_topalign_dwn=t+"topalignment_dwn.png";
};e.tool.WhiteBoardTool.setIconsPath();e.tool.WhiteBoardTool.loadFromLS=function(s){if(!localStorage){e.util.Logger.alert("MAPVIEWER_9041","OM.tool.WhiteBoardTool.loadFromLS");
return;}if(e.isNull(s)||s===""){return;}var y=localStorage[s];if(e.isNull(y)||y===""){return;}var z=e.$.parseJSON(y);
if(!z.length){return;}var t=[];for(var v=0,w=z.length;v<w;v++){var u=z[v];var A=e.geometry.Geometry.createGeometry(u.geometry,u.geometry.srid);
var x=new e.style.Text(u.styleConfig);var B=new e.TextFeature(u.id,A,z[v].text,x);t.push(B);}return t;
};e.tool.DuplicateTool=e.tool.Tool.extend({initialize:function b(u,s){b.base.call(this,u);var t=this;
this.feature=s;if(e.isNull(s)){e.util.Logger.alert("MAPVIEWER_9054","OM.tool.DuplicateTool.initialize","");
this.clear();return;}this.mouseDown=function(v){if(v.button===0){}v.stopPropagation();};this.mouseUp=function(F){if(e.isNull(F)){return;
}if(t.status==e.tool.Tool.STOPPED||t.status==e.tool.Tool.FINISHED){return;}if(e.isNull(t.feature)||e.isNull(t.feature.getGeometry())||e.isNull(t.feature.parentLayer)||e.isNull(t.feature.parentLayer.changeManager)){return;
}var y=t.feature.getGeometry();var G=y.getMBR();if(e.isNull(G)){return;}var z=u.getScreenPointLocation(t._map.mLocX,t._map.mLocY);
var v=G.getCenter();var C=z.coordinates[0]-v.coordinates[0];var B=z.coordinates[1]-v.coordinates[1];var A=y.clone(true);
e.util.GeomUtil.moveGeometry(A,C,B);var I=Math.floor((Math.random()*10000)+1);var x="dup_"+I.toString();
var w=new e.Feature(x,A);var D=t.feature.parentLayer;var E=D.changeManager.addFeature(w.id,w);if(e.notNull(E)){D.getUndoManager().addEdit({changeManager:D.changeManager,editChangeEvent:E,canUndo:function(){return true;
},canRedo:function(){return true;},getPresentationName:function(){return"feature added";},undo:function(){this.changeManager.undo(this.editChangeEvent);
},redo:function(){this.changeManager.redo(this.editChangeEvent);}});}};this.touchStart=function(x){var w=e.util.DomUtil;
var v=w.getTouchCount(x);if(v==1){x.button=0;var y=w.getTouchesPosition(x);t.touchPos=y;x.pageX=y.x;x.pageY=y.y;
}else{if(v==2){x.button=2;}else{return;}}t.mouseDown(x);};this.touchEnd=function(v){if(t.touchPos){v.pageX=t.touchPos.x;
v.pageY=t.touchPos.y;t.mouseUp(v);}};this.finish=function(){if(t.status!=e.tool.Tool.STARTED){return;
}var v=true;if(!e.browser.touchSupported&&!e.gv.isWin8Touch){v=false;}t._$container.unbind("mouseup",t.mouseUp);
t._$container.unbind("mousedown",t.mouseDown);if(e.gv.isWin8Touch){t._$container[0].removeEventListener("MSPointerUp",t.mouseUp);
t._$container[0].removeEventListener("MSPointerDown",t.mouseDown);}if(e.browser.touchSupported){t._$container.unbind("touchstart",t.touchStart);
t._$container.unbind("touchend",t.touchEnd);}t.status=e.tool.Tool.FINISHED;t._map.enableMapAction.dbclick=true;
t._map.enableMapAction.mouse=true;t._map.enableMapAction.drag=true;};},start:function(){var t=e.event.ToolEvent;
this.clear();this._map.enableMapAction.dbclick=false;this._map.enableMapAction.mouse=false;if(!this._group){this._group=this._graphic.createGroup();
this._graphic.addGroup(this._group,this._map.draggableGroup);}this._map.on(e.event.MapEvent.MAP_BEFORE_ZOOM,this.zoomAction,this);
var s=true;if(!e.browser.touchSupported&&!e.gv.isWin8Touch){s=false;}this._$container.bind("mouseup",this.mouseUp);
this._$container.bind("mousedown",this.mouseDown);if(e.gv.isWin8Touch){this._$container[0].addEventListener("MSPointerUp",this.mouseUp);
this._$container[0].addEventListener("MSPointerDown",this.mouseDown);}if(e.browser.touchSupported){this._$container.bind("touchstart",this.touchStart);
this._$container.bind("touchend",this.touchEnd);}this.status=e.tool.Tool.STARTED;this.fire(t.type,t);
return this;},end:function(){},clear:function(){this.finish();this.clear_base();}});h.OM=e;})(window);
